diff -Nur -x CVS passepartout-0.6/configure.ac passepartout/configure.ac
--- passepartout-0.6/configure.ac	2004-10-30 17:33:39.000000000 +0200
+++ passepartout/configure.ac	2005-04-18 16:35:46.000000000 +0200
@@ -1,16 +1,16 @@
 # Process this file with autoconf to produce a configure script.
-AC_INIT(Passepartout, 0.6, [passepartout@stacken.kth.se])
+AC_INIT(Passepartout, 0.7-PRE, [passepartout@stacken.kth.se])
 AC_CONFIG_SRCDIR([src/xml2ps/blockcontainer.cc])
 
 AM_INIT_AUTOMAKE([foreign dist-bzip2])
 # For automake < 1.6 you need to use this line instead:
-#AM_INIT_AUTOMAKE(Passepartout, 0.6)
+#AM_INIT_AUTOMAKE(Passepartout, 0.7-PRE)
 
 AM_CONFIG_HEADER(src/defines.h)
 # AC_CONFIG_HEADER(src/defines.h)
 
 # Define global compiler flags:
-MY_CXXFLAGS="-Wall -Wold-style-casts"
+MY_CXXFLAGS="-Wall"
 CXXFLAGS="$CXXFLAGS $MY_CXXFLAGS"
 
 # Checks for programs.
@@ -27,44 +27,45 @@
 fi])
 AC_ARG_VAR([APPLY_RPATH], [="true" : specify -rpath options to the linker])
 
-LIBS="$LIBS -L/mpkg/gettext/0.12.1/lib"
-
 # check for libxml++ 
 AC_SUBST([XMLPP_LIBS])
 AC_SUBST([XMLPP_CFLAGS])
-PKG_CHECK_MODULES([XMLPP], libxml++-1.0)
+PKG_CHECK_MODULES([XMLPP], libxml++-1.0 >= 1.0)
 AC_APPLY_RPATH([XMLPP_LIBS])
 
-AC_SUBST([XML2_LIBS])
-AC_SUBST([XML2_CFLAGS])
-PKG_CHECK_MODULES(XML2, libxml-2.0)
-AC_APPLY_RPATH([XML2_LIBS])
-
 AC_SUBST([GTKMM_LIBS])
 AC_SUBST([GTKMM_CFLAGS])
-PKG_CHECK_MODULES(GTKMM, gtkmm-2.0)
+PKG_CHECK_MODULES(GTKMM, gtkmm-2.4)
 AC_APPLY_RPATH([GTKMM_LIBS])
 
 AC_SUBST([GNOMECANVAS_LIBS])
 AC_SUBST([GNOMECANVAS_CFLAGS])
-PKG_CHECK_MODULES(GNOMECANVAS, libgnomecanvasmm-2.0)
-AC_APPLY_RPATH([XMLPP_LIBS])
+PKG_CHECK_MODULES(GNOMECANVAS, libgnomecanvasmm-2.6)
+AC_APPLY_RPATH([GNOMECANVAS_LIBS])
 
 AC_SUBST([GTHREAD_LIBS])
 AC_SUBST([GTHREAD_CFLAGS])
 PKG_CHECK_MODULES([GTHREAD], [gthread-2.0])
 AC_APPLY_RPATH([GTHREAD_LIBS])
 
-AC_SUBST([SIGC_LIBS])
-AC_SUBST([SIGC_CFLAGS])
-PKG_CHECK_MODULES([SIGC], [sigc++-1.2])
-AC_APPLY_RPATH([SIGC_LIBS])
-
 AC_SUBST([FREETYPE_LIBS])
 AC_SUBST([FREETYPE_CFLAGS])
 PKG_CHECK_MODULES([FREETYPE], [freetype2])
 AC_APPLY_RPATH([FREETYPE_LIBS])
 
+# gnome is optional
+AC_SUBST([GNOME_LIBS])
+AC_SUBST([GNOME_CFLAGS])
+AC_SUBST([GNOMEVFS_LIBS])
+AC_SUBST([GNOMEVFS_CFLAGS])
+AC_ARG_WITH([gnome], AC_HELP_STRING([--with-gnome],
+                                    [Gnome support (default is NO)]),
+            [PKG_CHECK_MODULES(GNOME, libgnome-2.0)]
+            [PKG_CHECK_MODULES(GNOMEVFS, gnome-vfs-module-2.0)]
+            AC_DEFINE([HAVE_GNOME], [1], [Gnome is present]))
+AC_APPLY_RPATH([GNOME_LIBS])
+AC_APPLY_RPATH([GNOMEVFS_LIBS])
+
 # check for fam
 AC_CHECK_LIB([fam], [FAMOpen])
 
diff -Nur -x CVS passepartout-0.6/DEVNOTES passepartout/DEVNOTES
--- passepartout-0.6/DEVNOTES	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/DEVNOTES	2004-10-30 14:29:15.000000000 +0200
@@ -0,0 +1,45 @@
+Notes for Passepartout developers
+---------------------------------
+
+*** automake/autoconf ***
+
+Needs automake >= 1.6 or AM_INIT_AUTOMAKE won't work.
+Perhaps we should use version 1.5 instead. (Gentoo installs 1.4, 1.5
+and 1.6 but sets 1.5 as default.)
+
+As far as autoconf is concerned, both version 2.13 and 2.5x seem to
+work fine.
+
+The process:
+
+1. aclocal 	# install macros that will be needed
+2. automake -a	# "-a" means "add missing files"
+3. autoconf
+
+You should now have a ./configure script.
+
+
+Checklist for making a release
+------------------------------
+
+* Update Copyright notices in all source files, in the about box and
+in COPYING.
+
+* Update NEWS.
+
+* Update User's Guide, and man pages.
+
+* Update README, INSTALL, AUTHORS, BUGS
+
+* Update version number in configure.ac and doc/users_guide.xml
+
+* Check out a fresh copy (or make sure you have no uncommitted
+changes), then do "make dist".
+
+* Make a cvs tag PASSEPARTOUT_X_Y.
+
+* Check the dist files for omissions. Check that they build, install and run.
+
+* Update web page and send a mail to passepartout-announce@stacken.kth.se.
+
+* Make a freshmeat release and a GnomeFiles release.
diff -Nur -x CVS passepartout-0.6/devutils/copyright.py passepartout/devutils/copyright.py
--- passepartout-0.6/devutils/copyright.py	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/devutils/copyright.py	2002-11-05 02:11:53.000000000 +0100
@@ -0,0 +1,88 @@
+#! /usr/bin/env python
+
+# copyright.py
+# Insert copyright information into source code.
+
+# Looks at every C++ file (.cc, .h, .hh) in the current directory and
+# recursively in the subdirectories to see if it has two comments
+# "///".  If it does, the text between the comments is substituted for
+# the text in the file specified on the command line. Does not follow
+# symlinks.  Todo: make it insert a copyright message into this file
+# as well :-)
+
+import sys
+import re
+import os
+import stat
+
+add=0 # add tags to beginning of file instead of substituting
+
+if len(sys.argv)!=2:
+    sys.stderr.write("Usage: copyright.py <message file>\n")
+    sys.stderr.write("   or: copyright.py -a\n   to add tags\n")
+    sys.exit(2)
+
+def parse_message(message):
+    message=re.sub("\n$", "", message) # remove newline on last line
+    message=re.sub("(?m)^", "// ", message) # commentify
+    message="///\n"+message+"\n///\n" # add begin/end tag
+    return message
+
+if sys.argv[1]=="-a": # "add" flag
+    add=1
+else:
+    try:
+        message_file=open(sys.argv[1])
+        message=message_file.read()
+        parsed_message=parse_message(message)
+    except IOError:
+        sys.stderr.write("Couldn't read "+sys.argv[1]+"\n")
+        sys.exit(2)
+
+
+def substitute(filename, add):
+    file=open(filename, "r+")
+    sys.stderr.write(filename)
+    file_content=file.read() # one big string
+    # Check for two lines beginning with "///" and replace everything
+    # in between:
+    if add:
+        file_content="///\n///\n"+file_content
+        file.seek(0)
+        file.write(file_content)
+    else:
+        (file_content, num)=re.subn("(?ms)^\/\/\/.*^\/\/\/[^\n]*\n",
+                                    parsed_message,
+                                    file_content)
+        if num==1: # check if a substitution was made
+            file.seek(0)
+            file.write(file_content)
+        else:
+            sys.stderr.write(": nothing changed")
+    sys.stderr.write("\n")
+    file.close()
+
+filetypes=(".cc", ".h", ".hh") # file types to modify
+
+def correct_filetype(filename):
+    for filetype in filetypes:
+        if filename[-len(filetype):]==filetype:
+            return 1
+    return 0
+
+from os.path import *
+def recursive_substitute(path):
+    files=os.listdir(path)
+    for file in files:
+        file=path+"/"+file
+        # Don't follow links!
+        if isdir(file) and not islink(file):
+            recursive_substitute(file)
+        elif isfile(file) and (not islink(file)) and correct_filetype(file):
+            # It's a file,
+            substitute(file, add)
+        else:
+            pass
+
+recursive_substitute(".")
+
diff -Nur -x CVS passepartout-0.6/devutils/copyright.txt passepartout/devutils/copyright.txt
--- passepartout-0.6/devutils/copyright.txt	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/devutils/copyright.txt	2003-02-26 01:29:10.000000000 +0100
@@ -0,0 +1 @@
+Copyright (C) 2002, 2003, Fredrik Arnerup & Rasmus Kaj, See COPYING
diff -Nur -x CVS passepartout-0.6/doc/faq.xml passepartout/doc/faq.xml
--- passepartout-0.6/doc/faq.xml	2004-09-19 17:58:56.000000000 +0200
+++ passepartout/doc/faq.xml	2004-12-02 22:41:52.000000000 +0100
@@ -4,7 +4,7 @@
 <article>
   <articleinfo>
     <title>Passepartout Frequently Asked Questions</title>
-    <releaseinfo>$Id$</releaseinfo>
+    <releaseinfo>$Id$</releaseinfo>
   </articleinfo>
   
   <section>
@@ -63,7 +63,8 @@
 	API. Versions prior to 0.4 will only be guaranteed to build
 	with <emphasis>exactly</emphasis> the version or versions of
 	libxml++ that are specified in the
-	<filename>INSTALL</filename> file.
+	<filename>INSTALL</filename> file. No version have yet been
+	built against the libxml++ 2.6 branch.
       </para>
     </section>
 
@@ -145,8 +146,7 @@
     <section>
       <title>Is there no TrueType support?</title>
       <para>
-	No. PostScript Type 1 only, but we will have at least partial
-	TrueType support in release 0.6.
+	Yes there is, as of version 0.6.
       </para>
     </section>
 
diff -Nur -x CVS passepartout-0.6/doc/README passepartout/doc/README
--- passepartout-0.6/doc/README	2002-11-22 02:30:20.000000000 +0100
+++ passepartout/doc/README	2004-12-02 22:45:12.000000000 +0100
@@ -2,18 +2,15 @@
 The documentation is also available online: 
 http://www.stacken.kth.se/project/pptout/doc.shtml
 
-Documentation in DocBook and HTML formats:
+Documentation in DocBook, HTML and .txt formats:
 
-	users_guide.xml
-	users_guide.html
-	faq.xml
-	faq.html
-	nsfaq.xml	
-	nsfaq.html
+	users_guide.*
+	faq.*
+	nsfaq.*
 
 User's guide in Passepartout layout format:
 
-	users_guide.ppt
+	users_guide.pp
 
 xml2ps markup example:
 
@@ -21,4 +18,8 @@
 
 Layout example:
 	
-	examples/example1.ppt
+	examples/example1.pp
+
+Unicode example:
+
+	examples/multilingual.pp
diff -Nur -x CVS passepartout-0.6/doc/users_guide.xml passepartout/doc/users_guide.xml
--- passepartout-0.6/doc/users_guide.xml	2004-10-30 14:24:11.000000000 +0200
+++ passepartout/doc/users_guide.xml	2004-12-02 22:35:38.000000000 +0100
@@ -3,7 +3,7 @@
 	"http://www.oasis-open.org/docbook/xml/4.1.2/docbookx.dtd"> 
 <article>
   <articleinfo>
-    <title>Passepartout 0.6 User's Guide</title>
+    <title>Passepartout 0.7 User's Guide</title>
   </articleinfo>
 
   <graphic fileref="pptout.png"/>
@@ -397,6 +397,10 @@
       with default values for all settings.
       If you want to, you can change these settings.</para>
 
+    <para><emphasis>Note: you should not edit this file while
+    Passepartout is running, because it will be overwritten when the
+    program ends.</emphasis></para>
+
     <variablelist>
       <title>Settings that may be of interest:</title>
 
@@ -421,11 +425,6 @@
       </varlistentry>
       
       <varlistentry>
-	<term><varname>PSViewer</varname></term>
-	<listitem><para>PostScript viewer. (Default is
-	<command>gv</command>.)</para></listitem></varlistentry>
-      
-      <varlistentry>
 	<term><varname>PrintCommand</varname></term>
 	<listitem><para>Default command used for printing. (Default is
 	<command>lpr</command>.)</para></listitem></varlistentry>
diff -Nur -x CVS passepartout-0.6/INSTALL passepartout/INSTALL
--- passepartout-0.6/INSTALL	2004-10-30 14:37:40.000000000 +0200
+++ passepartout/INSTALL	2004-12-16 22:00:18.000000000 +0100
@@ -1,6 +1,6 @@
 INSTALLING PASSEPARTOUT 
 -----------------------
-Fredrik Arnerup, 30 Oct 2004
+Fredrik Arnerup, 16 December 2004
 Report problems to <passepartout@stacken.kth.se>
 
 Passepartout has so far been successfully built on Linux, FreeBSD and
@@ -12,13 +12,13 @@
 Requirements
 ------------
 
-Make sure you have gtkmm-2.2.x, libgnomecanvasmm-2.0.x
+Make sure you have gtkmm-2.4.x, libgnomecanvasmm-2.6.x
 (http://gtkmm.sourceforge.net), and libxml++ 1.0.x
 (http://sourceforge.net/projects/libxmlplusplus/) properly installed
-(later versions will *not* work!) and that you are using at least
-gcc-3.2. You will need xsltproc (http://xmlsoft.org/XSLT/xsltproc2.html)
-and Ghostscript to run Passepartout. A postscript viewer (e.g. gv) is
-recommended.
+and that you are using at least gcc-3.2. You will need xsltproc
+(http://xmlsoft.org/XSLT/xsltproc2.html) and Ghostscript to run
+Passepartout. The gv postscript viewer is recommended. If you want
+Gnome support, then you will need libgnome and gnome-vfs.
 
 
 Building and installing
@@ -30,7 +30,7 @@
 http://www.stacken.kth.se/project/pptout/files/.
 Check http://www.stacken.kth.se/project/pptout/items.html for news.
 
-./configure
+./configure (--with-gnome if you want Gnome support)
 make
 make install
 
diff -Nur -x CVS passepartout-0.6/logotype/pptout.eps passepartout/logotype/pptout.eps
--- passepartout-0.6/logotype/pptout.eps	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/logotype/pptout.eps	2002-11-05 02:12:07.000000000 +0100
@@ -0,0 +1,1396 @@
+%!PS-Adobe-3.0 EPSF-3.0
+%%Creator: Fredrik Arnerup
+%%CreationDate: D:20020930182227
+%%LanguageLevel: 2
+%%Pages: 1
+%%BoundingBox: 0 90 390 450
+%%PageOrder: Ascend
+%%Title: Passepartout logotype
+%%DocumentSuppliedResources: procset gnome-print-procs-0.34
+%%EndComments
+%%BeginProlog
+%%BeginResource: procset gnome-print-procs-0.34
+/|/def load def/,/load load
+|/n/newpath , |/m/moveto , |/l/lineto , |/c/curveto ,
+|/q/gsave , |/Q/grestore , |/rg/setrgbcolor , |/J/setlinecap ,
+|/j/setlinejoin , |/w/setlinewidth , |/M/setmiterlimit ,
+|/d/setdash , |/i/pop , |/W/clip , |/W*/eoclip , |/n/newpath ,
+|/S/stroke , |/f/fill , |/f*/eofill , |/Tj/show , |/Tm/moveto ,
+|/FF/findfont ,
+|/h/closepath , |/cm/concat , |/rm/rmoveto , |/sp/strokepath ,
+|/SP/showpage , |/p/pop , |/EX/exch , |/DF/definefont , |
+/F {scalefont setfont} def
+%%EndResource
+%%EndProlog
+%%BeginSetup
+%%EndSetup
+%%Page: Passepartout 1
+%%PageResources: (atend)
+
+%0 setgray
+%/ww 350 def
+%/hh 420 def
+%/ox 20 def
+%/oy 10 def
+%ox oy moveto
+%0 hh rlineto
+%ww 0 rlineto
+%0 hh neg rlineto
+%closepath
+%stroke
+
+% *** Scissors ***
+
+-70 40 translate
+
+q
+q
+q
+q
+0.5 0.5 0.5 rg
+252.38 281.318 m
+194.543 244.158 193.957 243.28 166.031 220.817 c
+168.081 229.967 163.633 238.374 157.532 246.32 c
+140.805 266.462 113.331 251 100.659 241.247 c
+88.7817 232.1 65.3508 209.423 84.2651 183.53 c
+103.975 158.243 132.65 177.627 143.052 185.545 c
+152.659 192.856 156.177 196.79 167.685 209.319 c
+170.525 212.349 213.809 240.656 217.853 242.473 c
+231.015 248.46 243.936 242.073 249.254 242.495 c
+279.613 262.684 432.338 390.178 427.966 397.358 c
+420.496 398.356 260.316 286.429 252.38 281.318 c
+h
+106.011 234.271 m
+89.2629 221.525 82.5024 202.203 90.9205 191.142 c
+99.3386 180.082 119.763 181.45 136.511 194.196 c
+153.259 206.942 160.02 226.264 151.602 237.325 c
+143.183 248.386 122.759 247.018 106.011 234.271 c
+h
+eofill
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+160.272 214.508 m
+159.611 227.284 164.394 225.925 157.415 237.578 c
+159.53 233.409 166.148 225.883 160.272 214.508 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+94.4089 226.042 m
+84.8204 220.641 82.5795 205.796 83.8961 199.466 c
+84.6587 209.584 88.6993 220.649 94.4089 226.042 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.298 0.298 0.298 rg
+252.38 281.318 m
+194.543 244.158 213.809 240.656 217.853 242.473 c
+231.015 248.46 243.936 242.073 249.254 242.495 c
+279.613 262.684 432.338 390.178 427.966 397.358 c
+420.496 398.356 260.316 286.429 252.38 281.318 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+223.583 261.914 m
+217.853 242.473 l
+211.564 239.958 211.647 244.28 211.061 246.566 c
+210.891 248.797 214.861 257.058 223.583 261.914 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+q
+0.5 0.5 0.5 rg
+271.623 283.151 m
+329.17 245.544 329.749 244.661 357.5 221.983 c
+355.52 231.148 360.034 239.52 366.197 247.419 c
+383.079 267.43 410.432 251.756 423.028 241.905 c
+434.834 232.665 458.088 209.807 438.974 184.062 c
+419.068 158.929 390.545 178.535 380.204 186.533 c
+370.654 193.919 367.167 197.879 355.756 210.497 c
+352.94 213.55 309.877 242.191 305.847 244.04 c
+292.733 250.129 279.762 243.842 274.448 244.305 c
+244.245 264.729 92.5152 393.405 96.9421 400.551 c
+104.42 401.491 263.726 288.324 271.623 283.151 c
+h
+417.622 234.971 m
+434.27 222.095 440.88 202.722 432.377 191.726 c
+423.873 180.731 403.46 182.258 386.811 195.134 c
+370.163 208.01 363.552 227.383 372.056 238.378 c
+380.56 249.374 400.973 247.847 417.622 234.971 c
+h
+eofill
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.8 0.8 0.8 rg
+247.23 277.76 m
+204.041 310.124 118.546 379.284 99.692 399.554 c
+113.868 395.196 193.268 338.913 258.024 292.655 c
+247.23 277.76 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+259.06 287.79 m
+261.044 290.786 338.092 234.529 355.658 218.903 c
+357.875 216.968 356.112 221.3 357.933 220.663 c
+359.798 217.34 359.315 215.591 361.736 212.594 c
+343.241 228.864 320.305 244.891 298.19 260.068 c
+276.074 275.246 258.222 286.49 259.06 287.79 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+412.902 180.678 m
+402.553 176.148 382.174 192.433 379.926 196.068 c
+388.937 190.556 402.061 181.287 412.902 180.678 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+386.804 251.225 m
+402.193 254.363 417.711 243.159 421.778 237.758 c
+412.073 244.959 397.864 251.833 386.804 251.225 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+q
+0 0 0 rg
+265.19 275.9 m
+267.423 274.173 267.834 270.958 266.107 268.725 c
+264.379 266.492 261.165 266.081 258.931 267.808 c
+256.698 269.535 256.287 272.75 258.015 274.983 c
+259.742 277.217 262.956 277.627 265.19 275.9 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.498 0.498 0.498 rg
+264.464 274.963 m
+266.439 273.435 266.802 270.593 265.275 268.619 c
+263.748 266.644 260.906 266.281 258.931 267.808 c
+256.956 269.335 256.593 272.177 258.12 274.152 c
+259.648 276.127 262.49 276.49 264.464 274.963 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 0 rg
+261.672 267.34 m
+263.206 267.539 l
+262.129 275.823 l
+260.595 275.623 l
+261.672 267.34 l
+h
+f
+Q
+Q
+Q
+Q
+
+% *** Glue ***
+
+0 -10 translate
+q
+q
+q
+q
+q
+0.8 0.8 0.8 rg
+255.288 327.838 m
+234.686 312.947 l
+290.885 311.17 l
+271.764 327.542 l
+255.288 327.838 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.6 0.6 0.6 rg
+258.251 328.727 m
+241.5 311.17 l
+264.218 310.874 l
+265.245 328.134 l
+258.251 328.727 l
+h
+f
+Q
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 1 rg
+293.346 136.224 m
+292.095 142.724 298.608 144.406 298.608 150.548 c
+297.254 157.584 295.55 163.455 297.565 170.431 c
+298.801 177.572 286.02 185.489 286.02 192.724 c
+283.766 194.892 293.911 194.978 293.911 197.544 c
+292.499 208.954 292.867 220.372 292.867 231.887 c
+292.867 239.519 292.867 247.151 292.867 254.782 c
+293.545 262.606 286.569 270.424 286.569 278.28 c
+286.569 285.711 289.4 297.03 289.749 311.359 c
+235.306 313.838 l
+234.853 301.403 232.851 298.08 232.851 290.932 c
+231.712 279.095 236.54 268.96 236.54 257.037 c
+236.54 247.415 231.806 236.018 234.435 226.912 c
+235.28 222.526 231.637 217.413 232.851 213.209 c
+232.851 203.971 232.851 194.733 232.851 185.494 c
+231.241 178.061 234.43 169.727 234.43 162.075 c
+235.544 158.216 234.68 155.66 235.982 151.152 c
+235.982 148.274 236.81 141.942 234.939 139.782 c
+252.251 147.385 287.142 133.364 293.346 136.224 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+q
+1 0 0 rg
+252.918 362.504 m
+245.945 325.984 l
+280.811 325.984 l
+273.838 362.504 l
+252.918 362.504 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+267.732 361.912 m
+271.13 326.28 l
+275.181 326.577 l
+269.986 361.912 l
+267.732 361.912 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.8 0 0 rg
+253.806 362.207 m
+246.834 326.872 l
+259.478 326.577 l
+260.801 362.207 l
+253.806 362.207 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.8 0 0 rg
+263.584 361.911 m
+264.612 326.576 l
+271.626 326.577 l
+267.023 361.911 l
+263.584 361.911 l
+h
+f
+Q
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0.498 0.498 1 rg
+293.871 136.224 m
+292.619 142.724 298.608 144.406 298.608 150.548 c
+297.254 157.584 295.55 163.455 297.565 170.431 c
+298.801 177.572 293.911 194.978 293.911 197.544 c
+292.499 208.954 292.867 220.372 292.867 231.887 c
+292.867 239.519 292.867 247.151 292.867 254.782 c
+293.545 262.606 286.569 270.424 286.569 278.28 c
+286.569 285.711 289.4 297.03 289.749 311.359 c
+252.618 312.789 l
+252.165 300.353 258.556 296.506 244.917 290.408 c
+243.778 278.571 253.326 282.074 246.507 264.906 c
+246.507 255.284 271.152 274.838 247.551 238.978 c
+248.396 234.592 246.326 216.364 247.54 212.16 c
+247.54 202.921 273.246 208.897 273.246 199.658 c
+271.635 192.225 296.06 128.642 293.871 136.224 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 1 rg
+260.846 285.339 m
+256.728 285.339 253.975 279.045 255.224 290.96 c
+261.131 294.504 267.181 295.299 270.841 288.711 c
+270.841 284.59 270.374 281.127 268.342 277.469 c
+266.882 273.526 271.465 267.204 271.465 262.854 c
+268.934 260.576 268.971 257.236 266.468 254.983 c
+266.468 251.883 265.773 248.3 268.342 245.99 c
+268.342 242.379 270.62 240.567 273.339 238.119 c
+273.339 234.169 274.015 229.217 272.09 225.753 c
+272.09 221.99 271.525 218.391 274.588 215.634 c
+273.37 213.442 270.345 207.202 267.717 207.202 c
+265.77 207.953 256.474 216.223 256.474 218.445 c
+256.474 222.014 261.776 221.112 265.844 222.942 c
+267.775 226.418 264.593 230.201 264.593 234.185 c
+264.593 238.639 263.97 242.746 263.97 247.114 c
+263.97 249.697 263.098 254.762 265.219 256.67 c
+265.219 262.691 265.844 268.011 265.844 274.096 c
+264.952 277.306 265.662 279.881 263.344 281.966 c
+262.626 282.613 260.846 283.369 260.846 285.339 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+273.418 301.759 m
+273.604 291.466 l
+273.644 289.224 273.142 287.538 272.096 286.406 c
+271.05 285.266 269.542 284.678 267.574 284.643 c
+265.551 284.606 263.959 285.188 262.797 286.389 c
+261.636 287.58 261.033 289.424 260.988 291.921 c
+260.927 295.311 l
+253.491 295.177 l
+253.378 301.397 l
+273.418 301.759 l
+h
+264.987 295.385 m
+265.014 293.867 l
+265.036 292.674 265.256 291.839 265.675 291.363 c
+266.103 290.888 266.64 290.656 267.287 290.668 c
+267.916 290.679 268.445 290.898 268.875 291.326 c
+269.305 291.753 269.509 292.545 269.489 293.702 c
+269.457 295.466 l
+264.987 295.385 l
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+273.418 301.759 m
+273.604 291.466 l
+273.644 289.224 273.142 287.538 272.096 286.406 c
+271.05 285.266 269.542 284.678 267.574 284.643 c
+265.551 284.606 263.959 285.188 262.797 286.389 c
+261.636 287.58 261.033 289.424 260.988 291.921 c
+260.927 295.311 l
+253.491 295.177 l
+253.378 301.397 l
+273.418 301.759 l
+h
+264.987 295.385 m
+265.014 293.867 l
+265.036 292.674 265.256 291.839 265.675 291.363 c
+266.103 290.888 266.64 290.656 267.287 290.668 c
+267.916 290.679 268.445 290.898 268.875 291.326 c
+269.305 291.753 269.509 292.545 269.489 293.702 c
+269.457 295.466 l
+264.987 295.385 l
+h
+S
+Q
+Q
+q
+q
+1 1 1 rg
+273.783 281.542 m
+273.97 271.248 l
+274.01 269.007 273.507 267.32 272.461 266.189 c
+271.415 265.049 269.908 264.461 267.94 264.425 c
+265.917 264.389 264.324 264.971 263.163 266.171 c
+262.002 267.363 261.399 269.207 261.354 271.704 c
+261.293 275.094 l
+253.856 274.959 l
+253.744 281.179 l
+273.783 281.542 l
+h
+265.352 275.167 m
+265.38 273.65 l
+265.401 272.456 265.622 271.622 266.04 271.146 c
+266.468 270.671 267.006 270.439 267.653 270.45 c
+268.282 270.462 268.811 270.681 269.241 271.108 c
+269.671 271.535 269.875 272.328 269.854 273.485 c
+269.822 275.248 l
+265.352 275.167 l
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+273.783 281.542 m
+273.97 271.248 l
+274.01 269.007 273.507 267.32 272.461 266.189 c
+271.415 265.049 269.908 264.461 267.94 264.425 c
+265.917 264.389 264.324 264.971 263.163 266.171 c
+262.002 267.363 261.399 269.207 261.354 271.704 c
+261.293 275.094 l
+253.856 274.959 l
+253.744 281.179 l
+273.783 281.542 l
+h
+265.352 275.167 m
+265.38 273.65 l
+265.401 272.456 265.622 271.622 266.04 271.146 c
+266.468 270.671 267.006 270.439 267.653 270.45 c
+268.282 270.462 268.811 270.681 269.241 271.108 c
+269.671 271.535 269.875 272.328 269.854 273.485 c
+269.822 275.248 l
+265.352 275.167 l
+h
+S
+Q
+Q
+q
+q
+1 1 1 rg
+274.124 262.705 m
+274.465 243.882 l
+269.516 243.792 l
+269.402 250.108 l
+254.311 249.835 l
+254.199 256.027 l
+269.29 256.3 l
+269.176 262.615 l
+274.124 262.705 l
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+274.124 262.705 m
+274.465 243.882 l
+269.516 243.792 l
+269.402 250.108 l
+254.311 249.835 l
+254.199 256.027 l
+269.29 256.3 l
+269.176 262.615 l
+274.124 262.705 l
+h
+S
+Q
+Q
+q
+q
+1 1 1 rg
+264.468 241.677 m
+267.739 241.736 270.303 240.871 272.158 239.081 c
+274.014 237.292 274.971 234.77 275.03 231.517 c
+275.09 228.182 274.239 225.595 272.477 223.759 c
+270.723 221.922 268.233 220.974 265.007 220.916 c
+262.665 220.874 260.735 221.235 259.217 222.001 c
+257.709 222.758 256.521 223.876 255.656 225.355 c
+254.8 226.825 254.352 228.672 254.311 230.896 c
+254.271 233.156 254.597 235.035 255.29 236.534 c
+255.983 238.023 257.1 239.242 258.642 240.191 c
+260.184 241.139 262.126 241.635 264.468 241.677 c
+h
+264.552 235.484 m
+262.529 235.448 261.083 235.048 260.212 234.285 c
+259.342 233.512 258.918 232.479 258.942 231.185 c
+258.966 229.854 259.417 228.832 260.296 228.119 c
+261.175 227.406 262.736 227.069 264.977 227.11 c
+266.864 227.144 268.233 227.552 269.085 228.333 c
+269.946 229.105 270.365 230.143 270.341 231.446 c
+270.319 232.694 269.859 233.689 268.961 234.429 c
+268.063 235.17 266.594 235.521 264.552 235.484 c
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+264.468 241.677 m
+267.739 241.736 270.303 240.871 272.158 239.081 c
+274.014 237.292 274.971 234.77 275.03 231.517 c
+275.09 228.182 274.239 225.595 272.477 223.759 c
+270.723 221.922 268.233 220.974 265.007 220.916 c
+262.665 220.874 260.735 221.235 259.217 222.001 c
+257.709 222.758 256.521 223.876 255.656 225.355 c
+254.8 226.825 254.352 228.672 254.311 230.896 c
+254.271 233.156 254.597 235.035 255.29 236.534 c
+255.983 238.023 257.1 239.242 258.642 240.191 c
+260.184 241.139 262.126 241.635 264.468 241.677 c
+h
+264.552 235.484 m
+262.529 235.448 261.083 235.048 260.212 234.285 c
+259.342 233.512 258.918 232.479 258.942 231.185 c
+258.966 229.854 259.417 228.832 260.296 228.119 c
+261.175 227.406 262.736 227.069 264.977 227.11 c
+266.864 227.144 268.233 227.552 269.085 228.333 c
+269.946 229.105 270.365 230.143 270.341 231.446 c
+270.319 232.694 269.859 233.689 268.961 234.429 c
+268.063 235.17 266.594 235.521 264.552 235.484 c
+h
+S
+Q
+Q
+q
+q
+1 1 1 rg
+275.173 204.718 m
+275.285 198.54 l
+263.338 198.324 l
+262.153 198.302 261.029 198.469 259.965 198.823 c
+258.91 199.169 257.979 199.731 257.172 200.509 c
+256.374 201.279 255.808 202.094 255.473 202.954 c
+255.005 204.148 254.756 205.589 254.725 207.275 c
+254.707 208.25 254.756 209.317 254.872 210.477 c
+254.988 211.628 255.24 212.594 255.627 213.376 c
+256.023 214.158 256.588 214.879 257.324 215.54 c
+258.06 216.191 258.822 216.643 259.61 216.894 c
+260.879 217.3 262.006 217.512 262.99 217.529 c
+274.937 217.745 l
+275.049 211.567 l
+262.815 211.345 l
+261.721 211.326 260.87 211.009 260.261 210.397 c
+259.662 209.775 259.372 208.927 259.391 207.851 c
+259.41 206.785 259.726 205.957 260.339 205.366 c
+260.96 204.767 261.827 204.477 262.939 204.497 c
+275.173 204.718 l
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+275.173 204.718 m
+275.285 198.54 l
+263.338 198.324 l
+262.153 198.302 261.029 198.469 259.965 198.823 c
+258.91 199.169 257.979 199.731 257.172 200.509 c
+256.374 201.279 255.808 202.094 255.473 202.954 c
+255.005 204.148 254.756 205.589 254.725 207.275 c
+254.707 208.25 254.756 209.317 254.872 210.477 c
+254.988 211.628 255.24 212.594 255.627 213.376 c
+256.023 214.158 256.588 214.879 257.324 215.54 c
+258.06 216.191 258.822 216.643 259.61 216.894 c
+260.879 217.3 262.006 217.512 262.99 217.529 c
+274.937 217.745 l
+275.049 211.567 l
+262.815 211.345 l
+261.721 211.326 260.87 211.009 260.261 210.397 c
+259.662 209.775 259.372 208.927 259.391 207.851 c
+259.41 206.785 259.726 205.957 260.339 205.366 c
+260.96 204.767 261.827 204.477 262.939 204.497 c
+275.173 204.718 l
+h
+S
+Q
+Q
+q
+q
+1 1 1 rg
+275.334 195.847 m
+275.674 177.024 l
+270.726 176.934 l
+270.611 183.249 l
+255.52 182.977 l
+255.408 189.169 l
+270.499 189.442 l
+270.385 195.757 l
+275.334 195.847 l
+h
+f
+Q
+q
+0 0 0 rg
+0.031352 w 0 J 0 j 11 M
+[]0 d
+275.334 195.847 m
+275.674 177.024 l
+270.726 176.934 l
+270.611 183.249 l
+255.52 182.977 l
+255.408 189.169 l
+270.499 189.442 l
+270.385 195.757 l
+275.334 195.847 l
+h
+S
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+274.04 312.647 m
+274.04 309.111 273.003 305.792 273.003 302.155 c
+272.551 299.416 273.295 294.204 271.965 292.187 c
+271.965 291.498 271.689 286.941 272.311 286.941 c
+273.879 289.914 273.695 291.33 273.695 294.81 c
+273.695 297.608 275.771 306.177 275.771 308.975 c
+276.725 311.867 274.733 308.196 274.733 311.598 c
+274.648 306.096 274.387 308.196 274.04 312.647 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+296.621 147.397 m
+296.621 149.324 285.513 167.607 284.031 172.054 c
+282.853 172.643 282.178 172.579 280.883 172.579 c
+275.366 174.943 279.288 194.748 273.538 199.857 c
+268.509 209.854 273.742 212.364 271.965 217.694 c
+271.221 221.044 273.539 231.442 273.014 234.481 c
+276.32 236.055 274.063 226.058 273.539 220.317 c
+276.463 217.393 267.529 211.877 269.342 208.251 c
+270.038 205.469 280.183 189.016 277.736 177.3 c
+281.287 174.341 280.472 174.464 284.556 173.103 c
+286.127 168.39 292.451 155.212 293.998 151.07 c
+294.408 149.432 295.884 148.873 296.621 147.397 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+267.768 256.514 m
+267.768 260.003 267.8 265.99 270.391 268.581 c
+272.27 264.823 274.588 259.663 274.588 255.466 c
+278.282 251.773 274.968 258.849 276.162 261.236 c
+276.162 264.605 281.337 259.137 280.883 274.351 c
+279.813 273.015 279.592 264 278.26 263.335 c
+275.881 259.765 280.783 256.514 275.637 256.514 c
+272.847 257.444 270.392 261.843 270.392 264.383 c
+270.041 262.629 268.293 258.736 267.768 256.514 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 1 rg
+231.571 162.086 m
+231.221 153.517 232.446 145.474 230.522 136.38 c
+254.828 134.282 273.889 134.282 298.195 130.085 c
+298.545 140.577 300.993 151.069 299.769 161.561 c
+277.036 161.736 254.304 161.911 231.571 162.086 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 0.702 rg
+231.571 165.233 m
+232.096 153.691 l
+301.867 155.265 l
+299.769 164.708 l
+231.571 165.233 l
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 0.702 rg
+236.817 160.512 m
+236.817 166.283 236.817 172.054 236.817 177.824 c
+236.817 180.99 236.444 184.424 237.866 187.267 c
+237.866 188.56 236.819 199.802 237.353 201.403 c
+242.01 201.403 244.686 188.015 244.686 184.644 c
+244.911 183.402 248.085 179.117 246.254 177.285 c
+247.93 174.771 247.146 171.529 250.456 171.529 c
+251.433 173.483 251.867 171.71 253.604 172.578 c
+255.207 174.182 256.702 176.775 258.85 176.775 c
+263.783 178.185 262.522 177.785 262.522 174.152 c
+261.482 169.991 273.934 165.238 279.258 165.238 c
+282.919 163.408 267.724 161.606 270.391 158.939 c
+271.252 158.078 274.65 157.365 271.965 157.365 c
+266.746 157.365 267.285 157.91 264.096 156.316 c
+262.278 155.952 260.424 156.25 260.424 154.217 c
+255.719 153.276 251.288 154.217 246.784 154.217 c
+243.027 154.635 238.39 153.956 238.39 158.414 c
+237.892 159.411 237.866 159.53 236.817 160.512 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 1 rg
+231.221 165.757 m
+228.678 165.792 228.939 159.205 230.697 157.363 c
+232.567 155.055 300.278 155.59 302.566 156.314 c
+305.267 157.056 303.929 163.219 302.566 165.757 c
+301.591 166.923 253.001 165.113 231.221 165.757 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+235.592 158.414 m
+235.242 155.49 235.154 165.584 236.641 164.185 c
+237.81 164.691 237.89 158.438 235.592 158.414 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+242.238 158.414 m
+241.888 155.49 241.101 164.535 242.588 163.136 c
+243.757 163.642 244.536 158.438 242.238 158.414 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+0 0 0.702 rg
+268.487 140.391 m
+264.483 140.391 257.41 137.778 253.328 137.778 c
+248.013 136.449 242.082 137.255 236.602 137.255 c
+236.602 138.904 235.556 137.867 235.556 139.869 c
+235.556 142.819 232.943 145.011 232.943 147.709 c
+231.681 150.234 232.452 153 233.466 155.027 c
+237.299 155.027 241.132 155.027 244.965 155.027 c
+246.351 155.72 243.864 157.063 241.829 155.027 c
+239.746 154.333 243.397 153.187 243.397 150.846 c
+243.397 148.344 244.746 145.619 247.578 145.619 c
+248.498 145.068 254.497 141.713 255.419 139.869 c
+257.569 139.331 260.282 140.835 262.214 139.869 c
+263.746 139.358 267.965 140.391 268.487 140.391 c
+h
+f
+Q
+Q
+Q
+Q
+q
+q
+q
+q
+1 1 1 rg
+242.063 150.72 m
+242.063 149.313 244.521 149.651 245.21 148.272 c
+247.075 146.407 247.748 143.375 250.806 143.375 c
+253.39 142.406 255.555 141.093 258.15 140.228 c
+262.464 138.995 265.83 139.523 270.041 140.927 c
+273 142.618 273.799 146.843 277.036 147.922 c
+280.091 149.231 281.305 145.545 283.331 147.572 c
+284.962 148.659 287.223 148.316 288.577 149.671 c
+290.733 149.671 291.292 151.07 293.474 151.07 c
+294.055 151.07 298.02 150.461 298.02 151.769 c
+294.609 151.769 290.861 149.804 287.528 148.971 c
+285.337 148.752 283.035 147.922 280.883 147.922 c
+277.7 147.126 275.097 144.075 271.79 144.075 c
+268.228 141.7 267.201 141.627 263.047 141.627 c
+260.934 140.922 253.431 140.664 251.506 141.627 c
+250.376 142.756 249.839 143.334 248.358 144.075 c
+247.493 144.939 246.882 146.873 245.56 146.873 c
+245.042 148.425 244.161 147.546 244.161 149.321 c
+243.27 149.766 243.673 150.02 242.063 150.72 c
+h
+f
+Q
+Q
+Q
+Q
+
+% *** Text ***
+
+
+-5 0 translate
+q
+q
+q
+q
+0 0 0 rg
+102.153 122.034 m
+114.769 122.034 l
+118.181 122.034 120.8 121.766 122.625 121.231 c
+124.47 120.695 125.848 119.921 126.761 118.91 c
+127.693 117.898 128.318 116.668 128.635 115.22 c
+128.973 113.792 129.141 111.57 129.141 108.555 c
+129.141 104.359 l
+129.141 101.284 128.824 99.0428 128.189 97.6343 c
+127.554 96.2259 126.384 95.1448 124.678 94.391 c
+122.992 93.6372 120.78 93.2602 118.042 93.2602 c
+114.68 93.2602 l
+114.68 73.8596 l
+102.153 73.8596 l
+102.153 122.034 l
+h
+114.68 113.792 m
+114.68 101.532 l
+115.037 101.512 115.345 101.503 115.602 101.503 c
+116.753 101.503 117.547 101.78 117.983 102.336 c
+118.439 102.911 118.667 104.091 118.667 105.877 c
+118.667 109.834 l
+118.667 111.481 118.409 112.552 117.894 113.048 c
+117.378 113.544 116.307 113.792 114.68 113.792 c
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+143.126 98.0509 m
+131.849 98.0509 l
+131.849 100.699 l
+131.849 103.754 132.196 106.105 132.891 107.751 c
+133.605 109.418 135.023 110.885 137.146 112.155 c
+139.268 113.425 142.025 114.059 145.418 114.059 c
+149.484 114.059 152.549 113.335 154.612 111.887 c
+156.675 110.459 157.915 108.693 158.332 106.591 c
+158.748 104.508 158.956 100.203 158.956 93.6768 c
+158.956 73.8596 l
+147.262 73.8596 l
+147.262 77.3708 l
+146.528 75.9623 145.576 74.901 144.406 74.1869 c
+143.255 73.4926 141.877 73.1455 140.27 73.1455 c
+138.167 73.1455 136.233 73.7307 134.468 74.901 c
+132.722 76.0913 131.849 78.68 131.849 82.6673 c
+131.849 85.9106 l
+131.849 88.8663 132.315 90.8798 133.248 91.951 c
+134.18 93.0222 136.491 94.2719 140.181 95.7002 c
+144.128 97.2475 146.241 98.2889 146.519 98.8245 c
+146.796 99.3601 146.935 100.451 146.935 102.098 c
+146.935 104.161 146.776 105.5 146.459 106.115 c
+146.162 106.749 145.656 107.067 144.942 107.067 c
+144.128 107.067 143.622 106.799 143.424 106.263 c
+143.226 105.748 143.126 104.389 143.126 102.187 c
+143.126 98.0509 l
+h
+146.935 92.6354 m
+145.011 91.227 143.89 90.0466 143.573 89.0945 c
+143.275 88.1423 143.126 86.7735 143.126 84.9882 c
+143.126 82.945 143.255 81.6258 143.513 81.0307 c
+143.791 80.4356 144.327 80.138 145.12 80.138 c
+145.874 80.138 146.36 80.3662 146.578 80.8224 c
+146.816 81.2985 146.935 82.5284 146.935 84.5121 c
+146.935 92.6354 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+187.641 100.729 m
+176.988 100.729 l
+176.988 102.871 l
+176.988 104.696 176.879 105.847 176.661 106.323 c
+176.463 106.819 175.947 107.067 175.114 107.067 c
+174.439 107.067 173.933 106.839 173.596 106.382 c
+173.259 105.946 173.09 105.282 173.09 104.389 c
+173.09 103.179 173.17 102.286 173.328 101.711 c
+173.507 101.155 174.013 100.54 174.846 99.866 c
+175.699 99.1915 177.435 98.2096 180.053 96.9202 c
+183.544 95.2142 185.836 93.6074 186.927 92.0998 c
+188.018 90.5922 188.563 88.4002 188.563 85.5238 c
+188.563 82.3102 188.147 79.8801 187.314 78.2337 c
+186.48 76.607 185.082 75.3474 183.118 74.4547 c
+181.174 73.5819 178.823 73.1455 176.066 73.1455 c
+173.011 73.1455 170.392 73.6216 168.21 74.5737 c
+166.048 75.5259 164.56 76.8153 163.747 78.442 c
+162.934 80.0686 162.527 82.5284 162.527 85.8213 c
+162.527 87.7257 l
+173.18 87.7257 l
+173.18 85.2262 l
+173.18 83.1037 173.309 81.725 173.566 81.0902 c
+173.844 80.4554 174.38 80.138 175.173 80.138 c
+176.026 80.138 176.621 80.3463 176.959 80.7629 c
+177.296 81.1993 177.464 82.1019 177.464 83.4707 c
+177.464 85.3552 177.246 86.5355 176.81 87.0116 c
+176.354 87.4877 174.023 88.8961 169.817 91.2369 c
+166.286 93.2206 164.134 95.0158 163.36 96.6226 c
+162.587 98.2493 162.2 100.173 162.2 102.395 c
+162.2 105.549 162.616 107.87 163.45 109.358 c
+164.283 110.866 165.691 112.026 167.675 112.839 c
+169.678 113.653 171.999 114.059 174.638 114.059 c
+177.256 114.059 179.478 113.722 181.303 113.048 c
+183.148 112.393 184.556 111.52 185.528 110.429 c
+186.52 109.338 187.115 108.327 187.314 107.394 c
+187.532 106.462 187.641 105.004 187.641 103.02 c
+187.641 100.729 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+216.325 100.729 m
+205.673 100.729 l
+205.673 102.871 l
+205.673 104.696 205.564 105.847 205.345 106.323 c
+205.147 106.819 204.631 107.067 203.798 107.067 c
+203.124 107.067 202.618 106.839 202.281 106.382 c
+201.943 105.946 201.775 105.282 201.775 104.389 c
+201.775 103.179 201.854 102.286 202.013 101.711 c
+202.191 101.155 202.697 100.54 203.53 99.866 c
+204.383 99.1915 206.119 98.2096 208.738 96.9202 c
+212.229 95.2142 214.52 93.6074 215.611 92.0998 c
+216.702 90.5922 217.248 88.4002 217.248 85.5238 c
+217.248 82.3102 216.831 79.8801 215.998 78.2337 c
+215.165 76.607 213.766 75.3474 211.802 74.4547 c
+209.858 73.5819 207.508 73.1455 204.75 73.1455 c
+201.695 73.1455 199.077 73.6216 196.895 74.5737 c
+194.733 75.5259 193.245 76.8153 192.431 78.442 c
+191.618 80.0686 191.211 82.5284 191.211 85.8213 c
+191.211 87.7257 l
+201.864 87.7257 l
+201.864 85.2262 l
+201.864 83.1037 201.993 81.725 202.251 81.0902 c
+202.529 80.4554 203.064 80.138 203.858 80.138 c
+204.711 80.138 205.306 80.3463 205.643 80.7629 c
+205.98 81.1993 206.149 82.1019 206.149 83.4707 c
+206.149 85.3552 205.931 86.5355 205.494 87.0116 c
+205.038 87.4877 202.707 88.8961 198.502 91.2369 c
+194.971 93.2206 192.818 95.0158 192.045 96.6226 c
+191.271 98.2493 190.884 100.173 190.884 102.395 c
+190.884 105.549 191.301 107.87 192.134 109.358 c
+192.967 110.866 194.376 112.026 196.359 112.839 c
+198.363 113.653 200.684 114.059 203.322 114.059 c
+205.941 114.059 208.162 113.722 209.987 113.048 c
+211.832 112.393 213.241 111.52 214.213 110.429 c
+215.204 109.338 215.8 108.327 215.998 107.394 c
+216.216 106.462 216.325 105.004 216.325 103.02 c
+216.325 100.729 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+247.688 92.9032 m
+232.125 92.9032 l
+232.125 84.3633 l
+232.125 82.578 232.254 81.4274 232.512 80.9117 c
+232.77 80.3959 233.266 80.138 234 80.138 c
+234.913 80.138 235.518 80.4753 235.815 81.1497 c
+236.133 81.844 236.291 83.1731 236.291 85.137 c
+236.291 90.3442 l
+247.688 90.3442 l
+247.688 87.4282 l
+247.688 84.9882 247.529 83.1136 247.212 81.8043 c
+246.914 80.4951 246.2 79.0966 245.069 77.6088 c
+243.938 76.121 242.5 75.0002 240.755 74.2464 c
+239.029 73.5124 236.857 73.1455 234.238 73.1455 c
+231.699 73.1455 229.457 73.5124 227.513 74.2464 c
+225.569 74.9804 224.052 75.9822 222.961 77.2517 c
+221.89 78.5411 221.146 79.9496 220.729 81.477 c
+220.312 83.0243 220.104 85.2659 220.104 88.2018 c
+220.104 99.7172 l
+220.104 103.169 220.57 105.887 221.503 107.87 c
+222.435 109.874 223.962 111.401 226.085 112.453 c
+228.208 113.524 230.648 114.059 233.405 114.059 c
+236.777 114.059 239.554 113.415 241.737 112.125 c
+243.938 110.856 245.476 109.16 246.349 107.037 c
+247.241 104.934 247.688 101.969 247.688 98.1402 c
+247.688 92.9032 l
+h
+235.637 99.3304 m
+235.637 102.217 l
+235.637 104.26 235.528 105.579 235.309 106.174 c
+235.091 106.769 234.645 107.067 233.97 107.067 c
+233.137 107.067 232.621 106.809 232.423 106.293 c
+232.225 105.797 232.125 104.438 232.125 102.217 c
+232.125 99.3304 l
+235.637 99.3304 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+263.845 113.345 m
+263.637 109.864 l
+264.708 111.272 265.888 112.324 267.178 113.018 c
+268.467 113.712 269.875 114.059 271.403 114.059 c
+273.268 114.059 274.874 113.554 276.223 112.542 c
+277.592 111.55 278.445 110.399 278.782 109.09 c
+279.119 107.781 279.288 105.559 279.288 102.425 c
+279.288 85.7916 l
+279.288 82.2011 279.07 79.6421 278.633 78.1146 c
+278.217 76.607 277.344 75.397 276.015 74.4845 c
+274.706 73.5918 273.119 73.1455 271.254 73.1455 c
+269.766 73.1455 268.388 73.4926 267.118 74.1869 c
+265.848 74.8812 264.688 75.9127 263.637 77.2815 c
+263.637 68.2358 l
+251.615 68.2358 l
+251.615 113.345 l
+263.845 113.345 l
+h
+267.267 101.86 m
+267.267 104.3 267.178 105.777 266.999 106.293 c
+266.82 106.809 266.325 107.067 265.511 107.067 c
+264.718 107.067 264.202 106.769 263.964 106.174 c
+263.746 105.579 263.637 104.141 263.637 101.86 c
+263.637 85.494 l
+263.637 83.1136 263.756 81.6258 263.994 81.0307 c
+264.232 80.4356 264.748 80.138 265.541 80.138 c
+266.315 80.138 266.791 80.4058 266.969 80.9414 c
+267.168 81.4969 267.267 82.826 267.267 84.9287 c
+267.267 101.86 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+293.987 98.0509 m
+282.71 98.0509 l
+282.71 100.699 l
+282.71 103.754 283.057 106.105 283.751 107.751 c
+284.466 109.418 285.884 110.885 288.006 112.155 c
+290.129 113.425 292.886 114.059 296.279 114.059 c
+300.345 114.059 303.41 113.335 305.473 111.887 c
+307.536 110.459 308.776 108.693 309.192 106.591 c
+309.609 104.508 309.817 100.203 309.817 93.6768 c
+309.817 73.8596 l
+298.123 73.8596 l
+298.123 77.3708 l
+297.389 75.9623 296.437 74.901 295.267 74.1869 c
+294.116 73.4926 292.738 73.1455 291.131 73.1455 c
+289.028 73.1455 287.094 73.7307 285.328 74.901 c
+283.583 76.0913 282.71 78.68 282.71 82.6673 c
+282.71 85.9106 l
+282.71 88.8663 283.176 90.8798 284.108 91.951 c
+285.041 93.0222 287.352 94.2719 291.042 95.7002 c
+294.989 97.2475 297.102 98.2889 297.379 98.8245 c
+297.657 99.3601 297.796 100.451 297.796 102.098 c
+297.796 104.161 297.637 105.5 297.32 106.115 c
+297.022 106.749 296.517 107.067 295.802 107.067 c
+294.989 107.067 294.483 106.799 294.285 106.263 c
+294.087 105.748 293.987 104.389 293.987 102.187 c
+293.987 98.0509 l
+h
+297.796 92.6354 m
+295.872 91.227 294.751 90.0466 294.434 89.0945 c
+294.136 88.1423 293.987 86.7735 293.987 84.9882 c
+293.987 82.945 294.116 81.6258 294.374 81.0307 c
+294.652 80.4356 295.187 80.138 295.981 80.138 c
+296.735 80.138 297.221 80.3662 297.439 80.8224 c
+297.677 81.2985 297.796 82.5284 297.796 84.5121 c
+297.796 92.6354 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+325.975 113.345 m
+325.499 108.168 l
+327.244 111.877 329.773 113.841 333.086 114.059 c
+333.086 100.164 l
+330.884 100.164 329.268 99.866 328.236 99.2709 c
+327.205 98.6758 326.57 97.8426 326.332 96.7714 c
+326.094 95.72 325.975 93.2801 325.975 89.4515 c
+325.975 73.8596 l
+313.953 73.8596 l
+313.953 113.345 l
+325.975 113.345 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+348.44 118.612 m
+348.44 112.393 l
+351.683 112.393 l
+351.683 106.144 l
+348.44 106.144 l
+348.44 85.0179 l
+348.44 82.4193 348.569 80.9712 348.827 80.6736 c
+349.105 80.3761 350.225 80.2273 352.189 80.2273 c
+352.189 73.8596 l
+347.339 73.8596 l
+344.602 73.8596 342.648 73.9687 341.477 74.1869 c
+340.307 74.425 339.275 74.9506 338.383 75.764 c
+337.49 76.5971 336.935 77.5394 336.716 78.5907 c
+336.498 79.6619 336.389 82.1614 336.389 86.0891 c
+336.389 106.144 l
+333.8 106.144 l
+333.8 112.393 l
+336.389 112.393 l
+336.389 118.612 l
+348.44 118.612 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+381.528 99.4792 m
+381.528 89.8086 l
+381.528 86.2578 381.35 83.6492 380.993 81.9829 c
+380.636 80.3364 379.872 78.7891 378.702 77.341 c
+377.531 75.9127 376.024 74.8514 374.179 74.1572 c
+372.354 73.4827 370.251 73.1455 367.871 73.1455 c
+365.212 73.1455 362.961 73.4331 361.116 74.0084 c
+359.271 74.6035 357.833 75.4862 356.801 76.6566 c
+355.79 77.8468 355.066 79.2751 354.629 80.9414 c
+354.193 82.6276 353.975 85.1469 353.975 88.4994 c
+353.975 98.6163 l
+353.975 102.286 354.371 105.153 355.165 107.216 c
+355.958 109.279 357.387 110.935 359.45 112.185 c
+361.513 113.435 364.151 114.059 367.365 114.059 c
+370.063 114.059 372.374 113.653 374.298 112.839 c
+376.242 112.046 377.739 111.005 378.791 109.715 c
+379.842 108.426 380.556 107.097 380.933 105.728 c
+381.33 104.359 381.528 102.276 381.528 99.4792 c
+h
+369.507 102.455 m
+369.507 104.478 369.398 105.748 369.18 106.263 c
+368.962 106.799 368.495 107.067 367.781 107.067 c
+367.067 107.067 366.591 106.799 366.353 106.263 c
+366.115 105.748 365.996 104.478 365.996 102.455 c
+365.996 84.6311 l
+365.996 82.7664 366.115 81.5465 366.353 80.9712 c
+366.591 80.4157 367.057 80.138 367.751 80.138 c
+368.466 80.138 368.932 80.3959 369.15 80.9117 c
+369.388 81.4274 369.507 82.5383 369.507 84.2443 c
+369.507 102.455 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+413.01 113.345 m
+413.01 73.8596 l
+400.78 73.8596 l
+400.989 77.1327 l
+400.155 75.8036 399.124 74.8019 397.894 74.1274 c
+396.684 73.4728 395.285 73.1455 393.698 73.1455 c
+391.893 73.1455 390.396 73.4629 389.205 74.0976 c
+388.015 74.7324 387.132 75.5755 386.557 76.6269 c
+386.002 77.6782 385.654 78.7693 385.516 79.9 c
+385.377 81.0505 385.307 83.3219 385.307 86.714 c
+385.307 113.345 l
+397.329 113.345 l
+397.329 86.476 l
+397.329 83.4012 397.418 81.5762 397.596 81.0009 c
+397.795 80.4257 398.311 80.138 399.144 80.138 c
+400.036 80.138 400.562 80.4356 400.721 81.0307 c
+400.899 81.6258 400.989 83.5401 400.989 86.7735 c
+400.989 113.345 l
+413.01 113.345 l
+h
+f
+Q
+Q
+q
+q
+0 0 0 rg
+430 118.612 m
+430 112.393 l
+433.244 112.393 l
+433.244 106.144 l
+430 106.144 l
+430 85.0179 l
+430 82.4193 430.129 80.9712 430.387 80.6736 c
+430.665 80.3761 431.786 80.2273 433.749 80.2273 c
+433.749 73.8596 l
+428.899 73.8596 l
+426.162 73.8596 424.208 73.9687 423.037 74.1869 c
+421.867 74.425 420.836 74.9506 419.943 75.764 c
+419.05 76.5971 418.495 77.5394 418.277 78.5907 c
+418.058 79.6619 417.949 82.1614 417.949 86.0891 c
+417.949 106.144 l
+415.36 106.144 l
+415.36 112.393 l
+417.949 112.393 l
+417.949 118.612 l
+430 118.612 l
+h
+f
+Q
+Q
+Q
+Q
+
+% ***
+Q
+Q
+SP
+%%PageTrailer
+%%PageResources: procset gnome-print-procs-0.34
+%%Trailer
+%%EOF
Files passepartout-0.6/logotype/pptout-icon.png and passepartout/logotype/pptout-icon.png differ
Files passepartout-0.6/logotype/pptout.png and passepartout/logotype/pptout.png differ
diff -Nur -x CVS passepartout-0.6/logotype/pptout.svg passepartout/logotype/pptout.svg
--- passepartout-0.6/logotype/pptout.svg	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/logotype/pptout.svg	2003-09-05 00:54:03.000000000 +0200
@@ -0,0 +1,245 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
+"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
+<!-- Created with Sodipodi ("http://www.sodipodi.com/") -->
+<svg
+   version="1"
+   x="0"
+   y="0"
+   width="453.543"
+   height="416.693"
+   id="svg37"
+   sodipodi:version="0.31.1"
+   sodipodi:docname="/home/fredrik/bilder/pptout/pptout-mirror.svg"
+   sodipodi:docbase="/home/fredrik/bilder/pptout/"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:xlink="http://www.w3.org/1999/xlink">
+  <sodipodi:namedview
+     id="base" />
+  <defs
+     id="defs39" />
+  <g
+     id="g246"
+     transform="translate(-6.76929,-35.2004)">
+    <path
+       d="M 388.591 242.716 C 405.239 255.591 411.85 274.966 403.346 285.961 C 394.842 296.956 374.428 295.429 357.78 282.554 C 341.131 269.677 334.521 250.304 343.025 239.309 C 351.529 228.313 371.942 229.84 388.591 242.716 L 373.186 262.635 L 388.591 242.716 z M 242.592 194.536 C 300.139 232.143 300.718 233.026 328.469 255.704 C 326.489 246.539 331.003 238.166 337.166 230.268 C 354.048 210.257 381.401 225.931 393.997 235.782 C 405.803 245.021 429.057 267.88 409.943 293.625 C 390.037 318.758 361.514 299.152 351.173 291.154 C 341.623 283.768 338.136 279.807 326.725 267.189 C 323.909 264.137 280.846 235.496 276.816 233.647 C 263.702 227.558 250.731 233.845 245.417 233.382 C 215.215 212.957 63.4842 84.282 67.9111 77.136 C 75.3886 76.1962 234.695 189.363 242.592 194.536 z "
+       style="font-size:12;fill:#7e7e7e;fill-rule:evenodd;"
+       id="path259"
+       transform="matrix(-1,0,0,1,465.333,-7.62939e-06)" />
+    <path
+       d="M 76.9797 243.416 C 60.2322 256.162 53.4712 275.484 61.8893 286.545 C 70.3075 297.606 90.7327 296.237 107.48 283.491 C 124.228 270.745 130.989 251.423 122.57 240.362 C 114.152 229.301 93.7279 230.669 76.9797 243.416 L 92.2299 263.453 L 76.9797 243.416 z M 223.349 196.369 C 165.512 233.529 164.926 234.407 137 256.87 C 139.05 247.72 134.602 239.313 128.501 231.367 C 111.774 211.225 84.3005 226.687 71.6277 236.44 C 59.7507 245.587 36.3198 268.264 55.2341 294.157 C 74.9443 319.444 103.619 300.06 114.021 292.142 C 123.629 284.831 127.146 280.897 138.654 268.368 C 141.494 265.337 184.778 237.031 188.822 235.214 C 201.984 229.227 214.905 235.614 220.223 235.192 C 250.582 215.003 403.307 87.5089 398.935 80.3287 C 391.465 79.331 231.285 191.258 223.349 196.369 z "
+       style="font-size:12;fill:#7f7f7f;fill-rule:evenodd;"
+       id="path254"
+       transform="matrix(-1,0,0,1,465.333,-7.62939e-06)" />
+    <path
+       d="M 347.638 550.945 C 353.096 619.474 338.641 606.264 337.638 601.945 C 334.431 587.846 321.523 581.432 318.638 576.945 C 316.317 540.559 325.277 341.815 333.638 340.945 C 338.956 346.285 346.899 541.534 347.638 550.945 z "
+       transform="matrix(0.605624,-0.795751,0.795751,0.605624,-406.969,139.337)"
+       style="font-size:12;fill:#4c4c4c;fill-rule:evenodd;"
+       id="path1799" />
+    <path
+       d="M 348.751 582.076 L 337.53 600.223 C 339.337 606.751 342.834 605.789 345.008 604.871 C 346.887 603.655 351.437 595.203 348.751 582.076 z "
+       transform="matrix(0.605624,-0.795751,0.795751,0.605624,-406.969,139.337)"
+       style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+       id="path1811"
+       sodipodi:nodetypes="cccc" />
+    <path
+       d="M 328.45 534.948 C 327.629 480.984 330.032 371.045 334.532 343.73 C 339.757 357.61 343.811 454.85 346.836 534.374 L 328.45 534.948 z "
+       transform="matrix(-0.611781,-0.791027,-0.791027,0.611781,871.232,132.469)"
+       style="font-size:12;fill:#cccccc;fill-rule:evenodd;"
+       id="path1748" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:round;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+       d="M 61.3649 249.823 C 75.5266 232.359 101.955 220.921 116.794 226.186 "
+       id="path241"
+       sodipodi:nodetypes="cc" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:miter;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+       d="M 72.7566 296.549 C 83.7658 298.183 103.691 297.028 120.281 274.791 "
+       id="path242"
+       sodipodi:nodetypes="cc" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:miter;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+       d="M 333.627 258.256 C 333.627 258.256 330.195 247.923 336.978 238.63 "
+       id="path243"
+       sodipodi:nodetypes="cc"
+       transform="translate(-1.35387,-7.62939e-06)" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:miter;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+       d="M 139.769 257.299 C 190.507 217.091 221.142 200.338 221.142 200.338 "
+       id="path244"
+       sodipodi:nodetypes="cc"
+       transform="translate(-1.91465,1.91463)" />
+    <path
+       style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:miter;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+       d="M 400.161 295.113 C 408.298 290.327 415 276.923 410.214 267.829 "
+       id="path245"
+       sodipodi:nodetypes="cc"
+       transform="translate(-0.676956,-7.62939e-06)" />
+  </g>
+  <g
+     id="g383"
+     transform="matrix(0.999464,-0.0327327,0.0327327,0.999464,-20.7504,-173.508)">
+    <g
+       id="g285"
+       transform="matrix(-1,0,0,1,501.314,-220.786)"
+       style="font-size:12;fill-opacity:0.5;">
+      <path
+         style="stroke:none;fill:#cccccc;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 256.322 463.208 L 214.447 489.108 L 328.673 492.2 L 289.809 463.724 L 256.322 463.208 z "
+         id="path286"
+         transform="matrix(0.491999,0,0,0.574937,129.178,247.736)" />
+      <path
+         style="stroke:none;fill:#999999;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 262.344 461.662 L 228.298 492.2 L 274.472 492.715 L 276.56 462.693 L 262.344 461.662 z "
+         id="path287"
+         transform="matrix(0.491999,0,0,0.574937,129.178,247.736)" />
+    </g>
+    <g
+       id="g288"
+       transform="matrix(-0.611781,-0.791027,-0.791027,0.611781,878.182,275.886)"
+       style="font-size:12;fill-opacity:0.5;">
+      <path
+         sodipodi:type="arc"
+         style="fill-opacity:1;fill-rule:evenodd;"
+         id="path289"
+         sodipodi:cx="332.851776"
+         sodipodi:cy="550.292358"
+         sodipodi:rx="5.114881"
+         sodipodi:ry="5.114881"
+         sodipodi:start="0.000000"
+         sodipodi:end="6.283185"
+         d="M 337.966644,550.292358 A 5.114881,5.114881 0 1 1 337.966644,550.292358 L 332.851776,550.292358 z" />
+      <path
+         sodipodi:type="arc"
+         style="fill:#7f7f7f;fill-opacity:1;fill-rule:evenodd;"
+         id="path290"
+         transform="matrix(0.884143,0,0,0.884143,37.9705,63.755)"
+         sodipodi:cx="332.851776"
+         sodipodi:cy="550.292358"
+         sodipodi:rx="5.114881"
+         sodipodi:ry="5.114881"
+         sodipodi:start="0.000000"
+         sodipodi:end="6.283185"
+         d="M 337.966644,550.292358 A 5.114881,5.114881 0 1 1 337.966644,550.292358 L 332.851776,550.292358 z" />
+      <rect
+         style="stroke:none;fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         id="rect291"
+         x="-159.617813"
+         y="623.174547"
+         width="8.353552"
+         height="1.546955"
+         rx="0.000000"
+         ry="0.000000"
+         transform="matrix(0.705569,-0.708641,0.708733,0.705477,0,0)" />
+    </g>
+    <path
+       style="font-size:12;fill:#0000ff;fill-rule:evenodd;"
+       id="path292"
+       d="M 291.551 686.349 C 290.198 680.262 297.24 678.687 297.24 672.934 C 295.776 666.345 293.934 660.847 296.112 654.313 C 297.449 647.626 283.63 640.211 283.63 633.435 C 281.193 631.405 292.162 631.324 292.162 628.921 C 290.635 618.235 291.033 607.542 291.033 596.758 C 291.033 589.61 291.033 582.463 291.033 575.316 C 291.766 567.989 284.224 560.667 284.224 553.309 C 284.224 546.35 287.284 535.749 287.662 522.33 L 228.797 520.008 C 228.307 531.654 226.143 534.766 226.143 541.46 C 224.911 552.546 230.131 562.038 230.131 573.204 C 230.131 582.215 225.013 592.889 227.856 601.417 C 228.769 605.525 224.83 610.313 226.143 614.25 C 226.143 622.902 226.143 631.554 226.143 640.206 C 224.402 647.168 227.85 654.973 227.85 662.139 C 229.055 665.753 228.121 668.147 229.528 672.369 C 229.528 675.064 230.423 680.994 228.4 683.017 C 247.118 675.897 284.843 689.028 291.551 686.349 z "
+       transform="matrix(-0.924888,0,0,1.06777,477.62,-247.983)" />
+    <g
+       id="g293"
+       transform="matrix(-1,0,0,1,501.314,-220.786)"
+       style="font-size:12;fill-opacity:0.5;">
+      <path
+         style="stroke:none;fill:#ff0000;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 255.118 452.386 L 240.945 515.906 L 311.811 515.906 L 297.638 452.386 L 255.118 452.386 z "
+         id="path294"
+         transform="matrix(0.491999,0,0,0.574937,127.4,219.292)" />
+      <path
+         style="stroke:none;fill:#ffffff;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 285.229 453.417 L 292.135 515.391 L 300.369 514.875 L 289.809 453.417 L 285.229 453.417 z "
+         id="path295"
+         transform="matrix(0.491999,0,0,0.574937,127.4,219.292)" />
+      <path
+         style="stroke:none;fill:#cc0000;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 274.991 451.871 L 260.819 513.33 L 286.518 513.844 L 289.207 451.871 L 274.991 451.871 z "
+         id="path296"
+         transform="matrix(0.491999,0,0,0.574937,118.511,219.885)" />
+      <path
+         style="stroke:none;fill:#cc0000;fill-opacity:1;fill-rule:evenodd;stroke-opacity:1;stroke-width:1px;stroke-linejoin:miter;stroke-linecap:butt;"
+         d="M 294.865 452.386 L 296.953 513.845 L 311.209 513.844 L 301.854 452.386 L 294.865 452.386 z "
+         id="path297"
+         transform="matrix(0.491999,0,0,0.574937,118.511,219.885)" />
+    </g>
+    <path
+       style="font-size:12;fill:#7f7fff;fill-rule:evenodd;"
+       id="path298"
+       d="M 292.118 686.349 C 290.765 680.262 297.24 678.687 297.24 672.934 C 295.776 666.345 293.934 660.847 296.112 654.313 C 297.449 647.626 292.162 631.324 292.162 628.921 C 290.635 618.235 291.033 607.542 291.033 596.758 C 291.033 589.61 291.033 582.463 291.033 575.316 C 291.766 567.989 284.224 560.667 284.224 553.309 C 284.224 546.35 287.284 535.749 287.662 522.33 L 247.515 520.991 C 247.025 532.637 253.936 536.24 239.189 541.951 C 237.957 553.037 248.281 549.756 240.908 565.835 C 240.908 574.846 267.554 556.533 242.037 590.117 C 242.95 594.225 240.712 611.296 242.025 615.233 C 242.025 623.885 269.818 618.289 269.818 626.941 C 268.077 633.903 294.485 693.45 292.118 686.349 z "
+       transform="matrix(-0.924888,0,0,1.06777,477.62,-247.983)" />
+    <path
+       style="font-size:12;fill:#0000ff;fill-rule:evenodd;"
+       id="path299"
+       d="M 263.047 561.768 C 259.588 561.768 257.276 567.642 258.325 556.522 C 263.286 553.215 268.367 552.473 271.441 558.621 C 271.441 562.467 271.049 565.699 269.342 569.113 C 268.116 572.792 271.965 578.692 271.965 582.752 C 269.839 584.878 269.87 587.995 267.768 590.097 C 267.768 592.99 267.185 596.334 269.342 598.49 C 269.342 601.86 271.255 603.551 273.539 605.835 C 273.539 609.522 274.106 614.143 272.49 617.376 C 272.49 620.888 272.015 624.246 274.588 626.819 C 273.565 628.865 271.024 634.688 268.817 634.688 C 267.182 633.987 259.375 626.27 259.375 624.196 C 259.375 620.865 263.828 621.707 267.244 619.999 C 268.866 616.755 266.194 613.225 266.194 609.507 C 266.194 605.35 265.67 601.517 265.67 597.441 C 265.67 595.03 264.938 590.304 266.719 588.523 C 266.719 582.904 267.244 577.939 267.244 572.26 C 266.495 569.265 267.091 566.862 265.145 564.916 C 264.542 564.312 263.047 563.606 263.047 561.768 z "
+       transform="matrix(-1.19073,0,0,1.07154,553.685,-266.192)" />
+    <path
+       transform="matrix(0.0180858,0.999836,-0.999836,0.0180858,-28.6702,-220.786)"
+       style="font-size:28;font-weight:normal;fill:#ffffff;fill-rule:evenodd;stroke:#000000;stroke-width:1.1pt;font-family:Arial Black;"
+       d="M 650.917 -263.604 L 669.743 -263.604 L 669.743 -258.655 L 663.427 -258.655 L 663.427 -243.561 L 657.234 -243.561 L 657.234 -258.655 L 650.917 -258.655 L 650.917 -263.604 z M 642.044 -263.604 L 648.224 -263.604 L 648.224 -251.655 C 648.224 -250.47 648.037 -249.349 647.663 -248.292 C 647.299 -247.244 646.72 -246.323 645.927 -245.53 C 645.143 -244.746 644.318 -244.195 643.452 -243.876 C 642.249 -243.429 640.805 -243.206 639.118 -243.206 C 638.143 -243.206 637.077 -243.274 635.919 -243.411 C 634.771 -243.548 633.809 -243.817 633.034 -244.218 C 632.26 -244.628 631.549 -245.207 630.902 -245.954 C 630.264 -246.701 629.826 -247.472 629.589 -248.265 C 629.206 -249.541 629.015 -250.671 629.015 -251.655 L 629.015 -263.604 L 635.195 -263.604 L 635.195 -251.368 C 635.195 -250.274 635.495 -249.418 636.097 -248.798 C 636.708 -248.187 637.551 -247.882 638.626 -247.882 C 639.693 -247.882 640.527 -248.183 641.128 -248.784 C 641.739 -249.395 642.044 -250.256 642.044 -251.368 L 642.044 -263.604 z M 604.898 -253.569 C 604.898 -256.841 605.809 -259.389 607.632 -261.212 C 609.455 -263.035 611.993 -263.946 615.247 -263.946 C 618.583 -263.946 621.154 -263.048 622.958 -261.253 C 624.763 -259.466 625.665 -256.96 625.665 -253.733 C 625.665 -251.391 625.269 -249.468 624.476 -247.964 C 623.692 -246.469 622.553 -245.302 621.058 -244.464 C 619.572 -243.634 617.717 -243.22 615.493 -243.22 C 613.233 -243.22 611.36 -243.58 609.874 -244.3 C 608.398 -245.02 607.199 -246.159 606.279 -247.718 C 605.358 -249.276 604.898 -251.227 604.898 -253.569 z M 611.091 -253.542 C 611.091 -251.518 611.465 -250.065 612.212 -249.181 C 612.969 -248.296 613.994 -247.854 615.288 -247.854 C 616.619 -247.854 617.649 -248.287 618.378 -249.153 C 619.107 -250.019 619.472 -251.573 619.472 -253.815 C 619.472 -255.702 619.089 -257.078 618.324 -257.944 C 617.567 -258.819 616.537 -259.257 615.234 -259.257 C 613.985 -259.257 612.982 -258.815 612.226 -257.931 C 611.469 -257.046 611.091 -255.584 611.091 -253.542 z M 584.048 -263.604 L 602.874 -263.604 L 602.874 -258.655 L 596.558 -258.655 L 596.558 -243.561 L 590.365 -243.561 L 590.365 -258.655 L 584.048 -258.655 L 584.048 -263.604 z M 565.208 -263.604 L 575.503 -263.604 C 577.745 -263.604 579.423 -263.071 580.534 -262.005 C 581.656 -260.938 582.216 -259.421 582.216 -257.452 C 582.216 -255.429 581.605 -253.847 580.384 -252.708 C 579.172 -251.569 577.317 -250.999 574.82 -250.999 L 571.429 -250.999 L 571.429 -243.561 L 565.208 -243.561 L 565.208 -263.604 z M 571.429 -255.059 L 572.947 -255.059 C 574.141 -255.059 574.979 -255.265 575.462 -255.675 C 575.945 -256.094 576.187 -256.627 576.187 -257.274 C 576.187 -257.903 575.977 -258.436 575.558 -258.874 C 575.139 -259.311 574.35 -259.53 573.193 -259.53 L 571.429 -259.53 L 571.429 -255.059 z M 544.988 -263.604 L 555.283 -263.604 C 557.525 -263.604 559.202 -263.071 560.314 -262.005 C 561.435 -260.938 561.995 -259.421 561.995 -257.452 C 561.995 -255.429 561.385 -253.847 560.163 -252.708 C 558.951 -251.569 557.096 -250.999 554.599 -250.999 L 551.208 -250.999 L 551.208 -243.561 L 544.988 -243.561 L 544.988 -263.604 z M 551.208 -255.059 L 552.726 -255.059 C 553.92 -255.059 554.758 -255.265 555.242 -255.675 C 555.725 -256.094 555.966 -256.627 555.966 -257.274 C 555.966 -257.903 555.756 -258.436 555.337 -258.874 C 554.918 -259.311 554.13 -259.53 552.972 -259.53 L 551.208 -259.53 L 551.208 -255.059 z "
+       id="path300" />
+    <path
+       style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+       id="path301"
+       d="M 273.538 531.341 C 273.538 534.877 271.965 538.196 271.965 541.833 C 271.28 544.572 272.408 549.784 270.391 551.801 C 270.391 552.49 269.973 557.047 270.916 557.047 C 273.294 554.074 273.014 552.658 273.014 549.178 C 273.014 546.38 276.162 537.811 276.162 535.013 C 277.608 532.121 274.588 535.792 274.588 532.39 C 274.46 537.892 274.063 535.792 273.538 531.341 z "
+       transform="matrix(-0.659498,0,0,1,407.671,-222.884)" />
+    <path
+       style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+       id="path302"
+       d="M 296.621 694.493 C 296.621 692.566 285.513 674.283 284.031 669.836 C 282.853 669.247 282.178 669.311 280.883 669.311 C 275.366 666.947 279.288 647.142 273.538 642.033 C 268.509 632.036 273.742 629.526 271.965 624.196 C 271.221 620.846 273.539 610.448 273.014 607.409 C 276.32 605.835 274.063 615.832 273.539 621.573 C 276.463 624.497 267.529 630.013 269.342 633.639 C 270.038 636.421 280.183 652.874 277.736 664.59 C 281.287 667.549 280.472 667.426 284.556 668.787 C 286.127 673.5 292.451 686.678 293.998 690.82 C 294.408 692.458 295.884 693.017 296.621 694.493 z "
+       transform="matrix(-1,0,0,1,501.314,-220.786)" />
+    <path
+       style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+       id="path303"
+       d="M 267.768 585.376 C 267.768 581.887 267.8 575.9 270.391 573.309 C 272.27 577.067 274.588 582.227 274.588 586.424 C 278.282 590.117 274.968 583.041 276.162 580.654 C 276.162 577.285 281.337 582.753 280.883 567.539 C 279.813 568.875 279.592 577.89 278.26 578.555 C 275.881 582.125 280.783 585.376 275.637 585.376 C 272.847 584.446 270.392 580.047 270.392 577.507 C 270.041 579.261 268.293 583.154 267.768 585.376 z "
+       transform="matrix(-1,0,0,1,501.314,-220.786)" />
+    <path
+       style="font-size:12;fill:#0000b3;fill-rule:evenodd;"
+       id="path306"
+       d="M 236.817 681.378 C 236.817 675.607 236.817 669.836 236.817 664.066 C 236.817 660.9 236.444 657.466 237.866 654.623 C 237.866 653.33 236.819 642.088 237.353 640.487 C 242.01 640.487 244.686 653.875 244.686 657.246 C 244.911 658.488 248.085 662.773 246.254 664.605 C 247.93 667.119 247.146 670.361 250.456 670.361 C 251.433 668.407 251.867 670.18 253.604 669.312 C 255.207 667.708 256.702 665.115 258.85 665.115 C 263.783 663.705 262.522 664.105 262.522 667.738 C 261.482 671.899 273.934 676.652 279.258 676.652 C 282.919 678.482 267.724 680.284 270.391 682.951 C 271.252 683.812 274.65 684.525 271.965 684.525 C 266.746 684.525 267.285 683.98 264.096 685.574 C 262.278 685.938 260.424 685.64 260.424 687.673 C 255.719 688.614 251.288 687.673 246.784 687.673 C 243.027 687.255 238.39 687.934 238.39 683.476 C 237.892 682.479 237.866 682.36 236.817 681.378 z "
+       transform="matrix(-1,0,0,1,501.314,-220.786)" />
+    <path
+       style="font-size:12;fill:#0000ff;fill-rule:evenodd;"
+       d="M 231.571 679.804 C 231.221 688.373 232.446 696.416 230.522 705.51 C 254.828 707.608 273.889 707.608 298.195 711.805 C 298.545 701.313 300.993 690.821 299.769 680.329 C 277.036 680.154 254.304 679.979 231.571 679.804 z "
+       id="path304"
+       transform="translate(-30.129,-220.786)" />
+    <path
+       style="font-size:12;fill:#0000b3;fill-rule:evenodd;"
+       id="path310"
+       d="M 268.487 701.499 C 264.483 701.499 257.41 704.112 253.328 704.112 C 248.013 705.441 242.082 704.635 236.602 704.635 C 236.602 702.986 235.556 704.023 235.556 702.021 C 235.556 699.071 232.943 696.879 232.943 694.181 C 231.681 691.656 232.452 688.89 233.466 686.863 C 237.299 686.863 241.132 686.863 244.965 686.863 C 246.351 686.17 243.864 684.827 241.829 686.863 C 239.746 687.557 243.397 688.703 243.397 691.044 C 243.397 693.546 244.746 696.271 247.578 696.271 C 248.498 696.822 254.497 700.177 255.419 702.021 C 257.569 702.559 260.282 701.055 262.214 702.021 C 263.746 702.532 267.965 701.499 268.487 701.499 z "
+       transform="translate(-30.129,-220.786)" />
+    <path
+       style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+       id="path311"
+       d="M 242.063 691.17 C 242.063 692.577 244.521 692.239 245.21 693.618 C 247.075 695.483 247.748 698.515 250.806 698.515 C 253.39 699.484 255.555 700.797 258.15 701.662 C 262.464 702.895 265.83 702.367 270.041 700.963 C 273 699.272 273.799 695.047 277.036 693.968 C 280.091 692.659 281.305 696.345 283.331 694.318 C 284.962 693.231 287.223 693.574 288.577 692.219 C 290.733 692.219 291.292 690.82 293.474 690.82 C 294.055 690.82 298.02 691.429 298.02 690.121 C 294.609 690.121 290.861 692.086 287.528 692.919 C 285.337 693.138 283.035 693.968 280.883 693.968 C 277.7 694.764 275.097 697.815 271.79 697.815 C 268.228 700.19 267.201 700.263 263.047 700.263 C 260.934 700.968 253.431 701.226 251.506 700.263 C 250.376 699.134 249.839 698.556 248.358 697.815 C 247.493 696.951 246.882 695.017 245.56 695.017 C 245.042 693.465 244.161 694.344 244.161 692.569 C 243.27 692.124 243.673 691.87 242.063 691.17 z "
+       transform="translate(-30.129,-220.786)" />
+    <g
+       id="g369"
+       transform="matrix(-1,-0,-0,1,473.216,-7.62939e-06)">
+      <path
+         style="font-size:12;fill:#0000b3;fill-rule:evenodd;"
+         d="M 231.571 679.804 L 232.096 691.346 L 301.867 689.772 L 299.769 680.329 L 231.571 679.804 z "
+         id="path305"
+         transform="translate(-30.129,-223.934)" />
+      <path
+         style="font-size:12;fill:#0000ff;fill-rule:evenodd;"
+         d="M 231.221 680.679 C 228.678 680.644 228.939 687.231 230.697 689.073 C 232.567 691.381 300.278 690.846 302.566 690.122 C 305.267 689.38 303.929 683.217 302.566 680.679 C 301.591 679.513 253.001 681.323 231.221 680.679 z "
+         id="path307"
+         transform="translate(-30.129,-225.333)" />
+      <path
+         style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+         id="path308"
+         d="M 237.341 683.476 C 236.991 686.4 236.903 676.306 238.39 677.705 C 239.559 677.199 239.639 683.452 237.341 683.476 z "
+         transform="translate(-31.877,-220.786)" />
+      <path
+         style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+         id="path309"
+         d="M 237.341 683.476 C 236.991 686.4 236.204 677.355 237.691 678.754 C 238.86 678.248 239.639 683.452 237.341 683.476 z "
+         transform="translate(-25.232,-220.786)" />
+    </g>
+  </g>
+  <path
+     style="font-size:64;font-weight:normal;stroke-width:1pt;font-family:Impact;"
+     d="M 400.854 329.034 L 400.854 335.565 L 404.261 335.565 L 404.261 342.128 L 400.854 342.128 L 400.854 364.315 C 400.854 367.044 400.99 368.565 401.261 368.878 C 401.552 369.19 402.729 369.346 404.792 369.346 L 404.792 376.034 L 399.698 376.034 C 396.823 376.034 394.771 375.919 393.542 375.69 C 392.313 375.44 391.229 374.888 390.292 374.034 C 389.354 373.159 388.771 372.169 388.542 371.065 C 388.313 369.94 388.198 367.315 388.198 363.19 L 388.198 342.128 L 385.479 342.128 L 385.479 335.565 L 388.198 335.565 L 388.198 329.034 L 400.854 329.034 z M 383.011 334.565 L 383.011 376.034 L 370.167 376.034 L 370.386 372.596 C 369.511 373.992 368.427 375.044 367.136 375.753 C 365.865 376.44 364.396 376.784 362.729 376.784 C 360.834 376.784 359.261 376.451 358.011 375.784 C 356.761 375.117 355.834 374.232 355.229 373.128 C 354.646 372.024 354.282 370.878 354.136 369.69 C 353.99 368.482 353.917 366.096 353.917 362.534 L 353.917 334.565 L 366.542 334.565 L 366.542 362.784 C 366.542 366.013 366.636 367.93 366.823 368.534 C 367.032 369.138 367.573 369.44 368.448 369.44 C 369.386 369.44 369.938 369.128 370.104 368.503 C 370.292 367.878 370.386 365.867 370.386 362.471 L 370.386 334.565 L 383.011 334.565 z M 349.948 349.128 L 349.948 359.284 C 349.948 363.013 349.761 365.753 349.386 367.503 C 349.011 369.232 348.209 370.857 346.979 372.378 C 345.75 373.878 344.167 374.992 342.229 375.721 C 340.313 376.43 338.104 376.784 335.604 376.784 C 332.813 376.784 330.448 376.482 328.511 375.878 C 326.573 375.253 325.063 374.326 323.979 373.096 C 322.917 371.846 322.157 370.346 321.698 368.596 C 321.24 366.826 321.011 364.18 321.011 360.659 L 321.011 350.034 C 321.011 346.18 321.427 343.169 322.261 341.003 C 323.094 338.836 324.594 337.096 326.761 335.784 C 328.927 334.471 331.698 333.815 335.073 333.815 C 337.907 333.815 340.334 334.242 342.354 335.096 C 344.396 335.93 345.969 337.024 347.073 338.378 C 348.177 339.732 348.927 341.128 349.323 342.565 C 349.74 344.003 349.948 346.19 349.948 349.128 z M 337.323 346.003 C 337.323 343.878 337.209 342.544 336.979 342.003 C 336.75 341.44 336.261 341.159 335.511 341.159 C 334.761 341.159 334.261 341.44 334.011 342.003 C 333.761 342.544 333.636 343.878 333.636 346.003 L 333.636 364.721 C 333.636 366.68 333.761 367.961 334.011 368.565 C 334.261 369.149 334.75 369.44 335.479 369.44 C 336.229 369.44 336.719 369.169 336.948 368.628 C 337.198 368.086 337.323 366.919 337.323 365.128 L 337.323 346.003 z M 315.198 329.034 L 315.198 335.565 L 318.604 335.565 L 318.604 342.128 L 315.198 342.128 L 315.198 364.315 C 315.198 367.044 315.334 368.565 315.604 368.878 C 315.896 369.19 317.073 369.346 319.136 369.346 L 319.136 376.034 L 314.042 376.034 C 311.167 376.034 309.115 375.919 307.886 375.69 C 306.657 375.44 305.573 374.888 304.636 374.034 C 303.698 373.159 303.115 372.169 302.886 371.065 C 302.657 369.94 302.542 367.315 302.542 363.19 L 302.542 342.128 L 299.823 342.128 L 299.823 335.565 L 302.542 335.565 L 302.542 329.034 L 315.198 329.034 z M 291.604 334.565 L 291.104 340.003 C 292.938 336.107 295.594 334.044 299.073 333.815 L 299.073 348.409 C 296.761 348.409 295.063 348.721 293.979 349.346 C 292.896 349.971 292.229 350.846 291.979 351.971 C 291.729 353.076 291.604 355.638 291.604 359.659 L 291.604 376.034 L 278.979 376.034 L 278.979 334.565 L 291.604 334.565 z M 258.011 350.628 L 246.167 350.628 L 246.167 347.846 C 246.167 344.638 246.532 342.169 247.261 340.44 C 248.011 338.69 249.5 337.149 251.729 335.815 C 253.959 334.482 256.854 333.815 260.417 333.815 C 264.688 333.815 267.907 334.576 270.073 336.096 C 272.24 337.596 273.542 339.451 273.979 341.659 C 274.417 343.846 274.636 348.367 274.636 355.221 L 274.636 376.034 L 262.354 376.034 L 262.354 372.346 C 261.584 373.826 260.584 374.94 259.354 375.69 C 258.146 376.419 256.698 376.784 255.011 376.784 C 252.802 376.784 250.771 376.169 248.917 374.94 C 247.084 373.69 246.167 370.971 246.167 366.784 L 246.167 363.378 C 246.167 360.274 246.657 358.159 247.636 357.034 C 248.615 355.909 251.042 354.596 254.917 353.096 C 259.063 351.471 261.282 350.378 261.573 349.815 C 261.865 349.253 262.011 348.107 262.011 346.378 C 262.011 344.211 261.844 342.805 261.511 342.159 C 261.198 341.492 260.667 341.159 259.917 341.159 C 259.063 341.159 258.532 341.44 258.323 342.003 C 258.115 342.544 258.011 343.971 258.011 346.284 L 258.011 350.628 z M 262.011 356.315 C 259.99 357.794 258.813 359.034 258.479 360.034 C 258.167 361.034 258.011 362.471 258.011 364.346 C 258.011 366.492 258.146 367.878 258.417 368.503 C 258.709 369.128 259.271 369.44 260.104 369.44 C 260.896 369.44 261.407 369.201 261.636 368.721 C 261.886 368.221 262.011 366.93 262.011 364.846 L 262.011 356.315 z M 226.354 334.565 L 226.136 338.221 C 227.261 336.742 228.5 335.638 229.854 334.909 C 231.209 334.18 232.688 333.815 234.292 333.815 C 236.25 333.815 237.938 334.346 239.354 335.409 C 240.792 336.451 241.688 337.659 242.042 339.034 C 242.396 340.409 242.573 342.742 242.573 346.034 L 242.573 363.503 C 242.573 367.274 242.344 369.961 241.886 371.565 C 241.448 373.149 240.532 374.419 239.136 375.378 C 237.761 376.315 236.094 376.784 234.136 376.784 C 232.573 376.784 231.125 376.419 229.792 375.69 C 228.459 374.961 227.24 373.878 226.136 372.44 L 226.136 381.94 L 213.511 381.94 L 213.511 334.565 L 226.354 334.565 z M 229.948 346.628 C 229.948 344.065 229.854 342.513 229.667 341.971 C 229.479 341.43 228.959 341.159 228.104 341.159 C 227.271 341.159 226.729 341.471 226.479 342.096 C 226.25 342.721 226.136 344.232 226.136 346.628 L 226.136 363.815 C 226.136 366.315 226.261 367.878 226.511 368.503 C 226.761 369.128 227.302 369.44 228.136 369.44 C 228.948 369.44 229.448 369.159 229.636 368.596 C 229.844 368.013 229.948 366.617 229.948 364.409 L 229.948 346.628 z M 209.386 356.034 L 193.042 356.034 L 193.042 365.003 C 193.042 366.878 193.177 368.086 193.448 368.628 C 193.719 369.169 194.24 369.44 195.011 369.44 C 195.969 369.44 196.604 369.086 196.917 368.378 C 197.25 367.649 197.417 366.253 197.417 364.19 L 197.417 358.721 L 209.386 358.721 L 209.386 361.784 C 209.386 364.346 209.219 366.315 208.886 367.69 C 208.573 369.065 207.823 370.534 206.636 372.096 C 205.448 373.659 203.938 374.836 202.104 375.628 C 200.292 376.399 198.011 376.784 195.261 376.784 C 192.594 376.784 190.24 376.399 188.198 375.628 C 186.157 374.857 184.563 373.805 183.417 372.471 C 182.292 371.117 181.511 369.638 181.073 368.034 C 180.636 366.409 180.417 364.055 180.417 360.971 L 180.417 348.878 C 180.417 345.253 180.907 342.399 181.886 340.315 C 182.865 338.211 184.469 336.607 186.698 335.503 C 188.927 334.378 191.49 333.815 194.386 333.815 C 197.927 333.815 200.844 334.492 203.136 335.846 C 205.448 337.18 207.063 338.961 207.979 341.19 C 208.917 343.399 209.386 346.513 209.386 350.534 L 209.386 356.034 z M 196.729 349.284 L 196.729 346.253 C 196.729 344.107 196.615 342.721 196.386 342.096 C 196.157 341.471 195.688 341.159 194.979 341.159 C 194.104 341.159 193.563 341.43 193.354 341.971 C 193.146 342.492 193.042 343.919 193.042 346.253 L 193.042 349.284 L 196.729 349.284 z M 176.448 347.815 L 165.261 347.815 L 165.261 345.565 C 165.261 343.649 165.146 342.44 164.917 341.94 C 164.709 341.419 164.167 341.159 163.292 341.159 C 162.584 341.159 162.052 341.399 161.698 341.878 C 161.344 342.336 161.167 343.034 161.167 343.971 C 161.167 345.242 161.25 346.18 161.417 346.784 C 161.604 347.367 162.136 348.013 163.011 348.721 C 163.907 349.43 165.729 350.461 168.479 351.815 C 172.146 353.607 174.552 355.294 175.698 356.878 C 176.844 358.461 177.417 360.763 177.417 363.784 C 177.417 367.159 176.979 369.711 176.104 371.44 C 175.229 373.149 173.761 374.471 171.698 375.409 C 169.657 376.326 167.188 376.784 164.292 376.784 C 161.084 376.784 158.334 376.284 156.042 375.284 C 153.771 374.284 152.209 372.93 151.354 371.221 C 150.5 369.513 150.073 366.93 150.073 363.471 L 150.073 361.471 L 161.261 361.471 L 161.261 364.096 C 161.261 366.326 161.396 367.774 161.667 368.44 C 161.959 369.107 162.521 369.44 163.354 369.44 C 164.25 369.44 164.875 369.221 165.229 368.784 C 165.584 368.326 165.761 367.378 165.761 365.94 C 165.761 363.961 165.532 362.721 165.073 362.221 C 164.594 361.721 162.146 360.242 157.729 357.784 C 154.021 355.701 151.761 353.815 150.948 352.128 C 150.136 350.419 149.729 348.399 149.729 346.065 C 149.729 342.753 150.167 340.315 151.042 338.753 C 151.917 337.169 153.396 335.951 155.479 335.096 C 157.584 334.242 160.021 333.815 162.792 333.815 C 165.542 333.815 167.875 334.169 169.792 334.878 C 171.729 335.565 173.209 336.482 174.229 337.628 C 175.271 338.774 175.896 339.836 176.104 340.815 C 176.334 341.794 176.448 343.326 176.448 345.409 L 176.448 347.815 z M 146.323 347.815 L 135.136 347.815 L 135.136 345.565 C 135.136 343.649 135.021 342.44 134.792 341.94 C 134.584 341.419 134.042 341.159 133.167 341.159 C 132.459 341.159 131.927 341.399 131.573 341.878 C 131.219 342.336 131.042 343.034 131.042 343.971 C 131.042 345.242 131.125 346.18 131.292 346.784 C 131.48 347.367 132.011 348.013 132.886 348.721 C 133.782 349.43 135.605 350.461 138.355 351.815 C 142.021 353.607 144.427 355.294 145.573 356.878 C 146.719 358.461 147.292 360.763 147.292 363.784 C 147.292 367.159 146.855 369.711 145.98 371.44 C 145.105 373.149 143.636 374.471 141.573 375.409 C 139.532 376.326 137.063 376.784 134.167 376.784 C 130.959 376.784 128.209 376.284 125.917 375.284 C 123.646 374.284 122.084 372.93 121.229 371.221 C 120.375 369.513 119.948 366.93 119.948 363.471 L 119.948 361.471 L 131.136 361.471 L 131.136 364.096 C 131.136 366.326 131.271 367.774 131.542 368.44 C 131.834 369.107 132.396 369.44 133.23 369.44 C 134.125 369.44 134.75 369.221 135.105 368.784 C 135.459 368.326 135.636 367.378 135.636 365.94 C 135.636 363.961 135.407 362.721 134.948 362.221 C 134.469 361.721 132.021 360.242 127.605 357.784 C 123.896 355.701 121.636 353.815 120.823 352.128 C 120.011 350.419 119.604 348.399 119.604 346.065 C 119.604 342.753 120.042 340.315 120.917 338.753 C 121.792 337.169 123.271 335.951 125.355 335.096 C 127.459 334.242 129.896 333.815 132.667 333.815 C 135.417 333.815 137.75 334.169 139.667 334.878 C 141.605 335.565 143.084 336.482 144.105 337.628 C 145.146 338.774 145.771 339.836 145.98 340.815 C 146.209 341.794 146.323 343.326 146.323 345.409 L 146.323 347.815 z M 99.5733 350.628 L 87.7295 350.628 L 87.7295 347.846 C 87.7295 344.638 88.0941 342.169 88.8232 340.44 C 89.5732 338.69 91.0628 337.149 93.292 335.815 C 95.5212 334.482 98.417 333.815 101.98 333.815 C 106.25 333.815 109.469 334.576 111.636 336.096 C 113.802 337.596 115.105 339.451 115.542 341.659 C 115.98 343.846 116.198 348.367 116.198 355.221 L 116.198 376.034 L 103.917 376.034 L 103.917 372.346 C 103.146 373.826 102.146 374.94 100.917 375.69 C 99.7087 376.419 98.2608 376.784 96.5733 376.784 C 94.3649 376.784 92.3337 376.169 90.4795 374.94 C 88.6462 373.69 87.7295 370.971 87.7295 366.784 L 87.7295 363.378 C 87.7295 360.274 88.2191 358.159 89.1982 357.034 C 90.1774 355.909 92.6045 354.596 96.4795 353.096 C 100.625 351.471 102.844 350.378 103.136 349.815 C 103.427 349.253 103.573 348.107 103.573 346.378 C 103.573 344.211 103.407 342.805 103.073 342.159 C 102.761 341.492 102.23 341.159 101.48 341.159 C 100.625 341.159 100.094 341.44 99.8858 342.003 C 99.6774 342.544 99.5733 343.971 99.5733 346.284 L 99.5733 350.628 z M 103.573 356.315 C 101.552 357.794 100.375 359.034 100.042 360.034 C 99.7295 361.034 99.5733 362.471 99.5733 364.346 C 99.5733 366.492 99.7087 367.878 99.9795 368.503 C 100.271 369.128 100.834 369.44 101.667 369.44 C 102.459 369.44 102.969 369.201 103.198 368.721 C 103.448 368.221 103.573 366.93 103.573 364.846 L 103.573 356.315 z M 56.542 325.44 L 69.792 325.44 C 73.3753 325.44 76.1253 325.721 78.042 326.284 C 79.9795 326.846 81.4274 327.659 82.3858 328.721 C 83.3649 329.784 84.0212 331.076 84.3545 332.596 C 84.7087 334.096 84.8858 336.43 84.8858 339.596 L 84.8858 344.003 C 84.8858 347.232 84.5524 349.586 83.8858 351.065 C 83.2191 352.544 81.9899 353.68 80.1983 354.471 C 78.4274 355.263 76.1045 355.659 73.2295 355.659 L 69.6983 355.659 L 69.6983 376.034 L 56.542 376.034 L 56.542 325.44 z M 69.6983 334.096 L 69.6983 346.971 C 70.0733 346.992 70.3962 347.003 70.667 347.003 C 71.8753 347.003 72.7087 346.711 73.167 346.128 C 73.6462 345.524 73.8858 344.284 73.8858 342.409 L 73.8858 338.253 C 73.8858 336.524 73.6149 335.399 73.0733 334.878 C 72.5316 334.357 71.4066 334.096 69.6983 334.096 z "
+     id="path481" />
+</svg>
diff -Nur -x CVS passepartout-0.6/logotype/pptout-sv.svg passepartout/logotype/pptout-sv.svg
--- passepartout-0.6/logotype/pptout-sv.svg	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/logotype/pptout-sv.svg	2003-09-05 00:54:03.000000000 +0200
@@ -0,0 +1,120 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
+"http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
+<!-- Created with Sodipodi ("http://www.sodipodi.com/") -->
+<svg
+   version="1"
+   x="0"
+   y="0"
+   width="453.543"
+   height="416.693"
+   id="svg37"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:xlink="http://www.w3.org/1999/xlink"
+   sodipodi:version="0.31.1"
+   sodipodi:docname="/home/fredrik/bilder/pptout/pptout-sv.svg"
+   sodipodi:docbase="/home/fredrik/bilder/pptout/">
+  <sodipodi:namedview
+     id="base"
+     snaptogrid="false"
+     gridspacingx="2mm"
+     gridspacingy="2mm" />
+  <defs
+     id="defs39" />
+  <path
+     d="M 242.592 192.036 C 300.139 229.643 300.718 233.026 328.469 255.704 C 326.489 246.539 328.503 236.291 334.666 228.393 C 351.548 208.382 382.651 224.056 395.247 233.907 C 407.053 243.146 432.182 269.13 413.068 294.875 C 393.162 320.008 360.889 301.027 350.548 293.029 C 340.998 285.643 338.136 279.807 326.725 267.189 C 323.909 264.137 280.846 235.496 276.816 233.647 C 263.702 227.558 250.731 233.845 245.417 233.382 C 215.215 212.957 64.1092 90.532 67.2861 76.511 C 89.7636 78.6962 234.695 186.863 242.592 192.036 z M 388.591 242.716 C 405.239 255.591 411.85 274.966 403.346 285.961 C 394.842 296.956 374.428 295.429 357.78 282.554 C 341.131 269.677 334.521 250.304 343.025 239.309 C 351.529 228.313 371.942 229.84 388.591 242.716 L 373.186 262.635 L 388.591 242.716 z "
+     style="font-size:12;fill:#000000;fill-rule:evenodd;fill-opacity:1;"
+     id="path259"
+     transform="matrix(-1,0,0,1,458.262,-38.007)"
+     sodipodi:nodetypes="cccccccccccccccccc" />
+  <path
+     d="M 76.9797 243.416 C 60.2322 256.162 53.4712 275.484 61.8893 286.545 C 70.3075 297.606 90.7327 296.237 107.48 283.491 C 124.228 270.745 130.989 251.423 122.57 240.362 C 114.152 229.301 93.7279 230.669 76.9797 243.416 L 92.2299 263.453 L 76.9797 243.416 z M 223.349 196.369 C 165.512 233.529 164.926 234.407 137 256.87 C 139.05 247.72 137.102 239.313 131.001 231.367 C 114.274 211.225 83.0505 224.812 70.3777 234.565 C 58.5007 243.712 33.8198 268.889 52.7341 294.782 C 72.4443 320.069 104.869 301.935 115.271 294.017 C 124.879 286.706 127.146 280.897 138.654 268.368 C 141.494 265.337 184.778 237.031 188.822 235.214 C 201.984 229.227 214.905 235.614 220.223 235.192 C 250.582 215.003 402.057 101.259 398.935 80.3287 C 391.465 79.331 231.285 191.258 223.349 196.369 z "
+     style="font-size:12;fill:#000000;fill-rule:evenodd;fill-opacity:1;"
+     id="path254"
+     transform="matrix(-1,0,0,1,458.262,-38.007)"
+     sodipodi:nodetypes="cccccccccccccccccc" />
+  <path
+     d="M 351.497 581.557 L 334.405 600.245 C 336.212 606.773 342.834 605.789 345.008 604.871 C 346.887 603.655 354.183 594.684 351.497 581.557 z "
+     transform="matrix(0.605624,-0.795751,0.795751,0.605624,-414.04,101.33)"
+     style="font-size:12;fill:#ffffff;fill-rule:evenodd;"
+     id="path1811"
+     sodipodi:nodetypes="cccc" />
+  <path
+     d="M 328.45 534.948 C 327.629 480.984 329.321 390.557 333.821 363.242 C 336.574 379.034 341.115 458.515 343.441 533.049 L 328.45 534.948 z "
+     transform="matrix(-0.611781,-0.791027,-0.791027,0.611781,863.536,91.962)"
+     style="font-size:12;fill:#ffffff;fill-rule:evenodd;fill-opacity:1;"
+     id="path1748"
+     sodipodi:nodetypes="cccc" />
+  <path
+     style="font-size:12;fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:2.5;stroke-linecap:round;stroke-linejoin:round;"
+     d="M 61.3649 249.198 C 75.5266 231.734 102.58 219.671 117.419 224.936 "
+     id="path241"
+     sodipodi:nodetypes="cc"
+     transform="translate(-7.07108,-38.007)" />
+  <path
+     style="font-size:12;fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:2.5;stroke-linecap:round;"
+     d="M 72.7566 297.799 C 83.7658 299.433 104.316 297.653 120.906 276.041 "
+     id="path242"
+     sodipodi:nodetypes="cc"
+     transform="translate(-7.07108,-38.007)" />
+  <path
+     style="font-size:12;fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:2.5;stroke-linecap:round;"
+     d="M 334.877 260.131 C 334.877 260.131 330.195 247.923 336.978 238.63 "
+     id="path243"
+     sodipodi:nodetypes="cc"
+     transform="translate(-7.79995,-38.632)" />
+  <path
+     style="font-size:12;fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:2.5;stroke-linecap:round;"
+     d="M 139.769 257.924 C 191.132 215.216 214.267 202.213 221.142 200.338 "
+     id="path244"
+     sodipodi:nodetypes="cc"
+     transform="translate(-8.98573,-36.0924)" />
+  <path
+     style="font-size:12;fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-width:2.5;stroke-linecap:round;"
+     d="M 400.786 295.113 C 411.423 290.952 414.375 276.923 410.839 267.204 "
+     id="path245"
+     sodipodi:nodetypes="cc"
+     transform="translate(-7.74803,-38.007)" />
+  <path
+     style="fill:#000000;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.62414;stroke-linejoin:miter;stroke-linecap:butt;fill-opacity:1;stroke-dasharray:none;"
+     d="M 198.75 132.318 C 198.75 132.318 259.375 132.318 259.375 132.318 C 259.375 132.318 261.036 279.891 259.786 304.266 C 267.911 303.641 272.071 328.805 261.25 347.148 C 242.347 336.526 229.715 358.145 212.5 349.193 C 204.374 344.642 201.25 310.473 203.125 288.65 C 204.903 273.133 198.125 133.568 198.75 132.318 z "
+     id="path422"
+     sodipodi:nodetypes="ccccssc"
+     transform="matrix(1,0,0,0.907624,-5.30331,-3.68695)" />
+  <path
+     style="fill:none;fill-rule:evenodd;stroke:#ffffff;stroke-opacity:1;stroke-width:2.90449;stroke-linejoin:miter;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+     d="M 200.576 313.228 C 200.576 313.228 203.173 348.576 217.26 346.851 C 226.635 347.476 225.277 337.729 220.288 312.168 C 218.49 304.054 205.816 309.501 213.605 327.484 "
+     id="path423"
+     sodipodi:nodetypes="ccss"
+     transform="matrix(0.928423,0,0,0.797987,9.98542,31.0247)" />
+  <path
+     style="font-size:12;font-weight:bold;stroke-width:1pt;font-family:Arial;fill:#ffffff;fill-opacity:1;"
+     d="M 207.895 77.943 L 207.895 70.8062 L 205.346 70.8062 L 205.346 69.3531 L 212.172 69.3531 L 212.172 70.8062 L 209.629 70.8062 L 209.629 77.943 L 207.895 77.943 z M 197.283 69.3531 L 199.018 69.3531 L 199.018 74.0055 C 199.018 74.7437 199.039 75.2223 199.082 75.441 C 199.156 75.7926 199.332 76.0758 199.609 76.2906 C 199.891 76.5015 200.273 76.607 200.758 76.607 C 201.25 76.607 201.621 76.5074 201.871 76.3082 C 202.121 76.1051 202.271 75.857 202.322 75.564 C 202.373 75.2711 202.398 74.7848 202.398 74.1051 L 202.398 69.3531 L 204.133 69.3531 L 204.133 73.8648 C 204.133 74.8961 204.086 75.6246 203.992 76.0504 C 203.898 76.4762 203.725 76.8355 203.471 77.1285 C 203.221 77.4215 202.885 77.6558 202.463 77.8316 C 202.041 78.0035 201.49 78.0894 200.811 78.0894 C 199.99 78.0894 199.367 77.9957 198.941 77.8082 C 198.52 77.6168 198.186 77.3707 197.939 77.0699 C 197.693 76.7652 197.531 76.4469 197.453 76.1148 C 197.34 75.6226 197.283 74.8961 197.283 73.9351 L 197.283 69.3531 z M 187.609 73.7008 C 187.609 72.8258 187.74 72.0914 188.002 71.4976 C 188.197 71.0601 188.463 70.6676 188.799 70.3199 C 189.139 69.9723 189.51 69.7144 189.912 69.5465 C 190.447 69.3199 191.064 69.2066 191.764 69.2066 C 193.029 69.2066 194.041 69.5992 194.799 70.3844 C 195.561 71.1695 195.941 72.2613 195.941 73.6598 C 195.941 75.0465 195.564 76.1324 194.811 76.9176 C 194.057 77.6988 193.049 78.0894 191.787 78.0894 C 190.51 78.0894 189.494 77.7008 188.74 76.9234 C 187.986 76.1422 187.609 75.068 187.609 73.7008 z M 189.396 73.6422 C 189.396 74.6148 189.621 75.3531 190.07 75.857 C 190.52 76.357 191.09 76.607 191.781 76.607 C 192.473 76.607 193.039 76.359 193.48 75.8629 C 193.926 75.3629 194.148 74.6148 194.148 73.6187 C 194.148 72.6344 193.932 71.9 193.498 71.4156 C 193.068 70.9312 192.496 70.689 191.781 70.689 C 191.066 70.689 190.49 70.9351 190.053 71.4273 C 189.615 71.9156 189.396 72.6539 189.396 73.6422 z M 182.564 77.943 L 182.564 70.8062 L 180.016 70.8062 L 180.016 69.3531 L 186.842 69.3531 L 186.842 70.8062 L 184.299 70.8062 L 184.299 77.943 L 182.564 77.943 z M 172.627 77.943 L 172.627 69.3531 L 175.41 69.3531 C 176.465 69.3531 177.152 69.3961 177.473 69.482 C 177.965 69.6109 178.377 69.8922 178.709 70.3258 C 179.041 70.7555 179.207 71.3121 179.207 71.9957 C 179.207 72.523 179.111 72.9664 178.92 73.3258 C 178.729 73.6851 178.484 73.9683 178.188 74.1754 C 177.895 74.3785 177.596 74.5133 177.291 74.5797 C 176.877 74.6617 176.277 74.7027 175.492 74.7027 L 174.361 74.7027 L 174.361 77.943 L 172.627 77.943 z M 174.361 70.8062 L 174.361 73.2437 L 175.311 73.2437 C 175.994 73.2437 176.451 73.1988 176.682 73.109 C 176.912 73.0191 177.092 72.8785 177.221 72.6871 C 177.354 72.4957 177.42 72.273 177.42 72.0191 C 177.42 71.7066 177.328 71.4488 177.145 71.2457 C 176.961 71.0426 176.729 70.9156 176.447 70.8648 C 176.24 70.8258 175.824 70.8062 175.199 70.8062 L 174.361 70.8062 z M 164.623 77.943 L 164.623 69.3531 L 167.406 69.3531 C 168.461 69.3531 169.148 69.3961 169.469 69.482 C 169.961 69.6109 170.373 69.8922 170.705 70.3258 C 171.037 70.7555 171.203 71.3121 171.203 71.9957 C 171.203 72.523 171.107 72.9664 170.916 73.3258 C 170.725 73.6851 170.48 73.9683 170.184 74.1754 C 169.891 74.3785 169.592 74.5133 169.287 74.5797 C 168.873 74.6617 168.273 74.7027 167.488 74.7027 L 166.357 74.7027 L 166.357 77.943 L 164.623 77.943 z M 166.357 70.8062 L 166.357 73.2437 L 167.307 73.2437 C 167.99 73.2437 168.447 73.1988 168.678 73.109 C 168.908 73.0191 169.088 72.8785 169.217 72.6871 C 169.35 72.4957 169.416 72.273 169.416 72.0191 C 169.416 71.7066 169.324 71.4488 169.141 71.2457 C 168.957 71.0426 168.725 70.9156 168.443 70.8648 C 168.236 70.8258 167.82 70.8062 167.195 70.8062 L 166.357 70.8062 z "
+     id="path469"
+     transform="matrix(1.34469e-16,2.6299,-2.19613,1.61029e-16,386.398,-301.478)" />
+  <path
+     style="fill:none;fill-rule:evenodd;stroke:black;stroke-opacity:1;stroke-width:2.5;stroke-linejoin:round;stroke-linecap:round;fill-opacity:1;stroke-dasharray:none;"
+     d="M 201.406 134.349 L 230.625 109.193 L 256.719 134.349 L 201.406 134.349 z "
+     id="path470"
+     sodipodi:nodetypes="cccc"
+     transform="translate(-5.30331,-15.9099)" />
+  <g
+     id="g473"
+     transform="translate(-5.30331,-15.9099)">
+    <path
+       style="fill:#000000;fill-rule:evenodd;stroke:none;stroke-opacity:1;stroke-width:1pt;stroke-linejoin:miter;stroke-linecap:butt;fill-opacity:1;"
+       d="M 212.598 119.055 L 248.031 119.055 L 240.945 83.6221 L 219.685 83.6221 L 212.598 119.055 z "
+       id="path471"
+       sodipodi:nodetypes="ccccc" />
+    <path
+       style="fill:#ffffff;fill-rule:evenodd;stroke:none;stroke-opacity:1;stroke-width:1pt;stroke-linejoin:miter;stroke-linecap:butt;fill-opacity:1;"
+       d="M 236.25 80.1301 L 243.125 116.381 L 237.188 116.068 L 234.063 80.4426 L 236.25 80.1301 z "
+       id="path472"
+       sodipodi:nodetypes="ccccc" />
+  </g>
+  <path
+     style="font-size:64;font-weight:normal;stroke-width:1pt;font-family:Impact;"
+     d="M 400.854 329.034 L 400.854 335.565 L 404.261 335.565 L 404.261 342.128 L 400.854 342.128 L 400.854 364.315 C 400.854 367.044 400.99 368.565 401.261 368.878 C 401.552 369.19 402.729 369.346 404.792 369.346 L 404.792 376.034 L 399.698 376.034 C 396.823 376.034 394.771 375.919 393.542 375.69 C 392.313 375.44 391.229 374.888 390.292 374.034 C 389.354 373.159 388.771 372.169 388.542 371.065 C 388.313 369.94 388.198 367.315 388.198 363.19 L 388.198 342.128 L 385.479 342.128 L 385.479 335.565 L 388.198 335.565 L 388.198 329.034 L 400.854 329.034 z M 383.011 334.565 L 383.011 376.034 L 370.167 376.034 L 370.386 372.596 C 369.511 373.992 368.427 375.044 367.136 375.753 C 365.865 376.44 364.396 376.784 362.729 376.784 C 360.834 376.784 359.261 376.451 358.011 375.784 C 356.761 375.117 355.834 374.232 355.229 373.128 C 354.646 372.024 354.282 370.878 354.136 369.69 C 353.99 368.482 353.917 366.096 353.917 362.534 L 353.917 334.565 L 366.542 334.565 L 366.542 362.784 C 366.542 366.013 366.636 367.93 366.823 368.534 C 367.032 369.138 367.573 369.44 368.448 369.44 C 369.386 369.44 369.938 369.128 370.104 368.503 C 370.292 367.878 370.386 365.867 370.386 362.471 L 370.386 334.565 L 383.011 334.565 z M 349.948 349.128 L 349.948 359.284 C 349.948 363.013 349.761 365.753 349.386 367.503 C 349.011 369.232 348.209 370.857 346.979 372.378 C 345.75 373.878 344.167 374.992 342.229 375.721 C 340.313 376.43 338.104 376.784 335.604 376.784 C 332.813 376.784 330.448 376.482 328.511 375.878 C 326.573 375.253 325.063 374.326 323.979 373.096 C 322.917 371.846 322.157 370.346 321.698 368.596 C 321.24 366.826 321.011 364.18 321.011 360.659 L 321.011 350.034 C 321.011 346.18 321.427 343.169 322.261 341.003 C 323.094 338.836 324.594 337.096 326.761 335.784 C 328.927 334.471 331.698 333.815 335.073 333.815 C 337.907 333.815 340.334 334.242 342.354 335.096 C 344.396 335.93 345.969 337.024 347.073 338.378 C 348.177 339.732 348.927 341.128 349.323 342.565 C 349.74 344.003 349.948 346.19 349.948 349.128 z M 337.323 346.003 C 337.323 343.878 337.209 342.544 336.979 342.003 C 336.75 341.44 336.261 341.159 335.511 341.159 C 334.761 341.159 334.261 341.44 334.011 342.003 C 333.761 342.544 333.636 343.878 333.636 346.003 L 333.636 364.721 C 333.636 366.68 333.761 367.961 334.011 368.565 C 334.261 369.149 334.75 369.44 335.479 369.44 C 336.229 369.44 336.719 369.169 336.948 368.628 C 337.198 368.086 337.323 366.919 337.323 365.128 L 337.323 346.003 z M 315.198 329.034 L 315.198 335.565 L 318.604 335.565 L 318.604 342.128 L 315.198 342.128 L 315.198 364.315 C 315.198 367.044 315.334 368.565 315.604 368.878 C 315.896 369.19 317.073 369.346 319.136 369.346 L 319.136 376.034 L 314.042 376.034 C 311.167 376.034 309.115 375.919 307.886 375.69 C 306.657 375.44 305.573 374.888 304.636 374.034 C 303.698 373.159 303.115 372.169 302.886 371.065 C 302.657 369.94 302.542 367.315 302.542 363.19 L 302.542 342.128 L 299.823 342.128 L 299.823 335.565 L 302.542 335.565 L 302.542 329.034 L 315.198 329.034 z M 291.604 334.565 L 291.104 340.003 C 292.938 336.107 295.594 334.044 299.073 333.815 L 299.073 348.409 C 296.761 348.409 295.063 348.721 293.979 349.346 C 292.896 349.971 292.229 350.846 291.979 351.971 C 291.729 353.076 291.604 355.638 291.604 359.659 L 291.604 376.034 L 278.979 376.034 L 278.979 334.565 L 291.604 334.565 z M 258.011 350.628 L 246.167 350.628 L 246.167 347.846 C 246.167 344.638 246.532 342.169 247.261 340.44 C 248.011 338.69 249.5 337.149 251.729 335.815 C 253.959 334.482 256.854 333.815 260.417 333.815 C 264.688 333.815 267.907 334.576 270.073 336.096 C 272.24 337.596 273.542 339.451 273.979 341.659 C 274.417 343.846 274.636 348.367 274.636 355.221 L 274.636 376.034 L 262.354 376.034 L 262.354 372.346 C 261.584 373.826 260.584 374.94 259.354 375.69 C 258.146 376.419 256.698 376.784 255.011 376.784 C 252.802 376.784 250.771 376.169 248.917 374.94 C 247.084 373.69 246.167 370.971 246.167 366.784 L 246.167 363.378 C 246.167 360.274 246.657 358.159 247.636 357.034 C 248.615 355.909 251.042 354.596 254.917 353.096 C 259.063 351.471 261.282 350.378 261.573 349.815 C 261.865 349.253 262.011 348.107 262.011 346.378 C 262.011 344.211 261.844 342.805 261.511 342.159 C 261.198 341.492 260.667 341.159 259.917 341.159 C 259.063 341.159 258.532 341.44 258.323 342.003 C 258.115 342.544 258.011 343.971 258.011 346.284 L 258.011 350.628 z M 262.011 356.315 C 259.99 357.794 258.813 359.034 258.479 360.034 C 258.167 361.034 258.011 362.471 258.011 364.346 C 258.011 366.492 258.146 367.878 258.417 368.503 C 258.709 369.128 259.271 369.44 260.104 369.44 C 260.896 369.44 261.407 369.201 261.636 368.721 C 261.886 368.221 262.011 366.93 262.011 364.846 L 262.011 356.315 z M 226.354 334.565 L 226.136 338.221 C 227.261 336.742 228.5 335.638 229.854 334.909 C 231.209 334.18 232.688 333.815 234.292 333.815 C 236.25 333.815 237.938 334.346 239.354 335.409 C 240.792 336.451 241.688 337.659 242.042 339.034 C 242.396 340.409 242.573 342.742 242.573 346.034 L 242.573 363.503 C 242.573 367.274 242.344 369.961 241.886 371.565 C 241.448 373.149 240.532 374.419 239.136 375.378 C 237.761 376.315 236.094 376.784 234.136 376.784 C 232.573 376.784 231.125 376.419 229.792 375.69 C 228.459 374.961 227.24 373.878 226.136 372.44 L 226.136 381.94 L 213.511 381.94 L 213.511 334.565 L 226.354 334.565 z M 229.948 346.628 C 229.948 344.065 229.854 342.513 229.667 341.971 C 229.479 341.43 228.959 341.159 228.104 341.159 C 227.271 341.159 226.729 341.471 226.479 342.096 C 226.25 342.721 226.136 344.232 226.136 346.628 L 226.136 363.815 C 226.136 366.315 226.261 367.878 226.511 368.503 C 226.761 369.128 227.302 369.44 228.136 369.44 C 228.948 369.44 229.448 369.159 229.636 368.596 C 229.844 368.013 229.948 366.617 229.948 364.409 L 229.948 346.628 z M 209.386 356.034 L 193.042 356.034 L 193.042 365.003 C 193.042 366.878 193.177 368.086 193.448 368.628 C 193.719 369.169 194.24 369.44 195.011 369.44 C 195.969 369.44 196.604 369.086 196.917 368.378 C 197.25 367.649 197.417 366.253 197.417 364.19 L 197.417 358.721 L 209.386 358.721 L 209.386 361.784 C 209.386 364.346 209.219 366.315 208.886 367.69 C 208.573 369.065 207.823 370.534 206.636 372.096 C 205.448 373.659 203.938 374.836 202.104 375.628 C 200.292 376.399 198.011 376.784 195.261 376.784 C 192.594 376.784 190.24 376.399 188.198 375.628 C 186.157 374.857 184.563 373.805 183.417 372.471 C 182.292 371.117 181.511 369.638 181.073 368.034 C 180.636 366.409 180.417 364.055 180.417 360.971 L 180.417 348.878 C 180.417 345.253 180.907 342.399 181.886 340.315 C 182.865 338.211 184.469 336.607 186.698 335.503 C 188.927 334.378 191.49 333.815 194.386 333.815 C 197.927 333.815 200.844 334.492 203.136 335.846 C 205.448 337.18 207.063 338.961 207.979 341.19 C 208.917 343.399 209.386 346.513 209.386 350.534 L 209.386 356.034 z M 196.729 349.284 L 196.729 346.253 C 196.729 344.107 196.615 342.721 196.386 342.096 C 196.157 341.471 195.688 341.159 194.979 341.159 C 194.104 341.159 193.563 341.43 193.354 341.971 C 193.146 342.492 193.042 343.919 193.042 346.253 L 193.042 349.284 L 196.729 349.284 z M 176.448 347.815 L 165.261 347.815 L 165.261 345.565 C 165.261 343.649 165.146 342.44 164.917 341.94 C 164.709 341.419 164.167 341.159 163.292 341.159 C 162.584 341.159 162.052 341.399 161.698 341.878 C 161.344 342.336 161.167 343.034 161.167 343.971 C 161.167 345.242 161.25 346.18 161.417 346.784 C 161.604 347.367 162.136 348.013 163.011 348.721 C 163.907 349.43 165.729 350.461 168.479 351.815 C 172.146 353.607 174.552 355.294 175.698 356.878 C 176.844 358.461 177.417 360.763 177.417 363.784 C 177.417 367.159 176.979 369.711 176.104 371.44 C 175.229 373.149 173.761 374.471 171.698 375.409 C 169.657 376.326 167.188 376.784 164.292 376.784 C 161.084 376.784 158.334 376.284 156.042 375.284 C 153.771 374.284 152.209 372.93 151.354 371.221 C 150.5 369.513 150.073 366.93 150.073 363.471 L 150.073 361.471 L 161.261 361.471 L 161.261 364.096 C 161.261 366.326 161.396 367.774 161.667 368.44 C 161.959 369.107 162.521 369.44 163.354 369.44 C 164.25 369.44 164.875 369.221 165.229 368.784 C 165.584 368.326 165.761 367.378 165.761 365.94 C 165.761 363.961 165.532 362.721 165.073 362.221 C 164.594 361.721 162.146 360.242 157.729 357.784 C 154.021 355.701 151.761 353.815 150.948 352.128 C 150.136 350.419 149.729 348.399 149.729 346.065 C 149.729 342.753 150.167 340.315 151.042 338.753 C 151.917 337.169 153.396 335.951 155.479 335.096 C 157.584 334.242 160.021 333.815 162.792 333.815 C 165.542 333.815 167.875 334.169 169.792 334.878 C 171.729 335.565 173.209 336.482 174.229 337.628 C 175.271 338.774 175.896 339.836 176.104 340.815 C 176.334 341.794 176.448 343.326 176.448 345.409 L 176.448 347.815 z M 146.323 347.815 L 135.136 347.815 L 135.136 345.565 C 135.136 343.649 135.021 342.44 134.792 341.94 C 134.584 341.419 134.042 341.159 133.167 341.159 C 132.459 341.159 131.927 341.399 131.573 341.878 C 131.219 342.336 131.042 343.034 131.042 343.971 C 131.042 345.242 131.125 346.18 131.292 346.784 C 131.48 347.367 132.011 348.013 132.886 348.721 C 133.782 349.43 135.605 350.461 138.355 351.815 C 142.021 353.607 144.427 355.294 145.573 356.878 C 146.719 358.461 147.292 360.763 147.292 363.784 C 147.292 367.159 146.855 369.711 145.98 371.44 C 145.105 373.149 143.636 374.471 141.573 375.409 C 139.532 376.326 137.063 376.784 134.167 376.784 C 130.959 376.784 128.209 376.284 125.917 375.284 C 123.646 374.284 122.084 372.93 121.229 371.221 C 120.375 369.513 119.948 366.93 119.948 363.471 L 119.948 361.471 L 131.136 361.471 L 131.136 364.096 C 131.136 366.326 131.271 367.774 131.542 368.44 C 131.834 369.107 132.396 369.44 133.23 369.44 C 134.125 369.44 134.75 369.221 135.105 368.784 C 135.459 368.326 135.636 367.378 135.636 365.94 C 135.636 363.961 135.407 362.721 134.948 362.221 C 134.469 361.721 132.021 360.242 127.605 357.784 C 123.896 355.701 121.636 353.815 120.823 352.128 C 120.011 350.419 119.604 348.399 119.604 346.065 C 119.604 342.753 120.042 340.315 120.917 338.753 C 121.792 337.169 123.271 335.951 125.355 335.096 C 127.459 334.242 129.896 333.815 132.667 333.815 C 135.417 333.815 137.75 334.169 139.667 334.878 C 141.605 335.565 143.084 336.482 144.105 337.628 C 145.146 338.774 145.771 339.836 145.98 340.815 C 146.209 341.794 146.323 343.326 146.323 345.409 L 146.323 347.815 z M 99.5733 350.628 L 87.7295 350.628 L 87.7295 347.846 C 87.7295 344.638 88.0941 342.169 88.8232 340.44 C 89.5732 338.69 91.0628 337.149 93.292 335.815 C 95.5212 334.482 98.417 333.815 101.98 333.815 C 106.25 333.815 109.469 334.576 111.636 336.096 C 113.802 337.596 115.105 339.451 115.542 341.659 C 115.98 343.846 116.198 348.367 116.198 355.221 L 116.198 376.034 L 103.917 376.034 L 103.917 372.346 C 103.146 373.826 102.146 374.94 100.917 375.69 C 99.7087 376.419 98.2608 376.784 96.5733 376.784 C 94.3649 376.784 92.3337 376.169 90.4795 374.94 C 88.6462 373.69 87.7295 370.971 87.7295 366.784 L 87.7295 363.378 C 87.7295 360.274 88.2191 358.159 89.1982 357.034 C 90.1774 355.909 92.6045 354.596 96.4795 353.096 C 100.625 351.471 102.844 350.378 103.136 349.815 C 103.427 349.253 103.573 348.107 103.573 346.378 C 103.573 344.211 103.407 342.805 103.073 342.159 C 102.761 341.492 102.23 341.159 101.48 341.159 C 100.625 341.159 100.094 341.44 99.8858 342.003 C 99.6774 342.544 99.5733 343.971 99.5733 346.284 L 99.5733 350.628 z M 103.573 356.315 C 101.552 357.794 100.375 359.034 100.042 360.034 C 99.7295 361.034 99.5733 362.471 99.5733 364.346 C 99.5733 366.492 99.7087 367.878 99.9795 368.503 C 100.271 369.128 100.834 369.44 101.667 369.44 C 102.459 369.44 102.969 369.201 103.198 368.721 C 103.448 368.221 103.573 366.93 103.573 364.846 L 103.573 356.315 z M 56.542 325.44 L 69.792 325.44 C 73.3753 325.44 76.1253 325.721 78.042 326.284 C 79.9795 326.846 81.4274 327.659 82.3858 328.721 C 83.3649 329.784 84.0212 331.076 84.3545 332.596 C 84.7087 334.096 84.8858 336.43 84.8858 339.596 L 84.8858 344.003 C 84.8858 347.232 84.5524 349.586 83.8858 351.065 C 83.2191 352.544 81.9899 353.68 80.1983 354.471 C 78.4274 355.263 76.1045 355.659 73.2295 355.659 L 69.6983 355.659 L 69.6983 376.034 L 56.542 376.034 L 56.542 325.44 z M 69.6983 334.096 L 69.6983 346.971 C 70.0733 346.992 70.3962 347.003 70.667 347.003 C 71.8753 347.003 72.7087 346.711 73.167 346.128 C 73.6462 345.524 73.8858 344.284 73.8858 342.409 L 73.8858 338.253 C 73.8858 336.524 73.6149 335.399 73.0733 334.878 C 72.5316 334.357 71.4066 334.096 69.6983 334.096 z "
+     id="path481" />
+</svg>
diff -Nur -x CVS passepartout-0.6/NEWS passepartout/NEWS
--- passepartout-0.6/NEWS	2004-10-30 13:37:20.000000000 +0200
+++ passepartout/NEWS	2004-12-16 21:09:16.000000000 +0100
@@ -1,4 +1,33 @@
-0.6: Released 2004-11-??
+0.7: Released 2004-12-??
+
+	* Migrated to gtkmm 2.4 / libgnomecanvasmm 2.6.
+	
+	* Will build with gcc 3.4.
+
+	* Added controls for changing the scale and shearing of an object.
+
+	* Using the new FileChooserDialog instead of the old FileSelection.
+	Preview images are loaded in the background.
+
+	* Partial Gnome integration, but only if the --with-gnome option
+	is given to configure. Gnome is used to launch web browsers and to
+	get suggested MIME type handlers. If you right-click on an object
+	in Passepartout you will get a pop-up menu with suggested apps for
+	editing the file.
+
+	* Removed the PSViewer config var. If built with Gnome support, it
+	asks Gnome which viewer to open, otherwise it just uses gv.
+
+	* A simple new zoom widget and zoom toolbuttons and menu
+	items. Arbitrary zoom levels are now possible.
+
+	* Full screen mode.
+
+	* Better thread handling. This should improve stability. Also, the
+	screen update signals should be slightly more sane.
+
+
+0.6: Released 2004-11-12
 
 	* Support for PDF output! Mostly complete, we even have support
 	for including EPS files. Limitations include lack of support for
diff -Nur -x CVS passepartout-0.6/package/gentoo/passepartout-0.2-r1.ebuild passepartout/package/gentoo/passepartout-0.2-r1.ebuild
--- passepartout-0.6/package/gentoo/passepartout-0.2-r1.ebuild	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/package/gentoo/passepartout-0.2-r1.ebuild	2003-09-12 18:45:03.000000000 +0200
@@ -0,0 +1,32 @@
+DESCRIPTION="Passepartout is GTK-based DTP-application"
+HOMEPAGE="http://www.stacken.kth.se/project/pptout"
+SRC_URI="http://www.stacken.kth.se/project/pptout/files/${P}.tar.bz2
+http://www.stacken.kth.se/project/pptout/files/${P}-assert.patch
+http://www.stacken.kth.se/project/pptout/files/${P}-thread.patch"
+LICENSE="BSD"
+SLOT="0"
+IUSE=""
+KEYWORDS="~x86 ~ppc ~sparc"
+
+DEPEND=">=dev-cpp/libxmlpp-0.25.0
+>=dev-cpp/gtkmm-2.2.7"
+
+RDEPEND="dev-libs/libxslt
+app-text/ghostscript"
+
+src_compile() {
+	patch -p1 < ${DISTDIR}/${P}-assert.patch || die "Failed to apply patch"
+	patch -p1 < ${DISTDIR}/${P}-thread.patch || die "Failed to apply patch"
+	econf || die "Configuration failed"
+	emake || die "Building failed"
+}
+
+src_install() {
+	einstall install || die "Install failed"	
+	dodoc AUTHORS BUGS COPYING NEWS README
+	mv ${D}/usr/share/doc/passepartout ${D}/usr/share/doc/${P}/doc
+	dosym /usr/share/xml/passepartout/xhtml.xslt /usr/share/doc/${P}/doc/xhtml.xslt
+	dosym /usr/share/xml/passepartout/docbook.xslt /usr/share/doc/${P}/doc/docbook.xslt
+	dosym /usr/share/xml/passepartout/xhtml.xslt /usr/share/doc/${P}/doc/examples/xhtml.xslt
+	dosym /usr/share/xml/passepartout/docbook.xslt /usr/share/doc/${P}/doc/examples/docbook.xslt
+}
diff -Nur -x CVS passepartout-0.6/passepartout.desktop passepartout/passepartout.desktop
--- passepartout-0.6/passepartout.desktop	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/passepartout.desktop	2003-11-14 14:47:53.000000000 +0100
@@ -0,0 +1,9 @@
+[Desktop Entry]
+Name=Passepartout
+Comment=Desktop publishing application
+Comment[sv]=Layoutprogram
+Icon=pptout-icon.png
+Exec=passepartout
+Terminal=false
+Type=Application
+Categories=Application;Office;
diff -Nur -x CVS passepartout-0.6/src/defines.h.in passepartout/src/defines.h.in
--- passepartout-0.6/src/defines.h.in	2004-10-31 19:55:26.000000000 +0100
+++ passepartout/src/defines.h.in	2004-11-15 22:06:50.000000000 +0100
@@ -7,6 +7,9 @@
 /* Define to 1 if you have the `fork' function. */
 #undef HAVE_FORK
 
+/* Gnome is present */
+#undef HAVE_GNOME
+
 /* Define to 1 if you have the <inttypes.h> header file. */
 #undef HAVE_INTTYPES_H
 
diff -Nur -x CVS passepartout-0.6/src/pptout/aboutdialog.cc passepartout/src/pptout/aboutdialog.cc
--- passepartout-0.6/src/pptout/aboutdialog.cc	2004-04-26 19:32:25.000000000 +0200
+++ passepartout/src/pptout/aboutdialog.cc	2004-12-18 14:06:44.000000000 +0100
@@ -4,6 +4,7 @@
 #include "aboutdialog.h"
 #include "defines.h"
 #include "widget/wmisc.h"
+#include "widget/programs.h"
 #include <gtkmm/label.h>
 #include <gtkmm/image.h>
 #include <gtkmm/box.h>
@@ -11,14 +12,9 @@
 #include <gtkmm/notebook.h>
 #include <gtkmm/scrolledwindow.h>
 #include "icons/logo.h"
-#include "webbrowser.h"
 
 AboutDialog *AboutDialog::_instance = 0;
 
-namespace {
-  enum { OPEN_WEBPAGE = 4711 };
-}
-
 extern const char *builddate;  
 // The date this program was linked.
 // Defined in builddate.cc.
@@ -26,6 +22,17 @@
 // The contents of the AUTHORS file as a string in authors.cc
 extern const char *authors;
 
+namespace {
+  const std::string mail_address = "passepartout@stacken.kth.se";
+
+#ifdef HAVE_GNOME
+  bool have_gnome = true;
+#else
+  bool have_gnome = false;
+#endif
+
+}
+
 AboutDialog::AboutDialog()
   : DialogWrap("About")
 {
@@ -55,20 +62,29 @@
     manage(new Gtk::Label("", Gtk::JUSTIFY_LEFT, Gtk::ALIGN_TOP));
   label->set_markup("<u><span foreground=\"blue\">" + homepage + 
 		    "</span></u>");
-  Gtk::Button *webpage = 
-    manage(new Gtk::Button());
+  Gtk::Button *webpage = manage(new Gtk::Button());
   webpage->add(*label);
   webpage->set_relief(Gtk::RELIEF_NONE);
   webpage->set_border_width(0);
-  webpage->signal_clicked().connect
-    (bind(slot(*this, &AboutDialog::on_response), OPEN_WEBPAGE));
-  webpage->signal_activate().connect
-    (bind(slot(*this, &AboutDialog::on_response), OPEN_WEBPAGE));
+  webpage->signal_clicked().connect(sigc::ptr_fun(&Programs::open_homepage));
   message->pack_start(*webpage, Gtk::PACK_SHRINK);
 
   label =
+    manage(new Gtk::Label("", Gtk::JUSTIFY_LEFT, Gtk::ALIGN_TOP));
+  label->set_markup("<u><span foreground=\"blue\">" + mail_address
+                    + "</span></u>");
+  Gtk::Button *mail = manage(new Gtk::Button());
+  mail->add(*label);
+  mail->set_relief(Gtk::RELIEF_NONE);
+  mail->set_border_width(0);
+  mail->signal_clicked().connect
+    (sigc::bind(sigc::ptr_fun(&Programs::open_url), "mailto:" + mail_address));
+  message->pack_start(*mail, Gtk::PACK_SHRINK);
+
+  label =
     manage(new Gtk::Label("", Gtk::JUSTIFY_LEFT, Gtk::ALIGN_BOTTOM));
-  label->set_markup("\nBuild date: " + std::string(builddate));
+  label->set_markup("\nBuild date: " + std::string(builddate) + "\n"
+                    "GNOME support: " + (have_gnome ? "yes" : "no"));
   label->set_selectable();
   message->pack_start(*label, Gtk::PACK_SHRINK);
 
@@ -98,14 +114,5 @@
 }
 
 void AboutDialog::on_response(int response_id) {
-  switch(response_id) {
-  case OPEN_WEBPAGE:
-    open_homepage();
-    break;
-  case Gtk::RESPONSE_CLOSE:
-      hide();
-    break;
-  default: 
-    break;
-  }
+  hide();
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/authors.cc passepartout/src/pptout/authors.cc
--- passepartout-0.6/src/pptout/authors.cc	2004-10-31 19:55:28.000000000 +0100
+++ passepartout/src/pptout/authors.cc	1970-01-01 01:00:00.000000000 +0100
@@ -1,14 +0,0 @@
-const char *authors =
-"Maintainers\n"
-"-------\n"
-"Fredrik Arnerup		<e97_far@e.kth.se>\n"
-"Rasmus Kaj		<kaj@e.kth.se>\n"
-"\n"
-"Contributors\n"
-"------------\n"
-"Sergej Gratchev		- prefs dialog, gui work\n"
-"Ayose Cazorla Len	- threading bugfix\n"
-"Gaudenz Steinlin	- man pages\n"
-"Magnus Henoch		- postscript landscape mode bugfix\n"
-"Emissionen		- being guinea pigs :-)\n"
-;
diff -Nur -x CVS passepartout-0.6/src/pptout/clipboard.cc passepartout/src/pptout/clipboard.cc
--- passepartout-0.6/src/pptout/clipboard.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/clipboard.cc	2004-11-27 02:28:15.000000000 +0100
@@ -0,0 +1,126 @@
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include "clipboard.h"
+#include <gtkmm/clipboard.h>
+#include "document/page.h"
+#include "document/textframe.h"
+#include "document/loader.h"
+#include "util/warning.h"
+
+namespace {
+  template<class P> P nonull(P p) {
+    if(!p)
+      throw std::runtime_error("A pointer was null in " __FILE__);
+    return p;
+  }
+  
+  std::string clip; // a global clip should suffice
+  
+  const std::string pptout_target = "PPTOUT_PAGENTS_2"; // with version number
+  
+  void on_clipboard_get(Gtk::SelectionData& selection_data, guint info) {
+    const Glib::ustring& target = selection_data.get_target();
+    if(target == pptout_target)
+      selection_data.set(pptout_target, clip);
+  }
+  
+  void on_clipboard_clear() {
+    // not really necessary
+    clip.clear();
+  }
+  
+  void on_clipboard_received(const Gtk::SelectionData& selection_data,
+                             std::pair<DocRef, Page*> bundle) {
+    DocRef document = bundle.first;
+    Page *page = bundle.second;
+    Glib::ustring clipboard_data = selection_data.get_data_as_string();
+    try {
+      xmlpp::DomParser parser;
+      parser.parse_memory(clipboard_data);
+      xmlpp::Element *root = parser.get_document()->get_root_node();
+      if(!root)
+        throw std::runtime_error("Root node is NULL.");
+      xmlpp::Element::NodeList children = root->get_children();
+      
+      document->select_all(false);
+      for(xmlpp::Element::NodeList::const_iterator
+            i = children.begin(); i != children.end(); i++) {
+        if(xmlpp::Element *elem = dynamic_cast<xmlpp::Element*>(*i)) {
+          if(elem->get_name() == "text_stream") {
+            std::auto_ptr<TextStream> stream(new TextStream
+                                             (ElementWrap("", *elem)));
+            // Don't try to add a stream with a name that already exists
+            /// \todo rename the stream automatically?
+            if(!document->get_text_stream(stream->get_name()))
+              document->add_text_stream(stream.release());
+          } else {
+            Pagent *pagent = load(ElementWrap("", *elem), page);
+            page->add(pagent);
+            document->select(pagent, false); // don't deselect
+          }
+        }
+      }
+    } catch(const std::exception& e) {
+      throw std::runtime_error("Error encountered when pasting:\n"
+                               + std::string(e.what()));
+    }
+  }
+}
+
+void Clipboard::copy(DocRef document) {
+  nonull(document);
+  
+  /// \todo make sure the selection is sorted
+  const Document::Selection selected = document->selected();
+  if(selected.empty())
+    return;
+  
+  Glib::RefPtr<Gtk::Clipboard> clipboard = Gtk::Clipboard::get();
+  std::list<Gtk::TargetEntry> target_list;
+  target_list.push_back(Gtk::TargetEntry(pptout_target));
+  clipboard->set(target_list,
+		 sigc::ptr_fun(&on_clipboard_get),
+		 sigc::ptr_fun(&on_clipboard_clear));
+  
+  // store an XML representation of the selected pagents
+  xmlpp::Document rep;
+  xmlpp::Element *root = rep.create_root_node("copy_data");
+  
+  // save relevant streams
+  typedef std::set<const TextStream*> Streams;
+  Streams streams;
+  for(Document::Selection::const_iterator i = selected.begin();
+      i != selected.end(); i++) {
+    const TextFrame *frame = dynamic_cast<const TextFrame *>(*i);
+    if(!frame)
+      continue;
+    const TextStream *stream = frame->get_stream();
+    if(stream && streams.find(stream) == streams.end()) {
+      streams.insert(stream);
+      stream->save(*root, FileContext());
+    }
+  }
+  
+  // save pagents
+  for(Document::Selection::const_iterator i = selected.begin();
+      i != selected.end(); i++) {
+    (*i)->save(*root, FileContext());
+  }
+  
+  clip = rep.write_to_string();
+  debug << clip << std::endl;
+}
+
+void Clipboard::cut(DocRef document) {
+  nonull(document);
+  copy(document);
+  document->delete_selected();
+}
+
+void Clipboard::paste(DocRef document, Page *page) {
+  Gtk::Clipboard::get()->request_contents
+    (pptout_target, sigc::bind(sigc::ptr_fun(&on_clipboard_received),
+                               std::make_pair(nonull(document),
+                                              nonull(page))));
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/clipboard.h passepartout/src/pptout/clipboard.h
--- passepartout-0.6/src/pptout/clipboard.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/clipboard.h	2004-11-27 02:28:15.000000000 +0100
@@ -0,0 +1,16 @@
+#ifndef CLIPBOARD_H		// -*- c++ -*-
+#define CLIPBOARD_H
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+
+#include "document/document.h"
+
+/// Copy/paste selected Pagents from/to Document.
+namespace Clipboard {
+  void copy(DocRef document);
+  void cut(DocRef document);
+  void paste(DocRef document, Page *page);
+}
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/config.cc passepartout/src/pptout/config.cc
--- passepartout-0.6/src/pptout/config.cc	2004-10-07 13:59:14.000000000 +0200
+++ passepartout/src/pptout/config.cc	2004-11-22 15:20:56.000000000 +0100
@@ -27,7 +27,6 @@
   DefaultStylesheet("DefaultStylesheet", "Default text stylesheet"),
   DocTemplatePath("DocTemplatePath", "Default document template"),
   PSInterpreter("PSInterpreter", "Command to run Ghostscript"),
-  PSViewer("PSViewer", "Command to run external PS viewer"),
   LengthUnit("LengthUnit", "Default unit for measuring lengths"),
   first_error(true)
 {
@@ -75,9 +74,6 @@
 
   declare_var(&PSInterpreter);
   PSInterpreter.values.push_back("gs");
-  declare_var(&PSViewer);
-  // -safer makes gv send the -dSAFER option to gs
-  PSViewer.values.push_back("gv -safer");
 
   declare_var(&LengthUnit);
   LengthUnit.values.push_back("pt");
@@ -136,7 +132,7 @@
   if(dialog)
     return *dialog;
   dialog = new PreferencesDialog();
-  dialog->signal_hide().connect(slot(*this, &PFile::dialog_done));
+  dialog->signal_hide().connect(sigc::mem_fun(*this, &PFile::dialog_done));
   return *dialog;
 }
 
diff -Nur -x CVS passepartout-0.6/src/pptout/config.h passepartout/src/pptout/config.h
--- passepartout-0.6/src/pptout/config.h	2004-10-07 13:59:14.000000000 +0200
+++ passepartout/src/pptout/config.h	2004-11-22 15:20:56.000000000 +0100
@@ -34,7 +34,7 @@
 };
 
 /// Passepartout-specific config file reader.
-class PFile: public Config::File, public SigC::Object {
+class PFile: public Config::File, public sigc::trackable {
 public:
 
   /// The global instance.
@@ -43,7 +43,7 @@
   FVar ReshapeBoxSize, DefaultResolution, ZoomLevel, StartPage;
   BVar Landscape, FakeTransparency, SingleSided;
   SVar PaperName, PrintCommand, StylesheetPath,
-    DefaultStylesheet, DocTemplatePath, PSInterpreter, PSViewer,
+    DefaultStylesheet, DocTemplatePath, PSInterpreter,
     LengthUnit;
 
   PFile();
diff -Nur -x CVS passepartout-0.6/src/pptout/docmeta.cc passepartout/src/pptout/docmeta.cc
--- passepartout-0.6/src/pptout/docmeta.cc	2004-01-12 20:01:19.000000000 +0100
+++ passepartout/src/pptout/docmeta.cc	2004-11-12 16:18:08.000000000 +0100
@@ -19,7 +19,7 @@
 //   document = orig.document;
 // }
 
-SigC::Signal0<void>& DocMeta::changed_signal() {
+sigc::signal<void>& DocMeta::changed_signal() {
   return data->changed_signal;
 }
 
diff -Nur -x CVS passepartout-0.6/src/pptout/docmeta.h passepartout/src/pptout/docmeta.h
--- passepartout-0.6/src/pptout/docmeta.h	2004-04-15 23:17:15.000000000 +0200
+++ passepartout/src/pptout/docmeta.h	2004-11-12 16:18:08.000000000 +0100
@@ -18,7 +18,7 @@
   Document* operator->() const { return document.operator->(); }
 
   /** Returns a signal that is emitted when the data has changed. */
-  SigC::Signal0<void>& changed_signal();
+  sigc::signal<void>& changed_signal();
 
   const Glib::ustring& get_filename() const { return data->filename; }
   void set_filename(const Glib::ustring &filename);
@@ -28,7 +28,7 @@
 private:
   class DocData: public RefCounted {
   public:
-    SigC::Signal0<void> changed_signal;
+    sigc::signal<void> changed_signal;
     Glib::ustring filename;
   };
   Glib::RefPtr<DocData> data;
diff -Nur -x CVS passepartout-0.6/src/pptout/docpropsdialog.cc passepartout/src/pptout/docpropsdialog.cc
--- passepartout-0.6/src/pptout/docpropsdialog.cc	2004-01-12 20:01:19.000000000 +0100
+++ passepartout/src/pptout/docpropsdialog.cc	2004-11-22 16:48:32.000000000 +0100
@@ -9,7 +9,7 @@
 #include <gtkmm/separator.h>
 #include <gtkmm/radiobutton.h>
 #include <gtkmm/checkbutton.h>
-#include <gtkmm/combo.h>
+#include <gtkmm/comboboxtext.h>
 #include <gtkmm/stock.h>
 #include <gtkmm/image.h>
 
@@ -44,7 +44,7 @@
   single_sided_button = manage(new Gtk::RadioButton("_Single-sided", true));
   double_sided_button = manage(new Gtk::RadioButton("_Double-sided", true));
 
-  paper_size = manage(new Gtk::Combo());
+  paper_size = manage(new Gtk::ComboBoxText());
   file_entry = manage(new FileEntry("Select template"));
   first_page = manage(new Spinner(config.StartPage.values.front(), false));
 
@@ -60,27 +60,6 @@
   set_resizable(false);
 
   {
-    std::string& default_paper = config.PaperName.values.front();
-    bool default_is_known = false;
-    std::list<std::string> paper_list;
-    for(std::map<std::string, Papers::Size>::const_iterator 
-	  i = papers.sizes.begin(); i!=papers.sizes.end(); i++) {
-      paper_list.push_back(i->first);
-      if(i->first == default_paper)
-	default_is_known = true;
-    }
-    paper_size->set_popdown_strings(paper_list);
-    if(!default_is_known) {
-      warning << "Paper type \"" << default_paper 
-	      << "\" is unknown." << std::endl;
-      default_paper = "A4";
-      config.PaperName.values.clear();
-      config.PaperName.values.push_back(default_paper);
-    }
-    paper_size->get_entry()->set_text(default_paper);
-  }
-
-  {
     Gtk::RadioButton::Group group = landscape_button->get_group();
     portrait_button->set_group(group);
   }
@@ -103,7 +82,7 @@
   Gtk::Label *format_label = 
     manage(new Gtk::Label("<b>Document _format</b>", 0.0, 0.5, true));
   format_label->set_use_markup();
-  format_label->set_mnemonic_widget(*paper_size->get_entry());
+  format_label->set_mnemonic_widget(*paper_size);
   format_box->pack_start(*format_label);
   Gtk::HBox *format_box2 = manage(new Gtk::HBox());
   format_box2->pack_start(*manage(new Gtk::Label("  ")));
@@ -135,14 +114,12 @@
     single_sided_button->set_active() :
     double_sided_button->set_active();
 
-  paper_size->get_entry()->set_editable(false);
-
   cancel_button = add_button(Gtk::Stock::CANCEL, 0);
   ok_button = add_button(Gtk::Stock::OK, 1);
   create_button = add_button(Gtk::Stock::NEW, 1);
 
   template_button->signal_clicked().connect
-    (slot(*this, &DocPropsDialog::update_mode));
+    (sigc::mem_fun(*this, &DocPropsDialog::update_mode));
   update_mode();
 
   get_vbox()->show_all();
@@ -157,7 +134,29 @@
   file_entry->set_sensitive(active);
 }
 
+namespace {
+  // build list of paper sizes
+  void fill_paper_size(Gtk::ComboBoxText &paper_size,
+                       std::string selected_paper) {
+    if(papers.sizes.find(selected_paper) == papers.sizes.end()) {
+      warning << "Paper format \"" << selected_paper 
+	      << "\" is unknown." << std::endl;
+      selected_paper = "A4";
+    }
+    int i = 0;
+    for(std::map<std::string, Papers::Size>::const_iterator
+	  size = papers.sizes.begin();
+        size != papers.sizes.end();
+        size++, i++) {
+      paper_size.append_text(size->first);
+      if(size->first == selected_paper)
+        paper_size.set_active(i);
+    }
+  }
+}
+
 void DocPropsDialog::show_it(DocumentView *_view, bool create_new) {
+  std::string selected_paper = config.PaperName.values.front();
   new_document = create_new;
   view = _view;
   if(!new_document) {
@@ -170,7 +169,7 @@
     portrait_button->set_active(document->get_orientation()
 				== Papers::PORTRAIT);
     double_sided_button->set_active(document->is_doublesided());
-    paper_size->get_entry()->set_text(document->get_paper_name());
+    selected_paper = document->get_paper_name();
 
     create_button->hide(); ok_button->show();
     cancel_button->grab_default();
@@ -186,6 +185,9 @@
     show();
   }
 
+  Glib::RefPtr<Gtk::ListStore>::cast_dynamic(paper_size->get_model())->clear();
+  fill_paper_size(*paper_size, selected_paper);
+
   // have to show() first
   set_title(new_document
 	    ? "Create new document"
@@ -217,8 +219,8 @@
 	config.DocTemplatePath.values.front() = file_entry->entry.get_text();
       } else {
 	document = Document::create();
-	document->set_paper_name(paper_size->get_entry()->get_text());
-	config.PaperName.values.front() = paper_size->get_entry()->get_text();
+	document->set_paper_name(paper_size->get_active_text());
+	config.PaperName.values.front() = paper_size->get_active_text();
 	document->set_orientation(orientation);
 	config.Landscape.values.front() = !portrait_button->get_active();
 	document->set_doublesided(double_sided_button->get_active());
@@ -243,8 +245,8 @@
 	  config.DocTemplatePath.values.front() = file_entry->entry.get_text();
 	} else {
 	  document->set_template("");
-	  document->set_paper_name(paper_size->get_entry()->get_text());
-	  config.PaperName.values.front()= paper_size->get_entry()->get_text();
+	  document->set_paper_name(paper_size->get_active_text());
+	  config.PaperName.values.front()= paper_size->get_active_text();
 	  document->set_orientation(orientation);
 	  config.Landscape.values.front() = !portrait_button->get_active();
 	  document->set_doublesided(double_sided_button->get_active());
diff -Nur -x CVS passepartout-0.6/src/pptout/docpropsdialog.h passepartout/src/pptout/docpropsdialog.h
--- passepartout-0.6/src/pptout/docpropsdialog.h	2004-01-12 20:01:19.000000000 +0100
+++ passepartout/src/pptout/docpropsdialog.h	2004-11-22 16:48:32.000000000 +0100
@@ -11,7 +11,7 @@
   class RadioButton;
   class Button;
   class VBox;
-  class Combo;
+  class ComboBoxText;
 };
 class FileEntry;
 class Spinner;
@@ -32,7 +32,7 @@
   Gtk::CheckButton *template_button;
   Gtk::Button *cancel_button, *ok_button, *create_button;
   Gtk::VBox *format_box;
-  Gtk::Combo *paper_size;
+  Gtk::ComboBoxText *paper_size;
   FileEntry *file_entry;
   Spinner *first_page;
   bool new_document;
diff -Nur -x CVS passepartout-0.6/src/pptout/document/cachedframe.cc passepartout/src/pptout/document/cachedframe.cc
--- passepartout-0.6/src/pptout/document/cachedframe.cc	2004-05-02 21:56:33.000000000 +0200
+++ passepartout/src/pptout/document/cachedframe.cc	2004-11-14 04:02:49.000000000 +0100
@@ -4,9 +4,9 @@
 #include "cachedframe.h"
 
 CachedFrame::CachedFrame(Group *parent, const std::string &name)
-  : BasicFrame(parent, name), white_is_transparent(false)
+  : BasicFrame(parent, name)
 {}
 
 CachedFrame::CachedFrame(const ElementWrap& xml, Group* parent)
-  : BasicFrame(xml, parent), white_is_transparent(false)
+  : BasicFrame(xml, parent)
 {}
diff -Nur -x CVS passepartout-0.6/src/pptout/document/cachedframe.h passepartout/src/pptout/document/cachedframe.h
--- passepartout-0.6/src/pptout/document/cachedframe.h	2004-09-20 15:46:55.000000000 +0200
+++ passepartout/src/pptout/document/cachedframe.h	2005-03-19 15:09:03.000000000 +0100
@@ -6,15 +6,17 @@
 #include "basicframe.h"
 #include <sigc++/slot.h>
 
+/**
+ * A frame that is represented in postscript.  This may be a referenced EPS
+ * file, or a text frame (that is made into postscript code by TextStream and
+ * xml2ps).  This interface is mainly used by PostscriptViewent.
+ */
 class CachedFrame: public BasicFrame {
 public:
   CachedFrame(Group *parent, const std::string &name);
   CachedFrame(const ElementWrap& xml, Group *parent);
   
   virtual void generate_picture(std::ostream& psstream) const = 0;
-  
-protected:
-  bool white_is_transparent; // fake transparency
 };
 
 #endif
diff -Nur -x CVS passepartout-0.6/src/pptout/document/document.cc passepartout/src/pptout/document/document.cc
--- passepartout-0.6/src/pptout/document/document.cc	2004-10-26 01:54:57.000000000 +0200
+++ passepartout/src/pptout/document/document.cc	2004-11-27 03:55:16.000000000 +0100
@@ -24,10 +24,9 @@
 #include "ps/type42.h"
 #include "ps/pdf.h"
 
-SigC::Signal1<void, DocRef> Document::changed_signal;
-SigC::Signal1<void, DocRef> Document::size_changed_signal;
-SigC::Signal1<void, DocRef> Document::selection_changed_signal;
-SigC::Signal1<void, DocRef> Document::streams_changed_signal;
+sigc::signal<void, DocRef> Document::changed_signal;
+sigc::signal<void, DocRef> Document::selection_changed_signal;
+sigc::signal<void, DocRef> Document::streams_changed_signal;
 
 namespace {			// local
   class NameOrder {
@@ -504,7 +503,7 @@
 void Document::set_orientation(Papers::Orientation _orientation) {
   orientation = _orientation;
   changed_signal(self());
-  size_changed_signal(self());
+  size_changed_signal();
 }
 
 void Document::set_paper_name(const std::string &_paper_name) {
@@ -512,7 +511,7 @@
     throw Error::PaperName(_paper_name);
   paper_name = _paper_name;
   changed_signal(self());
-  size_changed_signal(self());
+  size_changed_signal();
 }
 
 xmlpp::Document *Document::xml_save(const FileContext &context) {
diff -Nur -x CVS passepartout-0.6/src/pptout/document/document.h passepartout/src/pptout/document/document.h
--- passepartout-0.6/src/pptout/document/document.h	2004-10-26 01:54:57.000000000 +0200
+++ passepartout/src/pptout/document/document.h	2004-11-27 03:55:15.000000000 +0100
@@ -38,10 +38,10 @@
   typedef std::list<Pagent*> Selection;
   typedef std::list<TextStream*> StreamVec;
 
-  static SigC::Signal1<void, DocRef> changed_signal;
-  static SigC::Signal1<void, DocRef> size_changed_signal;
-  static SigC::Signal1<void, DocRef> selection_changed_signal;
-  static SigC::Signal1<void, DocRef> streams_changed_signal;
+  static sigc::signal<void, DocRef> changed_signal;
+  sigc::signal<void> size_changed_signal;
+  static sigc::signal<void, DocRef> selection_changed_signal;
+  static sigc::signal<void, DocRef> streams_changed_signal;
 
   static DocRef null() { return DocRef(); }
 
diff -Nur -x CVS passepartout-0.6/src/pptout/document/group.cc passepartout/src/pptout/document/group.cc
--- passepartout-0.6/src/pptout/document/group.cc	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/group.cc	2004-11-14 20:08:15.000000000 +0100
@@ -205,7 +205,7 @@
     warning << "Got a strange group. Deleting it again." << std::endl;
     delete group;
   }
-  group_changed_signal(this);
+  group_changed_signal();
 }
 
 void Group::ungroup_selected() {
@@ -231,7 +231,7 @@
 	if(!ungroup(group))
 	  warning << "Group not in this group" << std::endl;
 	delete group;
-	group_changed_signal(this);
+	group_changed_signal();
       }
     }
 }
@@ -244,7 +244,7 @@
   // the front is the top
   childs.push_front(obj);
   obj->set_parent(this);
-  group_changed_signal(this);
+  group_changed_signal();
 }
 
 Pagent* Group::ungroup(Pagent* obj) {
@@ -253,7 +253,7 @@
     return 0;
   childs.erase(i);
   obj->set_parent(parent);
-  group_changed_signal(this);
+  group_changed_signal();
   return obj;
 }
 
@@ -299,16 +299,16 @@
       }
     }
   }
-  group_changed_signal(this);
-  geometry_changed_signal(this);
+  group_changed_signal();
+  geometry_changed_signal();
 }
 
-void Group::child_props_changed(Pagent *pagent) {
+void Group::child_props_changed() {
   //  if(pagent!=this) // no infinite loops, please
-  props_changed_signal(this);
+  props_changed_signal();
 }
 
-void Group::child_geometry_changed(Pagent *pagent) {
+void Group::child_geometry_changed() {
   //  if(pagent!=this) // no infinite loops, please
-  geometry_changed_signal(this);
+  geometry_changed_signal();
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/document/group.h passepartout/src/pptout/document/group.h
--- passepartout-0.6/src/pptout/document/group.h	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/group.h	2004-11-14 20:08:15.000000000 +0100
@@ -49,11 +49,11 @@
   ChildVec::const_reverse_iterator prend() const { return childs.rend(); }
 
   // A change in a child is a change in the group:
-  virtual void child_props_changed(Pagent *pagent);
-  virtual void child_geometry_changed(Pagent *pagent);
+  virtual void child_props_changed();
+  virtual void child_geometry_changed();
   
   /** Raised on direct changes to the group (i.e. new / ungrouped member) */
-  SigC::Signal1<void, Pagent*> group_changed_signal; 
+  sigc::signal<void> group_changed_signal; 
 private:
   Boundary Group::get_untransformed_box() const;
   
diff -Nur -x CVS passepartout-0.6/src/pptout/document/imageframe.cc passepartout/src/pptout/document/imageframe.cc
--- passepartout-0.6/src/pptout/document/imageframe.cc	2004-10-03 21:57:16.000000000 +0200
+++ passepartout/src/pptout/document/imageframe.cc	2004-11-14 20:08:15.000000000 +0100
@@ -28,8 +28,8 @@
   : CachedFrame(parent, "Image " + basename(assoc)),
   association(assoc), filewatcher(association)
 {
-  filewatcher.modified_signal.connect(slot(*this, 
-					   &ImageFrame::on_file_modified));
+  filewatcher.modified_signal.connect
+    (sigc::mem_fun(*this, &ImageFrame::on_file_modified));
   read_size();
 }
 
@@ -38,8 +38,8 @@
     association(xml.get_filename("file")),
     filewatcher(association)
 {
-  filewatcher.modified_signal.connect(slot(*this, 
-					   &ImageFrame::on_file_modified));
+  filewatcher.modified_signal.connect
+    (sigc::mem_fun(*this, &ImageFrame::on_file_modified));
   
   if(association.empty()) {
     warning << "No or empty \"file\" attribute found in image frame"
@@ -273,7 +273,7 @@
   association = s;
   filewatcher.set_file(association);
   on_file_modified();
-  props_changed_signal(this);
+  props_changed_signal();
 }
 
 Boundary ImageFrame::get_box() const {
@@ -304,7 +304,7 @@
 
 void ImageFrame::on_file_modified() {
   read_size();
-  object_changed_signal(this);
+  object_changed_signal();
 }
 
 // Note: as long as this is only called in the constructor there is no need to
diff -Nur -x CVS passepartout-0.6/src/pptout/document/Makefile.am passepartout/src/pptout/document/Makefile.am
--- passepartout-0.6/src/pptout/document/Makefile.am	2003-10-25 18:59:18.000000000 +0200
+++ passepartout/src/pptout/document/Makefile.am	2004-11-27 22:42:22.000000000 +0100
@@ -3,12 +3,13 @@
 dist_noinst_HEADERS = basicframe.h cachedframe.h document.h group.h	\
 	imageframe.h page.h pagent.h rasterframe.h textframe.h		\
 	textstream.h fileerrors.h paper_sizes.h getxsltparams.h		\
-	loader.h filecontext.h
+	loader.h filecontext.h typesetterthread.h
 
-libdocument_a_SOURCES = basicframe.cc cachedframe.cc document.cc group.cc \
-	imageframe.cc page.cc pagent.cc rasterframe.cc textframe.cc	  \
-	textstream.cc paper_sizes.cc getxsltparams.cc loader.cc
+libdocument_a_SOURCES = basicframe.cc cachedframe.cc document.cc	\
+	group.cc imageframe.cc page.cc pagent.cc rasterframe.cc		\
+	textframe.cc textstream.cc paper_sizes.cc getxsltparams.cc	\
+	loader.cc typesetterthread.cc
 
-libdocument_a_CXXFLAGS = $(GTKMM_CFLAGS) $(XMLPP_CFLAGS) $(SIGC_CFLAGS)
+libdocument_a_CXXFLAGS = $(GTKMM_CFLAGS) $(XMLPP_CFLAGS)
 
 libdocument_a_CXXFLAGS += -I$(top_srcdir)/src
diff -Nur -x CVS passepartout-0.6/src/pptout/document/pagent.cc passepartout/src/pptout/document/pagent.cc
--- passepartout-0.6/src/pptout/document/pagent.cc	2004-09-26 21:32:34.000000000 +0200
+++ passepartout/src/pptout/document/pagent.cc	2004-11-29 22:50:50.000000000 +0100
@@ -19,7 +19,7 @@
   obstacle_margin(0)
 {
   // a geometry change implies a properties change
-  geometry_changed_signal.connect(props_changed_signal.slot());
+  geometry_changed_signal.connect(props_changed_signal.make_slot());
   // a geometry change does NOT imply a redraw
 
   connect_to_parent();
@@ -33,6 +33,11 @@
   set_matrix(m);
 }
 
+void Pagent::set_shearing(float shear) {
+  Matrix m = get_matrix(); m.set_sh(shear);
+  set_matrix(m);
+}
+
 void Pagent::set_rotation(float angle) {
   Matrix m = get_matrix(); m.set_rot(angle);
   set_matrix(m);
@@ -46,28 +51,28 @@
 void Pagent::set_lock(bool _locked) {
   if(_locked != locked) {
     locked = _locked;
-    props_changed_signal(this);
+    props_changed_signal();
   }
 }
 
 void Pagent::set_flow_around(bool _flow_around) {
   if(flow_around != _flow_around) {
     flow_around = _flow_around;
-    props_changed_signal(this);
+    props_changed_signal();
   }
 }
 
 void Pagent::set_obstacle_margin(float margin) {
   if(margin != obstacle_margin) {
     obstacle_margin = margin;
-    props_changed_signal(this);
+    props_changed_signal();
   }
 }
 
 void Pagent::set_name(const std::string &_name) {
   if(_name != name) {
     name = _name;
-    props_changed_signal(this);
+    props_changed_signal();
   }
 }
 
@@ -86,7 +91,6 @@
   }
   parent = _parent;
   connect_to_parent();
-  props_changed_signal(this);
 }
 
 void Pagent::set_matrix(Matrix m) {
@@ -96,7 +100,7 @@
   if(m.sc_x() == 0 || m.sc_y() == 0 || m.det() == 0)
     throw std::runtime_error("Bad matrix in set_matrix: " + tostr(m));
   matrix = m;
-  geometry_changed_signal(this);
+  geometry_changed_signal();
 }
 
 Group& Pagent::get_parent() {
@@ -119,13 +123,12 @@
   // a group would need to maintain a list of connections.
   // Note: we will get multible implicit signals.
   if(parent) {
-    using SigC::slot;
-      geometry_connection = geometry_changed_signal.connect
-	(slot(*parent, &Group::child_geometry_changed));
-
-      props_connection = props_changed_signal.connect
-	(slot(*parent, &Group::child_props_changed));
-    }
+    geometry_connection = geometry_changed_signal.connect
+      (sigc::mem_fun(*parent, &Group::child_geometry_changed));
+    
+    props_connection = props_changed_signal.connect
+      (sigc::mem_fun(*parent, &Group::child_props_changed));
+  }
 }
 
 Pagent::Resizable::~Resizable() {}
diff -Nur -x CVS passepartout-0.6/src/pptout/document/pagent.h passepartout/src/pptout/document/pagent.h
--- passepartout-0.6/src/pptout/document/pagent.h	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/pagent.h	2004-11-29 22:47:39.000000000 +0100
@@ -6,7 +6,7 @@
 #include "util/matrix.h"
 #include "util/boundary.h"
 #include "ps/pdf.h"
-#include <sigc++/object.h>
+#include <sigc++/connection.h>
 #include <sigc++/signal.h>
 #include <libxml++/nodes/element.h>
 #include <string>
@@ -30,7 +30,7 @@
  * A Pagent has a size and a transformation matrix that defines where on the
  * Page it is.
  */
-class Pagent: public SigC::Object {
+class Pagent: public sigc::trackable {
 public:
   Pagent(Group *_parent, const std::string& _name);
   virtual ~Pagent();
@@ -59,6 +59,7 @@
   
   // *** undoable actions ***
   virtual void set_translation(const Vector& v);
+  virtual void set_shearing(float shear);
   virtual void set_rotation(float angle);
   virtual void set_scaling(float xfactor, float yfactor);
   virtual void set_lock(bool _locked);
@@ -103,13 +104,13 @@
   Group& get_parent();
 
   /** There was a change in the source object for this Pagent. */
-  SigC::Signal1<void, Pagent*> object_changed_signal;
+  sigc::signal<void> object_changed_signal;
   
   /** Anything has changed, anything at all, including position and shape. */
-  SigC::Signal1<void, Pagent*> props_changed_signal; 
+  sigc::signal<void> props_changed_signal; 
 
   /** the pagent has changed shape / position */
-  SigC::Signal1<void, Pagent*> geometry_changed_signal; 
+  sigc::signal<void> geometry_changed_signal; 
   
   /**
    * Resizability contract for Pagents.  That a Pagent inherits Resizable
@@ -132,7 +133,7 @@
   float obstacle_margin;
   
   // connections to parent
-  SigC::Connection draw_connection, geometry_connection, props_connection;
+  sigc::connection draw_connection, geometry_connection, props_connection;
   void connect_to_parent();
 
 private:  
diff -Nur -x CVS passepartout-0.6/src/pptout/document/rasterframe.cc passepartout/src/pptout/document/rasterframe.cc
--- passepartout-0.6/src/pptout/document/rasterframe.cc	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/rasterframe.cc	2004-12-16 20:06:20.000000000 +0100
@@ -20,8 +20,8 @@
   if(association.empty())
     throw Error::Read("\"file\" attribute missing or empty in RasterFrame");
   
-  filewatcher.modified_signal.connect(slot(*this, 
-					   &RasterFrame::on_file_modified));
+  filewatcher.modified_signal.connect
+    (sigc::mem_fun(*this, &RasterFrame::on_file_modified));
   on_file_modified();
   
   // Handle widht and height for backwards compatibility
@@ -40,8 +40,8 @@
   : BasicFrame(parent, "Raster " + basename(filename)),
    association(filename), filewatcher(association)
 {
-  filewatcher.modified_signal.connect(slot(*this, 
-					   &RasterFrame::on_file_modified));
+  filewatcher.modified_signal.connect
+    (sigc::mem_fun(*this, &RasterFrame::on_file_modified));
  
   try {
     filepixbuf = Gdk::Pixbuf::create_from_file(association);
@@ -70,7 +70,7 @@
     warning << e.what() << std::endl;
   }
 
-  object_changed_signal(this);
+  object_changed_signal();
 }
 
 std::string RasterFrame::getTypeName() const { return "raster"; }
@@ -202,10 +202,7 @@
 	  guchar g = guchar(0.3 * pixel[0]     // r
 			    + 0.59 * pixel[1]  // g
 			    + 0.11 * pixel[2]  // b
-			    + 0.5); /// \todo "+ 0.5" ??? This was added
-				    /// in revision 1.60, before the
-				    /// move to document/, but I dont
-				    /// know why.
+			    + 0.5);
 	  buffer[i++] = g;
 	} else {
 	  // memcpy?
@@ -280,7 +277,7 @@
   filewatcher.set_file(association);
   
   on_file_modified();
-  props_changed_signal(this);
+  props_changed_signal();
 }
 
 Boundary RasterFrame::get_box() const {
diff -Nur -x CVS passepartout-0.6/src/pptout/document/textframe.cc passepartout/src/pptout/document/textframe.cc
--- passepartout-0.6/src/pptout/document/textframe.cc	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/textframe.cc	2004-11-29 22:54:10.000000000 +0100
@@ -23,14 +23,11 @@
     text_stream(stream),
     num_columns(1), gutter_width(12.0), width(w), height(h)
 {
-  white_is_transparent = true;
   ps_exists = false;
   parsed_file_lock = false;
 
   if(text_stream)
     text_stream->add_frame(this);
-  signal_end_write_ps.connect
-    (slot(*this,  &TextFrame::_end_write_ps));
 }
 
 TextFrame::TextFrame(const ElementWrap& xml, Group *parent)
@@ -42,7 +39,6 @@
     width(xml.get_required_attribute<float>("width")),
     height(xml.get_required_attribute<float>("height"))
 {
-  white_is_transparent = true;
   ps_exists = false;
   parsed_file_lock = false;
   
@@ -53,8 +49,6 @@
       throw Error::Read("Failed to get text stream \"" + stream->get_value()
 			+ "\" for text frame");
   } // If stream is not present text_stream is null. This is ok.
-  signal_end_write_ps.connect
-    (slot(*this,  &TextFrame::_end_write_ps));
 }
 
 TextFrame::~TextFrame() {
@@ -127,33 +121,26 @@
   ps_exists = false;
   if(text_stream) {
     text_stream->add_frame(this);
-    text_stream->generate_ps_request(this);
   } else {
     // make sure the viewent notices that something happened
-    object_changed_signal(this);
+    object_changed_signal();
   }
   
-  props_changed_signal(this);
-  if(text_stream)
-    text_stream->generate_ps_request(this);
+  props_changed_signal();
 }
 
 void TextFrame::set_num_columns(unsigned int columns) { 
   if(num_columns != columns) {
     num_columns = columns;
     //content_is_broken = false;	// Assume it's ok until we try it
-    props_changed_signal(this);
-    if(text_stream)
-      text_stream->generate_ps_request(this);
+    props_changed_signal();
   }
 }
 
 void TextFrame::set_gutter(const float& gutter) { 
   if(gutter_width != gutter) {
     gutter_width = gutter; 
-    props_changed_signal(this);
-    if(text_stream)
-      text_stream->generate_ps_request(this);
+    props_changed_signal();
   }
 }
 
@@ -161,7 +148,7 @@
   if(w != width || h != height) {
     width = w; height = h;
     ps_exists = false;
-    geometry_changed_signal(this);
+    geometry_changed_signal();
   }
 }
 
@@ -171,6 +158,7 @@
 
 void TextFrame::end_write_ps(bool _ps_exists, bool _truncated,
 			     const std::string &_error) {
+  debug << "*** END_WRITE_PS ***" << std::endl;
   parsed_file_lock = false;
   error = _error;
   ps_exists = _ps_exists;
@@ -178,11 +166,7 @@
     truncated = _truncated;
     truncated_state_changed_signal(truncated);
   }
-  signal_end_write_ps();
-}
-
-void TextFrame::_end_write_ps() {
-  object_changed_signal(this);
+  object_changed_signal();
 }
 
 void TextFrame::generate_picture(std::ostream& psstream) const {
diff -Nur -x CVS passepartout-0.6/src/pptout/document/textframe.h passepartout/src/pptout/document/textframe.h
--- passepartout-0.6/src/pptout/document/textframe.h	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/textframe.h	2004-12-20 14:58:30.000000000 +0100
@@ -5,7 +5,6 @@
 ///
 #include "cachedframe.h"
 #include "textstream.h"
-#include <glibmm/dispatcher.h>
 
 class TextFrame : public CachedFrame, public Pagent::Resizable {
 public:
@@ -47,7 +46,7 @@
   
   /** Emitted when the frame is or stops being the last frame of a
    * truncated stream. */
-  SigC::Signal1<void, bool> truncated_state_changed_signal;
+  sigc::signal<void, bool> truncated_state_changed_signal;
 
   // the frame will not try to read the ps between calls to
   // begin- and end_write_ps
@@ -58,12 +57,8 @@
   void generate_picture(std::ostream& psstream) const;
   
 private:
-  // for making end_write_ps() thread safe:
-  Glib::Dispatcher signal_end_write_ps;
-  void _end_write_ps();
-
   bool ps_exists, parsed_file_lock, truncated;
-  std::string parsed_file, error;
+  std::string error;
   TextStream *text_stream;
   unsigned int num_columns;
   float gutter_width, width, height;
diff -Nur -x CVS passepartout-0.6/src/pptout/document/textstream.cc passepartout/src/pptout/document/textstream.cc
--- passepartout-0.6/src/pptout/document/textstream.cc	2004-10-28 20:18:32.000000000 +0200
+++ passepartout/src/pptout/document/textstream.cc	2004-11-29 22:46:46.000000000 +0100
@@ -5,168 +5,53 @@
 #include "getxsltparams.h"
 #include <algorithm>
 #include <fstream>
-#include <sigc++/slot.h>
 
 #include "util/processman.h"
 #include "util/warning.h"
 #include "util/stringutil.h"
 #include "util/filesys.h"
 #include "util/os.h"
-#include "util/barrier.h"
 #include "xml2ps/typesetter.hh"
 #include "xml2ps/pdfcanvas.hh"
 
 #include "textframe.h"
 #include "page.h"
-
-#include <sys/types.h>
-#include <signal.h>
+#include "typesetterthread.h"
 
 namespace {			// local
   class SortingPredicate {
   public:
-    bool operator () (const TextFrame* a, const TextFrame* b) {
+    bool operator () (const TextFrame& a, const TextFrame& b) {
       try {
-	int a_num = a->get_page_num(); 
-	int b_num = b->get_page_num();
+	int a_num = a.get_page_num();
+	int b_num = b.get_page_num();
 	if(a_num < b_num)
 	  return true;
 	if(a_num > b_num)
 	  return false;
-      } catch (Error::InvalidPageNum e) {
-	// shouldn't happen, but it has happened
+      } catch(...) {
+	// Error::InvalidPageNum shouldn't happen, but it has happened
 	return true;		// something broken; any order!
       }
       
       // Same page, look at boxes.
-      const Vector a_vec = a->get_box()->getCorner(Corner::UL);
-      const Vector b_vec = b->get_box()->getCorner(Corner::UL);
+      const Vector a_vec = a.get_box()->getCorner(Corner::UL);
+      const Vector b_vec = b.get_box()->getCorner(Corner::UL);
       static const float k = 0.1;  // 10% slope
       const float m = a_vec.y - k * a_vec.x;
       return b_vec.y < k * b_vec.x + m;
     }
   };
 
-  bool gtk_main_running = false;
-
-  /**
-   * Start an external process running a XLST transform.
-   * \return a Process handle
-   */
-  Process runXsltProc(const std::string& transform,
-		      const std::string& association,
-		      const TextStream::ParamIter& begin,
-		      const TextStream::ParamIter& end) {
-    debug << "Applying XSL Transform" << std::endl;
-    // Assume xsltproc is in the path
-    std::vector<std::string> command;
-    command.push_back("xsltproc");
-    command.push_back("--nonet");
-    command.push_back("--catalogs");
-    
-    for(TextStream::ParamIter i = begin; i != end; ++i)
-      if(!i->second.empty()) {
-	command.push_back("--stringparam");
-	command.push_back(i->first);
-	command.push_back(i->second);
-      }
-    command.push_back(transform);
-    command.push_back(association);
-    
-    Process xformproc = ProcessManager::instance().run(command);
-    if(debug) {
-      debug << "Started " << xformproc->get_pid() << ':';
-      for(std::vector<std::string>::const_iterator i = command.begin();
-	  i != command.end(); ++i)
-	debug << ' ' << *i;
-      debug << "" << std::endl;
+  struct SortingPredicatePtr {
+    bool operator () (TextFrame *a, TextFrame *b) {
+      return SortingPredicate()(*a, *b);
     }
-    return xformproc;
-  }
-}
-
-
-class TextStream::WorkerThread : public SigC::Object {
-public:
-  static Glib::RefPtr<WorkerThread> create(TextStream& stream,
-                                           const Frames& frames) {
-    Glib::RefPtr<WorkerThread> tmp(new WorkerThread(stream, frames));
-    tmp->reference();
-    tmp->self = tmp;
-    return tmp;
-  }
-  
-  /// replaces SigC::Object::reference
-  void reference() const { ++count_; }
-  /// replaces SigC::Object::unreference
-  void unreference() const { if(--count_ == 0) delete this; }
-
-  bool is_done();
-  
-private:
-  WorkerThread(TextStream& stream, const Frames& frames);
-  ~WorkerThread();
-
-  void run();
-  void run_xml2ps(istream& source);
-
-  void on_done();
-  void on_error();
-  
-  void process_stopped(pid_t  pid, bool exited_normally, int exit_code);
-  
-  /// reference count
-  mutable unsigned int count_;
-
-  /// Keeps a reference to itself, so that the object is not deleted
-  /// until self is set to null explicitly, which should happen in
-  /// on_done() or on_error(). The idea is that the object should be
-  /// kept from being deleted until we are sure the Dispatcher pipe is
-  /// empty.
-  Glib::RefPtr<WorkerThread> self;
-
-  Barrier started, done;
-  TextStream& stream;
-  Frames sorted_frames;
-  bool truncated;
-  Glib::Dispatcher signal_done, signal_error;
-  SigC::Connection proc_stop_connection;
-  Glib::Thread* thread;
-  Process xformproc;
-  Glib::RefPtr<xml2ps::PsCanvas> new_canvas;
-};
-
-TextStream::WorkerThread::WorkerThread(TextStream& s, const Frames& frames)
-  : count_(0), stream(s), sorted_frames(frames), truncated(false),
-    proc_stop_connection(ProcessManager::instance().process_stopped.connect
-			 (SigC::slot(*this, 
-				     &WorkerThread::process_stopped)))
-{
-  sorted_frames.sort(SortingPredicate());
-  
-  signal_done.connect(SigC::slot(*this, &WorkerThread::on_done));
-  signal_error.connect(SigC::slot(*this,  &WorkerThread::on_error));
-  
-  thread = Glib::Thread::create(SigC::slot(*this, &WorkerThread::run), false);
-  debug << "Started thread " << thread << " from " << Glib::Thread::self()
-	<< std::endl;
-  
-  started.wait();
-  debug << "Thread " << thread << " initialized. "
-	<< Glib::Thread::self() << " may continue." << std::endl;
-}
-
-TextStream::WorkerThread::~WorkerThread() {
-  proc_stop_connection.disconnect();
-  if(xformproc)
-    kill(xformproc->get_pid(), SIGTERM);
-}
+  };
 
-bool TextStream::WorkerThread::is_done() {
-  return done.get_open();
+  bool gtk_main_running = false;
 }
 
-
 TextStream::TextStream(const std::string& _name, 
 		       const std::string& _association,
 		       const std::string& _transform)
@@ -181,12 +66,12 @@
     parameters[*i] = "";
   
   association_watcher.modified_signal.connect
-    (SigC::slot(*this, &TextStream::on_file_modified));
+    (sigc::mem_fun(*this, &TextStream::on_file_modified));
   transform_watcher.modified_signal.connect
-    (SigC::slot(*this, &TextStream::on_file_modified));
+    (sigc::mem_fun(*this, &TextStream::on_file_modified));
 
   // make sure Gtk::main() is running 
-  Glib::signal_idle().connect(SigC::slot(*this, &TextStream::on_idle));
+  Glib::signal_idle().connect(sigc::mem_fun(*this, &TextStream::on_idle));
 }
 
 TextStream::TextStream(const ElementWrap& xml)
@@ -218,23 +103,18 @@
     }
 
   association_watcher.modified_signal.connect
-    (SigC::slot(*this, &TextStream::on_file_modified));
+    (sigc::mem_fun(*this, &TextStream::on_file_modified));
   transform_watcher.modified_signal.connect
-    (SigC::slot(*this, &TextStream::on_file_modified));
+    (sigc::mem_fun(*this, &TextStream::on_file_modified));
 
   // make sure Gtk::main() is running 
-  Glib::signal_idle().connect(SigC::slot(*this, &TextStream::on_idle));
+  Glib::signal_idle().connect(sigc::mem_fun(*this, &TextStream::on_idle));
 }
 
 TextStream::~TextStream() {
-  /// \todo  Wait for thread to finish or make sure thread can finish without
-  /// this data.
-  
-  /// \todo  Do this on a copy of frames, after clearing frames.
-
   // remove_frame has the property that removing an unexisting frame is not an
   // error, just a no-op.
-  for(Frames::iterator i = frames.begin(); i != frames.end(); i++)
+  for(FramePtrs::iterator i = frames.begin(); i != frames.end(); i++)
     (*i)->set_stream(0, false);
   // do not let the frame remove itself from this stream
 }
@@ -272,8 +152,8 @@
 }
 
 void TextStream::remove_frame(TextFrame *text_frame) {
-  Frames::iterator i = find(frames.begin(), frames.end(),
-			    text_frame);
+  FramePtrs::iterator i = find(frames.begin(), frames.end(),
+                               text_frame);
   if(i != frames.end()) 
     frames.erase(i);
 
@@ -299,7 +179,7 @@
 				  "No associated file");
   if(!access(association))
     throw BasicFrame::GenPicError(BasicFrame::ASSOCIATION, 
-  				     "Could not open \"" + association + "\"");
+                                  "Could not open \"" + association + "\"");
 
   if(frames.empty())
     return;
@@ -317,168 +197,48 @@
   /// new typesetter_thread is started after the last one that was ignored.}
   
   // start typesetter in separate thread
-  if(!typesetter_thread || typesetter_thread->is_done())
-    typesetter_thread = WorkerThread::create(*this, frames);
-  else
-    debug << "Typesetter already working, not starting new." << std::endl;
-}
-
-void TextStream::WorkerThread::run() {
-  // this method is supposed to run in a separate thread
-  debug << "inside typesetter thread" << std::endl;
-  try {
-    if(stream.transform.empty()) {
-      // Run xml2ps directly on the source xml
-      std::ifstream source(stream.association.c_str());
-      if(!source) {
-	stream.typesetter_error = "Could not read from " + stream.association;
-	throw std::runtime_error(stream.typesetter_error);
-      }
-      run_xml2ps(source);
-      
-    } else {
-      xformproc = runXsltProc(stream.transform, stream.association,
-			      stream.parameters.begin(),
-			      stream.parameters.end());
-      
-      run_xml2ps(xformproc->get_cout());
+  frames.sort(SortingPredicatePtr());
+  if(!typesetter_thread || typesetter_thread->is_done()) {
+    TypesetterThread::FrameDataList sorted_frames;
+    for(FramePtrs::const_iterator i = frames.begin(); i != frames.end(); i++) {
+      /// \todo bundling obstacles with frames is inefficient
+      sorted_frames.push_back(TypesetterThread::FrameData
+                              (**i, Page::containing(**i).obstacle_list()));
+      (*i)->begin_write_ps();
     }
-    debug << "Signalling done from " << Glib::Thread::self() << std::endl;
-    done.open();
-    signal_done();
-    debug << " signalled done from " << Glib::Thread::self() << std::endl;
-  } catch (...) {
-    started.open(); // make sure the barrier actually opens even on errors.
-    // have to let main thread resume
-    // even if there is an error
-    if(stream.typesetter_error.empty()) {
-      try { throw; }
-      catch (const std::exception& err) {
-	stream.typesetter_error = err.what();
-      } catch(...) {
-	stream.typesetter_error = "unknown error";
-      }
-    }
-    debug << "typesetter error: " << stream.typesetter_error << std::endl;
-    done.open();
-    signal_error();
-  }
+    typesetter_thread = TypesetterThread::create(association, transform,
+                                                 parameters, sorted_frames);
+    typesetter_thread->signal_done.connect
+      (sigc::mem_fun(this, &TextStream::on_typesetter_done));
+  } else
+    debug << "Typesetter already working, not starting new." << std::endl;
 }
 
-void TextStream::WorkerThread::run_xml2ps(std::istream& source) {
-  xml2ps::Canvas::PageVec pages;
-  for(Frames::const_iterator i = sorted_frames.begin(); 
-      i != sorted_frames.end(); 
-      i++) {
-    (*i)->begin_write_ps();
-    const Vector framesize = (*i)->get_inherent_size();
-    pages.push_back(xml2ps::PageBoundary((*i)->get_page_num(),
-					 framesize.x, framesize.y,
-					 (*i)->get_num_columns(),
-					 (*i)->get_gutter()));
-    
-    // A boundary for the actual text frame, to make sure it doesn't try to
-    // flow around itself.
-    const Boundary boundary = (*i)->get_obstacle_boundary();
-    
-    // Transform from page coords to local textframe coords.
-    const Matrix xform((*i)->get_matrix().inv());
+void TextStream::on_typesetter_done(Glib::ustring error,
+                                    Glib::RefPtr<xml2ps::PsCanvas> new_canvas,
+                                    bool truncated) {
+  typesetter_error = error;
+  frames.sort(SortingPredicatePtr());
+  if(error.empty()) {
+    used_fonts = new_canvas->getUsedFonts();
+    // The new canvas is now ready to get data from
+    pageno_map.clear();
+    canvas = new_canvas;
     
-    // List of boundaries the text should flow around
-    const BoundaryVect obstacle_list = Page::containing(**i).obstacle_list();
-    for(BoundaryVect::const_iterator j = obstacle_list.begin();
-	j != obstacle_list.end();
-	j++) {
-      if(boundary != *j) {
-	pages.back().addObstacle(*j * xform);
-      }
+    int num = 1;
+    for(FramePtrs::const_iterator
+          i = frames.begin(); i != frames.end(); ++i, ++num) {
+      pageno_map[*i] = num;
+      FramePtrs::const_iterator j = i;
+      (*i)->end_write_ps(true, truncated && (++j == frames.end()));
     }
+  } else { // error
+    for(FramePtrs::const_iterator
+          i = frames.begin(); i != frames.end();  ++i)
+      (*i)->end_write_ps(false, false, error);
+    
+    failed = true; // report the last attempt to be a failure
   }
-  
-  // ok for caller to proceed:
-  started.open();
-  
-  debug << "running internal xml2ps ..." << std::endl;
-  new_canvas = (new xml2ps::PsCanvas(pages, false /* no extra pages */));
-  new_canvas->setSubstituteFontAliases(true);
-  xml2ps::PsConverter parser(*new_canvas.operator->());
-  try {
-    parser.parse_stream(source);
-  } catch(const xml2ps::OutOfPages&) {
-    truncated = true;
-  }
-}
-
-/**
- * This method should run in the main GUI thread when the worker is done.
- */
-void TextStream::WorkerThread::on_done() {
-  // make sure the the WorkerThread won't keep any references to
-  // itself after this method has returned.
-  Glib::RefPtr<WorkerThread> tmp = self;
-  self.clear();
-
-  debug << "Acting on done signal in " << Glib::Thread::self()
-	<< std::endl;
-  stream.used_fonts = new_canvas->getUsedFonts();
-  
-  // The new canvas is now ready to get data from
-  stream.pageno_map.clear();
-  swap(new_canvas, stream.canvas);
-  int num = 1;
-  for(Frames::const_iterator i = sorted_frames.begin(); 
-      i != sorted_frames.end(); 
-      ++i, ++num) {
-    stream.pageno_map[*i] = num;
-    Frames::const_iterator j = i;
-    (*i)->end_write_ps(true, truncated && (++j == sorted_frames.end()));
-  }
-  debug << "internal xml2ps done" << std::endl;
-}
-
-/**
- * This method should run in the main GUI thread if the worker fails.
- */
-void TextStream::WorkerThread::on_error() {
-  // make sure the the WorkerThread won't keep any references to
-  // itself after this method has returned.
-  Glib::RefPtr<WorkerThread> tmp = self;
-  self.clear();
-
-  for(Frames::const_iterator i = sorted_frames.begin(); 
-      i != sorted_frames.end();  ++i)
-    (*i)->end_write_ps(false, false, stream.typesetter_error);
-
-  stream.failed = true; // report the last attempt to be a failure  
-
-  /// \todo Report this in a better way!
-  warning << "TextStream " << stream.name << ": "
-	  << stream.typesetter_error << std::endl;
-}
-
-void TextStream::WorkerThread::process_stopped(pid_t pid, 
-					       bool exited_normally, 
-					       int exit_code)
-{
-  if(!xformproc || pid != xformproc->get_pid())
-    return;
-  
-  if(!exited_normally) {
-    warning << "Process " << pid << " exited abnormally" << std::endl;
-    return; /// \todo do something clever
-  }
-
-  if(exit_code != 0) {
-    /// \todo check that the return code 127 is not unique to Bash.
-    if(exit_code == 127) // the shell could not find xsltproc
-      warning << "xsltproc is not in $PATH" << std::endl;
-    else
-      warning << "xsltproc process with pid " << pid
-	      << " failed with exit code " << exit_code << std::endl;
-    return;
-  }
-  
-  debug << "Stylesheet done" << std::endl;
 }
 
 void TextStream::set_association(const std::string &s) {
@@ -551,10 +311,9 @@
   debug << "TextStream:p-pdf: c\n";
   
   xml2ps::Canvas::PageVec pages;
-  Frames sorted_frames(frames);
-  sorted_frames.sort(SortingPredicate());
-  for(Frames::const_iterator i = sorted_frames.begin(); 
-      i != sorted_frames.end(); 
+  frames.sort(SortingPredicatePtr());
+  for(FramePtrs::const_iterator i = frames.begin(); 
+      i != frames.end(); 
       i++) {
     const Vector framesize = (*i)->get_inherent_size();
     pages.push_back(xml2ps::PageBoundary((*i)->get_page_num(),
diff -Nur -x CVS passepartout-0.6/src/pptout/document/textstream.h passepartout/src/pptout/document/textstream.h
--- passepartout-0.6/src/pptout/document/textstream.h	2004-10-02 23:18:45.000000000 +0200
+++ passepartout/src/pptout/document/textstream.h	2005-03-19 19:07:41.000000000 +0100
@@ -8,10 +8,11 @@
 #include "xml2ps/pscanvas.hh"
 #include "ps/pdf.h"
 #include "filecontext.h"
-#include <list>
-#include <sigc++/object.h>
+#include <vector>
 
 class TextFrame;
+class TypesetterThread;
+
 namespace xml2ps { class PDFCanvas; }
 
 /**
@@ -29,7 +30,7 @@
  * TextStream::generate_ps_request which will run xml2ps if
  * necessary. This also happens when a frame is resized.
  */
-class TextStream: public SigC::Object {
+class TextStream: public sigc::trackable {
 public:
   /**
    * Create a new TextStream.
@@ -91,28 +92,28 @@
   void print_pdf(PDF::Document::Ptr pdfdoc);
   PDF::Object::Ptr getPagePDF(const TextFrame* frame);
   
-protected:
-  typedef std::list<TextFrame*> Frames;
+private:
+  typedef std::list<TextFrame*> FramePtrs;
   std::string name, association, transform;
-  Frames frames;
+  FramePtrs frames;
   bool failed; // true if the last attempt to typeset failed
   FileWatcher association_watcher, transform_watcher;
   
   std::string typesetter_error;
   
+  void on_typesetter_done(Glib::ustring error, Glib::RefPtr<xml2ps::PsCanvas>,
+                          bool truncated);
   void on_file_modified();
 
   bool on_idle();
 
-private:
   font::Fonts used_fonts;
   ParamMap parameters;
 
   Glib::RefPtr<xml2ps::PsCanvas> canvas;
   std::map<const TextFrame*, unsigned int> pageno_map;
   
-  class WorkerThread;
-  Glib::RefPtr<WorkerThread> typesetter_thread;
+  Glib::RefPtr<TypesetterThread> typesetter_thread;
   
   std::auto_ptr<xml2ps::PDFCanvas> pdfcanvas;
   
diff -Nur -x CVS passepartout-0.6/src/pptout/document/typesetterthread.cc passepartout/src/pptout/document/typesetterthread.cc
--- passepartout-0.6/src/pptout/document/typesetterthread.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/document/typesetterthread.cc	2005-03-19 14:34:35.000000000 +0100
@@ -0,0 +1,203 @@
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include <typesetterthread.h>
+#include "util/warning.h"
+#include "textframe.h"
+#include "xml2ps/typesetter.hh"
+
+// kill
+#include <sys/types.h>
+#include <signal.h>
+
+
+/**
+ * Start an external process running a XLST transform.
+ * \return a Process handle
+ */
+Process runXsltProc(const std::string& transform,
+                    const std::string& association,
+                    const TextStream::ParamIter& begin,
+                    const TextStream::ParamIter& end) {
+  debug << "Applying XSL Transform" << std::endl;
+  // Assume xsltproc is in the path
+  std::vector<std::string> command;
+  command.push_back("xsltproc");
+  command.push_back("--nonet");
+  // TODO: Make arugments to xsltproc (e.g. --catalogs) optional.
+  
+  for(TextStream::ParamIter i = begin; i != end; ++i)
+    if(!i->second.empty()) {
+      command.push_back("--stringparam");
+      command.push_back(i->first);
+      command.push_back(i->second);
+    }
+  command.push_back(transform);
+  command.push_back(association);
+    
+  Process xformproc = ProcessManager::instance().run(command);
+  if(debug) {
+    debug << "Started " << xformproc->get_pid() << ':';
+    for(std::vector<std::string>::const_iterator i = command.begin();
+        i != command.end(); ++i)
+      debug << ' ' << *i;
+    debug << "" << std::endl;
+  }
+  return xformproc;
+}
+
+TypesetterThread::TypesetterThread(const std::string& association,
+                                   const std::string& transform,
+                                   const TextStream::ParamMap& parameters,
+                                   const FrameDataList& sorted_frames)
+  : count_(0), association(association), transform(transform),
+    parameters(parameters),
+    sorted_frames(sorted_frames), truncated(false),
+    proc_stop_connection(ProcessManager::instance().process_stopped.connect
+			 (sigc::mem_fun(*this,
+                                        &TypesetterThread::process_stopped)))
+{
+  signal_thread_done.connect(sigc::mem_fun(*this, &TypesetterThread::on_done));
+  signal_thread_error.connect
+    (sigc::mem_fun(*this,  &TypesetterThread::on_error));
+  
+  Glib::Thread *thread =
+    Glib::Thread::create(sigc::mem_fun(*this, &TypesetterThread::run), false);
+
+  debug << "Started thread " << thread << " from " << Glib::Thread::self()
+	<< std::endl;
+}
+
+TypesetterThread::~TypesetterThread() {
+  proc_stop_connection.disconnect();
+  if(xformproc)
+    kill(xformproc->get_pid(), SIGTERM);
+}
+
+bool TypesetterThread::is_done() {
+  return done.get_open();
+}
+
+void TypesetterThread::run() {
+  // this method is supposed to run in a separate thread
+  debug << "inside typesetter thread" << std::endl;
+  try {
+    if(transform.empty()) {
+      // Run xml2ps directly on the source xml
+      std::ifstream source(association.c_str());
+      if(!source) {
+	error = "Could not read from " + association;
+	throw std::runtime_error(error);
+      }
+      run_xml2ps(source);
+      
+    } else {
+      xformproc = runXsltProc(transform, association,
+			      parameters.begin(), parameters.end());
+      
+      run_xml2ps(xformproc->get_cout());
+    }
+    debug << "Signalling done from " << Glib::Thread::self() << std::endl;
+    done.open();
+    signal_thread_done();
+    debug << " signalled done from " << Glib::Thread::self() << std::endl;
+  } catch (...) {
+    if(error.empty()) {
+      try { throw; }
+      catch (const std::exception& err) {
+	error = err.what();
+      } catch(...) {
+	error = "unknown error";
+      }
+    }
+    debug << "typesetter error: " << error << std::endl;
+    done.open();
+    signal_thread_error();
+  }
+}
+
+void TypesetterThread::run_xml2ps(std::istream& source) {
+  xml2ps::Canvas::PageVec pages;
+  for(FrameDataList::const_iterator
+        i = sorted_frames.begin(); i != sorted_frames.end(); i++) {
+    pages.push_back(xml2ps::PageBoundary(i->page_num,
+					 i->framesize.x, i->framesize.y,
+					 i->num_columns, i->gutter));
+    
+    // Transform from page coords to local textframe coords.
+    const Matrix xform(i->matrix.inv());
+    
+    // List of boundaries the text should flow around
+    for(BoundaryVect::const_iterator
+          o = i->obstacles.begin(); o != i->obstacles.end(); o++) {
+      if(i->boundary != *o)
+    	pages.back().addObstacle(*o * xform);
+    }
+  }
+  
+  debug << "running internal xml2ps ..." << std::endl;
+  xml2ps::PsCanvas *tmp =
+    new xml2ps::PsCanvas(pages, false /* no extra pages */);
+  tmp->reference(); // refcount starts at 0
+  new_canvas = Glib::RefPtr<xml2ps::PsCanvas>(tmp);
+  new_canvas->setSubstituteFontAliases(true);
+  xml2ps::PsConverter parser(*new_canvas.operator->());
+  try {
+    parser.parse_stream(source);
+  } catch(const xml2ps::OutOfPages&) {
+    truncated = true;
+  }
+}
+
+/**
+ * This method should run in the main GUI thread when the worker is done.
+ */
+void TypesetterThread::on_done() {
+  // make sure the the TypesetterThread won't keep any references to
+  // itself after this method has returned.
+  Glib::RefPtr<TypesetterThread> tmp = self;
+  self.clear();
+
+  debug << "internal xml2ps done" << std::endl;
+  signal_done("", new_canvas, truncated);
+}
+
+/**
+ * This method should run in the main GUI thread if the worker fails.
+ */
+void TypesetterThread::on_error() {
+  // make sure the the TypesetterThread won't keep any references to
+  // itself after this method has returned.
+  Glib::RefPtr<TypesetterThread> tmp = self;
+  self.clear();
+
+  debug << "internal xml2ps failed" << std::endl;
+  signal_done(error,
+              /* the rest is ignored */
+              Glib::RefPtr<xml2ps::PsCanvas>(), true);
+}
+
+void TypesetterThread::process_stopped(pid_t pid, 
+                                       bool exited_normally, 
+                                       int exit_code)
+{
+  if(!xformproc || pid != xformproc->get_pid())
+    return;
+  
+  if(!exited_normally) {
+    warning << "Process " << pid << " exited abnormally" << std::endl;
+    return; /// \todo do something clever
+  }
+
+  if(exit_code != 0) {
+    /// \todo check that the return code 127 is not unique to Bash.
+    if(exit_code == 127) // the shell could not find xsltproc
+      warning << "xsltproc is not in $PATH" << std::endl;
+    else
+      warning << "xsltproc process with pid " << pid
+	      << " failed with exit code " << exit_code << std::endl;
+    return;
+  }
+  
+  debug << "Stylesheet done" << std::endl;
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/document/typesetterthread.h passepartout/src/pptout/document/typesetterthread.h
--- passepartout-0.6/src/pptout/document/typesetterthread.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/document/typesetterthread.h	2004-11-29 22:46:47.000000000 +0100
@@ -0,0 +1,96 @@
+#ifndef TYPESETTERTHREAD_H		// -*- c++ -*-
+#define TYPESETTERTHREAD_H
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+
+#include "textstream.h"
+#include <glibmm/dispatcher.h>
+#include "util/barrier.h"
+#include "util/processman.h"
+#include "textframe.h"
+
+/// \todo move this some place else
+Process runXsltProc(const std::string& transform,
+                    const std::string& association,
+                    const TextStream::ParamIter& begin,
+                    const TextStream::ParamIter& end);
+
+class TypesetterThread : public sigc::trackable {
+public:
+  struct FrameData {
+    const Vector framesize;
+    const int page_num, num_columns;
+    const float gutter;
+    const Matrix matrix;
+    const Boundary boundary;
+    BoundaryVect obstacles;
+    FrameData(const TextFrame& frame,
+              const BoundaryVect& obstacles)
+      : framesize(frame.get_inherent_size()), page_num(frame.get_page_num()),
+        num_columns(frame.get_num_columns()), gutter(frame.get_gutter()),
+        matrix(frame.get_matrix()), boundary(frame.get_obstacle_boundary()),
+        obstacles(obstacles)
+    {
+    }
+  };
+  typedef std::list<FrameData> FrameDataList;
+  
+  sigc::signal<void, Glib::ustring,
+               Glib::RefPtr<xml2ps::PsCanvas>, bool> signal_done;
+  
+  static Glib::RefPtr<TypesetterThread>
+  create(const std::string& association, const std::string& transform,
+         const TextStream::ParamMap& parameters,
+         const FrameDataList& sorted_frames) {
+    Glib::RefPtr<TypesetterThread> tmp(new TypesetterThread(association,
+                                                            transform,
+                                                            parameters,
+                                                            sorted_frames));
+    tmp->reference();
+    tmp->self = tmp;
+    return tmp;
+  }
+  
+  void reference() const { ++count_; }
+  void unreference() const { if(--count_ == 0) delete this; }
+  bool is_done();
+  
+private:
+  TypesetterThread(const std::string& association,
+                   const std::string& transform,
+                   const TextStream::ParamMap& parameters,
+                   const FrameDataList& sorted_frames);
+  ~TypesetterThread();
+  
+  void run();
+  void run_xml2ps(istream& source);
+
+  void on_done();
+  void on_error();
+  
+  void process_stopped(pid_t  pid, bool exited_normally, int exit_code);
+  
+  /// reference count
+  mutable unsigned int count_;
+
+  /// Keeps a reference to itself, so that the object is not deleted
+  /// until self is set to null explicitly, which should happen in
+  /// on_done() or on_error(). The idea is that the object should be
+  /// kept from being deleted until we are sure the Dispatcher pipe is
+  /// empty.
+  Glib::RefPtr<TypesetterThread> self;
+
+  Barrier done;
+  const std::string association, transform;
+  std::string error;
+  const TextStream::ParamMap parameters;
+  FrameDataList sorted_frames;
+  bool truncated;
+  Glib::Dispatcher signal_thread_done, signal_thread_error;
+  sigc::connection proc_stop_connection;
+  Process xformproc;
+  Glib::RefPtr<xml2ps::PsCanvas> new_canvas;
+};
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/docview.cc passepartout/src/pptout/docview.cc
--- passepartout-0.6/src/pptout/docview.cc	2004-08-02 21:51:03.000000000 +0200
+++ passepartout/src/pptout/docview.cc	2004-12-17 15:46:54.000000000 +0100
@@ -9,8 +9,6 @@
 #include <vector>
 #include <algorithm>
 
-#include <gtkmm/style.h>
-
 #include "document/loader.h"
 #include "document/textframe.h"
 #include "document/imageframe.h"
@@ -23,13 +21,18 @@
 #include "util/filesys.h"
 
 #include "widget/usererror.h"
+#include "widget/programs.h"
 
 #include "groupmeta.h"
 #include "pptcore.h"
-#include "pagesel.h"
 #include "config.h"
 #include "lengthunits.h"
 
+#include "defines.h"
+#ifdef HAVE_GNOME
+#include <libgnomevfs/gnome-vfs-mime.h>
+#endif
+
 float DocumentView::pt2scr(float pt) const {
    return int(resolution * zoom_factor 
 	      * length_units.from_base(pt, "in") + 0.5);
@@ -54,22 +57,6 @@
 
 
 //////////////////////////////////// BEGIN JUNK
-void DocumentView::insert_page_before() {
-  if(document)
-    template_page_dialog->show_it(true, 
-				  document->get_num_of_pages() 
-				  ? current_page_num
-				  : document->get_first_page_num());
-}
-
-void DocumentView::insert_page_after() {
-  if(document)
-    template_page_dialog->show_it(true, 
-				  document->get_num_of_pages()
-				  ? current_page_num + 1
-				  : document->get_first_page_num());
-}
-
 void DocumentView::delete_page() {
   if(document) {
     pageview.clear(); // Do this first, so the viewent won't be
@@ -77,20 +64,12 @@
                       // which is emitted after the page has been
                       // deleted.
     document->delete_page(current_page_num);
+    // Todo: this is an ugly fix to keep the pageview updated
+    set_current_page_num(current_page_num);
+    current_page_num_changed_signal(); // sometimes redundant
   }
 }
 
-
-void DocumentView::new_text_frame(TextStream *stream) {
-  Page *page = get_page();
-  if(!page || !document)
-    return;
-  
-  int w = 200, h = 300;
-  // default to the first (alphabetically) stream
-  page->addObject(new TextFrame(page, stream, w, h));
-}
-
 void DocumentView::new_image_frame(std::string filename, float res) {
   Page *page = get_page();
   if(!page)
@@ -110,41 +89,6 @@
   }
 }
 
-void DocumentView::select_all_frames() {
-  if(Page *page = get_page()) {
-      page->select_all(true); 
-    }
-}
-
-void DocumentView::unselect_all_frames() {
-  if(Page *page = get_page()) {
-      page->select_all(false); 
-    }
-}
-
-void DocumentView::delete_selected() {
-  if(DocRef doc = get_document()) {
-    doc->delete_selected();
-  }
-}  
-
-void DocumentView::group_selected() {
-  if(Page *page = get_page()) {
-    page->group_selected();
-  }
-}
-
-void DocumentView::ungroup_selected() {
-  if(Page *page = get_page()) {
-    page->ungroup_selected();
-  }
-}
-
-void DocumentView::rearrange_selected(RearrangeTarget target) {
-  if(Page *page = get_page()) {
-    page->rearrange_selected(target);
-  }
-}  
 //////////////////////////////////////END JUNK
 
 Page *DocumentView::get_page() {
@@ -200,13 +144,12 @@
   }
 }
 
-void DocumentView::update_document_size(DocRef document_) {
-  if(!document || document != document_)
-    return;
+void DocumentView::update_document_size() {
   float w = document->get_width();
   float h = document->get_height();
   
-  reset_scroll_region();
+  set_scroll_region(-margin_size, -h - margin_size,
+                    w + margin_size, margin_size);
   
   no_pages_frame->property_x1() = 0;
   no_pages_frame->property_y1() = 0;
@@ -224,17 +167,17 @@
   document = d;
   update_handles();
   if(document) {
-    update_document_size(document.get_document());
+    update_document_size();
     no_pages_group.show();
     
     current_page_num = document->get_first_page_num();
     
-    Document::size_changed_signal.connect
-      (slot(*this, &DocumentView::update_document_size));
+    document->size_changed_signal.connect
+      (sigc::mem_fun(*this, &DocumentView::update_document_size));
     Document::changed_signal.connect
-      (slot(*this, &DocumentView::act_on_document_change));
+      (sigc::mem_fun(*this, &DocumentView::act_on_document_change));
     Document::selection_changed_signal.connect
-      (slot(*this, &DocumentView::act_on_selection_change));
+      (sigc::mem_fun(*this, &DocumentView::act_on_selection_change));
   } else {
     no_pages_group.hide();
   }
@@ -313,18 +256,26 @@
 
   // Update handles when we turn pages
   current_page_num_changed_signal.connect
-    (slot(*this, &DocumentView::update_handles));
+    (sigc::mem_fun(*this, &DocumentView::update_handles));
+  
+  // make sure the scrolling region is the right size (it only seems
+  // to work if the canvas has been realized)
+  if(document)
+    signal_realize().connect
+      (sigc::mem_fun(*this, &DocumentView::update_document_size));
 }
 
 DocumentView::~DocumentView() {
 }
 
 void DocumentView::set_zoom_factor(float factor) {
-  if(factor > 0 && document) {
+  if(factor > 0) {
       zoom_factor = factor;
       set_pixels_per_unit(resolution / 72.0 * zoom_factor);
-      zoom_change_signal(zoom_factor);
-      update_handles();
+      if(document) {
+        zoom_change_signal(zoom_factor);
+        update_handles();
+      }
     }
 }
 
@@ -386,202 +337,130 @@
 }
 
 bool DocumentView::on_button_press_event(GdkEventButton *event) {
-  // Cursor-browsing hack:
-  //  static GdkCursorType foo=GdkCursorType(0);
-  //  cerr << foo << endl;
-  //  Gdk::Cursor moving_cursor(foo);
-  //  foo=GdkCursorType(foo+2);
-  //  win.set_cursor(moving_cursor);
-
   Page *page = get_page();
-  if(page && event->button == 1) {
-    const Document::Selection selected = get_document()->selected();
+  if(!page)
+    return true;
 
-    int j = hover_reshape(int(event->x), int(event->y));
-    if(j != -1 && selected.size() == 1
-       && !selected.front()->get_lock()) { // maybe start moving/resizing?
-      // reshape
-
-      begin_reshape(int(event->x), int(event->y), j);
-    } else if(Pagent* select = in_select_area(int(event->x), int(event->y))) {
-      // select / move
-
-      // is it already selected?
-      if(find(selected.begin(), selected.end(), select) != selected.end()) {
-	if(event->state & Gdk::CONTROL_MASK) { // deselect
-	  get_document()->deselect(select);
-	} else 
-	  begin_move(int(event->x), int(event->y));
-      } else { // select and begin moving
-	get_document()->select(select, !(event->state & Gdk::CONTROL_MASK));
-	if(!select->get_lock())
-	  begin_move(int(event->x), int(event->y));
+  switch(event->button) {
+  case 1:
+    {
+      const Document::Selection selected = get_document()->selected();
+
+      int j = hover_reshape(int(event->x), int(event->y));
+      if(j != -1 && selected.size() == 1
+         && !selected.front()->get_lock()) { // maybe start moving/resizing?
+        // reshape
+
+        begin_reshape(int(event->x), int(event->y), j);
+      } else if(Pagent* select = in_select_area(int(event->x), int(event->y))) {
+        // select / move
+
+        // is it already selected?
+        if(find(selected.begin(), selected.end(), select) != selected.end()) {
+          if(event->state & Gdk::CONTROL_MASK) { // deselect
+            get_document()->deselect(select);
+          } else
+            begin_move(int(event->x), int(event->y));
+        } else { // select and begin moving
+          get_document()->select(select, !(event->state & Gdk::CONTROL_MASK));
+          if(!select->get_lock())
+            begin_move(int(event->x), int(event->y));
+        }
+      } else if((event->state & Gdk::CONTROL_MASK) == 0) { // deselect all
+        get_document()->select_all(false);
       }
-    } else if((event->state & Gdk::CONTROL_MASK) == 0) { // deselect all
-      get_document()->select_all(false);
     }
+    break;
+  case 3:
+    {
+      if(event->type == GDK_BUTTON_PRESS) {
+        Pagent* select = in_select_area(int(event->x), int(event->y));
+        if(select) {
+          std::string filename;
+          std::vector<std::string> mimetypes;
+
+          /// \todo move the mime type heuristics elsewhere
+          ImageFrame *i_f; RasterFrame *r_f; TextFrame *t_f;
+          if((i_f = dynamic_cast<ImageFrame*>(select))) {
+            filename = i_f->get_association();
+          } else if((r_f = dynamic_cast<RasterFrame*>(select))) {
+            filename = r_f->get_association();
+          } else if((t_f = dynamic_cast<TextFrame*>(select))) {
+            TextStream *stream = t_f->get_stream();
+            filename = stream->get_association();
+            mimetypes.push_back("text/plain"); // always enable text editors
+          } else break;
+
+          if(filename.empty())
+            break;
+#ifdef HAVE_GNOME
+          const char *mtype = gnome_vfs_mime_type_from_name(filename.c_str());
+          if(mtype)
+            mimetypes.push_back(mtype);
+#endif
+          if(mimetypes.empty())
+            mimetypes.push_back("text/plain");
+
+          popup_menu.items().clear();
+          try {
+            for(std::vector<std::string>::const_iterator
+                  type = mimetypes.begin();
+                type != mimetypes.end();
+                type++)
+              Programs::populate_file_handler_menu(popup_menu,
+                                                   filename, *type);
+            popup_menu.popup(event->button, event->time);
+          }
+          catch(const std::exception &e) {
+            verbose << "Failed to display popup menu: " << e.what()
+                    << std::endl;
+          }
+        }
+      }
+    }
+    break;
+  default: break;
   }
 
   return true;
 }
 
-// *** copy/paste stuff ***/
-
 namespace {
-  std::string clip; // a global clip should suffice
-  const std::string pptout_target = "PPTOUT_PAGENTS_2"; // with version number
-}
-
-void DocumentView::copy() {
-  DocRef doc = get_document();
-  if(!doc)
-    return;
-
-  /// \todo make sure the selection is sorted
-  const Document::Selection selected = document->selected();
-  if(selected.empty())
-    return;
-  
-  Glib::RefPtr<Gtk::Clipboard> clipboard = Gtk::Clipboard::get();
-  std::list<Gtk::TargetEntry> target_list;
-  target_list.push_back(Gtk::TargetEntry(pptout_target)); 
-  clipboard->set(target_list, 
-		 SigC::slot(*this, &DocumentView::on_clipboard_get), 
-		 SigC::slot(*this, &DocumentView::on_clipboard_clear));
-
-  // store an XML representation of the selected pagents
-  xmlpp::Document rep;
-  xmlpp::Element *root = rep.create_root_node("copy_data");
-
-  // save relevant streams
-  typedef std::set<const TextStream*> Streams;
-  Streams streams;
-  for(Document::Selection::const_iterator i = selected.begin();
-      i != selected.end(); i++) {
-    const TextFrame *frame = dynamic_cast<const TextFrame *>(*i);
-    if(!frame)
-      continue;
-    const TextStream *stream = frame->get_stream();
-    if(stream && streams.find(stream) == streams.end()) {
-      streams.insert(stream);
-      stream->save(*root, FileContext());
-    }
-  }
-
-  // save pagents
-  for(Document::Selection::const_iterator i = selected.begin();
-      i != selected.end(); i++) {
-    (*i)->save(*root, FileContext());
-  }
-
-  clip = rep.write_to_string();
-  //std::cerr << clip << std::endl;
-}
-
-void DocumentView::on_clipboard_get(Gtk::SelectionData& selection_data, 
-				     guint info)
-{ 
-  const Glib::ustring& target = selection_data.get_target(); 
-  
-  if(target == pptout_target)
-    selection_data.set(pptout_target, clip);
-}
-
-void DocumentView::on_clipboard_clear() {
-  // not really necessary
-  clip.clear(); 
-}
-
-void DocumentView::cut() {
-  copy(); 
-  delete_selected();
-}
-
-void DocumentView::paste() {
-  Page *page = get_page();
-  if(!page)
-    return;
-
-  Glib::RefPtr<Gtk::Clipboard> clipboard = Gtk::Clipboard::get();
-  clipboard->request_contents
-    (pptout_target, SigC::slot(*this, &DocumentView::on_clipboard_received));
-}
-
-void 
-DocumentView::on_clipboard_received(const Gtk::SelectionData& selection_data)
-{
-  Page *page = get_page();
-  if(!page)
-    return;
-
-  Glib::ustring clipboard_data = selection_data.get_data_as_string();
-  try {
-    xmlpp::DomParser parser;  
-    parser.parse_memory(clipboard_data);
-    xmlpp::Element *root = parser.get_document()->get_root_node();
-    if(!root)
-      throw std::runtime_error("Root node is NULL.");
-    xmlpp::Element::NodeList children = root->get_children();
-
-    get_document()->select_all(false);
-    for(xmlpp::Element::NodeList::const_iterator i = children.begin();
-	i != children.end(); i++)
-      {
-	if(xmlpp::Element *elem = dynamic_cast<xmlpp::Element*>(*i)) {
-	  if(elem->get_name() == "text_stream") {
-	    std::auto_ptr<TextStream> stream(new TextStream
-					     (ElementWrap("", *elem)));
-	    // Don't try to add a stream with a name that already exists
-	    /// \todo rename the stream automatically?
-	    if(!document->get_text_stream(stream->get_name()))
-	      document->add_text_stream(stream.release());
-	  } else {
-	    Pagent *pagent = load(ElementWrap("", *elem), page);
-	    page->add(pagent);
-	    get_document()->select(pagent, false); // don't deselect
-	  }
-	}
-      }
-  } catch(const std::exception& e) {
-    throw std::runtime_error("Error encountered when pasting:\n" 
-			     + std::string(e.what()));
-  }
-}  
-
-// Todo: This method should be removed.  Instead, there should exist something
-// (not related to a specific view, but to the document), that listens to
-// geometry changes, finds all text streams that have frames that intersects
-// with the object (before or after the change) and retypesets them.
-// What is done here is to much typsetting when objects moved / resized by the
-// view, and no typesetting at all when objects are moved / resized by e.g.
-// the properties dialog.
-void DocumentView::refresh_streams() {
-  if(Page *page = get_page()) {
-    Document::StreamVec streams;
-    for(Group::ChildVec::const_iterator i = page->pbegin();
-	i != page->pend();
-	i++) 
-      {
-	TextFrame *tmp = dynamic_cast<TextFrame*>(*i);
-	if(tmp) {
-	  TextStream *stream = tmp->get_stream();
-	  if(stream 
-	     && find(streams.begin(), streams.end(), stream) == streams.end())
-	    streams.push_back(stream);
-	}
-      }
-    for(Document::StreamVec::iterator i = streams.begin();
-	i != streams.end();
-	i++)
-      {
-        try {
-          (*i)->run_typesetter();
-        } catch(const BasicFrame::GenPicError &e) {
-          warning << "Failed to refresh stream: " << e.what() << std::endl;
+  // Todo: This method should be removed.  Instead, there should exist something
+  // (not related to a specific view, but to the document), that listens to
+  // geometry changes, finds all text streams that have frames that intersects
+  // with the object (before or after the change) and retypesets them.
+  // What is done here is to much typsetting when objects moved / resized by the
+  // view, and no typesetting at all when objects are moved / resized by e.g.
+  // the properties dialog.
+  void refresh_streams(Page *page) {
+    if(page) {
+      Document::StreamVec streams;
+      for(Group::ChildVec::const_iterator i = page->pbegin();
+          i != page->pend();
+          i++) 
+        {
+          TextFrame *tmp = dynamic_cast<TextFrame*>(*i);
+          if(tmp) {
+            TextStream *stream = tmp->get_stream();
+            if(stream 
+               && find(streams.begin(), streams.end(), stream) == streams.end())
+              streams.push_back(stream);
+          }
         }
-	debug << (*i)->get_name() << ", " 
-	      << (*i)->get_association() << std::endl;
-      }
+      for(Document::StreamVec::iterator i = streams.begin();
+          i != streams.end();
+          i++)
+        {
+          try {
+            (*i)->run_typesetter();
+          } catch(const BasicFrame::GenPicError &e) {
+            warning << "Failed to refresh stream: " << e.what() << std::endl;
+          }
+          debug << (*i)->get_name() << ", " 
+                << (*i)->get_association() << std::endl;
+        }
+    }
   }
 }
 
@@ -621,7 +500,7 @@
 	}
       }
     }
-    refresh_streams();
+    refresh_streams(get_page());
   }
 }
 
@@ -658,10 +537,8 @@
 }
 
 void DocumentView::end_move(bool revert) {
-  if(get_page()) {
-    moving = false;
-    refresh_streams();
-  }
+  moving = false;
+  refresh_streams(get_page());
 }
 
 bool DocumentView::on_key_press_event(GdkEventKey* key) {
@@ -682,7 +559,7 @@
   return true;
 }
 
-Gdk::Cursor DocumentView::get_cursor(int x, int y) {
+Gdk::CursorType DocumentView::get_cursor(int x, int y) {
   DocRef document = get_document();
   if(!document)
     return Gdk::LEFT_PTR;
@@ -721,7 +598,7 @@
 }
 
 void DocumentView::update_cursor(int x, int y) {
-  win->set_cursor(get_cursor(x, y));
+  get_window()->set_cursor(Gdk::Cursor(get_cursor(x, y)));
 }
 
 namespace {
@@ -845,7 +722,7 @@
   if(event->is_hint) {
     Gdk::ModifierType state;
     int x, y;
-    win->get_pointer(x, y, state);
+    get_window()->get_pointer(x, y, state);
   }
 
   int x = int(event->x);
@@ -899,42 +776,18 @@
   return true;
 }
 
-void DocumentView::reset_scroll_region() {
-  if(document) {
-    float w = document->get_width();
-    float h = document->get_height();
-    set_scroll_region(-margin_size, -h - margin_size, 
-                      w + margin_size, margin_size);
-  }
-}
-
-void DocumentView::on_realize() {
-  Gnome::Canvas::Canvas::on_realize();
-
-  // Doing this in the constructor does not seem to work all the time
-  reset_scroll_region();
-
-  // get_toplevel doesn't work in the constructor
-  Gtk::Window *toplevel = dynamic_cast<Gtk::Window*>(get_toplevel());
-  assert(toplevel != 0);
-  // template_page_dialog is deleted in the destructor
-  template_page_dialog.reset(new TemplatePageDialog(*toplevel, *this));
-
-  win = get_window();
-}
-
 void DocumentView::on_drag_data_received
-(const Glib::RefPtr<Gdk::DragContext>& context, 
- int x, int y, GtkSelectionData* selection_data, guint info, guint time)
+(const Glib::RefPtr<Gdk::DragContext>& context,
+ int x, int y, const Gtk::SelectionData& selection_data,
+ guint info, guint time)
 {
   /// \todo unicode ???
 
-  Gtk::SelectionData selection(selection_data);
   debug << "DocumentView::on_drop_drag_data_received:" << std::endl
 	<< "x = " << x << ", y = " << y << std::endl
-	<< selection.get_data_type() << " : \"" 
-	<< selection.get_text() << "\"" << std::endl
-	<< "\"" << selection.get_data_as_string() << "\"" << std::endl
+	<< selection_data.get_data_type() << " : \"" 
+	<< selection_data.get_text() << "\"" << std::endl
+	<< "\"" << selection_data.get_data_as_string() << "\"" << std::endl
 	<< std::endl;
 
   if(!get_page()) {
@@ -945,7 +798,7 @@
   // split into lines
   typedef std::vector<std::string> Strings;
   Strings strings;
-  std::string data = selection.get_data_as_string();
+  std::string data = selection_data.get_data_as_string();
   unsigned int start = 0;
   unsigned int stop;
   unsigned int length = data.length();
@@ -997,10 +850,10 @@
     selected_geometry_connection.disconnect();
     selected_props_connection.disconnect();
     selected_geometry_connection = pagent->geometry_changed_signal.connect
-      (SigC::hide<Pagent*>(slot(*this, &DocumentView::update_handles)));
+      (sigc::mem_fun(*this, &DocumentView::update_handles));
     // this is for noticing if the pagent is being locked/unlocked
     selected_props_connection = pagent->props_changed_signal.connect
-      (SigC::hide<Pagent*>(slot(*this, &DocumentView::update_handles)));
+      (sigc::mem_fun(*this, &DocumentView::update_handles));
   }
   ResizeHandles pos = get_resize_handles(*pagent);
   assert(pos.size() == 8);
diff -Nur -x CVS passepartout-0.6/src/pptout/docview.h passepartout/src/pptout/docview.h
--- passepartout-0.6/src/pptout/docview.h	2004-08-02 21:51:03.000000000 +0200
+++ passepartout/src/pptout/docview.h	2004-11-27 04:22:45.000000000 +0100
@@ -11,7 +11,6 @@
 #include <libgnomecanvasmm.h>
 #include <memory> // auto_ptr
 
-class TemplatePageDialog;
 class Page;
 class TextStream;
 
@@ -21,10 +20,9 @@
 
 class DocumentView: public Gnome::Canvas::Canvas, public View {
 public:
-  SigC::Signal0<void> current_page_num_changed_signal;
-  SigC::Signal0<void> document_changed_signal;
-  SigC::Signal0<void> document_set_signal;
-  SigC::Signal1<void, float> zoom_change_signal;
+  sigc::signal<void> current_page_num_changed_signal;
+  sigc::signal<void> document_changed_signal;
+  sigc::signal<void> document_set_signal;
 
   Gdk::Color white, black, gray, red;
 
@@ -40,22 +38,9 @@
   float get_zoom_factor() const { return zoom_factor; }
   void set_zoom_factor(float);
 
-  void insert_page_before();
-  void insert_page_after();
   void delete_page();
 
-  void copy();
-  void cut();
-  void paste();
-
-  void delete_selected();
-  void rearrange_selected(RearrangeTarget target);
-  void group_selected();
-  void ungroup_selected();
-  void new_text_frame(TextStream *stream);
   void new_image_frame(std::string, float res = -1);
-  void select_all_frames();
-  void unselect_all_frames();
 
   Gnome::Canvas::Group& get_pagent_group() { return pagent_group; }
   Gnome::Canvas::Group& get_guide_group() { return guide_group; }
@@ -82,7 +67,7 @@
   DocumentView();
   void operator = (const DocumentView&);
 
-  Glib::RefPtr<Gdk::Window> win;
+  sigc::signal<void, float> zoom_change_signal;
   Viewent::Ref pageview;
   Gnome::Canvas::Group no_pages_group, pagent_group, guide_group, handle_group;
   std::auto_ptr<Gnome::Canvas::Rect> no_pages_frame;
@@ -90,9 +75,9 @@
   Gnome::Canvas::Rect *handles[8]; /// managed by the canvas
 
   /// a connection to the selected pagents geometry_changed_signal
-  SigC::Connection selected_geometry_connection;
+  sigc::connection selected_geometry_connection;
   /// a connection to the selected pagents props_changed_signal
-  SigC::Connection selected_props_connection;
+  sigc::connection selected_props_connection;
   /// keep track of which pagent the connection is to
   Pagent *last_selected;
 
@@ -107,28 +92,22 @@
   bool moving, reshaping;
   DocMeta document;
   Page *old_page; //last page visited
-  std::auto_ptr<TemplatePageDialog> template_page_dialog;
-
-  void on_clipboard_get(Gtk::SelectionData& selection_data, guint info);
-  void on_clipboard_clear();
-  void on_clipboard_received(const Gtk::SelectionData& selection_data);
+  Gtk::Menu popup_menu;
 
   /// If there is a reshape box at pixel coordinates (x, y) return the
   /// index of the box, otherwise return -1.
   int hover_reshape(int x, int y);
-  /// Set the scroll region of the canvas to fit the size of the document
-  void reset_scroll_region();
 
-  void on_realize();
   bool on_button_press_event(GdkEventButton*);
   bool on_button_release_event(GdkEventButton*);
   bool on_motion_notify_event(GdkEventMotion*);
-  void on_drag_data_received(const Glib::RefPtr<Gdk::DragContext>& context, 
-			     int x, int y, GtkSelectionData* selection_data, 
+  void on_drag_data_received(const Glib::RefPtr<Gdk::DragContext>& context,
+			     int x, int y,
+                             const Gtk::SelectionData &selection_data,
 			     guint info, guint time);
+
   void update_handles();
 
-  void refresh_streams();
   void begin_move(int x, int y);
   void end_move(bool revert);
   void begin_reshape(int x, int y, int box);
@@ -137,13 +116,13 @@
 
   void act_on_document_change(DocRef document_);
   void act_on_selection_change(DocRef document_);
-  void update_document_size(DocRef document_);
-  Gdk::Cursor get_cursor(int x, int y);
+  void update_document_size();
+  Gdk::CursorType get_cursor(int x, int y);
   void update_cursor(int x, int y);
   bool in_move_area(int x, int y);
   Pagent* in_select_area(int x, int y);
 
-  SigC::Connection connect_zoom_change(SigC::Slot1<void, float> slot) {
+  sigc::connection connect_zoom_change(sigc::slot<void, float> slot) {
     return zoom_change_signal.connect(slot);
   }
 };
diff -Nur -x CVS passepartout-0.6/src/pptout/groupmeta.cc passepartout/src/pptout/groupmeta.cc
--- passepartout-0.6/src/pptout/groupmeta.cc	2004-04-27 17:54:03.000000000 +0200
+++ passepartout/src/pptout/groupmeta.cc	2004-11-12 16:18:08.000000000 +0100
@@ -15,7 +15,6 @@
 Viewent::Ref GroupMeta::create_viewent(View& view, Pagent& node) {
   Viewent::Ref result(new GroupViewent
 		      (view, &dynamic_cast<Group&>(node)));
-  result->set_manage(); // turn refcounting on
   result->reference();
   return result;
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/groupviewent.cc passepartout/src/pptout/groupviewent.cc
--- passepartout-0.6/src/pptout/groupviewent.cc	2004-09-26 16:13:02.000000000 +0200
+++ passepartout/src/pptout/groupviewent.cc	2004-11-14 20:08:13.000000000 +0100
@@ -39,7 +39,7 @@
   const Gdk::Color &get_color(Color::Id color) const { 
     return parent.get_color(color); 
   }
-  SigC::Connection connect_zoom_change(SigC::Slot1<void, float> slot) {
+  sigc::connection connect_zoom_change(sigc::slot<void, float> slot) {
     return parent.connect_zoom_change(slot);
   }
 private:
@@ -53,10 +53,13 @@
     subview(new SubView(view, groupframe->get_matrix(), *content_group)),
     frame(groupframe),
     groupcon(frame->group_changed_signal.connect
-	     (SigC::hide<Pagent*>(slot(*this, &GroupViewent::group_changed))))
+	     (sigc::mem_fun(*this, &GroupViewent::group_changed)))
 {
   // Create the initial content, just as if it was added after this object.
   group_changed();
+  
+  on_geometry_changed();
+  on_properties_changed();
 }
 
 GroupViewent::~GroupViewent() {
diff -Nur -x CVS passepartout-0.6/src/pptout/groupviewent.h passepartout/src/pptout/groupviewent.h
--- passepartout-0.6/src/pptout/groupviewent.h	2004-09-26 16:13:02.000000000 +0200
+++ passepartout/src/pptout/groupviewent.h	2004-11-12 16:18:08.000000000 +0100
@@ -26,7 +26,7 @@
 
   View* subview;
   FrameRef frame;
-  SigC::Connection groupcon;
+  sigc::connection groupcon;
   ChildVec childvec;
 };
 
diff -Nur -x CVS passepartout-0.6/src/pptout/icons/icons.h passepartout/src/pptout/icons/icons.h
--- passepartout-0.6/src/pptout/icons/icons.h	2004-01-12 20:01:25.000000000 +0100
+++ passepartout/src/pptout/icons/icons.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,25 +0,0 @@
-// -*- c++ -*-
-///
-// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
-///
-#ifndef ICONS_H
-#define ICONS_H
-
-#include <gtkmm/image.h>
-
-#include "newframe_24.h"
-#include "streams_24.h"
-#include "moose_24.h"
-#include "grid_24.h"
-
-struct Icons {
-  Gtk::Image new_frame, streams, moose, grid;
-  Icons():
-    new_frame(Gdk::Pixbuf::create_from_inline(2328, newframe_24)),
-    streams(Gdk::Pixbuf::create_from_inline(2328, streams_24)),
-    moose(Gdk::Pixbuf::create_from_inline(2328, moose_24)),
-    grid(Gdk::Pixbuf::create_from_inline(2328, grid_24))
-  {}
-};
-
-#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/icons/Makefile.am passepartout/src/pptout/icons/Makefile.am
--- passepartout-0.6/src/pptout/icons/Makefile.am	2003-05-08 22:49:29.000000000 +0200
+++ passepartout/src/pptout/icons/Makefile.am	2004-11-24 00:02:52.000000000 +0100
@@ -1,2 +1,2 @@
-EXTRA_DIST = broken.xpm missing.xpm wait.xpm icons.h moose_24.h newframe_24.h\
+EXTRA_DIST = broken.xpm missing.xpm wait.xpm moose_24.h newframe_24.h\
 	streams_24.h grid_24.h icon_48.h logo.h
Files passepartout-0.6/src/pptout/icons/moose_24.png and passepartout/src/pptout/icons/moose_24.png differ
Files passepartout-0.6/src/pptout/icons/newframe_24.png and passepartout/src/pptout/icons/newframe_24.png differ
Files passepartout-0.6/src/pptout/icons/streams_24.png and passepartout/src/pptout/icons/streams_24.png differ
diff -Nur -x CVS passepartout-0.6/src/pptout/imagemeta.cc passepartout/src/pptout/imagemeta.cc
--- passepartout-0.6/src/pptout/imagemeta.cc	2004-06-03 16:35:20.000000000 +0200
+++ passepartout/src/pptout/imagemeta.cc	2004-11-24 22:22:07.000000000 +0100
@@ -18,13 +18,12 @@
   PostscriptViewent* rawresult
     = new PostscriptViewent(view, &dynamic_cast<ImageFrame&>(node));
   Viewent::Ref result(rawresult);
-  result->set_manage(); // turn refcounting on
   result->reference();
 
   // Images should be re-rastered when geometry changes, but not text frames,
   // so connect this signal here rather than in the result.
   node.geometry_changed_signal.connect
-    (SigC::hide<Pagent*>(slot(*rawresult, &PostscriptViewent::regenerate)));
+    (sigc::mem_fun(*rawresult, &PostscriptViewent::regenerate));
 
   return result;
 }
@@ -44,12 +43,12 @@
       label->set_mnemonic_widget(e_fname);
       line->pack_start(*label, Gtk::PACK_SHRINK);
       line->pack_start(e_fname);
-      e_fname.entry.get_entry()->signal_activate().connect
-	(slot(*this, &PropImage::on_change));
-      e_fname.entry.get_entry()->signal_focus_out_event().connect
-	(SigC::hide<GdkEventFocus*>(bind_return(slot(*this, 
-                                                     &PropImage::on_change),
-                                                true)));
+      e_fname.entry.get_entry().signal_activate().connect
+	(sigc::mem_fun(*this, &PropImage::on_change));
+      e_fname.entry.get_entry().signal_focus_out_event().connect
+	(sigc::hide(bind_return(sigc::mem_fun(*this, 
+                                              &PropImage::on_change),
+                                true)));
       pack_start(*line, Gtk::PACK_SHRINK);
       set_sensitive(false);
       update();
@@ -57,7 +56,8 @@
   
   void update() {
     if(object) {
-      e_fname.entry.set_text(object->get_association());
+      e_fname.entry.set_text(object->get_association(),
+                             true /* save history */);
     } else {
       e_fname.entry.set_text("");
     }
diff -Nur -x CVS passepartout-0.6/src/pptout/inspiration.cc passepartout/src/pptout/inspiration.cc
--- passepartout-0.6/src/pptout/inspiration.cc	2004-01-12 20:01:19.000000000 +0100
+++ passepartout/src/pptout/inspiration.cc	2004-11-12 16:18:08.000000000 +0100
@@ -19,7 +19,7 @@
 #endif
 
 class Game: public Gtk::DrawingArea {
-  SigC::Connection connection;
+  sigc::connection connection;
   Glib::RefPtr<Gdk::Window> win;
   Glib::RefPtr<Gdk::Visual> visual;
   Glib::RefPtr<Gdk::GC> gc;
@@ -44,7 +44,7 @@
   void put_pixel(Glib::RefPtr<Gdk::Image>, int x, int y, Gdk::Color &color);
   void draw_rect(Gdk::Color &color, bool filled, int x, int y, int w, int h);
 public:
-  SigC::Signal1<void, long> score_change_signal;
+  sigc::signal<void, long> score_change_signal;
   Game();
   bool on_key_press_event(GdkEventKey*);
   void new_game();
@@ -207,7 +207,7 @@
     grow();
   candy_found();
   connection = Glib::signal_timeout().connect
-    (slot(*this, &Game::update), 20);  
+    (sigc::mem_fun(*this, &Game::update), 20);  
 }
 
 void Game::stop_game() {
@@ -292,7 +292,8 @@
   add_button(Gtk::Stock::CLOSE, 0);
   add_button(Gtk::Stock::EXECUTE, 1);
 
-  game->score_change_signal.connect(slot(*this, &Inspiration::score_change));
+  game->score_change_signal.connect
+    (sigc::mem_fun(*this, &Inspiration::score_change));
 }
 
 Inspiration::~Inspiration() {}
diff -Nur -x CVS passepartout-0.6/src/pptout/main.cc passepartout/src/pptout/main.cc
--- passepartout-0.6/src/pptout/main.cc	2004-10-27 11:38:23.000000000 +0200
+++ passepartout/src/pptout/main.cc	2004-11-24 00:02:51.000000000 +0100
@@ -13,6 +13,7 @@
 #include "window.h"
 #include "config.h"
 #include "icons/icon_48.h"
+#include "stockitems.h"
 
 int main(int argc, char *argv[]) {
   try {
@@ -31,9 +32,13 @@
     // initialize GnomeCanvas
     Gnome::Canvas::init();
 
+    // register new stock items
+    register_stock_items();
+
     // application icon
     std::vector<Glib::RefPtr<Gdk::Pixbuf> > icon_list;
-    icon_list.push_back(Gdk::Pixbuf::create_from_inline(9240, icon_48));
+    icon_list.push_back(Gdk::Pixbuf::create_from_inline(sizeof(icon_48),
+                                                        icon_48));
     Gtk::Window::set_default_icon_list(icon_list);
 
     // parse command line
diff -Nur -x CVS passepartout-0.6/src/pptout/Makefile.am passepartout/src/pptout/Makefile.am
--- passepartout-0.6/src/pptout/Makefile.am	2004-04-26 19:32:25.000000000 +0200
+++ passepartout/src/pptout/Makefile.am	2004-11-27 02:28:15.000000000 +0100
@@ -4,39 +4,34 @@
 
 bin_PROGRAMS = passepartout
 
-dist_noinst_HEADERS = aboutdialog.h					\
-		config.h preferencesdialog.h docpropsdialog.h docview.h	\
-		groupmeta.h imagemeta.h pagemeta.h inspiration.h	\
-		metabase.h pagesel.h docmeta.h				\
-		viewent.h groupviewent.h postscriptviewent.h		\
-		pageviewent.h rasterviewent.h textviewent.h		\
-		pptcore.h printdialog.h 				\
-		propbase.h propertiesdialog.h rastermeta.h		\
-		streamdialog.h textmeta.h				\
-		lengthunits.h view.h window.h				\
-		webbrowser.h
+dist_noinst_HEADERS = aboutdialog.h config.h preferencesdialog.h	\
+		docpropsdialog.h docview.h groupmeta.h imagemeta.h	\
+		pagemeta.h inspiration.h metabase.h pagesel.h		\
+		docmeta.h viewent.h groupviewent.h postscriptviewent.h	\
+		pageviewent.h rasterviewent.h textviewent.h pptcore.h	\
+		printdialog.h propbase.h propertiesdialog.h		\
+		rastermeta.h streamdialog.h textmeta.h lengthunits.h	\
+		view.h window.h stockitems.h templatepagedialog.h	\
+		clipboard.h
 
 passepartout_SOURCES = inspiration.cc streamdialog.cc pagesel.cc	\
-		aboutdialog.cc docmeta.cc				\
-		printdialog.cc						\
-		viewent.cc groupviewent.cc postscriptviewent.cc		\
-		pageviewent.cc rasterviewent.cc	textviewent.cc		\
-		docview.cc window.cc main.cc lengthunits.cc		\
-		config.cc preferencesdialog.cc propertiesdialog.cc	\
-		imagemeta.cc rastermeta.cc textmeta.cc			\
-		groupmeta.cc pagemeta.cc				\
-		propbase.cc pptcore.cc docpropsdialog.cc		\
-		webbrowser.cc builddate.cc windowmenus.cc authors.cc
-
-passepartout_CXXFLAGS = $(XML2_CFLAGS) $(XMLPP_CFLAGS) \
-		$(GDK_PIXBUF_CFLAGS) $(GTKMM_CFLAGS) $(GNOMECANVAS_CFLAGS) \
-		$(SIGC_CFLAGS)
+		aboutdialog.cc docmeta.cc printdialog.cc viewent.cc	\
+		groupviewent.cc postscriptviewent.cc pageviewent.cc	\
+		rasterviewent.cc textviewent.cc docview.cc window.cc	\
+		main.cc lengthunits.cc config.cc preferencesdialog.cc	\
+		propertiesdialog.cc imagemeta.cc rastermeta.cc		\
+		textmeta.cc groupmeta.cc pagemeta.cc propbase.cc	\
+		pptcore.cc docpropsdialog.cc builddate.cc		\
+		windowmenus.cc authors.cc stockitems.cc			\
+		templatepagedialog.cc clipboard.cc
 
-passepartout_CXXFLAGS += -I$(top_srcdir)/src -D'DOCDIR=$(docdir)' \
-		-D'XMLPATH=$(xmldir)'
+passepartout_CXXFLAGS = $(XMLPP_CFLAGS) $(GTKMM_CFLAGS) $(GNOMECANVAS_CFLAGS) \
+	$(GNOME_CFLAGS) $(GNOMEVFS_CFLAGS)
 
-passepartout_LDADD = $(XML2_LIBS) $(XMLPP_LIBS) $(GDK_PIXBUF_LIBS)	\
-	$(GTKMM_LIBS) $(GNOMECANVAS_LIBS) $(SIGC_LIBS) $(GTHREAD_LIBS)
+passepartout_CXXFLAGS += -I$(top_srcdir)/src -D'XMLPATH=$(xmldir)'
+
+passepartout_LDADD = $(XMLPP_LIBS) $(GTKMM_LIBS) $(GNOMECANVAS_LIBS) \
+		$(GTHREAD_LIBS) $(GNOME_LIBS) $(GNOMEVFS_LIBS)
 
 pptpartlibs= document/libdocument.a ../xml2ps/libxml2ps.a	\
 	../fonts/libfonts.a ../ps/libps.a			\
diff -Nur -x CVS passepartout-0.6/src/pptout/pagemeta.cc passepartout/src/pptout/pagemeta.cc
--- passepartout-0.6/src/pptout/pagemeta.cc	2004-03-20 02:45:03.000000000 +0100
+++ passepartout/src/pptout/pagemeta.cc	2004-11-12 16:18:08.000000000 +0100
@@ -11,7 +11,6 @@
 Viewent::Ref PageMeta::create_viewent(View& view, Pagent& node) {
   Viewent::Ref result(new PageViewent
 		      (view, &dynamic_cast<Page&>(node)));
-  result->set_manage(); // turn refcounting on
   result->reference();
   return result;
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/pagesel.cc passepartout/src/pptout/pagesel.cc
--- passepartout-0.6/src/pptout/pagesel.cc	2004-04-28 01:59:42.000000000 +0200
+++ passepartout/src/pptout/pagesel.cc	2004-11-26 23:29:15.000000000 +0100
@@ -4,56 +4,48 @@
 #include "pagesel.h"
 #include "document/page.h"
 #include "document/document.h"
-#include "widget/wmisc.h"
-#include <util/stringutil.h>
-#include <util/warning.h>
-#include <gtkmm/scrolledwindow.h>
-#include <gtkmm/stock.h>
 #include <gtkmm/arrow.h>
-#include <gtkmm/label.h>
 
-void Pagesel::page_selected_action() {
-  Gtk::Menu *menu = pages.get_menu();
-  Gtk::MenuItem *active_item;
-  Gtk::Widget *child;
-  Gtk::Label *label;
-  // if active_item->get_child() returns null, then we are probably
-  // try to switch to the same page as we are coming from.
-  if(menu && (active_item = menu->get_active())
-     && (child = active_item->get_child())
-     && (label = dynamic_cast<Gtk::Label*>(child))) {
-    DocRef document = document_view.get_document();
+namespace {
+  void page_selected_action(DocumentView *view,
+                            const Gtk::ComboBoxText *pages) {
+    DocRef document = view->get_document();
     Page *page;
-    if(document && (page = document->get_page(label->get_text())))
-      document_view.set_current_page_num(page->get_page_num());
+    if(document && (page = document->get_page(pages->get_active_text())))
+      view->set_current_page_num(page->get_page_num());
   }
-}
 
-void Pagesel::next() {
-  document_view.set_current_page_num(document_view.get_current_page_num() + 1);
-}
+  void next(DocumentView *view) {
+    view->set_current_page_num(view->get_current_page_num() + 1);
+  }
 
-void Pagesel::prev() {
-  document_view.set_current_page_num(document_view.get_current_page_num() - 1);
+  void prev(DocumentView *view) {
+    view->set_current_page_num(view->get_current_page_num() - 1);
+  }
 }
 
 void Pagesel::update() {
-  int i;
-  using namespace Gtk;
-  using namespace Menu_Helpers;
-  Gtk::Menu dummy;       // we have to change the menu and change it back
-  pages.set_menu(dummy); // or else the OptionMenu widget won't notice that 
-                         // the real menu has changed
+  // we don't want to act on signal_changed while we're updating
+  struct ConnectionBlocker {
+    sigc::connection &connection;
+    ConnectionBlocker(sigc::connection &connection) : connection(connection) {
+      connection.block();
+    }
+    ~ConnectionBlocker() { connection.unblock(); }
+  } blocker(changed_connection);
 
   DocRef document = document_view.get_document();
-  MenuList& menu_list = menu.items();
-  menu_list.clear();
-
-  set_sensitive(document && document->get_num_of_pages());
-  if(!document)
-      return;
-
-  i = document->get_first_page_num();
+  Glib::RefPtr<Gtk::ListStore>::cast_dynamic(pages.get_model())->clear();
+  bool have_pages = document && document->get_num_of_pages();
+  set_sensitive(have_pages);
+  
+  if(!have_pages){
+    pages.append_text("-");
+    pages.set_active(0);
+    return;
+  }
+  
+  int i = document->get_first_page_num();
   while(i < (document->get_first_page_num()
 	     + int(document->get_num_of_pages()))) {
     Glib::ustring tmp;
@@ -77,171 +69,38 @@
 	i++;
       } else
 	tmp += ", -";
-    menu_list.push_back(MenuElem(tmp));
+    pages.append_text(tmp);
   }
   int index = document_view.get_current_page_num()
     - document->get_first_page_num();
-  menu.set_active(index);
+  pages.set_active(index);
   left.set_sensitive(index);
-  right.set_sensitive(index < (int(menu.items().size()) - 1));
-  pages.set_menu(menu);
-}
-
-void Pagesel::on_realize() {
-  Gtk::HBox::on_realize();
-  // this fixes a problem with get_active()->get_child in
-  // page_selected_action()
-  update();
+  right.set_sensitive(index < (pages.get_model()->children().size()) - 1);
 }
 
 Pagesel::Pagesel(DocumentView &docview) :
   document_view(docview)
 {
+  using namespace sigc;
+
   document_view.current_page_num_changed_signal.connect
-    (slot(*this, &Pagesel::update));
+    (mem_fun(*this, &Pagesel::update));
   document_view.document_changed_signal.connect
-    (slot(*this, &Pagesel::update));
+    (mem_fun(*this, &Pagesel::update));
 
   left.add(*manage(new Gtk::Arrow(Gtk::ARROW_LEFT, Gtk::SHADOW_NONE)));
   right.add(*manage(new Gtk::Arrow(Gtk::ARROW_RIGHT, Gtk::SHADOW_NONE)));
   
   update();
-  pages.set_menu(menu);
 
-  pack_start(left);
-  pack_start(pages);
-  pack_start(right);
-
-  left.signal_clicked().connect(slot(*this, &Pagesel::prev));
-  right.signal_clicked().connect(slot(*this, &Pagesel::next));
-  pages.get_menu()->signal_selection_done().connect
-    (slot(*this, &Pagesel::page_selected_action));
+  pack_start(left, Gtk::PACK_SHRINK);
+  pack_start(pages, Gtk::PACK_SHRINK);
+  pack_start(right, Gtk::PACK_SHRINK);
+
+  left.signal_clicked().connect(bind(sigc::ptr_fun(&prev), &document_view));
+  right.signal_clicked().connect(bind(sigc::ptr_fun(&next), &document_view));
+  changed_connection = pages.signal_changed().connect
+    (bind(sigc::ptr_fun(&page_selected_action), &document_view, &pages));
 
   show_all();
 }
-
-Pagesel::~Pagesel() {
-  // This is needed:
-  Gtk::Menu dummy;
-  pages.set_menu(dummy);
-  // Is it a bug in Gtk?
-}
-
-namespace {
-   class ModelColumns: public Gtk::TreeModel::ColumnRecord {
-  public:
-    ModelColumns()
-    {add(col_name); add(col_style);}
-    Gtk::TreeModelColumn<Glib::ustring> col_name;
-    Gtk::TreeModelColumn<int> col_style;
-  };
-  const ModelColumns columns;
-  const Glib::ustring no_template_string("blank page");
-}
-
-TemplatePageDialog::TemplatePageDialog(Gtk::Window &parent, 
-                                       DocumentView &document_view_):
-  DialogWrap("", parent), 
-  document_view(document_view_)
-{
-  set_resizable(false);
-  set_has_separator(false);
-
-  add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
-  add_button(Gtk::Stock::ADD, Gtk::RESPONSE_OK);
-
-  Gtk::ScrolledWindow *scroller = manage(new Gtk::ScrolledWindow);
-  scroller->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
-  scroller->set_shadow_type(Gtk::SHADOW_IN);
-  scroller->add(page_list);
-
-  Gtk::Label *template_label =
-    manage(new Gtk::Label("Select template page:", 0));
-
-  Gtk::Box *vbox = manage(new Gtk::VBox(false, double_space));
-  vbox->set_border_width(border_width);
-  Gtk::Box *template_label_box = manage(new Gtk::HBox());		  
-  template_label_box->pack_start(*template_label, Gtk::PACK_SHRINK);
-  vbox->pack_start(*template_label_box, Gtk::PACK_SHRINK);
-  vbox->pack_start(*scroller, Gtk::PACK_EXPAND_WIDGET);
-
-  get_vbox()->pack_start(*vbox);
-
-  get_vbox()->show_all();
-  get_action_area()->show_all();
-
-  tree_model = Gtk::ListStore::create(columns);
-  page_list.set_model(tree_model);
-  Gtk::CellRendererText *text_renderer = manage(new Gtk::CellRendererText());
-  int col_count = page_list.append_column("Name", *text_renderer);
-  Gtk::TreeViewColumn* column = page_list.get_column(col_count - 1);
-  if(column) {
-    column->add_attribute(text_renderer->property_text(), 
-			  columns.col_name);
-    column->add_attribute(text_renderer->property_style(), 
-			  columns.col_style);
-  }
-  page_list.set_headers_visible(false);
-  page_list.property_width_request() = 100;
-  page_list.property_height_request() = 100;
-}
-
-void TemplatePageDialog::show_it(bool new_page_, int page_num_) {
-  set_title(new_page_ ? "Add Page" : "Template Page");
-  tree_model->clear();
-  new_page = new_page_; page_num = page_num_;
-  DocRef document = document_view.get_document();
-  if(document) { 
-    typedef std::list<std::string> Strings;
-    Strings tmp = document->get_template_pages();
-    if(tmp.empty()) {
-      // if we don't have any template pages then there's no point in 
-      // showing the dialog - we just create a blank page
-      on_response(Gtk::RESPONSE_OK);
-      return;
-    }
-    for(Strings::iterator i = tmp.begin(); i != tmp.end(); i++) {
-      Gtk::TreeModel::Row row = *(tree_model->append());
-      row[columns.col_name] = *i;
-      row[columns.col_style] = Pango::STYLE_NORMAL;
-    }
-    Gtk::TreeModel::Row row = *(tree_model->append());
-    row[columns.col_name] = no_template_string;
-    row[columns.col_style] = Pango::STYLE_ITALIC;
-  }
-  show();
-}
-
-void TemplatePageDialog::on_response(int response_id) {
-  if(response_id == Gtk::RESPONSE_OK) { // assume anything else means CANCEL
-    DocRef document = document_view.get_document();
-    if(new_page && document) {
-      std::string page_name = "";
-      Glib::RefPtr<Gtk::TreeSelection> selection = page_list.get_selection();
-      Gtk::TreeModel::iterator iter = selection->get_selected();
-      if(iter) {
-        Gtk::TreeModel::Row row = *iter;
-        page_name = Glib::ustring(row[columns.col_name]);
-      }
-      
-      if(!page_name.empty() && page_name != no_template_string
-         && document->get_template()) {
-        Page *t_page = document->get_template()->get_page(page_name);
-        if(!t_page) {
-          // There should only be existing template pages in the list
-          throw std::logic_error("Template page \""
-                                 + page_name
-                                 + "\" not found");
-          return;
-        }
-        document->new_page(page_num, t_page); //problem here
-      } else {
-        document->new_page(page_num);
-      }
-      
-      // go to the new page
-      document_view.set_current_page_num(page_num);
-    }
-  }
-  hide();
-}
diff -Nur -x CVS passepartout-0.6/src/pptout/pagesel.h passepartout/src/pptout/pagesel.h
--- passepartout-0.6/src/pptout/pagesel.h	2004-04-25 03:13:59.000000000 +0200
+++ passepartout/src/pptout/pagesel.h	2004-11-26 23:29:15.000000000 +0100
@@ -5,56 +5,21 @@
 ///
 
 #include "docview.h"
-#include "widget/dialogwrap.h"
 #include <gtkmm/box.h>
 #include <gtkmm/button.h>
-#include <gtkmm/optionmenu.h>
-#include <gtkmm/menu.h>
-#include <gtkmm/treeview.h>
-#include <gtkmm/liststore.h>
+#include <gtkmm/comboboxtext.h>
 
 class Pagesel: public Gtk::HBox {
 public:
   Pagesel(DocumentView &docview);
-  ~Pagesel();
-
-  Gtk::OptionMenu &get_optionmenu() {return pages;}
+  Gtk::Widget& get_menu() { return pages; }
 
 private:
+  sigc::connection changed_connection;
   DocumentView &document_view;
-  Gtk::Menu menu;
-  Gtk::OptionMenu pages;
+  Gtk::ComboBoxText pages;
   Gtk::Button left, right;
-  void next();
-  void prev();
-  void page_selected_action();
   void update();
-  void on_realize();
-};
-
-class TemplatePageDialog: public DialogWrap {
-public:
-  TemplatePageDialog(Gtk::Window &parent, DocumentView &document_view_);
-  void show_it(bool new_page_ = false, int page_num_ = 0);
-
-private:
-  DocumentView &document_view;
-
-  Glib::RefPtr<Gtk::ListStore> tree_model;
-  Gtk::TreeView page_list;
-
-  bool new_page;
-  int page_num;
-  void on_response(int response_id);
 };
 
 #endif
-
-
-
-
-
-
-
-
-
diff -Nur -x CVS passepartout-0.6/src/pptout/pageviewent.cc passepartout/src/pptout/pageviewent.cc
--- passepartout-0.6/src/pptout/pageviewent.cc	2004-09-26 16:13:02.000000000 +0200
+++ passepartout/src/pptout/pageviewent.cc	2004-11-27 03:55:16.000000000 +0100
@@ -9,17 +9,17 @@
     guide_group(view.get_guide_group())
 {
   Document::selection_changed_signal.connect
-    (slot(*this, &PageViewent::on_selection_changed));
+    (sigc::mem_fun(*this, &PageViewent::on_selection_changed));
   /// \todo maybe let Page throw a size_changed_signal instead?
-  Document::size_changed_signal.connect
-    (slot(*this, &PageViewent::on_size_changed));
+  Document::containing(*page).size_changed_signal.connect
+    (sigc::mem_fun(*this, &PageViewent::on_size_changed));
   
   using namespace Gnome::Canvas;
 
   paper.reset(new Rect(view.get_pagent_group()));
   paper->property_fill_color_gdk() = view.get_color(Color::bg);
   paper->lower_to_bottom();
-  on_size_changed(Document::containing(*page).self());
+  on_size_changed();
 
   float width = page->get_width();
   float height = page->get_height();
@@ -57,10 +57,7 @@
 PageViewent::~PageViewent() {
 }
 
-void PageViewent::on_size_changed(DocRef doc) {
-  if(doc != Document::containing(*page).self())
-    return;
-
+void PageViewent::on_size_changed() {
   paper->property_x1() = 0; paper->property_y1() = 0;
   paper->property_x2() = page->get_width(); paper->property_y2() = -page->get_height();
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/pageviewent.h passepartout/src/pptout/pageviewent.h
--- passepartout-0.6/src/pptout/pageviewent.h	2004-09-26 16:13:02.000000000 +0200
+++ passepartout/src/pptout/pageviewent.h	2004-11-27 03:55:16.000000000 +0100
@@ -21,7 +21,7 @@
   const Pagent* get_frame() const { return page; }
   
 private:
-  void on_size_changed(DocRef doc);
+  void on_size_changed();
   void on_selection_changed(DocRef doc);
 
   FrameRef page;
diff -Nur -x CVS passepartout-0.6/src/pptout/postscriptviewent.cc passepartout/src/pptout/postscriptviewent.cc
--- passepartout-0.6/src/pptout/postscriptviewent.cc	2004-10-28 00:46:18.000000000 +0200
+++ passepartout/src/pptout/postscriptviewent.cc	2005-03-19 17:51:07.000000000 +0100
@@ -11,6 +11,7 @@
 #include "util/warning.h"
 #include "util/stringutil.h" // tostr
 #include "fonts/fontmanager.hh" // getFontPaths
+#include "widget/usererror.h"
 #include <sstream>
 
 /// \todo Remote the following line!
@@ -24,10 +25,12 @@
     if(devicename.empty()) {
       verbose << "Deciding which ghostscript device to use ..." << std::endl;
 
+      /// \todo Get a "required" attribute from the configuration!
       const std::string &psinterpreter = config.PSInterpreter.values.front();
       if(psinterpreter.empty())
-	throw GenPicError(BasicFrame::GENERATION,
-			  "No PostScript interpreter specified");
+	throw UserError("No postscript interpreter specified.",
+			"You probably have a configuration file without the"
+			" PSInterpreter property set.");
       
       if(ProcessManager::instance()
 	 .system(psinterpreter + " -q -dBATCH -sDEVICE=pngalpha") == 0)
@@ -51,12 +54,12 @@
     scale_factor = 1;
   
   ProcessManager::instance().process_stopped.connect
-    (slot(*this, &PostscriptViewent::process_stopped));
+    (sigc::mem_fun(*this, &PostscriptViewent::process_stopped));
   /// \todo  Only regenerate when necessary, i.e. not when just moving ...
   frame->object_changed_signal.connect
-    (SigC::hide<Pagent*>(slot(*this, &PostscriptViewent::regenerate)));
+    (sigc::mem_fun(*this, &PostscriptViewent::regenerate));
   view.connect_zoom_change
-    (SigC::hide<float>(slot(*this, &PostscriptViewent::regenerate)));
+    (sigc::hide(sigc::mem_fun(*this, &PostscriptViewent::regenerate)));
 
   canvas_pixbuf.reset(new Gnome::Canvas::Pixbuf(*content_group));
   canvas_pixbuf->property_anchor() = Gtk::ANCHOR_SOUTH_WEST;
@@ -65,7 +68,8 @@
   canvas_pixbuf->property_height_set() = true;
   canvas_pixbuf->property_width_in_pixels() = false;
   canvas_pixbuf->property_height_in_pixels() = false;
-  on_geometry_changed(psframe);
+  on_properties_changed();
+  on_geometry_changed();
   regenerate();
 }
 
@@ -92,8 +96,8 @@
   }
 }
 
-void PostscriptViewent::on_geometry_changed(Pagent *pagent) {
-  Viewent::on_geometry_changed(pagent);
+void PostscriptViewent::on_geometry_changed() {
+  Viewent::on_geometry_changed();
 
   Vector size = frame->get_inherent_size();
 
@@ -110,7 +114,7 @@
     pid = P_STARTUP;
     
     Glib::signal_timeout().connect
-      (SigC::slot(*this, &PostscriptViewent::regenerate_bg),
+      (sigc::mem_fun(*this, &PostscriptViewent::regenerate_bg),
        200, Glib::PRIORITY_DEFAULT_IDLE);
   }
 }
@@ -120,11 +124,13 @@
   try {
     set_state(WAIT);
     redraw_requested = false;
-    
-    std::string &psinterpreter = config.PSInterpreter.values.front();
+     
+    /// \todo Get a "required" attribute from the configuration!
+    const std::string &psinterpreter = config.PSInterpreter.values.front();
     if(psinterpreter.empty())
-      throw GenPicError(BasicFrame::GENERATION,
-                        "No PostScript interpreter specified");
+      throw UserError("No postscript interpreter specified.",
+		      "You probably have a configuration file without the"
+		      " PSInterpreter property set.");
     
     const Matrix &m = frame->get_matrix();
     const Vector framesize = frame->get_inherent_size();
@@ -159,11 +165,7 @@
         << scale_factor * pv.get_y()
 	<< " -sOutputFile=" << tmp_file << " -";
     Process proc = ProcessManager::instance().run(tmp.str());
-    
-    if((pid = proc->get_pid()) == -1)
-      throw GenPicError(BasicFrame::GENERATION,
-                        "Failed to run " + psinterpreter);
-    
+    pid = proc->get_pid();
     verbose << pid << ": " << tmp.str() << std::endl;
     
     frame->generate_picture(proc->get_cin());
@@ -174,17 +176,20 @@
       redraw_requested = true;	// simply try again
     else {
       set_state(e.type == BasicFrame::ASSOCIATION ? MISSING : BROKEN);
-      warning << frame->get_name() << ": " << e.what() << std::endl;
+      warning << "PostScriptviewent for " << frame->get_name()
+	      << ": GenPicError: " << e.what() << std::endl;
     }
     pid = P_IDLE;
   } catch(const std::exception& e) {
     stop_process();
-    warning << frame->get_name() << ": " << e.what() << std::endl;
+    warning << "PostScriptviewent for " << frame->get_name() << ": "
+	    << e.what() << std::endl;
     set_state(BROKEN);
     pid = P_IDLE;
   } catch(...) {
     stop_process();
-    warning << frame->get_name() << ": Unknown error" << std::endl;
+    warning << "PostScriptviewent for" << frame->get_name()
+	    << ": Unknown error" << std::endl;
     set_state(BROKEN);
     pid = P_IDLE;
   }
@@ -224,7 +229,7 @@
                                     Gdk::INTERP_BILINEAR);
 
     canvas_pixbuf->property_pixbuf() = pixbuf;
-    on_geometry_changed(frame);
+    on_geometry_changed();
     set_state(NORMAL);
   
   } catch(const std::exception& e) {
diff -Nur -x CVS passepartout-0.6/src/pptout/postscriptviewent.h passepartout/src/pptout/postscriptviewent.h
--- passepartout-0.6/src/pptout/postscriptviewent.h	2004-07-29 21:24:23.000000000 +0200
+++ passepartout/src/pptout/postscriptviewent.h	2004-11-14 20:08:13.000000000 +0100
@@ -31,7 +31,7 @@
 protected:
   const Pagent* get_frame() const { return frame; }
   void set_state(State state);
-  void on_geometry_changed(Pagent*);
+  void on_geometry_changed();
 private:
   void process_stopped(pid_t _pid, bool exited_normally, int exit_code);
   bool regenerate_bg();
diff -Nur -x CVS passepartout-0.6/src/pptout/preferencesdialog.cc passepartout/src/pptout/preferencesdialog.cc
--- passepartout-0.6/src/pptout/preferencesdialog.cc	2004-10-13 02:02:16.000000000 +0200
+++ passepartout/src/pptout/preferencesdialog.cc	2004-11-22 15:20:56.000000000 +0100
@@ -106,11 +106,15 @@
     tab3_scroller->add(*text_view);
 
     //Tab 1
-    xslt_entry = manage(new FileEntry(config.StylesheetPath.desc, "", false));
-    xslt_file_entry = manage(new FileEntry(config.DefaultStylesheet.desc));
-    print_entry = manage(new FileEntry(config.PrintCommand.desc));
-    gs_entry = manage(new FileEntry(config.PSInterpreter.desc));
-    ps_entry = manage(new FileEntry(config.PSViewer.desc));
+    xslt_entry =
+      manage(new FileEntry(config.StylesheetPath.desc,
+                           "Select default stylesheet folder",
+                           Gtk::FILE_CHOOSER_ACTION_SELECT_FOLDER));
+    xslt_file_entry = manage(new FileEntry(config.DefaultStylesheet.desc,
+                                           "Select default stylesheet"));
+    /// \todo filesel window titles
+    print_entry = manage(new FileEntry(config.PrintCommand.desc, ""));
+    gs_entry = manage(new FileEntry(config.PSInterpreter.desc, ""));
     SubPanel *filePanel = manage(new SubPanel(file_str)); 
     SubPanel *progPanel = manage(new SubPanel(prog_str)); 
 
@@ -136,11 +140,11 @@
     cancel_button->set_flags(Gtk::CAN_DEFAULT);
     cancel_button->grab_default();
     cancel_button->signal_clicked().
-      connect(SigC::slot(*this, &PreferencesDialog::dialog_cancel));
+      connect(sigc::mem_fun(*this, &PreferencesDialog::dialog_cancel));
     apply_button->signal_clicked().
-      connect(SigC::slot(*this, &PreferencesDialog::dialog_apply));
+      connect(sigc::mem_fun(*this, &PreferencesDialog::dialog_apply));
     signal_delete_event().
-      connect(SigC::slot(*this, &PreferencesDialog::dialog_delete));
+      connect(sigc::mem_fun(*this, &PreferencesDialog::dialog_delete));
 
 
     //Add the notebook pages
@@ -200,17 +204,6 @@
       gs_entry->show();
     }
 
-    if(config.PSViewer.visible) {
-      tab1_table3->attach
-	(*manage(new Gtk::Label(config.PSViewer.desc + ": ", 
-				Gtk::JUSTIFY_LEFT, 
-				Gtk::ALIGN_BOTTOM)), 
-	 0, 1, 2, 3);
-      tab1_table3->attach(*ps_entry, 1, 2, 2, 3);
-      ps_entry->entry.set_text(config.PSViewer.values.front());
-      ps_entry->show();
-    }
-
     notebook->append_page(*tab1_box, tab1_str);
 
     //---Page 2:
@@ -279,9 +272,6 @@
   if(config.PSInterpreter.visible)
     config.PSInterpreter.values.front() = gs_entry->entry.get_text(); 
   
-  if(config.PSViewer.visible)
-    config.PSViewer.values.front() = ps_entry->entry.get_text(); 
-
   if(config.DefaultResolution.visible)
     config.DefaultResolution.values.front() = resolution_spin->get();
 
diff -Nur -x CVS passepartout-0.6/src/pptout/preferencesdialog.h passepartout/src/pptout/preferencesdialog.h
--- passepartout-0.6/src/pptout/preferencesdialog.h	2004-10-07 17:37:18.000000000 +0200
+++ passepartout/src/pptout/preferencesdialog.h	2004-11-22 15:20:56.000000000 +0100
@@ -24,7 +24,7 @@
     close_button_str, apply_button_str;//, misc_str;
 
   FileEntry *xslt_entry, *print_entry, *gs_entry, 
-    *ps_entry, *xslt_file_entry;
+    *xslt_file_entry;
   Spinner *resolution_spin, *zoom_spin;
 };
 
diff -Nur -x CVS passepartout-0.6/src/pptout/printdialog.cc passepartout/src/pptout/printdialog.cc
--- passepartout-0.6/src/pptout/printdialog.cc	2004-10-27 11:38:24.000000000 +0200
+++ passepartout/src/pptout/printdialog.cc	2004-11-22 23:07:03.000000000 +0100
@@ -23,9 +23,7 @@
 #include "widget/errordialog.h"
 
 namespace {
-  const Glib::ustring  ps_format("PostScript"),
-    eps_format("Encapsulated PostScript (EPS)"),
-    pdf_format("Portable Document Format (PDF)");
+  enum {F_PS = 0, F_EPS, F_PDF};
 }
 
 PrintDialog::PrintDialog(Gtk::Window &parent, 
@@ -63,20 +61,12 @@
                                                         0.0, 0.5, true));
   format_menu_label->set_mnemonic_widget(format_menu);
   format_menu_box->pack_start(*format_menu_label, Gtk::PACK_SHRINK);
-  {
-    using namespace Gtk;
-    using namespace Menu_Helpers;
-
-    Menu *menu = manage(new Menu());
-    MenuList& menu_list = menu->items();
-    menu_list.push_back(MenuElem(ps_format));
-    menu_list.push_back(MenuElem(eps_format));
-    menu_list.push_back(MenuElem(pdf_format));
-
-    format_menu.set_menu(*menu);
-  }
-  format_menu.get_menu()->signal_selection_done().connect
-    (slot(*this, &PrintDialog::update));
+  format_menu.append_text("PostScript");
+  format_menu.append_text("Encapsulated PostScript (EPS)");
+  format_menu.append_text("Portable Document Format (PDF)");
+  format_menu.set_active(F_PS);
+  format_menu.signal_changed().connect
+    (sigc::mem_fun(*this, &PrintDialog::update));
   format_menu_box->pack_start(format_menu, Gtk::PACK_EXPAND_WIDGET);
 
   Gtk::HBox *using_box = manage(new Gtk::HBox(false, double_space));
@@ -126,12 +116,16 @@
   using_entry.set_text(config.PrintCommand.values.front());
   using_button.set_active(true);
 
-  using_button.signal_clicked().connect(slot(*this, &PrintDialog::update));
+  using_button.signal_clicked().connect
+    (sigc::mem_fun(*this, &PrintDialog::update));
   // If there are only two buttons in a group, you only need to connect one.
   // If there are more, you need to connect them all. That is annoying.
-  all_button.signal_clicked().connect(slot(*this, &PrintDialog::update));
-  current_button.signal_clicked().connect(slot(*this, &PrintDialog::update));
-  from_button.signal_clicked().connect(slot(*this, &PrintDialog::update));
+  all_button.signal_clicked().connect
+    (sigc::mem_fun(*this, &PrintDialog::update));
+  current_button.signal_clicked().connect
+    (sigc::mem_fun(*this, &PrintDialog::update));
+  from_button.signal_clicked().connect
+    (sigc::mem_fun(*this, &PrintDialog::update));
 
   add_button(Gtk::Stock::CANCEL, 0);
   add_button(Gtk::Stock::PRINT, 1)->grab_default();
@@ -142,7 +136,7 @@
   if(!document)
     return;
   int first = document->get_first_page_num();
-  int last = first + ((int) document->get_num_of_pages()) - 1;
+  int last = first + int(document->get_num_of_pages()) - 1;
   save_state(); 
   from_spinner.limits(first, last);  
   to_spinner.limits(first, last);
@@ -160,30 +154,6 @@
   update();
 }
 
-Glib::ustring PrintDialog::get_format() const {
-  if(const Gtk::Label* label
-     = dynamic_cast<const Gtk::Label*>(format_menu.get_child()))
-    return label->get_text();
-  else {
-    warning << "OptionMenu child is not a Label" << std::endl;
-    return "poop";
-  }
-}
-
-void PrintDialog::set_format(const Glib::ustring &format) {
-  using namespace Gtk::Menu_Helpers;
-  MenuList::iterator i;
-  const MenuList &items = format_menu.get_menu()->items();
-  int j;
-  for(i = items.begin(), j = 0; i != items.end(); i++, j++) {
-    const Gtk::Label *label = dynamic_cast<Gtk::Label*>(i->get_child());
-    if(label && label->get_text() == format) {
-      format_menu.set_history(j);
-      return;
-    }
-  }
-}
-
 void PrintDialog::on_response(int response_id) {
   Glib::RefPtr<Gdk::Window> window = get_window();
   if(response_id == 0) {
@@ -221,12 +191,12 @@
                                  + file_entry.entry.get_text(),
                                  "Check if you have permission "
                                  "to write to this file");
-        window->set_cursor(Gdk::WATCH);
+        window->set_cursor(Gdk::Cursor(Gdk::WATCH));
         // make sure the cursor is updated
         while(Gtk::Main::events_pending())
           Gtk::Main::iteration();
-        Glib::ustring format = get_format();
-        if(format == pdf_format) {
+        int format = format_menu.get_active_row_number();
+        if(format == F_PDF) {
           PDF::Document::Ptr result = PDF::Document::create();
           document->print_pdf(result, first, last);
           result->write(out);
@@ -239,7 +209,7 @@
                "present in the MacRoman encoding together with Type1 fonts.\n"
                "Passepartout currently lacks full Unicode support for Type1 "
                "fonts when printing to PDF.");
-        } else if(format == eps_format)
+        } else if(format == F_EPS)
           document->print(out,
                           // only the current page
                           document_view.get_current_page_num(),
@@ -290,7 +260,7 @@
   saved_file_not_using = file_button.get_active();
   saved_gray = gray_button.get_active();
   saved_fonts = fonts_button.get_active();
-  saved_format = get_format();
+  saved_format = format_menu.get_active_row_number();
 }
 
 void PrintDialog::restore_state() {
@@ -299,7 +269,7 @@
   file_button.set_active(saved_file_not_using);
   gray_button.set_active(saved_gray);
   fonts_button.set_active(saved_fonts);
-  set_format(saved_format);
+  format_menu.set_active(saved_format);
 }
 
 void PrintDialog::update() {
@@ -307,15 +277,15 @@
   file_entry.set_sensitive(file_button.get_active());
   from_spinner.set_sensitive(from_button.get_active());
   to_spinner.set_sensitive(from_button.get_active());
-  Glib::ustring format = get_format();
+  int format = format_menu.get_active_row_number();
   // always include fonts in PDFs
-  fonts_button.set_sensitive(format != pdf_format);
+  fonts_button.set_sensitive(format != F_PDF);
   // grayscale should apply to pdf too, eventually
-  gray_button.set_sensitive(format != pdf_format);
+  gray_button.set_sensitive(format != F_PDF);
   // eps format always prints the current page only
-  pages_box->set_sensitive(format != eps_format);
+  pages_box->set_sensitive(format != F_EPS);
   std::string suffix = ".ps";
-  if(format == pdf_format) suffix = ".pdf";
-  else if(format == eps_format) suffix = ".eps";
+  if(format == F_PDF) suffix = ".pdf";
+  else if(format == F_EPS) suffix = ".eps";
   file_entry.entry.set_text(no_suffix(file_entry.entry.get_text()) + suffix);
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/printdialog.h passepartout/src/pptout/printdialog.h
--- passepartout-0.6/src/pptout/printdialog.h	2004-08-01 22:20:40.000000000 +0200
+++ passepartout/src/pptout/printdialog.h	2004-11-22 23:07:03.000000000 +0100
@@ -10,7 +10,7 @@
 #include <gtkmm/radiobutton.h>
 #include <gtkmm/checkbutton.h>
 #include <gtkmm/entry.h>
-#include <gtkmm/optionmenu.h>
+#include <gtkmm/comboboxtext.h>
 
 class DocumentView;
 
@@ -24,18 +24,17 @@
     all_button, current_button, from_button;
   Gtk::CheckButton fonts_button, gray_button;
   Gtk::Entry using_entry;
-  Gtk::OptionMenu format_menu;
+  Gtk::ComboBoxText format_menu;
   Gtk::Widget *pages_box;
   Spinner from_spinner, to_spinner;
   DocumentView &document_view; // document_view keeps record of the document
   FileEntry file_entry;
   Filesel *filesel;
 
-  std::string saved_file_text, saved_using_text, saved_format;
+  std::string saved_file_text, saved_using_text;
+  int saved_format;
   bool saved_file_not_using, saved_eps, saved_gray, saved_fonts;
 
-  Glib::ustring get_format() const;
-  void set_format(const Glib::ustring &format);
   void on_response(int response_id);
   void save_state(); // in case cancel is pressed we will restore inital state
   void restore_state();
diff -Nur -x CVS passepartout-0.6/src/pptout/propbase.cc passepartout/src/pptout/propbase.cc
--- passepartout-0.6/src/pptout/propbase.cc	2004-04-16 21:03:56.000000000 +0200
+++ passepartout/src/pptout/propbase.cc	2004-11-12 16:18:09.000000000 +0100
@@ -23,7 +23,7 @@
   // one. I think this has to do with Gtk::Entry having its own
   // window.
   if(!sensitive)
-    foreach(slot(hide_widget));
+    foreach(sigc::ptr_fun(hide_widget));
 }
 
 void PropBase::right_justify(Gtk::Label &label) {
diff -Nur -x CVS passepartout-0.6/src/pptout/propertiesdialog.cc passepartout/src/pptout/propertiesdialog.cc
--- passepartout-0.6/src/pptout/propertiesdialog.cc	2004-05-06 01:56:30.000000000 +0200
+++ passepartout/src/pptout/propertiesdialog.cc	2004-11-15 00:17:26.000000000 +0100
@@ -27,8 +27,8 @@
 // Currently that means some kind of name, and the position and size of the
 // object.
 class PropBasic : public PropBase {
-  enum ChangeId { NAME, LEFT, BOTTOM, WIDTH, HEIGHT, ROTATE,
-		  LOCKED, FLOWAROUND, MARGIN };
+  enum ChangeId { NAME, LEFT, BOTTOM, WIDTH, HEIGHT, SCALEX, SCALEY, ROTATE,
+		  SHEAR, LOCKED, FLOWAROUND, MARGIN };
 public:
   // | name:  | "name of object"             |
   // -----------------------------------------
@@ -40,7 +40,8 @@
      e_bottom(0, true, &length_units, default_unit), 
      e_width(0, true, &length_units, default_unit),
      e_height(0, true, &length_units, default_unit), 
-     e_rotate(0, true, &angle_units), 
+     e_scalex(0, true), e_scaley(0, true),
+     e_rotate(0, true, &angle_units), e_shear(0, true),
      e_margin(0, true, &length_units, default_unit),
      c_flow("Text avoids object", 0), c_locked("Locked", 0)
   {
@@ -53,10 +54,11 @@
       line->pack_start(e_name);
       // not sure if connecting to signal_activate adds anything
       e_name.signal_activate().connect
-	(bind(slot(*this, &PropBasic::on_change), NAME));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), NAME));
       e_name.signal_focus_out_event().connect
-        (SigC::hide<GdkEventFocus*>
-         (bind_return(bind(slot(*this, &PropBasic::on_change), NAME), true)));
+        (sigc::hide
+         (bind_return(bind(sigc::mem_fun(*this, &PropBasic::on_change),
+                           NAME), true)));
       pack_start(*line, Gtk::PACK_SHRINK);
       
       SubPanel *box = manage(new SubPanel("Geometry"));
@@ -69,7 +71,7 @@
       line->pack_start(*label, Gtk::PACK_SHRINK);
       line->pack_start(e_left, Gtk::PACK_SHRINK);
       e_left.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), LEFT));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), LEFT));
       label->set_mnemonic_widget(e_left);
 
       sizegroup->add_widget(*(label = manage(new Gtk::Label("_Width:",
@@ -78,7 +80,7 @@
       line->pack_start(e_width, Gtk::PACK_SHRINK);
       label->set_mnemonic_widget(e_width);
       e_width.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), WIDTH));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), WIDTH));
       box->pack_start(*line, Gtk::PACK_SHRINK);
       
       line = manage(new Gtk::HBox(false, double_space));
@@ -87,7 +89,7 @@
       line->pack_start(*label, Gtk::PACK_SHRINK);
       line->pack_start(e_bottom, Gtk::PACK_SHRINK);
       e_bottom.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), BOTTOM));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), BOTTOM));
       label->set_mnemonic_widget(e_bottom);
 
       sizegroup->add_widget(*(label = manage(new Gtk::Label("_Height:",
@@ -96,19 +98,48 @@
       line->pack_start(e_height, Gtk::PACK_SHRINK);
       label->set_mnemonic_widget(e_height);
       e_height.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), HEIGHT));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), HEIGHT));
       box->pack_start(*line, Gtk::PACK_SHRINK);
+      pack_start(*box, Gtk::PACK_SHRINK);
       
+      box = manage(new SubPanel("Transform"));
       line = manage(new Gtk::HBox(false, double_space));
+      sizegroup->add_widget(*(label = manage(new Gtk::Label("Scale _X",
+							    0.0, 0.5, true))));
+      line->pack_start(*label, Gtk::PACK_SHRINK);
+      line->pack_start(e_scalex, Gtk::PACK_SHRINK);
+      label->set_mnemonic_widget(e_scalex);
+      e_scalex.signal_value_changed().connect
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), SCALEX));
+      
       sizegroup->add_widget(*(label = manage(new Gtk::Label("R_otate:",
 							    0.0, 0.5, true))));
       line->pack_start(*label, Gtk::PACK_SHRINK);
       line->pack_start(e_rotate, Gtk::PACK_SHRINK);
       label->set_mnemonic_widget(e_rotate);
       e_rotate.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), ROTATE));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), ROTATE));
+      
+      box->pack_start(*line, Gtk::PACK_SHRINK);
+      line = manage(new Gtk::HBox(false, double_space));
+      sizegroup->add_widget(*(label = manage(new Gtk::Label("Scale _Y",
+							    0.0, 0.5, true))));
+      line->pack_start(*label, Gtk::PACK_SHRINK);
+      line->pack_start(e_scaley, Gtk::PACK_SHRINK);
+      label->set_mnemonic_widget(e_scaley);
+      e_scaley.signal_value_changed().connect
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), SCALEY));
+
+      sizegroup->add_widget(*(label = manage(new Gtk::Label("_Shear:",
+							    0.0, 0.5, true))));
+      line->pack_start(*label, Gtk::PACK_SHRINK);
+      line->pack_start(e_shear, Gtk::PACK_SHRINK);
+      label->set_mnemonic_widget(e_shear);
+      e_shear.signal_value_changed().connect
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), SHEAR));
       
       box->pack_start(*line, Gtk::PACK_SHRINK);
+      
       pack_start(*box, Gtk::PACK_SHRINK);
       
       pack_start(hsep2, Gtk::PACK_SHRINK);
@@ -116,21 +147,21 @@
       Gtk::HBox *flow_box = manage(new Gtk::HBox(false, double_space));
       flow_box->pack_start(c_locked, Gtk::PACK_SHRINK, triple_space);
       c_locked.signal_toggled().connect
-	(bind(slot(*this, &PropBasic::on_change), LOCKED));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), LOCKED));
       flow_box->pack_start(c_flow, Gtk::PACK_SHRINK, 0);
       c_flow.signal_toggled().connect
-	(bind(slot(*this, &PropBasic::on_change), FLOWAROUND));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), FLOWAROUND));
       flow_box->pack_start(e_margin, Gtk::PACK_SHRINK, 0);
       e_margin.signal_value_changed().connect
-	(bind(slot(*this, &PropBasic::on_change), MARGIN));
+	(bind(sigc::mem_fun(*this, &PropBasic::on_change), MARGIN));
       pack_start(*flow_box, Gtk::PACK_SHRINK);
 
       set_sensitive(false);
     }
-  void on_geometry_changed(Pagent* pagent) {
+  void on_geometry_changed() {
     update();
   }
-  void on_props_changed(Pagent* pagent) {
+  void on_props_changed() {
     update();
   }
   void setObject(Pagent* pagent) {
@@ -139,9 +170,9 @@
     object = pagent;
     if(object) {
       geometry_changed_connection = object->geometry_changed_signal.connect
-	(slot(*this, &PropBasic::on_geometry_changed));
+	(sigc::mem_fun(*this, &PropBasic::on_geometry_changed));
       props_changed_connection = object->props_changed_signal.connect
-	(slot(*this, &PropBasic::on_props_changed));
+	(sigc::mem_fun(*this, &PropBasic::on_props_changed));
     }
     set_sensitive(object);
     if(is_visible())
@@ -165,8 +196,13 @@
       e_bottom.set(m.tr_y());
       e_width.set(size.x * m.sc_x());
       e_height.set(size.y * m.sc_y());
+      
+      // transform
+      e_scalex.set(m.sc_x());
+      e_scaley.set(m.sc_y());
       e_rotate.set(Matrix::rad2deg(m.rot()));
-
+      e_shear.set(Matrix::rad2deg(m.sh()));
+      
       const bool flowaround = obj->get_flow_around();
       c_flow.set_active(flowaround);
       e_margin.set_sensitive(flowaround);
@@ -195,11 +231,20 @@
 			    e_height.get() / size.y);
       }
       break;
+
+    case SCALEX:
+    case SCALEY:
+      object->set_scaling(e_scalex.get(), e_scaley.get());
+      break;
       
     case ROTATE:
       object->set_rotation(Matrix::deg2rad(e_rotate.get()));
       break;
       
+    case SHEAR:
+      object->set_shearing(Matrix::deg2rad(e_shear.get()));
+      break;
+      
     case LOCKED:
       object->set_lock(c_locked.get_active());
       break;
@@ -223,9 +268,10 @@
   Pagent* object;
   Gtk::HSeparator hsep1, hsep2;
   Gtk::Entry e_name;
-  Spinner e_left, e_bottom, e_width, e_height, e_rotate, e_margin;
+  Spinner e_left, e_bottom, e_width, e_height,
+	      e_scalex, e_scaley, e_rotate, e_shear, e_margin;
   Gtk::CheckButton c_flow, c_locked;
-  SigC::Connection geometry_changed_connection, props_changed_connection;
+  sigc::connection geometry_changed_connection, props_changed_connection;
 };
 
 // - - - - back to the actual PropertiesDialog implementation - - - -
@@ -245,7 +291,7 @@
   add(book);
 
   book.signal_switch_page().connect
-    (slot(*this, &PropertiesDialog::show_page_contents));
+    (sigc::mem_fun(*this, &PropertiesDialog::show_page_contents));
 
   PropBase* prop = new PropBasic(config.LengthUnit.values.front());
   pages.push_back(prop);
@@ -260,7 +306,7 @@
   
   // listen to selection change signals:
   Document::selection_changed_signal.connect
-    (slot(*this, &PropertiesDialog::select_change));
+    (sigc::mem_fun(*this, &PropertiesDialog::select_change));
 }
 
 PropertiesDialog::~PropertiesDialog() {}
diff -Nur -x CVS passepartout-0.6/src/pptout/rastermeta.cc passepartout/src/pptout/rastermeta.cc
--- passepartout-0.6/src/pptout/rastermeta.cc	2004-04-29 00:26:14.000000000 +0200
+++ passepartout/src/pptout/rastermeta.cc	2004-11-24 22:22:08.000000000 +0100
@@ -21,7 +21,6 @@
 Viewent::Ref RasterMeta::create_viewent(View& view, Pagent& node) {
   Viewent::Ref result(new RasterViewent
 		      (view, &dynamic_cast<RasterFrame&>(node)));
-  result->set_manage(); // turn refcounting on
   result->reference();
   return result;
 }
@@ -44,7 +43,7 @@
     Spinner e_ppix, e_ppiy;
     Gtk::ToggleButton b_ppic;
     Gtk::HSeparator hsep;
-    SigC::Connection geometry_changed_connection, props_changed_connection;
+    sigc::connection geometry_changed_connection, props_changed_connection;
   };
 };
 
@@ -62,13 +61,13 @@
   label->set_mnemonic_widget(e_fname);
   line->pack_start(*label, Gtk::PACK_SHRINK);
   line->pack_start(e_fname);
-  e_fname.entry.get_entry()->signal_activate().connect
-    (bind(slot(*this, &PropRaster::on_change), FILENAME));
-  e_fname.entry.get_entry()->signal_focus_out_event().connect
-    (SigC::hide<GdkEventFocus*>(bind_return(bind(slot(*this, 
-                                                      &PropRaster::on_change), 
-                                                 FILENAME), 
-                                            true)));
+  e_fname.entry.get_entry().signal_activate().connect
+    (bind(sigc::mem_fun(*this, &PropRaster::on_change), FILENAME));
+  e_fname.entry.get_entry().signal_focus_out_event().connect
+    (sigc::hide(bind_return(bind(sigc::mem_fun(*this, 
+                                      &PropRaster::on_change), 
+                                 FILENAME), 
+                            true)));
   pack_start(*line, Gtk::PACK_SHRINK);
   
   Glib::RefPtr<Gtk::SizeGroup>  sizegroup = 
@@ -108,11 +107,11 @@
   pack_start(*rezpanel, Gtk::PACK_SHRINK);
   
   e_ppix.signal_value_changed().connect
-    (bind(slot(*this, &PropRaster::on_change), HRES));
+    (bind(sigc::mem_fun(*this, &PropRaster::on_change), HRES));
   e_ppiy.signal_value_changed().connect
-    (bind(slot(*this, &PropRaster::on_change), VRES));
+    (bind(sigc::mem_fun(*this, &PropRaster::on_change), VRES));
   b_ppic.signal_toggled().connect
-    (bind(slot(*this, &PropRaster::on_change), ASPECT));
+    (bind(sigc::mem_fun(*this, &PropRaster::on_change), ASPECT));
   set_sensitive(false);
   update();
 }
@@ -123,16 +122,16 @@
   if(object) {
     // Switch raster resolution
     geometry_changed_connection = object->geometry_changed_signal.connect
-      (SigC::hide<Pagent*>(slot(*this, &PropRaster::update)));
+      (sigc::mem_fun(*this, &PropRaster::update));
     // Switched file
     props_changed_connection = object->props_changed_signal.connect
-      (SigC::hide<Pagent*>(slot(*this, &PropRaster::update)));
+      (sigc::mem_fun(*this, &PropRaster::update));
   }
 }
 
 void PropRaster::update() {
   if(object) {
-    e_fname.entry.set_text(object->get_association());
+    e_fname.entry.set_text(object->get_association(), true /* save history */);
     
     const Vector ppi = object->get_ppi();
     e_ppix.set(ppi.x);
diff -Nur -x CVS passepartout-0.6/src/pptout/rasterviewent.cc passepartout/src/pptout/rasterviewent.cc
--- passepartout-0.6/src/pptout/rasterviewent.cc	2004-04-29 22:36:17.000000000 +0200
+++ passepartout/src/pptout/rasterviewent.cc	2004-11-14 20:08:13.000000000 +0100
@@ -7,27 +7,28 @@
   : Viewent(view, rasterframe), frame(rasterframe)
 {
   frame->props_changed_signal.connect
-    (slot(*this, &RasterViewent::on_geometry_changed));
+    (sigc::mem_fun(*this, &RasterViewent::on_geometry_changed));
   frame->object_changed_signal.connect
-    (slot(*this, &RasterViewent::on_object_changed));
+    (sigc::mem_fun(*this, &RasterViewent::on_object_changed));
 
   canvas_pixbuf.reset(new Gnome::Canvas::Pixbuf(*content_group));
   canvas_pixbuf->property_x() = 0; canvas_pixbuf->property_y() = 0;
   canvas_pixbuf->property_anchor() = Gtk::ANCHOR_SOUTH_WEST;
-  on_object_changed(rasterframe);
+  on_properties_changed();
+  on_object_changed();
 }
 
-void RasterViewent::on_object_changed(Pagent *pagent) {
+void RasterViewent::on_object_changed() {
   Glib::RefPtr<Gdk::Pixbuf> pixbuf = frame->get_filepixbuf();
   set_state(pixbuf ? NORMAL : BROKEN);
   canvas_pixbuf->property_pixbuf() = pixbuf;
-  on_geometry_changed(pagent);
+  on_geometry_changed();
 }
 
-void RasterViewent::on_geometry_changed(Pagent *pagent) {
-  Viewent::on_geometry_changed(pagent);
+void RasterViewent::on_geometry_changed() {
+  Viewent::on_geometry_changed();
 
-  Vector size = pagent->get_inherent_size();
+  Vector size = frame->get_inherent_size();
 
   canvas_pixbuf->property_width() = size.x;
   canvas_pixbuf->property_height() = size.y;
diff -Nur -x CVS passepartout-0.6/src/pptout/rasterviewent.h passepartout/src/pptout/rasterviewent.h
--- passepartout-0.6/src/pptout/rasterviewent.h	2004-04-26 20:01:37.000000000 +0200
+++ passepartout/src/pptout/rasterviewent.h	2004-11-14 20:08:13.000000000 +0100
@@ -14,8 +14,8 @@
 protected:
   const Pagent* get_frame() const { return frame; }
   
-  void on_object_changed(Pagent*);
-  void on_geometry_changed(Pagent*);
+  void on_object_changed();
+  void on_geometry_changed();
   
 private:
   FrameRef frame;
diff -Nur -x CVS passepartout-0.6/src/pptout/stockitems.cc passepartout/src/pptout/stockitems.cc
--- passepartout-0.6/src/pptout/stockitems.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/stockitems.cc	2004-11-24 00:02:51.000000000 +0100
@@ -0,0 +1,37 @@
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include "stockitems.h"
+#include <gtkmm/iconfactory.h>
+#include <gtkmm/iconset.h>
+#include <gtkmm/iconsource.h>
+#include <gtkmm/stock.h>
+#include <gtkmm/stockitem.h>
+#include "icons/newframe_24.h"
+#include "icons/streams_24.h"
+#include "icons/moose_24.h"
+#include "icons/grid_24.h"
+
+namespace {
+  void add(Glib::RefPtr<Gtk::IconFactory> factory, const guint8 *data,
+           int data_size, const Glib::ustring &id) {
+    Gtk::IconSource source;
+    source.set_pixbuf(Gdk::Pixbuf::create_from_inline(data_size, data));
+    source.set_size(Gtk::ICON_SIZE_SMALL_TOOLBAR);
+    source.set_size_wildcarded();
+    Gtk::IconSet set;
+    set.add_source(source);
+    const Gtk::StockID stock_id(id);
+    factory->add(stock_id, set);
+    Gtk::Stock::add(Gtk::StockItem(stock_id, ""));
+  }
+}
+
+void register_stock_items() {
+  const Glib::RefPtr<Gtk::IconFactory> factory = Gtk::IconFactory::create();
+  add(factory, newframe_24, sizeof(newframe_24), "newframe");
+  add(factory, streams_24, sizeof(streams_24), "streams");
+  add(factory, moose_24, sizeof(moose_24), "moose");
+  add(factory, grid_24, sizeof(grid_24), "grid");
+  factory->add_default();
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/stockitems.h passepartout/src/pptout/stockitems.h
--- passepartout-0.6/src/pptout/stockitems.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/stockitems.h	2004-11-24 00:02:51.000000000 +0100
@@ -0,0 +1,11 @@
+// -*- c++ -*-
+///
+// Copyright (C) 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#ifndef STOCKITEMS_H
+#define STOCKITEMS_H
+
+/// Register icons as stock items.
+void register_stock_items();
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/streamdialog.cc passepartout/src/pptout/streamdialog.cc
--- passepartout-0.6/src/pptout/streamdialog.cc	2004-04-27 22:41:50.000000000 +0200
+++ passepartout/src/pptout/streamdialog.cc	2004-11-26 23:50:28.000000000 +0100
@@ -16,6 +16,8 @@
 
 #include "document/textstream.h"
 #include "document/document.h"
+#include "document/page.h"
+#include "document/textframe.h"
 
 #include "streamdialog.h"
 #include "config.h"
@@ -61,10 +63,10 @@
 }
 
 namespace {
-  SigC::Slot1<bool, GdkEventFocus*> 
-  adapt_focus_out(SigC::Slot1<void, int> slot, int response_id) {
-    return SigC::hide<GdkEventFocus*>(SigC::bind_return
-                                      (SigC::bind(slot, response_id), true));
+  sigc::slot<bool, GdkEventFocus*> 
+  adapt_focus_out(sigc::slot<void, int> slot, int response_id) {
+    return sigc::hide(sigc::bind_return(sigc::bind(slot, response_id), 
+                                        true));
   }
 }
 
@@ -90,7 +92,7 @@
     
     Glib::RefPtr<Gtk::TreeSelection> selection = stream_list.get_selection();
     selection->signal_changed().connect
-      (slot(*this, &StreamDialog::on_selection_changed));
+      (sigc::mem_fun(*this, &StreamDialog::on_selection_changed));
     
     Gtk::ScrolledWindow *scroll = manage(new Gtk::ScrolledWindow());
     scroll->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
@@ -142,7 +144,7 @@
       line = manage(new Gtk::HBox(false, double_space));
       label = manage(new Gtk::Label("_Stylesheet:", 1.0, 0.5, true));
       sizegroup->add_widget(*label);
-      label->set_mnemonic_widget(*xfrm_entry.entry.get_entry());
+      label->set_mnemonic_widget(xfrm_entry.entry.get_entry());
       line->pack_start(*label, Gtk::PACK_SHRINK);
       line->pack_start(xfrm_entry, Gtk::PACK_EXPAND_WIDGET);
       box->pack_start(*line, Gtk::PACK_SHRINK);
@@ -159,7 +161,7 @@
       param_list.append_column_editable("Value", param_columns.value);
       param_list.property_height_request() = 90;
       param_model->signal_row_changed().connect
-	(slot(*this, &StreamDialog::on_param_row_changed));
+	(sigc::mem_fun(*this, &StreamDialog::on_param_row_changed));
       Gtk::ScrolledWindow *scroll = manage(new Gtk::ScrolledWindow());
       scroll->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
       scroll->set_shadow_type(Gtk::SHADOW_IN);
@@ -174,24 +176,24 @@
   show_all_children();
 
   Document::streams_changed_signal.connect
-    (slot(*this, &StreamDialog::_update));
+    (sigc::mem_fun(*this, &StreamDialog::_update));
    
   name_entry.signal_activate().connect
-    (bind(slot(*this, &StreamDialog::on_response), Response::SETNAME));
+    (bind(sigc::mem_fun(*this, &StreamDialog::on_response), Response::SETNAME));
   name_entry.signal_focus_out_event().connect
-    (adapt_focus_out(slot(*this, &StreamDialog::on_response),
+    (adapt_focus_out(sigc::mem_fun(*this, &StreamDialog::on_response),
                      Response::SETNAME));
   
-  file_entry.entry.get_entry()->signal_activate().connect
-    (bind(slot(*this, &StreamDialog::on_response), Response::SETFILE));
-  file_entry.entry.get_entry()->signal_focus_out_event().connect
-    (adapt_focus_out(slot(*this, &StreamDialog::on_response),
+  file_entry.entry.get_entry().signal_activate().connect
+    (bind(sigc::mem_fun(*this, &StreamDialog::on_response), Response::SETFILE));
+  file_entry.entry.get_entry().signal_focus_out_event().connect
+    (adapt_focus_out(sigc::mem_fun(*this, &StreamDialog::on_response),
                      Response::SETFILE));
   
-  xfrm_entry.entry.get_entry()->signal_activate().connect
-    (bind(slot(*this, &StreamDialog::on_response), Response::SETXFRM));
-  xfrm_entry.entry.get_entry()->signal_focus_out_event().connect
-    (adapt_focus_out(slot(*this, &StreamDialog::on_response),
+  xfrm_entry.entry.get_entry().signal_activate().connect
+    (bind(sigc::mem_fun(*this, &StreamDialog::on_response), Response::SETXFRM));
+  xfrm_entry.entry.get_entry().signal_focus_out_event().connect
+    (adapt_focus_out(sigc::mem_fun(*this, &StreamDialog::on_response),
                      Response::SETXFRM));
 }
 
@@ -224,10 +226,10 @@
   Gtk::Button *b = manage(button);
   // Note: It seems that activate means "in any way except a simple click".
   // So we have to add callbacks for both activate and clicked.
-  b->signal_clicked().connect(bind(slot(*this, &StreamDialog::on_response),
-                                   action_id));
-  b->signal_activate().connect(bind(slot(*this, &StreamDialog::on_response),
-				    action_id));
+  b->signal_clicked().connect
+    (bind(sigc::mem_fun(*this, &StreamDialog::on_response), action_id));
+  b->signal_activate().connect
+    (bind(sigc::mem_fun(*this, &StreamDialog::on_response), action_id));
   return b;
 }
 
@@ -276,14 +278,14 @@
     
   case Response::SETFILE:
     if(current_stream)
-      current_stream->set_association(file_entry.entry.get_text(false));
+      current_stream->set_association(file_entry.entry.get_text(true));
     else
       debug << no_stream << std::endl;
     break;
     
   case Response::SETXFRM:
     if(current_stream) {
-      current_stream->set_transform(xfrm_entry.entry.get_text(false));
+      current_stream->set_transform(xfrm_entry.entry.get_text(true));
       update_params(current_stream);
     } else
       debug << no_stream << std::endl;
@@ -325,11 +327,13 @@
     current_selection = name;
 
     TextStream *stream = document->get_text_stream(name);
-    file_entry.entry.set_text(stream->get_association());
+    file_entry.entry.set_text(stream->get_association(),
+                              true /* save history */);
     if(stream->get_transform().empty()) {      //Set default stylesheet
       xfrm_entry.set_default_value(config.DefaultStylesheet.values.front());
     } else {
-      xfrm_entry.entry.set_text(stream->get_transform());
+      xfrm_entry.entry.set_text(stream->get_transform(),
+                                true /* save history */);
     }
 
     update_params(stream);
@@ -360,7 +364,7 @@
 }
 
 void StreamDialog::on_param_row_changed(const Gtk::TreeModel::Path& path,
-					 const Gtk::TreeModel::iterator& iter)
+                                        const Gtk::TreeModel::iterator& iter)
 {
   if(current_stream && iter)
     current_stream->set_parameter(iter->get_value(param_columns.name),
@@ -388,25 +392,17 @@
 }
 
 std::string StreamMenu::get_stream() const {
-  const Gtk::Label *tmp = dynamic_cast<const Gtk::Label*> (get_child());
-  if(!tmp || tmp->get_text() == no_stream)
-    return ""; 
-  return tmp->get_text();
+  Glib::ustring text = get_active_text();
+  return text == no_stream ? "" : text;
 }
  
 void StreamMenu::update(DocRef document, const std::string &select_name) {
-  Gtk::Menu dummy;
-  set_menu(dummy); //so it will notice the change
-  using namespace Gtk;
-  using namespace Menu_Helpers;
-  MenuList& menu_list = menu.items();
-  menu_list.clear();
+  Glib::RefPtr<Gtk::ListStore>::cast_dynamic(get_model())->clear();
   if(!document) {
-      menu.items().push_back(MenuElem("")); // cosmetic fix
-      menu.set_active(0);
-      set_menu(menu);
-      return;
-    }
+    append_text("-");
+    set_active(0);
+    return;
+  }
   int index = 0;
   Document::StreamVec streams = document->get_text_streams();
   for(Document::StreamVec::iterator i = streams.begin();
@@ -414,16 +410,14 @@
       i++)
     {
       const std::string &name = (*i)->get_name();
-      menu.items().push_back(MenuElem(name));
+      append_text(name);
       if(name == select_name)
-	menu.set_active(index);
+	set_active(index);
       index++;
     }
-  menu.items().push_back(SeparatorElem());
-  menu.items().push_back(MenuElem(no_stream));
+  append_text(no_stream);
   if(select_name.empty())
-    menu.set_active(index + 1);
-  set_menu(menu);
+    set_active(index);
 }
 
 
@@ -476,7 +470,7 @@
   line = manage(new Gtk::HBox(false, double_space));
   label = manage(new Gtk::Label("_Stylesheet:", 1.0, 0.5, true));
   sizegroup->add_widget(*label);
-  label->set_mnemonic_widget(*xfrm_entry.entry.get_entry());
+  label->set_mnemonic_widget(xfrm_entry.entry.get_entry());
   line->pack_start(*label, Gtk::PACK_SHRINK);
   line->pack_start(xfrm_entry, Gtk::PACK_EXPAND_WIDGET);
   new_box->pack_start(*line, Gtk::PACK_SHRINK);
@@ -491,7 +485,7 @@
 
   get_vbox()->pack_start(*main_box);
 
-  Gtk::RadioButton_Helpers::Group group = old_button->get_group();
+  Gtk::RadioButton::Group group = old_button->get_group();
   new_button->set_group(group);
   old_button->set_active();
   fix_button(new_button, RESPONSE_TOGGLE_MODE);
@@ -511,6 +505,13 @@
   DialogWrap::show_raise();
 }
 
+namespace {
+  void new_text_frame(TextStream *stream, Page *page) {
+    int w = 200, h = 300;
+    page->addObject(new TextFrame(page, stream, w, h));
+  }
+}
+
 void TextFrameDialog::on_response(int response_id) {
   switch(response_id) {
   case Gtk::RESPONSE_OK:
@@ -529,7 +530,7 @@
 	throw UserError("Could not create text stream", e.what());
       }
     }
-    view.new_text_frame(stream);
+    new_text_frame(stream, view.get_page());
     hide();
     break;
   case Gtk::RESPONSE_CANCEL:
diff -Nur -x CVS passepartout-0.6/src/pptout/streamdialog.h passepartout/src/pptout/streamdialog.h
--- passepartout-0.6/src/pptout/streamdialog.h	2004-04-27 02:34:39.000000000 +0200
+++ passepartout/src/pptout/streamdialog.h	2004-11-23 01:32:18.000000000 +0100
@@ -6,7 +6,7 @@
 #include "widget/filesel.h"
 #include "widget/dialogwrap.h"
 #include <gtkmm/entry.h>
-#include <gtkmm/optionmenu.h>
+#include <gtkmm/comboboxtext.h>
 #include <gtkmm/menu.h>
 #include <gtkmm/treeview.h>
 #include <gtkmm/liststore.h>
@@ -64,9 +64,9 @@
 };
 
 /**
- * An OptionMenu for selecting streams.
+ * An menu for selecting streams.
  */
-class StreamMenu: public Gtk::OptionMenu {
+class StreamMenu: public Gtk::ComboBoxText {
 public:
   StreamMenu();
   
@@ -76,9 +76,6 @@
 	      const std::string &select_name = "");
 
   std::string get_stream() const;
-
-private:
-  Gtk::Menu menu;
 };
 
 class DocumentView;
diff -Nur -x CVS passepartout-0.6/src/pptout/templatepagedialog.cc passepartout/src/pptout/templatepagedialog.cc
--- passepartout-0.6/src/pptout/templatepagedialog.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/templatepagedialog.cc	2004-11-26 23:29:15.000000000 +0100
@@ -0,0 +1,116 @@
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include "templatepagedialog.h"
+#include "document/page.h"
+#include "document/document.h"
+#include "widget/wmisc.h"
+#include <gtkmm/scrolledwindow.h>
+#include <gtkmm/stock.h>
+#include <gtkmm/label.h>
+
+namespace {
+  class ModelColumns: public Gtk::TreeModel::ColumnRecord {
+  public:
+    ModelColumns() { add(col_name); add(col_style); }
+    Gtk::TreeModelColumn<Glib::ustring> col_name;
+    Gtk::TreeModelColumn<int> col_style;
+  };
+  const ModelColumns columns;
+  const Glib::ustring no_template_string("blank page");
+}
+
+TemplatePageDialog::TemplatePageDialog(Gtk::Window &parent,
+                                       DocumentView &document_view,
+                                       int page_num):
+  DialogWrap("Add Page", parent),
+  document_view(document_view), page_num(page_num)
+{
+  set_resizable(false);
+  set_has_separator(false);
+
+  add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
+  add_button(Gtk::Stock::ADD, Gtk::RESPONSE_OK);
+
+  Gtk::ScrolledWindow *scroller = manage(new Gtk::ScrolledWindow);
+  scroller->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
+  scroller->set_shadow_type(Gtk::SHADOW_IN);
+  scroller->add(page_list);
+
+  Gtk::Label *template_label =
+    manage(new Gtk::Label("Select template page:", 0));
+
+  Gtk::Box *vbox = manage(new Gtk::VBox(false, double_space));
+  vbox->set_border_width(border_width);
+  Gtk::Box *template_label_box = manage(new Gtk::HBox());
+  template_label_box->pack_start(*template_label, Gtk::PACK_SHRINK);
+  vbox->pack_start(*template_label_box, Gtk::PACK_SHRINK);
+  vbox->pack_start(*scroller, Gtk::PACK_EXPAND_WIDGET);
+
+  get_vbox()->pack_start(*vbox);
+
+  
+  Glib::RefPtr<Gtk::ListStore> tree_model = Gtk::ListStore::create(columns);
+  page_list.set_model(tree_model);
+  Gtk::CellRendererText *text_renderer = manage(new Gtk::CellRendererText());
+  int col_count = page_list.append_column("Name", *text_renderer);
+  Gtk::TreeViewColumn* column = page_list.get_column(col_count - 1);
+  if(column) {
+    column->add_attribute(text_renderer->property_text(),
+			  columns.col_name);
+    column->add_attribute(text_renderer->property_style(),
+			  columns.col_style);
+  }
+  page_list.set_headers_visible(false);
+  page_list.property_width_request() = 100;
+  page_list.property_height_request() = 100;
+
+  DocRef document = document_view.get_document();
+  if(document) { 
+    typedef std::list<std::string> Strings;
+    Strings tmp = document->get_template_pages();
+    for(Strings::iterator i = tmp.begin(); i != tmp.end(); i++) {
+      Gtk::TreeModel::Row row = *(tree_model->append());
+      row[columns.col_name] = *i;
+      row[columns.col_style] = Pango::STYLE_NORMAL;
+    }
+    Gtk::TreeModel::Row row = *(tree_model->append());
+    row[columns.col_name] = no_template_string;
+    row[columns.col_style] = Pango::STYLE_ITALIC;
+  }
+  show_all();
+}
+
+void TemplatePageDialog::on_response(int response_id) {
+  DocRef document = document_view.get_document();
+  if(document
+     && response_id == Gtk::RESPONSE_OK) { // assume anything else means CANCEL
+    std::string page_name = "";
+    Glib::RefPtr<Gtk::TreeSelection> selection = page_list.get_selection();
+    Gtk::TreeModel::iterator iter = selection->get_selected();
+    if(iter) {
+      Gtk::TreeModel::Row row = *iter;
+      page_name = Glib::ustring(row[columns.col_name]);
+    }
+    
+    if(!page_name.empty() && page_name != no_template_string
+       && document->get_template()) {
+      Page *t_page = document->get_template()->get_page(page_name);
+      if(!t_page) {
+        // There should only be existing template pages in the list
+        throw std::logic_error("Template page \""
+                               + page_name
+                               + "\" not found");
+      }
+
+      document->new_page(page_num, t_page); //problem here
+    } else {
+      document->new_page(page_num);
+    }
+    
+    // go to the new page
+    document_view.set_current_page_num(page_num);
+  }
+  hide();
+  delete this;
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/templatepagedialog.h passepartout/src/pptout/templatepagedialog.h
--- passepartout-0.6/src/pptout/templatepagedialog.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/templatepagedialog.h	2004-11-26 23:29:15.000000000 +0100
@@ -0,0 +1,24 @@
+#ifndef TEMPLATEPAGEDIALOG_H		// -*- c++ -*-
+#define TEMPLATEPAGEDIALOG_H
+///
+// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+
+#include "docview.h"
+#include "widget/dialogwrap.h"
+#include <gtkmm/treeview.h>
+
+class TemplatePageDialog: public DialogWrap {
+public:
+  TemplatePageDialog(Gtk::Window &parent, DocumentView &document_view,
+                     int page_num);
+  
+private:
+  DocumentView &document_view;
+  Gtk::TreeView page_list;
+  int page_num;
+  
+  void on_response(int response_id);
+};
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/textmeta.cc passepartout/src/pptout/textmeta.cc
--- passepartout-0.6/src/pptout/textmeta.cc	2004-04-27 17:54:03.000000000 +0200
+++ passepartout/src/pptout/textmeta.cc	2004-11-12 16:18:09.000000000 +0100
@@ -21,7 +21,6 @@
 Viewent::Ref TextMeta::create_viewent(View& view, Pagent& node) {
   Viewent::Ref result(new TextViewent
 		      (view, &dynamic_cast<TextFrame&>(node), 2));
-  result->set_manage(); // turn refcounting on
   result->reference();
   return result;
 }
@@ -41,10 +40,10 @@
     label->set_mnemonic_widget(e_stream);
     line->pack_start(e_stream, Gtk::PACK_EXPAND_WIDGET);
     e_stream.signal_changed().connect
-      (bind(slot(*this, &PropText::on_change), STREAM));
+      (bind(sigc::mem_fun(*this, &PropText::on_change), STREAM));
     Gtk::Button *b_streams = manage(new Gtk::Button("E_dit streams", true));
-    b_streams->signal_clicked().connect(slot(StreamDialog::instance(),
-					     &StreamDialog::show_raise));
+    b_streams->signal_clicked().connect
+      (sigc::mem_fun(StreamDialog::instance(), &StreamDialog::show_raise));
     line->pack_start(*b_streams, Gtk::PACK_SHRINK);
     pack_start(*line, Gtk::PACK_SHRINK);
     
@@ -57,7 +56,7 @@
     label->set_mnemonic_widget(e_columns);
     e_columns.limits(1, 64);	// Note: The upper limit is rather arbitrary.
     e_columns.signal_value_changed().connect
-      (bind(slot(*this, &PropText::on_change), COLUMNS));
+      (bind(sigc::mem_fun(*this, &PropText::on_change), COLUMNS));
     line->pack_start(e_columns, Gtk::PACK_SHRINK);
     box->pack_start(*line);
     
@@ -69,13 +68,13 @@
     label->set_mnemonic_widget(e_gutter);
     line->pack_start(e_gutter, Gtk::PACK_SHRINK);
     e_gutter.signal_value_changed().connect
-      (bind(slot(*this, &PropText::on_change), GUTTER));
+      (bind(sigc::mem_fun(*this, &PropText::on_change), GUTTER));
     box->pack_start(*line);
     pack_start(*box, Gtk::PACK_SHRINK);
     
     // perhaps this should go into the StreamMenu class
     Document::streams_changed_signal.connect
-      (slot(*this, &PropText::on_streams_changed));
+      (sigc::mem_fun(*this, &PropText::on_streams_changed));
 
     set_sensitive(false);
     update();
diff -Nur -x CVS passepartout-0.6/src/pptout/textviewent.cc passepartout/src/pptout/textviewent.cc
--- passepartout-0.6/src/pptout/textviewent.cc	2004-04-29 22:36:17.000000000 +0200
+++ passepartout/src/pptout/textviewent.cc	2004-11-29 22:54:09.000000000 +0100
@@ -10,16 +10,17 @@
 
 TextViewent::TextViewent(View& view, const FrameRef cachedframe,
 			 int scale_factor)
-  : PostscriptViewent(view, cachedframe, scale_factor)
+  : PostscriptViewent(view, cachedframe, scale_factor),
+    textframe(dynamic_cast<TextFrame*>(cachedframe))
 {
   Gnome::Canvas::Polygon *tri = new Gnome::Canvas::Polygon(*group);
 
   tri->property_fill_color_gdk() = view.get_color(Color::guide);
   trunc_ind.reset(tri);
   trunc_ind->hide();
-  on_geometry_changed(cachedframe);
-  dynamic_cast<TextFrame*>(cachedframe)->truncated_state_changed_signal.connect
-    (slot(*this, &TextViewent::on_truncated_state_changed));
+  on_geometry_changed();
+  textframe->truncated_state_changed_signal.connect
+    (sigc::mem_fun(*this, &TextViewent::on_truncated_state_changed));
 }
 
 void TextViewent::on_truncated_state_changed(bool truncated) {
@@ -29,10 +30,10 @@
     trunc_ind->hide();
 }
 
-void TextViewent::on_geometry_changed(Pagent* pagent) {
-  PostscriptViewent::on_geometry_changed(pagent);
+void TextViewent::on_geometry_changed() {
+  PostscriptViewent::on_geometry_changed();
 
-  Vector size = pagent->get_inherent_size();
+  Vector size = get_frame()->get_inherent_size();
 
   Gnome::Canvas::Polygon *tri =
     dynamic_cast<Gnome::Canvas::Polygon*>(trunc_ind.get());
@@ -43,3 +44,9 @@
   points.push_back(Point(size.x - 15, + 5));
   tri->property_points() = points;
 }
+
+void TextViewent::on_properties_changed() {
+  TextStream *stream = textframe->get_stream();
+  if(stream)
+    stream->generate_ps_request(textframe);
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/textviewent.h passepartout/src/pptout/textviewent.h
--- passepartout-0.6/src/pptout/textviewent.h	2004-04-24 00:28:11.000000000 +0200
+++ passepartout/src/pptout/textviewent.h	2004-11-29 22:54:09.000000000 +0100
@@ -5,6 +5,8 @@
 ///
 #include "postscriptviewent.h"
 
+class TextFrame;
+
 class TextViewent : public PostscriptViewent {
 public:
   /**
@@ -18,8 +20,10 @@
 	      int scale_factor = 1);
 
 private:
+  TextFrame *textframe;
   std::auto_ptr<Gnome::Canvas::Item> trunc_ind;
-  void on_geometry_changed(Pagent*);
+  void on_geometry_changed();
+  void on_properties_changed();
   void on_truncated_state_changed(bool);
 };
 
diff -Nur -x CVS passepartout-0.6/src/pptout/viewent.cc passepartout/src/pptout/viewent.cc
--- passepartout-0.6/src/pptout/viewent.cc	2004-07-04 19:30:04.000000000 +0200
+++ passepartout/src/pptout/viewent.cc	2005-03-18 23:12:27.000000000 +0100
@@ -17,9 +17,9 @@
   : view(the_view)
 {
   pagent->props_changed_signal.connect
-    (slot(*this, &Viewent::on_properties_changed));
+    (sigc::mem_fun(*this, &Viewent::on_properties_changed));
   pagent->geometry_changed_signal.connect
-    (slot(*this, &Viewent::on_geometry_changed));
+    (sigc::mem_fun(*this, &Viewent::on_geometry_changed));
 
   // can't create pixbuf until glib (or whatever) is initialized 
   if(!broken_pixbuf) {
@@ -45,9 +45,6 @@
   state_pixbuf->property_height_in_pixels() = true;
   state_pixbuf->property_anchor() = Gtk::ANCHOR_CENTER;
   set_state(NORMAL);
-
-  on_geometry_changed(pagent);
-  on_properties_changed(pagent);
 }
 
 Viewent::~Viewent()
@@ -58,43 +55,34 @@
 }
 
 void Viewent::set_state(State state) {
-  if(state == NORMAL)
-    state_pixbuf->hide();
-  else
-    state_pixbuf->show();
   switch(state) {
   case BROKEN: state_pixbuf->property_pixbuf() = broken_pixbuf; break;
   case MISSING: state_pixbuf->property_pixbuf() = missing_pixbuf; break;
   case WAIT: state_pixbuf->property_pixbuf() = wait_pixbuf; break;
   default: break;
   }
+  if(state == NORMAL)
+    state_pixbuf->hide();
+  else
+    state_pixbuf->show();
 }
 
 void Viewent::raise_to_top() { group->raise_to_top(); }
 
-void Viewent::on_geometry_changed(Pagent* pagent) {
-  static const float pi = 3.14159265;
-
-  Vector size = pagent->get_inherent_size();
-
+void Viewent::on_geometry_changed() {
+  Vector size = get_frame()->get_inherent_size();
+  
   state_pixbuf->property_x() = size.x / 2;
   state_pixbuf->property_y() = -size.y / 2;
   
   rect->property_x2() = size.x;
   rect->property_y2() = -size.y;
-
-  const Matrix &matrix = pagent->get_matrix();
-  using Gnome::Art::AffineTrans;
-  const AffineTrans trans
-    = AffineTrans::scaling(matrix.sc_x(), matrix.sc_y())
-    * AffineTrans::rotation(matrix.rot() * -180 / pi)
-    * AffineTrans::translation(matrix.tr_x(), -matrix.tr_y());
-  /// todo: shearing
-  group->affine_absolute(trans);
+  
+  group->affine_absolute(get_frame()->get_matrix().gaTransform());
 }
 
-void Viewent::on_properties_changed(Pagent* pagent) {
-  rect->property_outline_color_gdk() = view.get_color(pagent->get_lock()
+void Viewent::on_properties_changed() {
+  rect->property_outline_color_gdk() = view.get_color(get_frame()->get_lock()
 						      ? Color::locked
 						      : Color::frame);
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/viewent.h passepartout/src/pptout/viewent.h
--- passepartout-0.6/src/pptout/viewent.h	2004-04-25 01:34:45.000000000 +0200
+++ passepartout/src/pptout/viewent.h	2004-11-14 20:08:13.000000000 +0100
@@ -5,6 +5,7 @@
 ///
 #include "view.h"
 #include "document/pagent.h"
+#include "util/refcount.h"
 #include <memory> // auto_ptr
 
 /**
@@ -13,7 +14,7 @@
  * Pagent.  When a View is rescaled etc, all its Viewent s are dropped
  * and new ones created.
  */
-class Viewent : public SigC::Object {
+class Viewent : public sigc::trackable, public RefCounted {
 public:
   typedef Glib::RefPtr<const Gdk::Pixmap> PixmapRef;
   typedef Glib::RefPtr<Viewent> Ref;
@@ -43,8 +44,8 @@
    * (or no icon if the state is NORMAL). */
   virtual void set_state(State state);
 
-  virtual void on_geometry_changed(Pagent* pagent);
-  virtual void on_properties_changed(Pagent* pagent);
+  virtual void on_geometry_changed();
+  virtual void on_properties_changed();
 
 private:
 
diff -Nur -x CVS passepartout-0.6/src/pptout/view.h passepartout/src/pptout/view.h
--- passepartout-0.6/src/pptout/view.h	2004-04-22 23:16:32.000000000 +0200
+++ passepartout/src/pptout/view.h	2004-11-12 16:18:09.000000000 +0100
@@ -27,7 +27,7 @@
   virtual const Gdk::Color& get_color(Color::Id color) const = 0;
 
   /** Register a callback for the signal raised on rescaling the view */
-  virtual SigC::Connection connect_zoom_change(SigC::Slot1<void, float>) = 0;
+  virtual sigc::connection connect_zoom_change(sigc::slot<void, float>) = 0;
 };
 
 #endif
diff -Nur -x CVS passepartout-0.6/src/pptout/webbrowser.cc passepartout/src/pptout/webbrowser.cc
--- passepartout-0.6/src/pptout/webbrowser.cc	2004-01-12 20:01:20.000000000 +0100
+++ passepartout/src/pptout/webbrowser.cc	1970-01-01 01:00:00.000000000 +0100
@@ -1,36 +0,0 @@
-///
-// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
-///
-#include "webbrowser.h"
-#include "widget/usererror.h"
-#include "defines.h" // VERSION
-#include "util/filesys.h"
-#include <glibmm/spawn.h>
-
-namespace {
-  const std::string browser = "gnome-moz-remote";
-}
-
-const std::string homepage = "http://www.stacken.kth.se/project/pptout/";
-
-void open_url(const std::string &url) {
-  try {
-    Glib::spawn_command_line_async(browser + " \"" + url + "\"");
-    
-  } catch(const Glib::SpawnError& e) {
-    throw UserError("Failed to run web browser \"" + browser + '"', e.what());
-  }
-}
-
-void open_homepage() {open_url(homepage);}
-
-void open_docs() {
-  std::string url = DOCDIR "/users_guide.html";
-  if(access(url))
-    url = "file://" + url;
-  else
-    url = "http://www.stacken.kth.se/project/pptout/doc/" 
-      + std::string(VERSION)
-      + "/users_guide.html";
-  open_url(url);
-}
diff -Nur -x CVS passepartout-0.6/src/pptout/webbrowser.h passepartout/src/pptout/webbrowser.h
--- passepartout-0.6/src/pptout/webbrowser.h	2004-01-12 20:01:20.000000000 +0100
+++ passepartout/src/pptout/webbrowser.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,13 +0,0 @@
-#ifndef WEBBROWSER_H		// -*- c++ -*-
-#define WEBBROWSER_H
-///
-// Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
-///
-#include <string>
-
-extern const std::string homepage;
-void open_url(const std::string&);
-void open_homepage();
-void open_docs();
-
-#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/dialogwrap.cc passepartout/src/pptout/widget/dialogwrap.cc
--- passepartout-0.6/src/pptout/widget/dialogwrap.cc	2004-04-16 16:59:36.000000000 +0200
+++ passepartout/src/pptout/widget/dialogwrap.cc	2004-11-29 12:58:14.000000000 +0100
@@ -13,29 +13,22 @@
 		parent, true /* modal */, false /* separator */)
 {}
 
-void DialogWrap::show_raise() {
-  Glib::RefPtr<Gdk::Window> win = get_window();
-  win->show();			// uniconify if necessary
-  win->raise();			// raise if necessary
-}
+void DialogWrap::show_raise() { present(); }
 
 Gtk::Button* DialogWrap::fix_button(Gtk::Button* button, int action_id) {
   Gtk::Button *b = manage(button);
   // Note: It seems that activate means "in any way except a simple click".
   // So we have to add callbacks for both activate and clicked.
-  b->signal_clicked().connect(bind(slot(*this, &Gtk::Dialog::on_response),
-				   action_id));
-  b->signal_activate().connect(bind(slot(*this, &Gtk::Dialog::on_response),
-				    action_id));
+  b->signal_clicked().connect
+    (bind(sigc::mem_fun(*this, &DialogWrap::on_response), action_id));
+  b->signal_activate().connect
+    (bind(sigc::mem_fun(*this, &DialogWrap::on_response), action_id));
   return b;
 }
 
 UtilityWindow::UtilityWindow(const Glib::ustring& name) {
+  set_type_hint(Gdk::WINDOW_TYPE_HINT_UTILITY);
   set_title(name + " - Passepartout");
 }
 
-void UtilityWindow::show_raise() {
-  Glib::RefPtr<Gdk::Window> win = get_window();
-  win->show();			// uniconify if necessary
-  win->raise();			// raise if necessary
-}
+void UtilityWindow::show_raise() { present(); }
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/errordialog.cc passepartout/src/pptout/widget/errordialog.cc
--- passepartout-0.6/src/pptout/widget/errordialog.cc	2004-10-27 11:38:24.000000000 +0200
+++ passepartout/src/pptout/widget/errordialog.cc	2004-12-17 15:54:42.000000000 +0100
@@ -55,6 +55,7 @@
                                            : Gtk::Stock::DIALOG_WARNING,
                                            Gtk::ICON_SIZE_DIALOG)),
                     Gtk::PACK_SHRINK);
+    label.set_selectable();
     box->pack_start(label, Gtk::PACK_SHRINK);
     add_button(Gtk::Stock::OK, 0);
   }
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/filesel.cc passepartout/src/pptout/widget/filesel.cc
--- passepartout-0.6/src/pptout/widget/filesel.cc	2004-10-28 20:58:52.000000000 +0200
+++ passepartout/src/pptout/widget/filesel.cc	2004-11-25 14:43:24.000000000 +0100
@@ -6,6 +6,7 @@
 #include <gtkmm/image.h>
 #include <gtkmm/box.h>
 #include <gtkmm/stock.h>
+#include <gtkmm/liststore.h>
 #include "usererror.h"
 #include "util/stringutil.h"
 #include "util/warning.h"
@@ -14,51 +15,56 @@
 
 // *** EndEntry methods ***
 
-EndEntry::EndEntry(int _history_max) 
-  :history_max(_history_max) 
-{
-  disable_activate(); // don't pop down history when pressing enter
-  // get_entry()->set_activates_default();
-  // set_activates_default() does not work together with the call to
-  // activate in FileEntry:filesel_done().
-}
+EndEntry::EndEntry(int _history_max) : history_max(_history_max) {}
 
-void EndEntry::set_text(const Glib::ustring &text) {
-  get_entry()->set_text(text); 
+void EndEntry::set_text(const Glib::ustring &text, bool remember_text) {
+  if(get_text(false) == text)
+    return;
+  Gtk::Entry &entry = get_entry();
+  entry.set_text(text);
   // move cursor to end so the filename is visible
-  get_entry()->set_position(text.length());
+  entry.set_position(text.length());
+  if(remember_text)
+    remember();
+}
+
+Glib::ustring EndEntry::get_text(bool remember_text) {
+  if(remember_text) 
+    remember();
+  return get_entry().get_text();
+}
+
+Gtk::Entry& EndEntry::get_entry() {
+  return *dynamic_cast<Gtk::Entry*>(get_child());
 }
 
 void EndEntry::remember() {
-  Glib::ustring text = get_entry()->get_text();
-  for(History::iterator i = history.begin();
-      i != history.end(); i++)
-    if(*i == text) {
-      History::iterator j = i++;
-      history.erase(j);
-    }
+  Glib::ustring text = get_entry().get_text();
+  // remove duplicates
+  History::iterator dup;
+  while((dup = std::find(history.begin(), history.end(), text))
+        != history.end())
+    history.erase(dup);
+  // add new
   history.push_front(text); 
-  // put text in front, or the entry will be altered
+  // remove old
   while(history.size() > history_max)
     history.pop_back();
-  set_popdown_strings(history);
-}
-
-Glib::ustring EndEntry::get_text(bool remember_text) {
-  if(remember_text) 
-    remember();
-  return get_entry()->get_text();
+  // update pop-down list
+  Glib::RefPtr<Gtk::ListStore>::cast_dynamic(get_model())->clear();
+  for(History::const_iterator i = history.begin(); i != history.end(); i++)
+    append_text(*i);
 }
 
 // *** FileEntry methods ***
 
 FileEntry::FileEntry(const Glib::ustring& window_title_, 
 		     const Glib::ustring& default_path_,
-		     const bool file_prompt_):
-  window_title(window_title_), default_path(default_path_),
-  default_value(&default_path),
-  filesel(0),
-  file_prompt(file_prompt_)
+                     Gtk::FileChooserAction action)
+  : window_title(window_title_), default_path(default_path_),
+    default_value(&default_path),
+    filesel(0),
+    action(action)
 {
   pack_start(entry, Gtk::PACK_EXPAND_WIDGET, 0);
   pack_start(button, Gtk::PACK_SHRINK, 0);
@@ -74,29 +80,23 @@
 
   entry.show();
   button.set_size_request(-1, entry.get_height());
-  button.signal_clicked().connect(slot(*this, &FileEntry::show_filesel));
+  button.signal_clicked().connect
+    (sigc::mem_fun(*this, &FileEntry::show_filesel));
 }
 
 bool FileEntry::on_mnemonic_activate(bool group_cycling) {
   // Not much documented in gtkmm, but it seems this metod gets called when
   // this widget is activated (by a mnemonic e.g. from a label) so I can put
   // focus on the proper part of the widget.
-  entry.get_entry()->grab_focus();
+  entry.get_entry().grab_focus();
   return true;
 }
 
 void FileEntry::filesel_done() {
   if(!filesel->was_cancelled()) {
-    if(file_prompt) {
-      entry.set_text(filesel->get_filename());      
-    } else {       //Get directory name
-      //selection_text label format: "Some label: directory"
-      std::string s = filesel->get_selection_text()->get_text();
-      if(s.find_last_of("/") != s.length()-1 ) s += "/"; //Unnecessary check?
-      int i = s.find_first_of("/");
-      entry.set_text(s.substr(i)); //Remove label
-    }
-    entry.get_entry()->activate(); // in case of instant apply
+    // get_filename does not return utf8
+    entry.set_text(Glib::filename_to_utf8(filesel->get_filename()));
+    entry.get_entry().activate(); // in case of instant apply
   }
   filesel.reset();
 }
@@ -105,26 +105,14 @@
   Gtk::Window *toplevel = dynamic_cast<Gtk::Window*>(this->get_toplevel());
   assert(toplevel);
 
-  if(!file_prompt) {
-    filesel.reset(new Filesel(*toplevel, window_title, true, true));
-    filesel->get_selection_entry()->hide();
-    filesel->get_file_list()->get_parent()->hide();
-    //A slightly more complicated way:
-    //  gtk_widget_hide(GTK_WIDGET(GTK_FILE_SELECTION(filesel->gobj())->
-    //file_list->parent));
-  } else {
-    filesel.reset(new Filesel(*toplevel, window_title, true, false));
-  }
-  filesel->signal_hide().connect(slot(*this, &FileEntry::filesel_done));
-  if(entry.get_text() != *default_value) { //If non-default entry
-    filesel->set_filename(entry.get_text().empty() 
-			  ? default_path 
-			  : entry.get_text());
-  } else { //Default entry found -> browse to default_path
-    filesel->set_filename(default_path.empty() 
-			  ? entry.get_text() 
-			  : default_path);
-  }
+  filesel.reset(new Filesel(*toplevel, window_title, action));
+  filesel->signal_hide().connect
+    (sigc::mem_fun(*this, &FileEntry::filesel_done));
+  Glib::ustring filename = entry.get_text(false /* don't save */);
+  if(filename != *default_value) // If non-default entry
+    filesel->set_filename(filename.empty() ? default_path : filename);
+  else // Default entry found -> browse to default_path
+    filesel->set_filename(default_path.empty() ? filename : default_path);
   filesel->show();
 }
 
@@ -140,39 +128,33 @@
 // *** Filesel methods ***
 
 Filesel::Filesel(Gtk::Window &parent, const Glib::ustring& title,
-		 bool _accept_nonexistent, bool _accept_dir)
-  :Gtk::FileSelection(title), cancelled(false),
-   accept_nonexistent(_accept_nonexistent), 
-   accept_dir(_accept_dir)
+		 Gtk::FileChooserAction action)
+  : Gtk::FileChooserDialog(parent, title, action), cancelled(false)
 {
   set_modal(true);
-  set_has_separator(false);
-  set_transient_for(parent);
+  add_button(Gtk::Stock::CANCEL, Gtk::RESPONSE_CANCEL);
+  add_button(Gtk::Stock::OK, Gtk::RESPONSE_OK)->grab_default();
+  signal_file_activated().connect
+    (sigc::bind(sigc::mem_fun(*this, &Filesel::on_response),
+                Gtk::RESPONSE_OK));
 }
 
 void Filesel::on_response(int response_id) {
   switch(response_id) {
   case Gtk::RESPONSE_OK:
-    {
-      std::string filename = get_filename();
-      if(!accept_dir && filename.at(filename.length() - 1) == '/') 
-	return;
-      if(!accept_nonexistent && !exists(filename))
-	throw UserError("Could not open file", filename + " does not exist.");
-      cancelled = false;
-      hide();
-    }
+    cancelled = false;
+    hide();
     break;
   case Gtk::RESPONSE_CANCEL: case Gtk::RESPONSE_DELETE_EVENT:
     // Gtk::RESPONSE_DELETE_EVENT is sent when the user tries to close
     // the window
-    set_filename("");
+    //    set_filename("");
     cancelled = true;
     hide();
     break;
   default:
-    warning << "Impossible error (you didn't see this)"
-	    << " in Filesel::on_response()" << std::endl;
+    throw std::runtime_error("Impossible error (you didn't see this)"
+                             " in Filesel::on_response()");
     break;
   }
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/filesel.h passepartout/src/pptout/widget/filesel.h
--- passepartout-0.6/src/pptout/widget/filesel.h	2004-01-12 20:01:25.000000000 +0100
+++ passepartout/src/pptout/widget/filesel.h	2004-11-24 22:22:10.000000000 +0100
@@ -5,8 +5,9 @@
 #ifndef FILESEL_H
 #define FILESEL_H
 
-#include <gtkmm/fileselection.h>
-#include <gtkmm/combo.h>
+#include <gtkmm/filechooserdialog.h>
+#include <gtkmm/comboboxentrytext.h>
+#include <gtkmm/entry.h>
 #include <memory>
 
 class Filesel;
@@ -16,11 +17,12 @@
  * in the pop-down menu. Also the cursor is moved to the end when the
  * text is set.
  */
-class EndEntry: public Gtk::Combo {
+class EndEntry: public Gtk::ComboBoxEntryText {
 public:
   EndEntry(int _history_max = 5);
-  void set_text(const Glib::ustring &text);
+  void set_text(const Glib::ustring &text, bool remember_text = false);
   Glib::ustring get_text(bool remember_text = true);
+  Gtk::Entry& get_entry();
   void remember(); // add current text to history
 private:
   unsigned int history_max;
@@ -36,7 +38,7 @@
   EndEntry entry;
   FileEntry(const Glib::ustring& window_title_, 
 	    const Glib::ustring& default_path_ = "", 
-	    const bool file_prompt_ = true);
+            Gtk::FileChooserAction action = Gtk::FILE_CHOOSER_ACTION_OPEN);
 
   const Glib::ustring& get_default_value(); 
   //set entry text to value. default_path is still going to be used 
@@ -51,7 +53,7 @@
   Glib::ustring *default_value;
   Gtk::Button button;
   std::auto_ptr<Filesel> filesel;
-  bool file_prompt;
+  Gtk::FileChooserAction action;
 
   void filesel_done();
   void show_filesel();
@@ -61,18 +63,15 @@
  * A file selection dialog with response handlers connected to the
  * ok/cancel buttons.
  */
-class Filesel: public Gtk::FileSelection {
+class Filesel: public Gtk::FileChooserDialog {
 public:
-  /**
-   * \param _accept_nonexistent If false, reject files that do not exist.
-   */
-  Filesel(Gtk::Window &parent, const Glib::ustring& title, 
-	  bool _accept_nonexistent = false, bool _accept_dir = false);
-  bool was_cancelled() const {return cancelled;}
+  Filesel(Gtk::Window &parent, const Glib::ustring& title,
+          Gtk::FileChooserAction action = Gtk::FILE_CHOOSER_ACTION_OPEN);
+  bool was_cancelled() const { return cancelled; }
   
 private:
   void on_response(int response_id);
-  bool cancelled, accept_nonexistent, accept_dir;
+  bool cancelled;
 };
 
 #endif
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/imagefilesel.cc passepartout/src/pptout/widget/imagefilesel.cc
--- passepartout-0.6/src/pptout/widget/imagefilesel.cc	2004-04-16 01:05:43.000000000 +0200
+++ passepartout/src/pptout/widget/imagefilesel.cc	2004-11-25 21:07:49.000000000 +0100
@@ -11,41 +11,57 @@
 const int ImageFilesel::maxwidth = 100;
 const int ImageFilesel::maxheight = 100;
 
+namespace {
+  typedef std::vector<std::string> MimeTypes;
+  
+  MimeTypes get_mime_types() {
+    MimeTypes mime_types;
+    std::vector<Gdk::PixbufFormat> formats = Gdk::Pixbuf::get_formats();
+    for(std::vector<Gdk::PixbufFormat>::const_iterator
+          format = formats.begin(); format != formats.end(); format++) {
+      MimeTypes tmp = format->get_mime_types();
+      mime_types.insert(mime_types.end(), tmp.begin(), tmp.end());
+    }
+    return mime_types;
+  }
+  
+  void add_images_filter(Gtk::FileChooser &fc) {
+    Gtk::FileFilter filter;
+    filter.set_name("Image files");
+    MimeTypes mime_types = get_mime_types();
+    for(MimeTypes::const_iterator
+          i = mime_types.begin(); i != mime_types.end(); i++)
+      filter.add_mime_type(*i);
+    filter.add_pattern("*.eps"); // is there no mime type for eps?
+    fc.add_filter(filter);
+  }
+}
+
 ImageFilesel::ImageFilesel(Gtk::Window &parent, const ustring& title,
 			     float default_res, 
 			   const ustring& unit_name, float unit_factor)
-  : Filesel(parent, title), res(0, true), 
-    show_preview("Show _preview", true),
-    no_preview("No preview available", 0.5, 0.5)
+  : Filesel(parent, title), res(0, true)
 {
   unit.name = unit_name;  unit.factor = unit_factor;
+  
+  // filters
+  add_images_filter(*this);
+  Gtk::FileFilter afilter; afilter.set_name("All files"); afilter.add_pattern("*");
+  add_filter(afilter);
+  
   // *** The preview image ***
-  // Find the right HBox
-  Gtk::Box::BoxList::iterator boxiter = get_main_vbox()->children().end();
-  boxiter--; boxiter--; boxiter--; boxiter--; // the fourth last widget
-  Gtk::Box *list_box = 
-    dynamic_cast<Gtk::Box*>(boxiter->get_widget());
-  if(!list_box)
-    list_box = get_main_vbox(); // safeguard
-      
-  Gtk::Frame *frame = manage(new Gtk::Frame);
   Gtk::Box *box = manage(new Gtk::VBox(false, double_space));
   Gtk::Alignment *alignment = manage(new Gtk::Alignment());
   alignment->set_size_request(maxwidth, maxheight);
   Gtk::Box *inner_box = manage(new Gtk::VBox());
   alignment->add(*inner_box);
-  frame->add(*alignment);
-  box->pack_end(show_preview, Gtk::PACK_SHRINK);
-  box->pack_end(info, Gtk::PACK_SHRINK);
-  box->pack_end(*frame, Gtk::PACK_SHRINK);
+  box->pack_start(*alignment, Gtk::PACK_SHRINK);
+  box->pack_start(info, Gtk::PACK_SHRINK);
   inner_box->pack_start(preview);
-  inner_box->pack_start(no_preview, Gtk::PACK_EXPAND_WIDGET);      
-  no_preview.set_line_wrap(); no_preview.set_sensitive(false);
-  no_preview.set_size_request(maxwidth, maxheight);
-  no_preview.set_justify(Gtk::JUSTIFY_CENTER);
-  list_box->pack_end(*box, Gtk::PACK_SHRINK);
-  box->show_all(); no_preview.hide(); preview.hide();
-
+  box->show_all();
+  set_preview_widget(*box);
+  set_preview_widget_active(false);
+  
   // *** The image resolution
   res.set(default_res);
   box = manage(new Gtk::HBox(false, double_space));
@@ -54,25 +70,26 @@
   box->pack_start(res, Gtk::PACK_SHRINK);
   box->pack_start(*manage(new Gtk::Label("ppi")),
 		  Gtk::PACK_SHRINK);
-  get_main_vbox()->pack_start(*box, Gtk::PACK_SHRINK, single_space);
   box->show_all();
-
-  get_selection_entry()->signal_changed().connect
-    (slot(*this, &ImageFilesel::update_preview));
-  show_preview.signal_clicked().connect
-    (slot(*this, &ImageFilesel::update_preview));
+  set_extra_widget(*box);
+  
+  // the preview is loaded in a separate thread, to avoid locking up the gui
+  signal_update_preview().connect
+    (sigc::mem_fun(*this, &ImageFilesel::start_loader));
+  signal_loaded.connect
+    (sigc::mem_fun(*this, &ImageFilesel::update_preview));
+  
   res.signal_value_changed().connect
-    (slot(*this, &ImageFilesel::update_size));
+    (sigc::mem_fun(*this, &ImageFilesel::update_size));
 }
 
 void ImageFilesel::update_size() {
-  if(!show_preview.get_active())
-    return;
   int w = image_size.width;  int h = image_size.height;
   float resolution = res.get() / 72.0; // pixels per point
   std::ostringstream text;
   text << w  << " x " << h << " pixels";
-  text.precision(3);
+  text.precision(2);
+  text.setf(std::ios_base::fixed, std::ios_base::floatfield);
   if(!unit.name.empty())
     text << '\n' 
 	 << w / resolution / unit.factor << " x " 
@@ -81,33 +98,38 @@
   info.set_text(text.str());
 }
 
-void ImageFilesel::update_preview() {
-  if(!show_preview.get_active()) {
-    info.set_text("");
-    preview.hide();
-    no_preview.hide();
-    return;
-  }
-  try {	
-    Glib::RefPtr<Gdk::Pixbuf> pixbuf = 
-      Gdk::Pixbuf::create_from_file(get_filename());
+void ImageFilesel::start_loader() {
+  info.set_text("Loading\npreview ...");
+  set_preview_widget_active(true);
+  preview.hide();
+  Glib::Thread::create(sigc::mem_fun(*this, &ImageFilesel::loader_thread),
+                       false /* not joinable */);
+}
+
+void ImageFilesel::loader_thread() {
+  try {
+    pixbuf.clear();
+    pixbuf = Gdk::Pixbuf::create_from_file(get_preview_filename());
     // scale to appropriate size
     int w = pixbuf->get_width();  int h = pixbuf->get_height();
     image_size.width = w;  image_size.height = h;
-    update_size();
     float fw = float(maxwidth) / w;  float fh = float(maxheight) / h;
     float f = std::min(fw, fh);
     w = int(f * w);  h = int(f * h);
     pixbuf = pixbuf->scale_simple(w, h, Gdk::INTERP_NEAREST);
+  }
+  catch (...) {}
+  signal_loaded();
+}
+
+
+void ImageFilesel::update_preview() {
+  if(pixbuf) {
+    update_size();
     preview.set(pixbuf);
     preview.show();
-    no_preview.hide();
-  } 
-  catch (...) {
-    // failed to load image, possibly because the file was not an
-    // image file
-    info.set_text("");
-    preview.hide();
-    no_preview.show();
+    set_preview_widget_active();
+  } else {
+    set_preview_widget_active(false);
   }
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/imagefilesel.h passepartout/src/pptout/widget/imagefilesel.h
--- passepartout-0.6/src/pptout/widget/imagefilesel.h	2004-01-12 20:01:25.000000000 +0100
+++ passepartout/src/pptout/widget/imagefilesel.h	2004-11-24 01:01:21.000000000 +0100
@@ -31,8 +31,11 @@
   struct { ustring name;  float factor; } unit; 
   Gtk::Image preview;
   struct { int width, height; } image_size;
-  Gtk::CheckButton show_preview;
-  Gtk::Label no_preview, info;
+  Gtk::Label info;
+  Glib::RefPtr<Gdk::Pixbuf> pixbuf;
+  Glib::Dispatcher signal_loaded;
+  void start_loader();
+  void loader_thread();
   void update_preview();
   void update_size();
 };
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/Makefile.am passepartout/src/pptout/widget/Makefile.am
--- passepartout-0.6/src/pptout/widget/Makefile.am	2003-09-21 17:34:47.000000000 +0200
+++ passepartout/src/pptout/widget/Makefile.am	2004-11-25 00:38:22.000000000 +0100
@@ -1,16 +1,13 @@
 noinst_LIBRARIES = libwidget.a
 
 dist_noinst_HEADERS = spinner.h filesel.h imagefilesel.h dialogwrap.h	\
-		subpanel.h wmisc.h errordialog.h usererror.h
+		subpanel.h wmisc.h errordialog.h usererror.h programs.h \
+		zoomer.h
 
 libwidget_a_SOURCES = spinner.cc filesel.cc imagefilesel.cc		\
 		dialogwrap.cc subpanel.cc wmisc.cc errordialog.cc	\
-		usererror.cc
+		usererror.cc programs.cc zoomer.cc
 
-libwidget_a_CXXFLAGS = $(GDK_PIXBUF_CFLAGS) $(GTKMM_CFLAGS)\
-		     $(SIGC_CFLAGS)
+libwidget_a_CXXFLAGS = $(GTKMM_CFLAGS) $(GNOMEVFS_CFLAGS) $(GNOME_CFLAGS)
 
-libwidget_a_CXXFLAGS += -I$(top_srcdir)/src
-
-#libwidget_a_LIBADD = $(GDK_PIXBUF_LIBS) $(GTKMM_LIBS)\
-#		$(SIGC_LIBS)
+libwidget_a_CXXFLAGS += -I$(top_srcdir)/src -D'DOCDIR=$(docdir)'
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/programs.cc passepartout/src/pptout/widget/programs.cc
--- passepartout-0.6/src/pptout/widget/programs.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/widget/programs.cc	2004-12-18 13:44:42.000000000 +0100
@@ -0,0 +1,109 @@
+///
+// Copyright (C) 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include "programs.h"
+#include "usererror.h"
+#include "defines.h" // VERSION, HAVE_GNOME
+#include "util/warning.h"
+#include "util/filesys.h"
+
+#ifdef HAVE_GNOME
+#include <libgnome/libgnome.h>
+#include <libgnomevfs/gnome-vfs-mime-handlers.h>
+#endif
+
+namespace {
+  const std::string browser = "gnome-moz-remote";
+}
+
+const std::string homepage = "http://www.stacken.kth.se/project/pptout/";
+
+void Programs::open_url(const std::string &url) {
+#ifdef HAVE_GNOME
+  GError *error = 0;
+  if(!gnome_url_show(url.c_str(), &error))
+    throw UserError("Failed to run web browser \"" + browser + '"',
+                    error->message);
+#else
+  try {
+    Glib::spawn_command_line_async(browser + " \"" + url + "\"");
+  } catch(const Glib::SpawnError& e) {
+    throw UserError("Failed to run web browser \"" + browser + '"', e.what());
+  }
+#endif
+}
+
+void Programs::open_homepage() { open_url(homepage); }
+
+void Programs::open_docs() {
+  std::string url = DOCDIR "/users_guide.html";
+  if(access(url))
+    url = "file://" + url;
+  else
+    url = "http://www.stacken.kth.se/project/pptout/doc/" 
+      + std::string(VERSION)
+      + "/users_guide.html";
+  open_url(url);
+}
+
+namespace {
+  void run_command(const std::string cmd, const std::string filename,
+                   bool requires_terminal) {
+    std::string full_cmd =
+      (requires_terminal ? "xterm -e " : "")
+      + cmd + " " + filename;
+    verbose << "Running: " << full_cmd << std::endl;
+    Glib::spawn_command_line_async(full_cmd);
+  }
+}
+
+void Programs::populate_file_handler_menu(Gtk::Menu &menu,
+                                          const std::string &filename,
+                                          const std::string &mimetype) {
+#ifdef HAVE_GNOME
+  using namespace Gtk;
+  using namespace Menu_Helpers;
+  MenuList& items = menu.items();
+  GList *list =
+    gnome_vfs_mime_get_short_list_applications(mimetype.c_str());
+  if(!list)
+    throw std::runtime_error("No applications handling "  + mimetype);
+  for(; list; list = list->next) {
+    GnomeVFSMimeApplication *app =
+      static_cast<GnomeVFSMimeApplication*>(list->data);
+    items.push_back
+      (MenuElem(app->name,
+                sigc::bind(sigc::ptr_fun(&run_command),
+                           app->command,
+                           filename,
+                           app->requires_terminal)));
+  }
+#else
+  throw std::runtime_error("No Gnome support");
+#endif
+}
+
+void Programs::open_postscript_file(const std::string &filename,
+                                    bool delete_when_done) {
+  // try to run gv (or whatever you want to use instead)
+  std::string psviewer = "";
+#ifdef HAVE_GNOME
+  GnomeVFSMimeApplication *app =
+    gnome_vfs_mime_get_default_application("application/postscript");
+  psviewer = app->command;
+#endif
+  if(psviewer.empty())
+    const std::string psviewer = "gv -safer "; //config.PSViewer.values.front();
+  // Removing the file after the viewer has terminated. However,
+  // nowadays many apps use ipc to prevent the user from starting
+  // more than one instance of the program, so the program might
+  // just tell the running instance to open the file and then exit
+  // immediately. Perhaps each document should have its own tmp file
+  // that lives as long as the document?
+  std::string cmd = "sh -c '" + psviewer + " " + filename;
+  if(delete_when_done)
+    cmd += " ; rm " + filename;
+  cmd += "'";
+  verbose << cmd << std::endl;
+  Glib::spawn_command_line_async(cmd);
+}
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/programs.h passepartout/src/pptout/widget/programs.h
--- passepartout-0.6/src/pptout/widget/programs.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/widget/programs.h	2004-11-20 02:04:43.000000000 +0100
@@ -0,0 +1,31 @@
+#ifndef PROGRAMS_H		// -*- c++ -*-
+#define PROGRAMS_H
+///
+// Copyright (C) 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+
+#include <string>
+#include <gtkmm/menu.h>
+
+/// Calling other programs for handling URLs and mime types
+
+extern const std::string homepage;
+
+namespace Programs {
+  void open_url(const std::string&);
+  void open_homepage();
+  void open_docs();
+
+  /// Add items for calling external programs (based on mime type) on
+  /// a given file to an existing menu. Throws an exception if it
+  /// fails to add any items.
+  void populate_file_handler_menu(Gtk::Menu &menu, const std::string &filename,
+                                  const std::string &mimetype);
+
+  /// Open a postscript file in an external viewer.
+  /// \param delete_when_done The file is deleted when the viewer terminates.
+  void open_postscript_file(const std::string &filename,
+                            bool delete_when_done);
+}
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/spinner.cc passepartout/src/pptout/widget/spinner.cc
--- passepartout-0.6/src/pptout/widget/spinner.cc	2004-04-16 01:05:43.000000000 +0200
+++ passepartout/src/pptout/widget/spinner.cc	2004-12-16 23:23:48.000000000 +0100
@@ -53,61 +53,48 @@
   pack_start(*spinbutton);
   
   if(units) { // only add menu if we have units for it
-    menu = manage(new Gtk::Menu());
-    using namespace Gtk::Menu_Helpers;
-    MenuList& menu_list = menu->items();
+    unitmenu = manage(new Gtk::ComboBoxText());
     FUUnits::UnitList list = units->list_units();
-
-    Glib::ustring top_unit = units->get_base_unit();
+    
+    Glib::ustring selected_unit = units->get_base_unit();
     // use default unit, if given
     if(!default_unit.empty()) {
       try {
 	// if the default unit is not the base unit, then the conversion
 	// factor needs to be changed from 1
 	value->set_factor(units->get_factor(default_unit));
-	top_unit = default_unit;  // after get_factor(), in case it
+	selected_unit = default_unit;  // after get_factor(), in case it
 				  // throws unknown_unit_error
       }
       catch(const unknown_unit_error&) {
       }
     }
 
-    // putting the top unit first makes it the default
-    menu_list.push_back(MenuElem(top_unit)); 
-    for(FUUnits::UnitList::const_iterator 
-	  i = list.begin(); i != list.end(); i++) {
-      if(*i != top_unit)  // don't add top unit twice
-	menu_list.push_back(MenuElem(*i));
+    int i = 0;
+    for(FUUnits::UnitList::const_iterator
+	  unit = list.begin(); unit != list.end(); unit++, i++) {
+      unitmenu->append_text(*unit);
+      if(*unit == selected_unit)
+        unitmenu->set_active(i);
     }
 
-    optionmenu = manage(new Gtk::OptionMenu());
-    optionmenu->set_menu(*menu);
-    menu->signal_selection_done().connect
-      (slot(*this, &Spinner::on_unit_select));
+    unitmenu->signal_changed().connect
+      (sigc::mem_fun(*this, &Spinner::on_unit_select));
 
-    optionmenu->set_size_request(-1, spinbutton->get_height());
-    pack_start(*optionmenu);
+    //    unitmenu->set_size_request(-1, spinbutton->get_height());
+    pack_start(*unitmenu);
   } // if(units)
 
   show_all();
 }
 
-Spinner::~Spinner() { delete value; }
+Spinner::~Spinner() {}
 
 void Spinner::limits(float low, float high) {
   value->set_lower(low);
   value->set_upper(high);
 }
 
-void Spinner::set_unit(const Glib::ustring &unit) {
-  Gtk::Menu_Helpers::MenuList::const_iterator i = menu->items().begin();
-  while (i != menu->items().end()) {
-    const Gtk::Label *label = dynamic_cast<const Gtk::Label*>(i->get_child());
-    if(label && (label->get_text() == unit))
-      i->select();
-  }
-}
-
 void Spinner::set(float _value) { 
   value->set_value(_value);
 }
@@ -129,15 +116,7 @@
 }
 
 void Spinner::on_unit_select() {
-  const Gtk::Label *label = 
-    dynamic_cast<const Gtk::Label*>(optionmenu->get_child());
-  if(!label)
-    return;
-  if(units) {
-    try {
-      value->set_factor(units->get_factor(label->get_text()));
-    } catch(const unknown_unit_error&) {}
-  }
+  value->set_factor(units->get_factor(unitmenu->get_active_text()));
 }
 
 
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/spinner.h passepartout/src/pptout/widget/spinner.h
--- passepartout-0.6/src/pptout/widget/spinner.h	2004-04-16 01:05:43.000000000 +0200
+++ passepartout/src/pptout/widget/spinner.h	2004-12-16 23:23:48.000000000 +0100
@@ -6,7 +6,8 @@
 #define W_SPINNER_H
 #include <gtkmm/box.h>
 #include <gtkmm/spinbutton.h>
-#include <gtkmm/optionmenu.h>
+#include <gtkmm/comboboxtext.h>
+#include <memory>
 #include "pptout/lengthunits.h"
 
 class UnitAdjustment;
@@ -20,15 +21,13 @@
 	  const float _lo_value = -8000, 
 	  const float _hi_value = 8000);
   ~Spinner();
-
+  
   void limits(float low, float high);
 
-  void set_unit(const Glib::ustring &unit);
   void set(float _value);
   float get() const;
 
   Gtk::SpinButton &get_spinbutton() const { return *spinbutton; }
-  Gtk::OptionMenu &get_optionmenu() const { return *optionmenu; }
 
   Glib::SignalProxy0<void> signal_value_changed();
 
@@ -38,12 +37,15 @@
   
 private:
   Gtk::SpinButton *spinbutton;
-  Gtk::Menu *menu;
-  Gtk::OptionMenu *optionmenu;
-  UnitAdjustment *value;
+  Gtk::ComboBoxText *unitmenu;
+  std::auto_ptr<UnitAdjustment> value;
   const FUUnits *units;
 
   void on_unit_select();
+
+  // Undefined
+  Spinner(const Spinner&);
+  Spinner& operator = (const Spinner&);
 };
 
 #endif
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/zoomer.cc passepartout/src/pptout/widget/zoomer.cc
--- passepartout-0.6/src/pptout/widget/zoomer.cc	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/widget/zoomer.cc	2004-11-25 00:38:22.000000000 +0100
@@ -0,0 +1,32 @@
+///
+// Copyright (C) 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#include "zoomer.h"
+#include "spinner.h"
+
+struct ZoomerRep {
+  Spinner spinner;
+  
+  ZoomerRep(float factor)
+    : spinner(100.0 * factor, false, 0, "", 5, 10000)
+  {}
+};
+
+namespace {
+  void on_value_changed(Zoomer *zoomer) {
+    zoomer->signal_changed(zoomer->get_factor());
+  }
+}
+
+Zoomer::Zoomer(float factor) : rep(new ZoomerRep(factor)) {
+  rep->spinner.signal_value_changed().connect
+    (sigc::bind(sigc::ptr_fun(&on_value_changed), this));
+}
+
+Zoomer::~Zoomer() { delete rep; }
+
+void Zoomer::set_factor(float factor) { rep->spinner.set(100.0 * factor); }
+
+float Zoomer::get_factor() const { return rep->spinner.get() / 100.0; }
+
+Gtk::Widget& Zoomer::get_widget() { return rep->spinner; }
diff -Nur -x CVS passepartout-0.6/src/pptout/widget/zoomer.h passepartout/src/pptout/widget/zoomer.h
--- passepartout-0.6/src/pptout/widget/zoomer.h	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/pptout/widget/zoomer.h	2004-11-25 00:38:22.000000000 +0100
@@ -0,0 +1,27 @@
+// -*- c++ -*-
+///
+// Copyright (C) 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
+///
+#ifndef ZOOMER_H
+#define ZOOMER_H
+
+#include <gtkmm/widget.h>
+
+class ZoomerRep;
+
+/// Zoom widget wrapper.
+class Zoomer {
+public:
+  sigc::signal<void, float> signal_changed;
+
+  Zoomer(float factor = 1.0);
+  ~Zoomer();
+  void set_factor(float factor);
+  float get_factor() const;
+  Gtk::Widget& get_widget();
+
+private:
+  ZoomerRep *rep;
+};
+
+#endif
diff -Nur -x CVS passepartout-0.6/src/pptout/window.cc passepartout/src/pptout/window.cc
--- passepartout-0.6/src/pptout/window.cc	2004-10-27 11:38:23.000000000 +0200
+++ passepartout/src/pptout/window.cc	2004-11-25 17:20:00.000000000 +0100
@@ -3,83 +3,38 @@
 ///
 #include "window.h"
 
-#include <iostream>
-#include <sstream>
-#include <fstream>
-#include <vector>
 #include <set>
-#include <cassert>
 
-#include <gtkmm/adjustment.h>
 #include <gtkmm/label.h>
-#include <gtkmm/stock.h>
 #include <gtkmm/scrolledwindow.h>
 #include <gtkmm/table.h>
-#include <gtkmm/image.h>
 #include <gtkmm/statusbar.h>
-#include <gtkmm/optionmenu.h>
-#include <gtkmm/menubar.h>
 #include <gtkmm/toolbar.h>
 #include <gtkmm/main.h>
 
-#include "util/tempfile.h"
 #include "util/warning.h"
-#include "util/stringutil.h"
-#include "util/filesys.h"
-#include "util/os.h"
 
 #include "widget/wmisc.h"
-#include "widget/usererror.h"
 #include "widget/filesel.h"
 #include "widget/imagefilesel.h"
-#include "widget/errordialog.h"
-
-#include "icons/icons.h"
-
-#include "document/fileerrors.h"
-#include "document/page.h"
 
 #include "config.h"
-#include "inspiration.h"
 #include "printdialog.h"
 #include "propertiesdialog.h"
-#include "docpropsdialog.h"
 #include "streamdialog.h"
 #include "pagesel.h"
 
 namespace{
   typedef std::set<FrameWindow*> Windows;
   Windows windows; // a list of all windows
-
-  typedef std::set<unsigned int> ZoomFactors;
-  ZoomFactors zoom_factors;
-}
-
-// A bit more clever than a usual conversion function
-// - it understands per cent signs.
-float str2float(const std::string& value) {
-  std::istringstream s(value.c_str());
-  float f, factor = 1;
-  if(s >> f) {
-    char ch;
-    if(s >> ch)
-      if(ch == '%') factor = 0.01;
-      else throw std::runtime_error("Strange unit in \"" + value + '"');
-    return f * factor;
-  } else
-    throw std::runtime_error("Not a float value: \"" + value + '"');
 }
 
 FrameWindow *FrameWindow::active_window(0);
 
 FrameWindow::FrameWindow(const FrameWindow &original)
-  : document_view(original.document_view.get_document_meta(),
-                  config.ZoomLevel.values.front() / 100.0), 
-    open_dialog(new Filesel(*this, "Open")),
-    save_dialog(new Filesel(*this, "Save As", true)), // accept non-existing
-    print_dialog(new PrintDialog(*this, document_view)),
-    text_frame_dialog(new TextFrameDialog(*this, document_view)),
-    icons(new Icons())
+  : zoom_factor(original.document_view.get_zoom_factor()),
+    document_view(original.document_view.get_document_meta(),
+                  zoom_factor.get_factor())
 {
   constructor_common();
 }
@@ -87,21 +42,42 @@
 // you are not supposed to call with non-empty string and non-null
 // document
 FrameWindow::FrameWindow(const Glib::ustring &filename, DocRef document)
-  : document_view(DocMeta(filename.empty() 
+  : zoom_factor(config.ZoomLevel.values.front() / 100.0),
+    document_view(DocMeta(filename.empty()
 			  ? document
 			  : Document::create(filename, false),
 			  filename),
-                  config.ZoomLevel.values.front() / 100.0),
-    open_dialog(new Filesel(*this, "Open")),
-    save_dialog(new Filesel(*this, "Save As", true)), // accept non-existing
-    print_dialog(new PrintDialog(*this, document_view)),
-    text_frame_dialog(new TextFrameDialog(*this, document_view)),
-    icons(new Icons())
+                  zoom_factor.get_factor())
 {
   constructor_common();
 }
 
 void FrameWindow::constructor_common() {
+  // key presses are forwarded to the view
+  signal_key_press_event().connect
+    (sigc::mem_fun(document_view, &DocumentView::on_key_press_event));
+
+  open_dialog.reset(new Filesel(*this, "Open"));
+  save_dialog.reset(new Filesel(*this, "Save As",
+                                Gtk::FILE_CHOOSER_ACTION_SAVE));
+
+  // file filters
+  {
+    Gtk::FileFilter pfilter;
+    pfilter.set_name("Passepartout Document files");
+    pfilter.add_pattern("*.pp");
+    Gtk::FileFilter afilter;
+    afilter.set_name("All files");
+    afilter.add_pattern("*");
+    open_dialog->add_filter(pfilter);
+    save_dialog->add_filter(pfilter);
+    open_dialog->add_filter(afilter);
+    save_dialog->add_filter(afilter);
+  }
+
+  print_dialog.reset(new PrintDialog(*this, document_view));
+  text_frame_dialog.reset(new TextFrameDialog(*this, document_view));
+
   { // get default unit of import image dialog from config file
     Glib::ustring unit = config.LengthUnit.values.front();
     float factor = 1;
@@ -113,33 +89,24 @@
 			unit, factor));
   }
 
-  // temp file for gv to read from when doing a print preview:
-  preview_tmp_file = Tempfile::find_new_name();
-
   pagesel = manage(new Pagesel(document_view));
 
-  toolbar = manage(new Gtk::Toolbar()); // before create_menus()
-  menubar = manage(new Gtk::MenuBar()); // before create_menus()
+  // create menus and toolbar
+  uimanager = Gtk::UIManager::create();
+  uimanager->insert_action_group(main_group = Gtk::ActionGroup::create());
+  uimanager->insert_action_group(doc_group = Gtk::ActionGroup::create());
+  uimanager->insert_action_group(page_group = Gtk::ActionGroup::create());
+  uimanager->insert_action_group(selection_group = Gtk::ActionGroup::create());
   create_menus(); // defined in windowmenus.cc
-  
-  zoom_lock = false;
-  set_default_size(500, 700);
+  add_accel_group(uimanager->get_accel_group());
 
-  
-  if(zoom_factors.empty()) {
-    unsigned int factors[] = {50, 75, 100, 150, 200, 0};
-    for(unsigned int *i = factors; *i; i++)
-      zoom_factors.insert(*i);
-    const Config::Floats &u_factors = config.ZoomLevel.values;
-    Config::Floats::const_iterator i;
-    for(i = u_factors.begin(); i != u_factors.end(); i++)
-      zoom_factors.insert(int(*i));
-    //    std::sort(zoom_factors.begin(), zoom_factors.end());
-  }
+  set_default_size(500, 700);
 
   Gtk::VBox *mainbox = manage(new Gtk::VBox());
   add(*mainbox);
 
+  Gtk::Toolbar *toolbar =
+    dynamic_cast<Gtk::Toolbar*>(uimanager->get_widget("/ToolBar"));
   toolbar->set_orientation(Gtk::ORIENTATION_VERTICAL);
   toolbar->set_toolbar_style(Gtk::TOOLBAR_ICONS);
 
@@ -149,7 +116,7 @@
   Gtk::Table *table = manage(new Gtk::Table(2, 2, false));
   hbox->pack_end(*table, Gtk::PACK_EXPAND_WIDGET, 0);
 
-  mainbox->pack_start(*menubar, Gtk::PACK_SHRINK);
+  mainbox->pack_start(*uimanager->get_widget("/MenuBar"), Gtk::PACK_SHRINK);
   mainbox->pack_start(*hbox);
 
   scroller = manage(new Gtk::ScrolledWindow());
@@ -158,78 +125,6 @@
 
   scroller->add(document_view);
   scroller->set_policy(Gtk::POLICY_AUTOMATIC, Gtk::POLICY_AUTOMATIC);
-
-  {
-    using namespace Gtk::Toolbar_Helpers;
-    ToolList &tools = toolbar->tools();
-
-    tools.push_back(StockElem(Gtk::Stock::SAVE,
-			      slot(*this, &FrameWindow::save),
-			      "Save file"));
-    save_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-    tools.push_back(Space());
-    tools.push_back(StockElem(Gtk::Stock::PRINT_PREVIEW,
-			      slot(*this, &FrameWindow::print_to_viewer),
-			      "Print to external viewer"));
-    preview_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-    tools.push_back(Space());
-    tools.push_back(ButtonElem("Text frame", 
-			       icons->new_frame, 
-			       slot(*text_frame_dialog, 
-				    &TextFrameDialog::show_raise),
-			       "Create new text frame"));
-    text_frame_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-    tools.push_back(ButtonElem("Image",
-			       icons->moose, 
-			       slot(*import_dialog, &ImageFilesel::show),
-			       "Import image file"));
-    image_frame_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-    tools.push_back(Space());
-    tools.push_back(StockElem(Gtk::Stock::PROPERTIES,
-			      slot(PropertiesDialog::instance(),
-				   &PropertiesDialog::show_raise),
-			       "Show object properties"));
-    properties_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-    tools.push_back(ButtonElem("Streams", 
-			       icons->streams, 
-			       slot(StreamDialog::instance(),
-				    &StreamDialog::show_raise),
-			       "Show list of text streams"));
-    tools.push_back(Space());
-    tools.push_back(ToggleElem("Snap to grid", 
-			       icons->grid, 
-			       slot(*this, 
-				    &FrameWindow::on_grid_button_clicked),
-			       "Align objects with grid"));
-    grid_button = 
-      static_cast<Gtk::ToggleButton*>(tools.back().get_widget());
-    tools.push_back(Space());
-    tools.push_back(StockElem(Gtk::Stock::GOTO_TOP,
-			      bind(slot(document_view, 
-					&DocumentView::rearrange_selected), 
-				   TOP),
-			      "Move object(s) to top"));
-
-    tools.push_back(StockElem(Gtk::Stock::GO_UP,
-			      bind(slot(document_view, 
-					&DocumentView::rearrange_selected), 
-				   UP),
-		    "Move object(s) up"));
-
-    tools.push_back(StockElem(Gtk::Stock::GO_DOWN,
-			      bind(slot(document_view, 
-					&DocumentView::rearrange_selected), 
-				   DOWN),
-		    "Move object(s) down"));
-
-    tools.push_back(StockElem(Gtk::Stock::GOTO_BOTTOM,
-			      bind(slot(document_view, 
-					&DocumentView::rearrange_selected), 
-				   BOTTOM),
-		    "Move object(s) to bottom"));
-
-    streams_button = static_cast<Gtk::Button*>(tools.back().get_widget());
-  }
   
   cafe_opera = manage(new Gtk::Statusbar());
   cafe_opera->set_has_resize_grip(false);
@@ -237,36 +132,32 @@
   
   cafe_opera->pack_end(*pagesel, Gtk::PACK_SHRINK, 0);
   Gtk::Label *page_label = manage(new Gtk::Label("P_age:", true));
-  page_label->set_mnemonic_widget(pagesel->get_optionmenu());
+  page_label->set_mnemonic_widget(pagesel->get_menu());
   cafe_opera->pack_end(*page_label,
 		       Gtk::PACK_SHRINK, 0);
-  zoom_factor = manage(new Gtk::OptionMenu());
-  cafe_opera->pack_end(*zoom_factor, Gtk::PACK_SHRINK, 0);
+
+  cafe_opera->pack_end(zoom_factor.get_widget(), Gtk::PACK_SHRINK, 0);
   Gtk::Label *zoom_label = manage(new Gtk::Label("_Zoom:", true));
-  zoom_label->set_mnemonic_widget(*zoom_factor);
-  cafe_opera->pack_end(*zoom_label, 
-		       Gtk::PACK_SHRINK, 0);
+  zoom_label->set_mnemonic_widget(zoom_factor.get_widget());
+  cafe_opera->pack_end(*zoom_label, Gtk::PACK_SHRINK, 0);
   
   mainbox->pack_end(*cafe_opera, Gtk::PACK_SHRINK);
   
-  document_view.zoom_change_signal.connect
-    (slot(*this, &FrameWindow::zoom_change_action));
-  zoom_factor->set_menu(*create_zoom_menu());
-  zoom_factor->get_menu()->signal_selection_done().connect
-    (slot(*this, &FrameWindow::zoom_factor_changed_action));
+  zoom_factor.signal_changed.connect
+    (sigc::mem_fun(*this, &FrameWindow::zoom_factor_changed_action));
   
   open_dialog->signal_hide().connect
-    (slot(*this, &FrameWindow::open_dialog_done));
+    (sigc::mem_fun(*this, &FrameWindow::open_dialog_done));
   save_dialog->signal_hide().connect
-    (slot(*this, &FrameWindow::save_dialog_done));
+    (sigc::mem_fun(*this, &FrameWindow::save_dialog_done));
   import_dialog->signal_hide().connect
-    (slot(*this, &FrameWindow::import_dialog_done));
+    (sigc::mem_fun(*this, &FrameWindow::import_dialog_done));
 
   document_view.document_set_signal.connect
-    (slot(*this, &FrameWindow::on_document_changed));
+    (sigc::mem_fun(*this, &FrameWindow::on_document_changed));
 
   Document::changed_signal.connect
-    (slot(*this, &FrameWindow::on_document_updated));
+    (sigc::mem_fun(*this, &FrameWindow::on_document_updated));
 
   // put window in global list
   windows.insert(this);
@@ -283,11 +174,6 @@
 FrameWindow::~FrameWindow() {
   // remove window from list
   windows.erase(this);
-
-  try { unlink(preview_tmp_file); }
-  catch(const std::exception& err) {
-    warning << "Failed to clean up: " << err.what() << std::endl;
-  }
   
   // set active window
   active_window = 0; // don't know which one it'll be
@@ -298,14 +184,6 @@
     debug << "window count = " << windows.size() << std::endl;
 }
 
-void FrameWindow::on_grid_button_clicked() {
-  document_view.set_snap(grid_button->get_active() ? snap::GRID : snap::NONE);
-}
-
-void FrameWindow::do_nothing() const {
-  ErrorDialog::instance().show_error("Not implemented yet", "Sorry.");
-}
-
 void FrameWindow::set_filename(const Glib::ustring &filename) {
   if(!filename.empty()) {
     set_title(basename(filename) + " - Passepartout");
@@ -313,62 +191,13 @@
     set_title("Passepartout");
 }
 
-void FrameWindow::zoom_change_action(float factor) {
-  if(!zoom_lock) {
-    using namespace Gtk::Menu_Helpers;
-    MenuList::iterator i;
-    const MenuList &items = zoom_factor->get_menu()->items();
-    int j;
-    for(i = items.begin(), j = 0; i != items.end(); i++, j++) {
-      if(str2float(dynamic_cast<Gtk::Label&>
-                   (*(i->get_child())).get_text()) == factor) {
-        zoom_factor->get_menu()->set_active(j);
-        return;
-      } else if(str2float(dynamic_cast<Gtk::Label&>
-                          (*(i->get_child())).get_text()) < factor) {
-        warning << "Zoom factor " << factor 
-                << " is not defined" << std::endl;
-      }
-    }
-  }
-}
-
-void FrameWindow::zoom_factor_changed_action() {
-  zoom_lock = true;
-  // GtkOtptionMenu (GTK+) behaves in a rather perverse manner:
-  // The child of the active MenuItem is reparented to
-  // reside within the actual button instead of inside the
-  // MenuItem. I went a little crazy before I read the GTK+ FAQ.
-  // /Fredrik
-  if(Gtk::Label* label = dynamic_cast<Gtk::Label*>(zoom_factor->get_child()))
-    document_view.set_zoom_factor(str2float(label->get_text()));
-  else ;//run around in circles and scream!
-
-  zoom_lock = false;
-  scroller->get_vadjustment()->set_value(0);
-  scroller->get_hadjustment()->set_value(0);
-}
-
-Gtk::Menu* FrameWindow::create_zoom_menu() {
-  using namespace Gtk;
-  using namespace Menu_Helpers;
-
-  Menu *menu = manage(new Menu());
-  MenuList& menu_list = menu->items();
-  for(ZoomFactors::const_iterator i = zoom_factors.begin();
-      i != zoom_factors.end();  ++i) {
-    menu_list.push_back(MenuElem(tostr(*i) + " %"));
-    // the first value in ZoomLevel is the default
-    if(int(*i) == int(config.ZoomLevel.values.front()))
-      menu->set_active(menu->items().size() - 1);
-  }
-
-  return menu;
+void FrameWindow::zoom_factor_changed_action(float factor) {
+  document_view.set_zoom_factor(factor);
 }
 
 void FrameWindow::on_document_updated(DocRef document_) {
   DocRef document = document_view.get_document();
-  if(!delete_page_item || document != document_)
+  if(document != document_)
     return;
   on_document_changed();
 }
@@ -383,60 +212,19 @@
   // enable/disable stuff
   bool on = document;
   bool have_pages = on && document->get_num_of_pages() > 0;
-  if(!(new_view_item && save_item && save_as_item 
-       && print_item && preview_item 
-       && props_item && prefs_item
-       && save_button && text_frame_button && image_frame_button 
-       && preview_button
-       && page_menu && edit_menu)) {
-    warning << "Some menu stuff is NULL" << std::endl;
-    return;
-  }
-  new_view_item->set_sensitive(on);
-  save_item->set_sensitive(on);
-  save_button->set_sensitive(on);
-  save_as_item->set_sensitive(on);
-  print_item->set_sensitive(have_pages);
-  preview_item->set_sensitive(have_pages);
-  preview_button->set_sensitive(have_pages);
-  props_item->set_sensitive(on);
-
-  text_frame_button->set_sensitive(have_pages);
-  image_frame_button->set_sensitive(have_pages);
-  toolbar->set_sensitive(on);
-  pagesel->set_sensitive(have_pages);
-  zoom_factor->set_sensitive(on);
-
-  Gtk::Menu_Helpers::MenuList::iterator i;
-  for(i = edit_menu->items().begin(); i != edit_menu->items().end(); i++)
-    i->set_sensitive(on);
-  // but show preferences anyway
-  prefs_item->set_sensitive(true);
-
-  for(i = page_menu->items().begin(); i != page_menu->items().end(); i++)
-    i->set_sensitive(on);
-  delete_page_item->set_sensitive(have_pages);
+  doc_group->set_sensitive(on);
+  page_group->set_sensitive(have_pages);
+  /// \todo when we have a selection
+  selection_group->set_sensitive(have_pages); 
 
   // We may have a new DocMeta in view, so connect to the new signal
   DocMeta docmeta = document_view.get_document_meta();
   docmeta.changed_signal().connect
-    (slot(*this, &FrameWindow::on_document_filename_changed));
+    (sigc::mem_fun(*this, &FrameWindow::on_document_filename_changed));
   set_filename(basename(docmeta.get_filename()));
 
 }
 
-void FrameWindow::new_document() {
-  DocPropsDialog::instance().create(&document_view);
-}
-
-void FrameWindow::duplicate_view() {
-  new FrameWindow(*this);
-}
-
-void FrameWindow::show_doc_props_dialog() {
-  DocPropsDialog::instance().modify(&document_view);
-}
-
 void FrameWindow::open_dialog_done() {
   if(!open_dialog->was_cancelled()) {
       if(document_view.get_document())
@@ -493,20 +281,6 @@
     save_dialog->show();
 }
 
-void FrameWindow::toggle_toolbar() {
-  if(toolbar->is_visible())
-    toolbar->hide();
-  else
-    toolbar->show();
-}
-
-void FrameWindow::toggle_cafe_opera() {
-  if(cafe_opera->is_visible())
-    cafe_opera->hide();
-  else
-    cafe_opera->show();
-}
-
 bool FrameWindow::on_delete_event(GdkEventAny *event) {
   close();
   return true;
@@ -528,59 +302,10 @@
   return false;
 }
 
-bool FrameWindow::on_key_press_event(GdkEventKey *k) {
-  Window::on_key_press_event(k);
-  document_view.on_key_press_event(k);
-  return false;
-}
-
-void FrameWindow::print_to_viewer() const {
-  const DocRef document = document_view.get_document();
-
-  // try to run gv (or whatever you want to use instead)
-  if(document) {
-    const std::string &psviewer = config.PSViewer.values.front();
-    if(!psviewer.empty()) {
-      try {
-	// Print to a file and then give that file to gv.
-	// This is actually the best way with gv.  If we pipe, gv can't reread
-	// the file when jumping pages.
-	/// \todo The tempfile belongs to this call, not to the window.  The
-	// file should be deleted when gv exits.
-	std::ofstream out(preview_tmp_file.c_str());
-	if(!out) {
-	  throw std::runtime_error("Could not open file for printing:\n"
-				   + preview_tmp_file);
-	}
-	// print all pages:
-	document->print(out, 
-			document->get_first_page_num(), 
-			document->get_first_page_num() 
-			+ document->get_num_of_pages() - 1,
-                        false /* not eps */,
-                        true /* include fonts */);
-	verbose << psviewer + " " + preview_tmp_file << std::endl;
-	try {
-	  Glib::spawn_command_line_async(psviewer + " " + preview_tmp_file);
-	} catch(Glib::SpawnError e) {
-	  throw std::runtime_error("Could not run: " + psviewer + "\n"
-				   + e.what());
-	}
-    }
-    catch(const std::exception &e) {
-      throw Error::Print(e.what());
-    }
-    } else
-      throw UserError("No PostScript viewer has been defined",
-		      "You need to define a PostScript viewer in the"
-		      " configuration file");
-  }
-}
-
 void FrameWindow::quit() {
   // make sure all destructors are executed
-  for(Windows::iterator i = windows.begin(); i != windows.end(); i++)
-    delete *i;
+  while(!windows.empty()) // the destructor removes the window from the set
+    delete *windows.begin();
 
   Gtk::Main::quit();
 }
diff -Nur -x CVS passepartout-0.6/src/pptout/window.h passepartout/src/pptout/window.h
--- passepartout-0.6/src/pptout/window.h	2004-01-12 20:01:20.000000000 +0100
+++ passepartout/src/pptout/window.h	2004-11-25 00:38:21.000000000 +0100
@@ -6,19 +6,17 @@
 #include "docview.h"
 #include <gtkmm/window.h>
 #include <memory> // auto_ptr
+#include <gtkmm/uimanager.h>
+#include "widget/zoomer.h"
 
-class Icons;
 class Pagesel;
 class Filesel;
 class PrintDialog;
 class TextFrameDialog;
 
 namespace Gtk {
-  class Button;  class ToggleButton;
   class ScrolledWindow;
-  class Menu; class MenuItem; class MenuBar;
   class OptionMenu;
-  class Toolbar;
   class Statusbar;
 }
 
@@ -31,37 +29,26 @@
 	      DocRef document = Document::null());
 
   /** Duplicate view */
-  FrameWindow(const FrameWindow&);
+  explicit FrameWindow(const FrameWindow&);
   ~FrameWindow();
 
 private:
   static FrameWindow *active_window; // pointer to the currently active window
-  Gtk::Toolbar *toolbar;
+  Gtk::Widget *toolbar;
   Gtk::ScrolledWindow *scroller;
   Gtk::Statusbar *cafe_opera;
-  Gtk::MenuBar *menubar;
-  Gtk::OptionMenu *zoom_factor;
+  Zoomer zoom_factor;
   DocumentView document_view;
   std::auto_ptr<Filesel> open_dialog, save_dialog, import_dialog;
   std::auto_ptr<PrintDialog> print_dialog;
   std::auto_ptr<TextFrameDialog> text_frame_dialog;
   Pagesel *pagesel;
-  Glib::ustring preview_tmp_file; // temp file to write ps to when previewing
-  Gtk::Menu *page_menu, *edit_menu, *view_menu;
-  Gtk::MenuItem *new_view_item, *save_item, *save_as_item, 
-    *print_item, *preview_item, 
-    *delete_page_item, *undo_item, *redo_item, *props_item, *prefs_item;
-  Gtk::Button *save_button, *text_frame_button, *image_frame_button;
-  Gtk::Button *streams_button, *preview_button, *properties_button;
-  Gtk::ToggleButton *grid_button;
-
-  // We need to create separate copies of the icons for each window since each
-  // icon can only have one parent
-  std::auto_ptr<Icons> icons; 
+  Glib::RefPtr<Gtk::UIManager> uimanager;
+  Glib::RefPtr<Gtk::ActionGroup> main_group, doc_group, page_group,
+    selection_group;
 
   bool on_delete_event(GdkEventAny*);
   bool on_focus_in_event(GdkEventFocus*);
-  bool on_key_press_event(GdkEventKey*);
 
   void constructor_common();
   void set_filename(const Glib::ustring&);
@@ -70,36 +57,16 @@
   void on_document_changed(); // change OF document
   void on_document_filename_changed(); 
 
-  void new_document();
-  void duplicate_view();
-  void print_to_viewer() const;
   static void quit();
 
-  bool zoom_lock; // avoid signal loops
-  void zoom_change_action(float);
-  void zoom_factor_changed_action();
-  Gtk::Menu* create_zoom_menu();
+  void zoom_factor_changed_action(float factor);
 
   void create_menus();
-  void toggle_cafe_opera();
-  void toggle_toolbar();
   void open_dialog_done();
   void save_dialog_done();
   void import_dialog_done();
   void save();
   void close();
-  void on_grid_button_clicked();
-  void do_nothing() const; // for unimplemented functions
-
-  void show_doc_props_dialog();
-  void show_template_page_dialog();
 };
 
 #endif
-
-
-
-
-
-
-
diff -Nur -x CVS passepartout-0.6/src/pptout/windowmenus.cc passepartout/src/pptout/windowmenus.cc
--- passepartout-0.6/src/pptout/windowmenus.cc	2004-05-01 02:04:24.000000000 +0200
+++ passepartout/src/pptout/windowmenus.cc	2005-03-17 22:53:40.000000000 +0100
@@ -2,222 +2,444 @@
 // Copyright (C) 2002 - 2004, Fredrik Arnerup & Rasmus Kaj, See COPYING
 ///
 #include "window.h"
-#include <gtkmm/menubar.h>
-#include <gtkmm/menu.h>
-#include <gtkmm/image.h>
+#include <fstream>
 #include <gtkmm/stock.h>
 #include "widget/filesel.h"
+#include "widget/programs.h"
+#include "widget/usererror.h"
 #include "config.h"
 #include "printdialog.h"
 #include "aboutdialog.h"
 #include "propertiesdialog.h"
 #include "streamdialog.h"
 #include "inspiration.h"
-#include "webbrowser.h"
+#include "util/warning.h"
+#include "util/tempfile.h"
+#include "docpropsdialog.h"
+#include "docview.h"
+#include "document/page.h"
+#include "templatepagedialog.h"
+#include "clipboard.h"
+
+namespace {
+  template<class P> P nonull(P p) {
+    if(!p)
+      throw std::runtime_error("A pointer was null in " __FILE__);
+    return p;
+  }
+  
+  void duplicate_view(const FrameWindow *orig) { new FrameWindow(*orig); }
+  
+  void new_document(DocumentView *view) {
+    DocPropsDialog::instance().create(view);
+  }
+  
+  void print_to_viewer(const DocumentView *view) {
+    const DocRef document = nonull(view->get_document());
+    std::string tmp_file = Tempfile::find_new_name();
+    std::ofstream out(tmp_file.c_str());
+    if(!out)
+      throw std::runtime_error("Could not open file for printing: "
+                               + tmp_file);
+    // print all pages:
+    document->print
+      (out, document->get_first_page_num(),
+       document->get_first_page_num() + document->get_num_of_pages() - 1,
+       false /* not eps */, true /* include fonts */);
+    Programs::open_postscript_file(tmp_file, true /* delete file when done */);
+  }
+  
+  void show_doc_props_dialog(DocumentView *view) {
+    DocPropsDialog::instance().modify(view);
+  }
+  
+  void copi(DocumentView *view) {
+    Clipboard::copy(nonull(view->get_document()));
+  }
+  
+  void cut(DocumentView *view) {
+    Clipboard::cut(nonull(view->get_document()));
+  }
+  
+  void paste(DocumentView *view) {
+    Clipboard::paste(nonull(view->get_document()),
+                     nonull(view->get_page()));
+  }
+  
+  void delete_selected(DocumentView *view) {
+    nonull(view->get_document())->delete_selected();
+  }
+  
+  void group_selected(DocumentView *view) {
+    nonull(view->get_page())->group_selected();
+  }
+  
+  void ungroup_selected(DocumentView *view) {
+    nonull(view->get_page())->ungroup_selected();
+  }
+  
+  void select_all_frames(DocumentView *view, bool select_not_unselect) {
+    nonull(view->get_page())->select_all(select_not_unselect);
+  }
+  
+  void rearrange_selected(DocumentView *view, RearrangeTarget target) {
+    nonull(view->get_page())->rearrange_selected(target);
+  }
+  
+  void insert_page(Gtk::Window *parent, DocumentView *view, bool after) {
+    DocRef document = nonull(view->get_document());
+    int page_num =
+      document->get_num_of_pages()
+      ? (view->get_current_page_num() + (after ? 1 : 0))
+      : document->get_first_page_num();
+    if(document->get_template_pages().empty()) {
+      document->new_page(page_num);
+      view->set_current_page_num(page_num);
+    } else {
+      new TemplatePageDialog(*parent, *view, page_num);
+    }
+  }
+  
+  void toggle_grid(Glib::RefPtr<Gtk::ToggleAction> action,
+                   DocumentView *view) {
+    view->set_snap(action->get_active() ? snap::GRID : snap::NONE);
+  }
+  
+  void toggle_toolbar(Glib::RefPtr<Gtk::UIManager> uimanager) {
+    Gtk::Widget *toolbar = nonull(uimanager->get_widget("/ToolBar"));
+    if(toolbar->is_visible())
+      toolbar->hide();
+    else
+      toolbar->show();
+  }
+  
+  void toggle_fullscreen(Glib::RefPtr<Gtk::ToggleAction> action,
+                         Gtk::Window *window) {
+    if(action->get_active())
+      window->fullscreen();
+    else
+      window->unfullscreen();
+  }
+  
+  void zoom(Zoomer *zoomer, Gtk::BuiltinStockID id) {
+    float f = zoomer->get_factor();
+    using namespace Gtk;
+    if(id == Stock::ZOOM_IN) f = 2.0 * f;
+    else if(id == Stock::ZOOM_OUT) f = 0.5 * f;
+    else if(id == Stock::ZOOM_100) f = 1.0;
+    // rely on Zoomer to limit the values
+    zoomer->set_factor(f);
+  }
+}
 
 void FrameWindow::create_menus() {
   using namespace Gtk;
-  using namespace Menu_Helpers;
-  using SigC::bind;
-  using SigC::slot;
-
+  using namespace sigc;
+  
   /// *** file menu ***
-
-  Menu *file_menu = manage(new Menu());
-  MenuList& list_file = file_menu->items();
-  list_file.push_back
-    (ImageMenuElem("_New ...", AccelKey("<control>N"),
-		   *manage(new Gtk::Image(Gtk::Stock::NEW, 
-					  Gtk::ICON_SIZE_MENU)),
-		   slot(*this, &FrameWindow::new_document)));
-  list_file.push_back
-    (ImageMenuElem("New Vi_ew", 
-		   *manage(new Gtk::Image(Gtk::Stock::NEW, 
-					  Gtk::ICON_SIZE_MENU)),
-		   slot(*this, &FrameWindow::duplicate_view)));
-  new_view_item = &list_file.back();
-  list_file.push_back
-    (ImageMenuElem("_Open ...", AccelKey("<control>O"),
-		   *manage(new Gtk::Image(Gtk::Stock::OPEN, 
-					  Gtk::ICON_SIZE_MENU)),
-		   slot(*open_dialog, &Filesel::show_all)));
-  list_file.push_back(SeparatorElem());
-  list_file.push_back(StockMenuElem(Gtk::Stock::SAVE,
-				    slot(*this, &FrameWindow::save)));
-  save_item = &list_file.back();
-  list_file.push_back
-    (ImageMenuElem("Save _As ...", AccelKey("<shift><control>S"),
-		   *manage(new Gtk::Image(Gtk::Stock::PRINT, 
-					  Gtk::ICON_SIZE_MENU)),
-		   slot(*save_dialog, &Filesel::show_all)));
-  save_as_item = &list_file.back();
-  list_file.push_back(SeparatorElem());
-  list_file.push_back
-    (ImageMenuElem("_Print ...", AccelKey("<control>P"),
-		   *manage(new Gtk::Image(Gtk::Stock::PRINT, 
-					  Gtk::ICON_SIZE_MENU)),
-		   slot(*print_dialog, &PrintDialog::show_it)));
-  print_item = &list_file.back();
-  list_file.push_back(StockMenuElem(Gtk::Stock::PRINT_PREVIEW,
-				    AccelKey("<shift><control>P"),
-				    slot(*this, 
-					 &FrameWindow::print_to_viewer)));
-  preview_item = &list_file.back();
-  list_file.push_back(SeparatorElem());
-  list_file.push_back
-    (MenuElem("P_roperties ...",
-	      slot(*this, &FrameWindow::show_doc_props_dialog)));
-  props_item = &list_file.back();
-  list_file.push_back(SeparatorElem());
-  list_file.push_back(StockMenuElem(Gtk::Stock::CLOSE,
-				    slot(*this, &FrameWindow::close)));
-  list_file.push_back(StockMenuElem(Gtk::Stock::QUIT,
-				    SigC::slot(&FrameWindow::quit)));
-  menubar->items().push_back(MenuElem("_File", AccelKey("<alt>f"), 
-				      *file_menu));
-
+  
+  main_group->add(Action::create("FileMenu", "_File"));
+  
+  main_group->add(Action::create("FileNew", Stock::NEW, "_New ...",
+                                 "Create a new document"),
+                  bind(sigc::ptr_fun(&new_document), &document_view));
+  
+  doc_group->add(Action::create("FileNewView", "New Vi_ew",
+                                "Create a new window "
+                                "for the current document"),
+                 bind(sigc::ptr_fun(&duplicate_view), this));
+  
+  main_group->add(Action::create("FileOpen", Stock::OPEN, "_Open ...",
+                                 "Open a document"),
+                  mem_fun(*open_dialog, &Filesel::show_all));
+  
+  doc_group->add(Action::create("FileSave", Stock::SAVE, "_Save ...",
+                                "Save document"),
+                 mem_fun(*this, &FrameWindow::save));
+  
+  doc_group->add(Action::create("FileSaveAs", Stock::SAVE_AS),
+                 AccelKey("<shift><control>S"),
+                 mem_fun(*save_dialog, &Filesel::show_all));
+  
+  page_group->add(Action::create("FilePrint", Stock::PRINT, "_Print ...",
+                                 "Print document"),
+                  AccelKey("<control>P"),
+                  mem_fun(*print_dialog, &PrintDialog::show_it));
+  
+  page_group->add(Action::create("FilePrintPreview", Stock::PRINT_PREVIEW,
+                                 "Print Pre_view ...",
+                                 "Print document to external viewer"),
+                  AccelKey("<shift><control>P"),
+                  bind(sigc::ptr_fun(&print_to_viewer), &document_view));
+  
+  doc_group->add(Action::create("FileDocProps", "P_roperties ...",
+                                "Document properties"),
+                 bind(sigc::ptr_fun(&show_doc_props_dialog), &document_view));
+  
+  main_group->add(Action::create("FileClose", Stock::CLOSE),
+                  mem_fun(*this, &FrameWindow::close));
+  
+  main_group->add(Action::create("FileQuit", Stock::QUIT),
+                  ptr_fun(&FrameWindow::quit));
+  
+  
   /// *** edit menu ***
-
-  edit_menu = manage(new Menu());
-  MenuList& list_edit = edit_menu->items();
   
-#ifdef ENABLE_UNDO
-  list_edit.push_back(StockMenuElem(Gtk::Stock::UNDO, 
-				    AccelKey("<control>Z") /*, slot*/));
-  undo_item = &list_edit.back();
-  list_edit.push_back(StockMenuElem(Gtk::Stock::REDO,
-				    AccelKey("<shift><control>Z") /*, slot*/));
-  redo_item = &list_edit.back();
-  list_edit.push_back(SeparatorElem());
-#endif
-  
-  list_edit.push_back(StockMenuElem(Gtk::Stock::COPY,
-				    slot(document_view, 
-					 &DocumentView::copy)));
-  list_edit.push_back(StockMenuElem(Gtk::Stock::CUT,
-				    slot(document_view, 
-					 &DocumentView::cut)));
-  list_edit.push_back(StockMenuElem(Gtk::Stock::PASTE,
-				    slot(document_view, 
-					 &DocumentView::paste)));
-  list_edit.push_back
-    (StockMenuElem(Gtk::Stock::DELETE,
-		   AccelKey(guint(GDK_Delete), 
-			    Gdk::ModifierType(0)),
-		   slot(document_view, &DocumentView::delete_selected)));
-
-  list_edit.push_back(SeparatorElem());
-  list_edit.push_back(MenuElem("Select _All", AccelKey("<control>A"),
-			       slot(document_view, 
-				    &DocumentView::select_all_frames)));
-  list_edit.push_back
-    (MenuElem("Dese_lect All",	AccelKey("<shift><control>A"),
-	      slot(document_view, &DocumentView::unselect_all_frames)));
-  list_edit.push_back(SeparatorElem());
+  main_group->add(Action::create("EditMenu", "_Edit"));
+  
+  selection_group->add(Action::create("EditCopy", Stock::COPY),
+                       bind(sigc::ptr_fun(&copi), &document_view));
+  
+  selection_group->add(Action::create("EditCut", Stock::CUT),
+                       bind(sigc::ptr_fun(&cut), &document_view));
+  
+  page_group->add(Action::create("EditPaste", Stock::PASTE),
+                  bind(sigc::ptr_fun(&paste), &document_view));
+  
+  selection_group->add(Action::create("EditDelete", Stock::DELETE),
+                       AccelKey("Delete"),
+                       bind(sigc::ptr_fun(&delete_selected), &document_view));
+  
+  page_group->add(Action::create("EditSelectAll", "Select _All"),
+                  AccelKey("<control>A"),
+                  bind(sigc::ptr_fun(&select_all_frames), &document_view,
+                       true /* select */));
+  
+  page_group->add(Action::create("EditUnselectAll", "Dese_lect All"),
+                  AccelKey("<shift><control>A"),
+                  bind(sigc::ptr_fun(&select_all_frames), &document_view,
+                       false /* deselect */));
+  
   // *** arrange submenu ***
-  Menu *arrange_menu = manage(new Menu());
-  MenuList& list_arrange = arrange_menu->items();
-  list_arrange.push_back(MenuElem("_Group", AccelKey("<control>G"),
-				  slot(document_view, 
-				       &DocumentView::group_selected)));
-  list_arrange.push_back
-    (MenuElem("_Ungroup", AccelKey("<control>U"),
-	      slot(document_view, &DocumentView::ungroup_selected)));
-  list_arrange.push_back(SeparatorElem());
-  list_arrange.push_back
-    (MenuElem("Move to _top", AccelKey("<control>Home"),
-	      bind(slot(document_view, 
-			&DocumentView::rearrange_selected), TOP)));
-  list_arrange.push_back
-    (MenuElem("Move _up", AccelKey("<control>Page_Up"),
-	      bind(slot(document_view, 
-			&DocumentView::rearrange_selected), UP)));
-  list_arrange.push_back
-    (MenuElem("Move _down", AccelKey("<control>Page_Down"),
-	      bind(slot(document_view, 
-			&DocumentView::rearrange_selected), DOWN)));
-  list_arrange.push_back
-    (MenuElem("Move to _bottom", AccelKey("<control>End"),
-	      bind(slot(document_view, 
-			&DocumentView::rearrange_selected), BOTTOM)));
-  list_edit.push_back(MenuElem("A_rrange", *arrange_menu));
-  list_edit.push_back(SeparatorElem());
-  list_edit.push_back(MenuElem("Insert Te_xt Frame ...", 
-			       slot(*text_frame_dialog,
-				    &TextFrameDialog::show_raise)));
-  list_edit.push_back(MenuElem("Insert _Image ...", 
-			       slot(*import_dialog, &Filesel::show_all)));
-  list_edit.push_back(SeparatorElem());
-  list_edit.push_back(MenuElem("Pre_ferences ...", 
-			       slot(config, &PFile::dialog_show)));
-  prefs_item = &list_edit.back();
-  menubar->items().push_back(MenuElem("_Edit", AccelKey("<alt>e"), 
-				      *edit_menu));
-
-
+  
+  main_group->add(Action::create("ArrangeMenu", "A_rrange"));
+  
+  selection_group->add(Action::create("ArrangeGroup", "_Group"),
+                       AccelKey("<control>G"),
+                       bind(sigc::ptr_fun(group_selected), &document_view));
+  
+  selection_group->add(Action::create("ArrangeUngroup", "_Ungroup"),
+                       AccelKey("<control>U"),
+                       bind(sigc::ptr_fun(ungroup_selected), &document_view));
+  
+  selection_group->add(Action::create("ArrangeTop", Stock::GOTO_TOP,
+                                      "Move to _top", "Move to top"),
+                       AccelKey("<control>Home"),
+                       bind(sigc::ptr_fun(&rearrange_selected),
+                            &document_view, TOP));
+  
+  
+  selection_group->add(Action::create("ArrangeUp", Stock::GO_UP,
+                                      "Move _up", "Move up"),
+                       AccelKey("<control>Page_Up"),
+                       bind(sigc::ptr_fun(&rearrange_selected),
+                            &document_view, UP));
+  
+  selection_group->add(Action::create("ArrangeDown", Stock::GO_DOWN,
+                                      "Move _down", "Move down"),
+                       AccelKey("<control>Page_Down"),
+                       bind(sigc::ptr_fun(&rearrange_selected),
+                            &document_view, DOWN));
+  
+  selection_group->add(Action::create("ArrangeBottom", Stock::GOTO_BOTTOM,
+                                      "Move to _bottom", "Move to bottom"),
+                       AccelKey("<control>End"),
+                       bind(sigc::ptr_fun(&rearrange_selected),
+                            &document_view, DOWN));
+  
+  page_group->add(Action::create("EditInsertText", StockID("newframe"),
+                                 "Insert Te_xt Frame ...",
+                                 "Insert text frame"),
+                  mem_fun(*text_frame_dialog, &TextFrameDialog::show_raise));
+  
+  page_group->add(Action::create("EditInsertImage", StockID("moose"),
+                                 "Insert _Image ...", "Insert image"),
+                  mem_fun(*import_dialog, &Filesel::show_all));
+  
+  main_group->add(Action::create("EditPrefs", Stock::PREFERENCES),
+                  mem_fun(config, &PFile::dialog_show));
+  
+  
   // *** page menu ***
-
-  page_menu = manage(new Menu());
-  MenuList& list_page = page_menu->items();
-  list_page.push_back(MenuElem("_Delete", 
-			       slot(document_view, 
-				    &DocumentView::delete_page)));
-  list_page.push_back(SeparatorElem());
-  list_page.push_back(MenuElem("Insert _Before ...", 
-			       slot(document_view, 
-				    &DocumentView::insert_page_before)));
-  list_page.push_back(MenuElem("Insert _After ...", 
-			       slot(document_view, 
-				    &DocumentView::insert_page_after)));
-  delete_page_item = &list_page.back();
-  //  list_page.push_back(SeparatorElem());
-  //  list_page.push_back(MenuElem("_Template Page ...", slot(this, &FrameWindow::show_template_page_dialog)));
-  // it is not yet possible to change the template of an existing page
-  menubar->items().push_back(MenuElem("_Page", AccelKey("<alt>p"),*page_menu));
-
-
+  
+  main_group->add(Action::create("PageMenu", "_Page"));
+  
+  page_group->add(Action::create("PageDelete", "_Delete"),
+                  mem_fun(document_view, &DocumentView::delete_page));
+  
+  doc_group->add(Action::create("PageInsertBefore", "Insert _Before ..."),
+                 bind(sigc::ptr_fun(&insert_page),
+                      this, &document_view, false /* not after */));
+  
+  // we only need one of these when we don't have any pages
+  page_group->add(Action::create("PageInsertAfter", "Insert _After ..."),
+                 bind(sigc::ptr_fun(&insert_page),
+                      this, &document_view, true /* after */));
+  
   // *** view menu ***
-
-  Menu *view_menu = manage(new Menu());
-  MenuList& list_view = view_menu->items();
-  list_view.push_back
-    (CheckMenuElem("_Toolbar", 
-		   slot(*this, &FrameWindow::toggle_toolbar)));
-  static_cast<CheckMenuItem*>(&list_view.back())->set_active(true);
-  list_view.push_back(SeparatorElem());
-  list_view.push_back
-    (StockMenuElem(Gtk::Stock::PROPERTIES,
-		   slot(PropertiesDialog::instance(),
-			&PropertiesDialog::show_raise)));
-  list_view.push_back(MenuElem("_Streams", 
-			       slot(StreamDialog::instance(),
-				    &StreamDialog::show_raise)));
-#ifdef ENABLE_UNDO
-  list_view.push_back(MenuElem("_Undo history", 
-			       slot(UndoDialog::instance(),
-				    &UndoDialog::show_raise)));
-#endif
-  menubar->items().push_back(MenuElem("_View", 
-				      AccelKey("<alt>v"), 
-				      *view_menu));
-
-
+  
+  main_group->add(Action::create("ViewMenu", "_View"));
+  
+  main_group->add(ToggleAction::create("ViewToolbar", "_Toolbar", "",
+                                       true /* active */),
+                  bind(sigc::ptr_fun(toggle_toolbar), uimanager));
+  {
+    Glib::RefPtr<ToggleAction> action =
+      ToggleAction::create("ViewFullScreen", "_Full screen", "",
+                           false /* not active */);
+    main_group->add(action, AccelKey("F11"),
+                    bind(sigc::ptr_fun(toggle_fullscreen), action, this));
+  }
+  
+  main_group->add(Action::create("ZoomIn", Stock::ZOOM_IN), 
+                  AccelKey("<ctrl>plus"),
+                  bind(sigc::ptr_fun(&zoom), &zoom_factor, Stock::ZOOM_IN));
+  main_group->add(Action::create("ZoomOut", Stock::ZOOM_OUT),
+                  AccelKey("<ctrl>minus"),
+                  bind(sigc::ptr_fun(&zoom), &zoom_factor, Stock::ZOOM_OUT));
+  main_group->add(Action::create("Zoom100", Stock::ZOOM_100),
+                  AccelKey("<ctrl>0"),
+                  bind(sigc::ptr_fun(&zoom), &zoom_factor, Stock::ZOOM_100));
+  
+  doc_group->add(Action::create("ViewProps", Stock::PROPERTIES,
+                                "_Properties", "Show Properties window"),
+                 mem_fun(PropertiesDialog::instance(),
+                         &PropertiesDialog::show_raise));
+  
+  doc_group->add(Action::create("ViewStreams", StockID("streams"),
+                                "_Streams", "Show Streams window"),
+                 mem_fun(StreamDialog::instance(),
+                         &StreamDialog::show_raise));
+  
+  {
+    Glib::RefPtr<Gtk::ToggleAction> action =
+      ToggleAction::create("ViewSnapGrid", StockID("grid"),
+                           "Snap to _grid", "Toggle snap to grid");
+    doc_group->add(action,
+                   bind(sigc::ptr_fun(&toggle_grid), action, &document_view));
+  }
+  
   // *** help menu ***
-
-  Menu *help_menu = manage(new Menu());
-  MenuList& list_help = help_menu->items();
-  list_help.push_back(MenuElem("_User's guide", AccelKey("F1"),
-			       SigC::slot(&open_docs)));
-  list_help.push_back(MenuElem("_About", 
-			       slot(AboutDialog::instance(), 
-				    &AboutDialog::show_all)));
-  list_help.push_back(SeparatorElem());
-  list_help.push_back(MenuElem("_Homepage", 
-			       SigC::slot(&open_homepage)));
-  list_help.push_back(MenuElem("_Inspiration", 
-			       slot(Inspiration::instance(),
-				    &Inspiration::show_all)));
-  menubar->items().push_back(MenuElem("_Help", AccelKey("<alt>h"), 
-				      *help_menu));
-  menubar->items().back().set_right_justified();
+  main_group->add(Action::create("HelpMenu", "_Help"));
+  
+  main_group->add(Action::create("HelpHelp", Stock::HELP,"_User's guide"),
+                  AccelKey("F1"),
+                  ptr_fun(&Programs::open_docs));
+  
+  main_group->add(Action::create("HelpAbout", "_About"),
+                  mem_fun(::AboutDialog::instance(), &::AboutDialog::show_all));
+  
+  main_group->add(Action::create("HelpHomepage", Stock::HOME, "_Homepage"),
+                  ptr_fun(&Programs::open_homepage));
+  
+  main_group->add(Action::create("HelpInspiration", "_Inspiration"),
+                  mem_fun(Inspiration::instance(),
+                          &Inspiration::show_all));
+  
+  // Layout the actions in a menubar and toolbar:
+  try {
+    const Glib::ustring ui_info = 
+      "<ui>"
+      "  <menubar name='MenuBar'>"
+      "    <menu action='FileMenu'>"
+      "      <menuitem action='FileNew'/>"
+      "      <menuitem action='FileNewView'/>"
+      "      <menuitem action='FileOpen'/>"
+      "      <separator/>"
+      "      <menuitem action='FileSave'/>"
+      "      <menuitem action='FileSaveAs'/>"
+      "      <separator/>"
+      "      <menuitem action='FilePrint'/>"
+      "      <menuitem action='FilePrintPreview'/>"
+      "      <separator/>"
+      "      <menuitem action='FileDocProps'/>"
+      "      <separator/>"
+      "      <menuitem action='FileClose'/>"
+      "      <menuitem action='FileQuit'/>"
+      "    </menu>"
+      
+      "    <menu action='EditMenu'>"
+      "      <menuitem action='EditCopy'/>"
+      "      <menuitem action='EditCut'/>"
+      "      <menuitem action='EditPaste'/>"
+      "      <menuitem action='EditDelete'/>"
+      "      <separator/>"
+      "      <menuitem action='EditSelectAll'/>"
+      "      <menuitem action='EditUnselectAll'/>"
+      "      <separator/>"
+      "      <menu action='ArrangeMenu'>"
+      "        <menuitem action='ArrangeGroup'/>"
+      "        <menuitem action='ArrangeUngroup'/>"
+      "        <separator/>"
+      "        <menuitem action='ArrangeTop'/>"
+      "        <menuitem action='ArrangeUp'/>"
+      "        <menuitem action='ArrangeDown'/>"
+      "        <menuitem action='ArrangeBottom'/>"
+      "      </menu>"
+      "      <separator/>"
+      "      <menuitem action='EditInsertText'/>"
+      "      <menuitem action='EditInsertImage'/>"
+      "      <separator/>"
+      "      <menuitem action='EditPrefs'/>"
+      "    </menu>"
+      
+      "    <menu action='PageMenu'>"
+      "      <menuitem action='PageDelete'/>"
+      "      <separator/>"
+      "      <menuitem action='PageInsertBefore'/>"
+      "      <menuitem action='PageInsertAfter'/>"
+      "    </menu>"
+      
+      "    <menu action='ViewMenu'>"
+      "      <menuitem action='ViewToolbar'/>"
+      "      <menuitem action='ViewFullScreen'/>"
+      "      <separator/>"
+      "      <menuitem action='ZoomIn'/>"
+      "      <menuitem action='ZoomOut'/>"
+      "      <menuitem action='Zoom100'/>"
+      "      <separator/>"
+      "      <menuitem action='ViewProps'/>"
+      "      <menuitem action='ViewStreams'/>"
+      "      <separator/>"
+      "      <menuitem action='ViewSnapGrid'/>"
+      "    </menu>"
+      
+      "    <menu action='HelpMenu'>"
+      "      <menuitem action='HelpHelp'/>"
+      "      <menuitem action='HelpAbout'/>"
+      "      <separator/>"
+      "      <menuitem action='HelpHomepage'/>"
+      "      <menuitem action='HelpInspiration'/>"
+      "    </menu>"
+      "  </menubar>"
+      
+      "  <toolbar name='ToolBar'>"
+      "    <toolitem action='FileNew'/>"
+      "    <separator/>"
+      "    <toolitem action='FilePrintPreview'/>"
+      "    <separator/>"
+      "    <toolitem action='EditInsertText'/>"
+      "    <toolitem action='EditInsertImage'/>"
+      "    <separator/>"
+      "    <toolitem action='ViewProps'/>"
+      "    <toolitem action='ViewStreams'/>"
+      "    <separator/>"
+      "    <toolitem action='ViewSnapGrid'/>"
+      "    <separator/>"
+      "    <toolitem action='ZoomIn'/>"
+      "    <toolitem action='ZoomOut'/>"
+      "    <toolitem action='Zoom100'/>"
+      "    <separator/>"
+      "    <toolitem action='ArrangeTop'/>"
+      "    <toolitem action='ArrangeUp'/>"
+      "    <toolitem action='ArrangeDown'/>"
+      "    <toolitem action='ArrangeBottom'/>"
+      "  </toolbar>"
+      "</ui>";
+    
+    uimanager->add_ui_from_string(ui_info);
+  }
+  catch(const Glib::Error& e) {
+    warning << "failed to build menus: " <<  e.what() << std::endl;
+  }
 }
diff -Nur -x CVS passepartout-0.6/src/ps/encode.cc passepartout/src/ps/encode.cc
--- passepartout-0.6/src/ps/encode.cc	2004-05-27 01:43:11.000000000 +0200
+++ passepartout/src/ps/encode.cc	2004-11-15 17:15:04.000000000 +0100
@@ -125,16 +125,11 @@
     // Conversion from a four-digit base 256 number 
     // to a five-digit base 85 number.
     // number should be at least a 32 bit number
-    unsigned long number =
-      (((unsigned long) chunk[0]) << 24)
-      + (((unsigned long) chunk[1]) << 16)
-      + (((unsigned long) chunk[2]) << 8)
-      + (((unsigned long) chunk[3]));
-      //      chunk[0] * 16777216 // 256^3
-      //      + chunk[1] * 65536  // 256^2
-      //      + chunk[2] * 256    // 256^1
-      //      + chunk[3];         // 256^0
-    
+    unsigned long number = 0;
+    for(int i = 0; i < 4; i++) {
+      number <<= 8;
+      number |= chunk[i];
+    }
 
     out_chunk[0] = number / 52200625; // 85^4
                   number %= 52200625;
diff -Nur -x CVS passepartout-0.6/src/ps/parseglyphlists.sh passepartout/src/ps/parseglyphlists.sh
--- passepartout-0.6/src/ps/parseglyphlists.sh	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/ps/parseglyphlists.sh	2003-03-19 02:25:44.000000000 +0100
@@ -0,0 +1,86 @@
+#!/bin/sh
+
+# Script to build C++ code containing PostScript-glyph-name-to-unicode
+# mapping by parsing the glyph lists supplied by Adobe
+#
+# The mappings can be found at:
+# http://partners.adobe.com/asn/developer/type/zapfdingbats.txt
+# http://partners.adobe.com/asn/developer/type/glyphlist.txt
+
+function parse_glyphs () {
+    awk 'BEGIN {ORS=" "; FS=";"; pl=4; c=0;} /#/ {gsub("#.*", "")} /\w+/ {print "\"" $1 "\","; c+=1; if(c==pl){c=0; print "\n  "} }' $1
+}
+
+function parse_codes () {
+    awk 'BEGIN {ORS=" "; FS=";"; pl=4; c=0;} /#/ {gsub("#.*", "")} /\w+/ {gsub("[^ ]+", "0x&,", $2); print $2 " 0, "; c+=1; if(c==pl){c=0; print "\n  "} }' $1
+}
+
+dingbats="zapfdingbats.txt"
+glyphlist="glyphlist.txt"
+output="glyphs.cc"
+
+if [ ! -f $glyphlist ]; then
+    echo "Can't find $glyphlist" 
+    exit 1
+fi
+
+if [ ! -f $dingbats ]; then
+    echo "Can't find $dingbats" 
+    exit 1
+fi
+
+echo -n > $output
+
+echo -n "#include \"unicode.h\"
+// This file is generated by parseglyphlists.sh
+// edit that file instead.
+
+#define u(x) Glib::ustring(Glib::ustring::size_type(1), gunichar(x))
+
+const PS::Unicode::Glyphs PS::Unicode::glyphlist(false), 
+  PS::Unicode::dingbats(true);
+
+PS::Unicode::Glyphs::Glyphs(bool dingbats) {
+  static const char *const names[] = {" >> $output
+
+parse_glyphs $glyphlist >> $output
+
+echo -n "0
+  };
+
+static const int codes[] = {" >> $output
+
+parse_codes $glyphlist >> $output
+
+echo -n "0
+  };
+
+static const char* const dingnames[] = {" >> $output
+
+parse_glyphs $dingbats >> $output
+
+echo -n "0
+  };
+
+static const int dingcodes[] = {" >> $output
+
+parse_codes $dingbats >> $output
+
+echo -n "0
+  };
+
+  const char * const *n = dingbats ? dingnames : names;
+  const int *c = dingbats ? dingcodes : codes;
+  while(*n) {
+    Glib::ustring tmp;
+    while(*c) 
+      tmp += u(*c++);
+    c++;
+    namemap[*n] = 0;
+    CodeMap::const_iterator i = 
+      codemap.insert(std::make_pair(tmp, &(namemap.find(*n)->first)));
+    namemap[*n] = &(i->first);
+    n++;
+  }
+}
+" >> $output
diff -Nur -x CVS passepartout-0.6/src/ps/pdfparser.cc passepartout/src/ps/pdfparser.cc
--- passepartout-0.6/src/ps/pdfparser.cc	2004-10-02 23:18:46.000000000 +0200
+++ passepartout/src/ps/pdfparser.cc	2004-12-17 15:28:08.000000000 +0100
@@ -231,7 +231,9 @@
     while(in.get(ch)) {
       if(ch == target[pos]) {
 	if(++pos >= target.size()) {
-	  in.seekg(-target.length(), std::ios_base::cur);
+          // Negative seeks from cur stopped working (in 3.4?)
+	  //in.seekg(-target.length(), std::ios_base::cur);
+          in.seekg(in.tellg() - std::streampos(target.length()));
 	  return;
 	}
       } else
diff -Nur -x CVS passepartout-0.6/src/ps/pfb2pfa.cc passepartout/src/ps/pfb2pfa.cc
--- passepartout-0.6/src/ps/pfb2pfa.cc	2004-10-07 23:35:36.000000000 +0200
+++ passepartout/src/ps/pfb2pfa.cc	2004-11-15 19:38:05.000000000 +0100
@@ -25,8 +25,8 @@
       for(int i = 0; i < 4; i++) 
 	length |= in.get() << (i << 3);
       
-      long blockstart = out.tellp();
-      if(blockstart == -1) blockstart = 0;
+      std::ostream::pos_type blockstart = out.tellp();
+      if(blockstart == std::ostream::pos_type(-1)) blockstart = 0;
       
       if(type == 1) { // ascii
 	unsigned char c;
diff -Nur -x CVS passepartout-0.6/src/util/configfile.cc passepartout/src/util/configfile.cc
--- passepartout-0.6/src/util/configfile.cc	2004-01-12 20:01:33.000000000 +0100
+++ passepartout/src/util/configfile.cc	2004-11-22 15:20:58.000000000 +0100
@@ -19,7 +19,7 @@
 
 void BoolVar::parse(const std::string &input) {
   Bools tmp;
-  std::istringstream in(input.c_str());
+  std::istringstream in(input);
   while(in) {
     std::string word;
     in >> word;
@@ -123,7 +123,7 @@
 
 void FloatVar::parse(const std::string &input) {
   Floats tmp;
-  std::istringstream in(input.c_str());
+  std::istringstream in(input);
   float value;
   while(in >> value)
     tmp.push_back(value);
diff -Nur -x CVS passepartout-0.6/src/util/filedescriptors.cc passepartout/src/util/filedescriptors.cc
--- passepartout-0.6/src/util/filedescriptors.cc	2004-07-04 19:37:44.000000000 +0200
+++ passepartout/src/util/filedescriptors.cc	2004-12-02 16:40:35.000000000 +0100
@@ -38,7 +38,13 @@
 }
 
 filedesc::OutBuf::~OutBuf() {
-  overflow(EOF);
+  try {
+    overflow(EOF);
+  }
+  catch(const std::exception &e) {
+    std::cerr << "failed to flush OutBuf for fd " << fd_ << ": "
+              << e.what() << std::endl;
+  }
   delete[] outbuffer_;
 }
     
diff -Nur -x CVS passepartout-0.6/src/util/filewatcher.cc passepartout/src/util/filewatcher.cc
--- passepartout-0.6/src/util/filewatcher.cc	2004-05-30 01:49:23.000000000 +0200
+++ passepartout/src/util/filewatcher.cc	2004-11-12 16:18:11.000000000 +0100
@@ -27,7 +27,7 @@
     ~File();
 
     /// Signal emitted every time a change is detected.
-    SigC::Signal0<void> signal;
+    sigc::signal<void> signal;
 
   private:
     std::string filename;
@@ -35,7 +35,7 @@
   };
 
   /** A singleton with no public methods. Used only by File. */
-  class Server: public SigC::Object {
+  class Server: public sigc::trackable {
     friend class File;
     static Server *_instance;
     bool ok;
@@ -55,7 +55,7 @@
       verbose << "Contact with FAM server established" << std::endl;
       fd = FAMCONNECTION_GETFD(&fc);
       /// \todo don't poll
-      Glib::signal_timeout().connect(slot(*this, &Server::poll), 
+      Glib::signal_timeout().connect(sigc::mem_fun(*this, &Server::poll), 
 				     100);
     }
     ~Server() {
@@ -118,7 +118,7 @@
 #ifdef HAVE_LIBFAM
   try {
     famfile.reset(new FAM::File(file));
-    famfile->signal.connect(modified_signal.slot());
+    famfile->signal.connect(modified_signal.make_slot());
   }
   catch(const std::exception&) { famfile.reset(); }
 #endif
@@ -127,8 +127,8 @@
     if(!connection.connected()) {
       debug << "Connecting to timeout" << std::endl;
       connection = 
-	Glib::signal_timeout().connect(slot(*this, &FileWatcher::check_file),
-				       100);
+	Glib::signal_timeout().connect
+        (sigc::mem_fun(*this, &FileWatcher::check_file), 100);
     }
   } else connection.disconnect();
 }
diff -Nur -x CVS passepartout-0.6/src/util/filewatcher.h passepartout/src/util/filewatcher.h
--- passepartout-0.6/src/util/filewatcher.h	2004-05-30 01:49:23.000000000 +0200
+++ passepartout/src/util/filewatcher.h	2004-11-12 16:18:11.000000000 +0100
@@ -13,7 +13,7 @@
 /// Monitor a file for changes.
 /** Uses the File Alteration Monitor from SGI if available, otherwise
  * it calls stat(2) on the file at regular intervals. */
-class FileWatcher: public SigC::Object {
+class FileWatcher: public sigc::trackable {
 public:
   /**
    * \param filename File to watch. Must be an absolute path.
@@ -23,13 +23,13 @@
   void set_file(const std::string &filename);
 
   /// Signal emitted each time a change is detected.
-  SigC::Signal0<void> modified_signal;
+  sigc::signal<void> modified_signal;
 
 protected:
   std::string file;
   time_t last_time;
   std::auto_ptr<FAM::File> famfile;
-  SigC::Connection connection;
+  sigc::connection connection;
   bool check_file();
 
 private:
diff -Nur -x CVS passepartout-0.6/src/util/Makefile.am passepartout/src/util/Makefile.am
--- passepartout-0.6/src/util/Makefile.am	2004-06-03 21:48:00.000000000 +0200
+++ passepartout/src/util/Makefile.am	2004-11-14 22:19:01.000000000 +0100
@@ -11,8 +11,8 @@
 	processman.cc tempfile.cc filewatcher.cc filedescriptors.cc 	\
 	cmdline.cc xmlwrap.cc
 
-# The gtkmm flags is needed just to get Glib::RefPtr.
-CXXFLAGS = $(GTKMM_CFLAGS) $(XMLPP_CFLAGS)
+# gtkmm and gnomecanvas flags is needed just to get RefPtr and AffineTrans.
+CXXFLAGS = $(XMLPP_CFLAGS) $(GTKMM_CFLAGS) $(GNOMECANVAS_CFLAGS)
 
 TESTS =	runtest
 check_PROGRAMS = runtest
@@ -20,4 +20,4 @@
 	test_boundary.cc test_procio.cc test_cmdline.cc
 runtest_CXXFLAGS = -I$(top_srcdir)/src
 runtest_DEPENDENCIES = $(noinst_LIBRARIES)
-runtest_LDADD = -L../testbed -lppttest -L. -lpptutil $(GTKMM_LIBS)
+runtest_LDADD = -L../testbed -lppttest -L. -lpptutil $(GTKMM_LIBS) $(GNOMECANVAS_LIBS)
diff -Nur -x CVS passepartout-0.6/src/util/matrix.cc passepartout/src/util/matrix.cc
--- passepartout-0.6/src/util/matrix.cc	2004-05-06 00:42:19.000000000 +0200
+++ passepartout/src/util/matrix.cc	2004-11-15 00:17:28.000000000 +0100
@@ -3,6 +3,7 @@
 ///
 #include "matrix.h"
 #include "typeinfo.h"
+#include <libgnomecanvasmm/affinetrans.h>
 #include <iostream>
 #include <cmath>
 
@@ -47,10 +48,18 @@
 
 Matrix Matrix::shearing(double shcoeff) {
   Matrix tmp;
-  tmp.rep[2] = shcoeff;
+  tmp.rep[2] = tan(shcoeff);
   return tmp;
 }
 
+const Gnome::Art::AffineTrans Matrix::gaTransform() const {
+  using Gnome::Art::AffineTrans;
+  return (AffineTrans::shearing(-rad2deg(sh()))
+	  * AffineTrans::scaling(sc_x(), sc_y())
+	  * AffineTrans::rotation(-rad2deg(rot()))
+	  * AffineTrans::translation(tr_x(), -tr_y()));
+}
+
 bool Matrix::is_plain() const {
   const float epsilon = 1e-5;
   return (abs(rep[2]) <= epsilon && abs(rep[1]) <= epsilon &&
@@ -101,9 +110,9 @@
 
 double Matrix::sh() const {
   if(a() != 0)
-    return (c() + sc_y() * sin(rot())) / a();
+    return atan2(c() + sc_y() * sin(rot()), a());
   else // if(b() != 0) an exception should occur before we get division by zero
-    return (d() - sc_y() * cos(rot())) / b();
+    return atan2(d() - sc_y() * cos(rot()), b());
 }
 
 Matrix& Matrix::set_tr_x(double val) {
diff -Nur -x CVS passepartout-0.6/src/util/matrix.h passepartout/src/util/matrix.h
--- passepartout-0.6/src/util/matrix.h	2004-01-12 20:01:33.000000000 +0100
+++ passepartout/src/util/matrix.h	2004-11-14 22:19:01.000000000 +0100
@@ -6,6 +6,9 @@
 #include "vector.h"
 #include <stdexcept>
 
+// forward declaration
+namespace Gnome { namespace Art { class AffineTrans; } }
+
 namespace Error {
   struct SingularMatrix : public std::runtime_error {
     SingularMatrix(const std::string& when)
@@ -40,7 +43,14 @@
   static Matrix rotation(double angle);
   static Matrix translation(const Vector& offset);
   static Matrix translation(double xoffset, double yoffset);
-
+  
+  /**
+   * Get this same transform in Gnome::Art format.
+   * Due to differences in reference system, the transforms are kind of
+   * reverse copies of each other.
+   */
+  const Gnome::Art::AffineTrans gaTransform() const;
+  
   // making sense out of matrices:
   // may throw Error::SingularMatrix
   bool is_plain() const;	// true iff this is only scale and translate.
diff -Nur -x CVS passepartout-0.6/src/util/processman.cc passepartout/src/util/processman.cc
--- passepartout-0.6/src/util/processman.cc	2004-09-20 02:43:58.000000000 +0200
+++ passepartout/src/util/processman.cc	2004-11-12 16:18:11.000000000 +0100
@@ -125,11 +125,10 @@
   return *_instance;
 }
 
-ProcessManager::ProcessManager()
-{
+ProcessManager::ProcessManager() {
   // Get a callback to run_check every 100ms.
   Glib::signal_timeout().connect
-    (slot(*this, &ProcessManager::run_check), 100);
+    (sigc::mem_fun(*this, &ProcessManager::run_check), 100);
 }
 
 ProcessManager::~ProcessManager() {
diff -Nur -x CVS passepartout-0.6/src/util/processman.h passepartout/src/util/processman.h
--- passepartout-0.6/src/util/processman.h	2004-09-20 02:43:58.000000000 +0200
+++ passepartout/src/util/processman.h	2004-11-12 16:18:11.000000000 +0100
@@ -67,12 +67,12 @@
 typedef Glib::RefPtr<ProcessRecord> Process;
 
 //This is a singleton
-class ProcessManager: public SigC::Object {
+class ProcessManager: public sigc::trackable {
 public:
   // Signal that a process has stopped,
   // attach process id, a bool to signify normal termination
   // and an exit code that is only meaningful if the bool is true:
-  SigC::Signal3<void, pid_t, bool, int> process_stopped;
+  sigc::signal<void, pid_t, bool, int> process_stopped;
 
   static ProcessManager &instance();
 
diff -Nur -x CVS passepartout-0.6/src/util/rectboundary.cc passepartout/src/util/rectboundary.cc
--- passepartout-0.6/src/util/rectboundary.cc	2004-05-02 20:54:48.000000000 +0200
+++ passepartout/src/util/rectboundary.cc	2004-11-15 00:17:28.000000000 +0100
@@ -6,12 +6,8 @@
 
 RectBoundary::RectBoundary(const Matrix& m,
 			   const double width, const double height)
-  :matrix(m)
-{
-  matrix.set_scale(matrix.sc_x() * width, matrix.sc_y() * height);
-  // Beware: set_scale will throw Error::SingularMatrix
-  // if any of the parameters is 0
-}
+  : matrix(Matrix::scaling(width, height) * m)
+{}
 
 Boundary RectBoundary::create(const Matrix& m,
 			      const double width, 
diff -Nur -x CVS passepartout-0.6/src/util/valueunit.h passepartout/src/util/valueunit.h
--- passepartout-0.6/src/util/valueunit.h	2004-01-12 20:01:34.000000000 +0100
+++ passepartout/src/util/valueunit.h	2004-11-15 18:18:16.000000000 +0100
@@ -7,6 +7,11 @@
 #include <string>
 
 template<class Value>
+class ValueUnit;
+template<class Value>
+std::istream& operator >> (std::istream& in, ValueUnit<Value>& vu);
+
+template<class Value>
 class ValueUnit {
 public:
   ValueUnit() : value_(0) {}
diff -Nur -x CVS passepartout-0.6/src/xml2ps/blockcontainer.cc passepartout/src/xml2ps/blockcontainer.cc
--- passepartout-0.6/src/xml2ps/blockcontainer.cc	2004-03-21 18:50:08.000000000 +0100
+++ passepartout/src/xml2ps/blockcontainer.cc	2005-03-18 02:01:30.000000000 +0100
@@ -47,7 +47,7 @@
 xml2ps::RootNode::RootNode(Canvas& out)
   // Note; The parameters to the FontInfo is the default root font.  They
   // should not matter in reality.
-  : BlockContainer(out, *this, "root", font::FontInfo("Palatino-Roman", 10))
+  : BlockContainer(out, *this, "root", font::FontInfo("Times-Roman", 10))
 {}
 
 void xml2ps::RootNode::debug(std::ostream& out, bool nl) {
diff -Nur -x CVS passepartout-0.6/src/xml2ps/.cvsignore passepartout/src/xml2ps/.cvsignore
--- passepartout-0.6/src/xml2ps/.cvsignore	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/xml2ps/.cvsignore	2003-02-14 19:15:56.000000000 +0100
@@ -0,0 +1,3 @@
+Makefile Makefile.in
+.deps
+xml2ps
diff -Nur -x CVS passepartout-0.6/src/xml2ps/kameran.html passepartout/src/xml2ps/kameran.html
--- passepartout-0.6/src/xml2ps/kameran.html	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/xml2ps/kameran.html	2002-11-18 23:17:01.000000000 +0100
@@ -0,0 +1,138 @@
+<?xml version='1.0' encoding="iso-8859-1"?>
+<html xmlns="http://www.w3.org/1999/xhtml">
+<head>
+<title>Stillbildskameran - dess uppbyggnad och funktion</title>
+<BASE HREF="http://www.stacken.kth.se/~foo/"/>
+<LINK REL="stylesheet" HREF="style.css"/>
+</head>
+<body>
+<div id="menu">
+[<a href="index.shtml">hem</a>] * 
+[<a href="album/index.shtml">bildarkiv</a>] * 
+[<a href="program.shtml">program</a>] * 
+[<a href="pilot/pilot.shtml">Palm Pilot</a>] * 
+[<a href="music.shtml">jukebox</a>] * 
+[<a href="http://www.e.kth.se/~e97_far/musique/musique.html">Musique
+-97</a>] * 
+[<a href="cv.shtml">kurser</a>] * 
+[<a href="bookmarks.cgi">bokmrken</a>] 
+</div>
+<hr/>
+<p class="unimp"><tt>artikel.shtml</tt>, last modified: Monday, 27-Sep-1999 17:10:06 MET DST</p>
+<h1>Stillbildskameran - dess uppbyggnad och funktion</h1>
+<div class="center"><a href="mailto:e97_far@e.kth.se">Fredrik Arnerup</a>, Stockholm 980503</div>
+<h2>Innehll</h2>
+<ul>
+<li><a href="artikel.shtml#obscura">Camera obscura</a></li>
+<li><a href="artikel.shtml#filmen">Filmen</a></li>
+<li><a href="artikel.shtml#linsen">Linsen</a></li>
+<li><a href="artikel.shtml#blaendare">Blndare och skrpedjup</a></li>
+<li><a href="artikel.shtml#slutare">Slutare</a></li>
+<li><a href="artikel.shtml#exponering">Exponering</a></li>
+<li><a href="artikel.shtml#soekare">Skare</a></li>
+<li><a href="artikel.shtml#fokusering">Fokusering</a></li>
+<li><a href="artikel.shtml#objektiv">Objektiv</a></li>
+<li><a href="artikel.shtml#filter">Filter</a></li>
+<li><a href="artikel.shtml#blixt">Blixt</a></li>
+</ul>
+<p class="bread">
+Principen fr stillbildskameran har varit knd i rtusenden. Ordet "kamera" kommer av italienskans "camera obscura" vilket betyder "mrkt rum". <big>Aristoteles</big> var den frste som beskrev fenomenet. Det visade sig nmligen att om man befann sig i ett rum som var <tt>fullstndigt ljusttt</tt> snr som p ett litet hl i ena vggen skulle en bild av omgivningen avteckna sig p den motsatta vggen. Det enda sttet att freviga denna bild var att teckna av den med en penna. Detta tminstone till 1827 d fransmannen <small>Joseph Nicephore Niepce</small> lyckades anvnda en camera obscura fr att skapa en bild p en plt bestruken med asfalt som hrdades av ljus. Den frsta kameran hade sett vrldens ljus, men mnga frbttringar stod att vnta.</p>
+<p>
+(C<sub>2</sub>H<sub>5</sub>OH)<sup>2</sup>
+</p>
+<p>Hej <acronym>tjffa Blj ungur hnfur</acronym> hej!</p>
+<a name="obscura"/>
+<h2>Camera obscura</h2>
+<p class="bread">En camera obscura r en ljustt lda med ett litet hl i ena vggen. Allt ljus som belyser en punkt p insidan av ldan mste ha passerat genom hlet. Detta betyder att allt ljus som belyser en viss punkt mste komma frn en och endast en bestmd riktning. Allts fr den belysta punkten en frg och intensitet som motsvarar den hos ljuskllan. Om man placerar en vit duk p vggen motsatt den med hlet kommer en bild att avteckna sig frutsatt att belysningen utanfr ldan r tillrckligt stark. Denna bild kommer att vara uppochnedvnd samt spegelvnd.<br/>
+<img src="bilder/obscura.gif" width="366" height="142" alt="[illustration]"/><br/>
+<em>Camera obscura: Ljuset frn motivets nedre del nr endast bildens vre del och vice versa.</em>
+</p>
+
+<a name="filmen"/>
+<h2>Filmen</h2>
+<p class="bread">I en kamera r den vita duken utbytt mot ett ljusknsligt medium. Detta r vanligtvis fotografisk film, men kan ocks vara en elektronisk detektor som producerar digitala bilder. Filmen kan vara frgfilm, svartvit film eller infrardknslig, negativ eller positiv, etc. och finns i mnga olika storlekar. Gemensamt fr alla medium r att de har ett knslighetstal angett som talar om hur kraftigt de reagerar p ljus. Detta r viktigt att veta nr man ska berkna exponeringen. 
+</p>
+
+<a name="linsen"/>
+<h2>Linsen</h2>
+<p class="bread">Det strsta problemet med camera obscura var att bilden var ganska ljussvag om inte motivet utanfr var mycket ljusstarkt. Att gra hlet strre hjlpte, men detta medfrde att bilden blev oskarp eftersom ljuset kunde komma frn ngot olika riktningar. Lsningen var att stta in en konvex lins i hlet. En konvex lins fokuserar ljusstrlar som kommer frn samma hll till en och samma punkt, den s kallade brnnpunkten. Det r dock inte skert att brnnpunkten sammanfaller med filmplanet som bilden skall projiceras p. Brnnvidden, avstndet mellan brnnpunkt och lins, beror p avstndet mellan motivet och linsen. Motiv som befinner sig fr nra kommer att f en brnnpunkt bakom filmplanet, medan motiv som r fr lngt bort kommer att f en brnnpunkt framfr. I bda fallen kommer motiven att avbildas oskarpa. Genom att gra linsen flyttbar i frhllande till filmplanet kan man vlja p vilket avstnd frn kameran man vill avbilda freml som skarpa. Det kallas att fokusera. Detta kan verka som en nackdel jmfrt med den ursprungliga camera obscura som avbildade allting med samma skrpa. S r dock inte fallet eftersom linskameran mer efterliknar det mnskliga gats stt att arbeta. Endast det som r av intresse visas skarpt medan ovidkommande detaljer frblir suddiga.<br/>
+Moderna objektiv bestr av inte en, utan flera linser fr att kompensera fr brytningsfel. De finns fr flera olika brnnvidder och frstorar bilden olika mycket.<br/>
+<img src="bilder/obsclens.gif" width="445" height="142" alt="[illustration]"/><br/>
+<em>Camera obscura med <strong>lins</strong>: Motivet i mitten r det enda vars ljusstrlar har en brnnpunkt som sammanfaller med filmplanet.</em>
+</p>
+
+<a name="blaendare"/>
+<h2>Blndare och skrpedjup</h2>
+<p class="bread">Fr att kunna variera storleken p ljusppningen infrdes blndaren. Blndaren placeras i anslutning till linsen. Blndaren kan stllas in fr att slppa in mycket ljus i svag belysning och lite ljus i stark belysning p ungefr samma stt som pupillen i det mnskliga gat ndrar storlek.
+Blndarens storlek pverkar ven skrpedjupet. Skrpedjupet kan ses som ett slags mtt p hur pass skarpa freml upplevs som ligger framfr respektive bakom sjlva motivet. ven om en exakt definition finns s r skrpedjupet en ganska subjektiv egenskap som bland annat pverkas av hur mycket man frstorar bilden. Det kan dock sgas att skrpedjupet kar om blndarppningen minskar och vice versa.
+</p>
+
+<a name="slutare"/>
+<h2>Slutare</h2>
+<p class="bread">I fotografins barndom rckte det med att ta bort ett lock frn linsen nr man ville ta bilden, titta p klockan och stta tillbaka locket igen. Efterhand blev filmernas knslighet s hg att tiden som filmen skulle exponeras fr ljus mttes inte i sekunder utan brkdelar av sekunder. Det blev d ndvndigt att anvnda automatiska slutare, ett "lock" som ppnas under en bestmd tid och sedan stngs igen.<br/>
+Moderna slutare r elektroniskt styrda och kan n slutartider p 1/8000 sekund.
+</p>
+<p class="bread">Detta r de grundlggande byggstenarna i alla kameror. vriga bestndsdelar som motorframmatning, exponeringsautomatik och autofokus r rena bekvmligheter som i och fr sig kan vara bra att ha.
+</p>
+
+<a name="exponering"/>
+<h2>Exponering</h2>
+<p class="bread">Det strsta problemet i all fotografering r att bestmma hur blndarppning och slutartid ska stllas in i frhllande till filmknslighet och ljusfrhllanden. Om man exponerar fr mycket, det vill sga om blndarppningen r fr stor, eller slutartiden fr lng, intrffar verexponering. Detta innebr att filmen exponeras s mycket att ljusstarka partier avbildas som helt kritvita, utan detaljer. Motsatsen r underexponering, dr vissa partier blir kolsvarta. I extremfall med hga kontraster kan bde ver- och underexponering upptrda i samma bild.</p>
+<p class="bread">Fotografen avlser ljusfrhllandena i motivet med en exponeringsmtare som visar olika tnkbara kombinationer av slutartid och blndarppning. Fotografen kan d vlja om slutartid eller skrpedjup skall prioriteras. Ofta finns en exponeringsmtare inbyggd i kameran och ofta r det kameran som stller in blndare och slutare automatiskt utan att fotografen behver bekymra sig. Resultatet blir dock inte sllan ovntat.</p>
+
+<a name="soekare"/>
+<h2>Skare</h2>
+<p class="bread">Fr att fotografen ska kunna ha en uppfattning om hur bilden kommer att se ut krvs en skare att titta i. Kompaktkameror har i allmnhet genomsiktsskare medan systemkameror fr professionellt bruk oftast har spegelreflexskare. Digitala kameror brukar frutom en vanlig skare ha en liten bildskrm som visar det som det elektroniska bildelementet registrerar.
+Genomsiktsskaren r egentligen inget annat n ett litet titthl bredvid objektivet, oftast i kombination med en lins som ger rtt bildvinkel. Problemet r att man inte ser motivet ur samma vinkel som objektivet gr. Detta ger s kallade parallaxfel vilket gr att man ltt kan missa motivet, srskilt vid nrbilder. Dessutom vill man ofta stta olika filter p objektivet. Effekten av dessa kommer d inte att synas i skaren.</p>
+<p class="bread">Spegelreflexskaren har inte dessa problem. Ljuset som kommer in genom objektivet reflekteras mot en spegel och projiceras p en matt glasskiva. P s stt r bilden i skaren densamma som avbildas p filmen. Nackdelarna r att skarbilden r ljussvag och att spegeln mste fllas undan fr att en bild ska kunna tas. Detta kan orsaka mekaniska problem.</p>
+
+<a name="fokusering"/>
+<h2>Fokusering</h2>
+<p class="bread">P kameror med manuell fokus vrider man vanligtvis p en ring p objektivet tills dess att skarbilden blir skarp. Om man frvntar sig en situation dr man inte har tid att fokusera kan man anvnda sig av tekniken med hyperfokalavstndet. Man stller blndaren p minsta mjliga ppning s att skrpedjupet blir s stort som mjligt. Sen stller man in fokus s att freml som befinner sig mycket lngt borta (i fotografiska termer: "ondligheten") ligger ntt och jmnt i skrpa. D kommer allting att avbildas skarpt frn ganska nra till vldigt lngt borta. Denna teknik anvnds ofta i billiga engngskameror med fixfokus (ej instllbar skrpa).</p>
+<p class="bread">Mnga kameror har autofokus, de stller in skrpan sjlva. Vanligtvis stller de in skrpan p centrum av bilden. Det kan vara ltt att glmma om man anvnder genomsiktsskare, eftersom skrpeinstllningen inte visas i skaren. Skrpan blir d ofta felaktigt instlld om man inte har motivet i centrum.</p>
+
+<a name="objektiv"/>
+<h2>Objektiv</h2>
+<p class="bread">Systemkameror r kameror dr olika delar kan bytas ut, framfr allt objektivet. Som sagt s bestr moderna objektiv inte av en enda, utan flera linser. De konstrueras bland annat fr att motverka det faktum att ljus av olika vglngder bryts olika mycket och eliminera frvrngningar av bilden. Det som framfr allt skiljer olika objektiv t r brnnvidden. Objektiv med korta brnnvidder kallas vidvinkelobjektiv. Dessa ger, som namnet antyder, en stor bildvinkel, ungefr som ett titthl i en drr. Teleobjektiv har lnga brnnvidder och fungerar som en kikare. Drimellan finns normalobjektiven.</p>
+<p class="bread">Det rcker dock inte enbart med att veta brnnvidden fr att avgra om ett objektiv r en vidvinkel eller ett teleobjektiv. Det beror ven p kamerans filmstorlek. En brnnvidd p 50 mm r ett normalobjektiv fr vanlig 35 mm smbildsfilm, men fr ett bildformat p 6x6 cm motsvarar det en vidvinkel.</p>
+<p class="bread">Andra typer av objektiv r zoomobjektivet som har en varibel brnnvidd och makroobjektivet som anvnds fr att ta extrema nrbilder.</p>
+<p class="bread">Kompaktkameror r vanligtvis frsedda med en fast monterad vidvinkel eller zoom. </p>
+
+<a name="filter"/>
+<h2>Filter</h2>
+<p class="bread">P systemkameror r det oftast mjligt att stta fast ett filter framfr objektivet. Detta kan pverka det infallande ljuset p olika stt. Vid svartvit fotografering r det vanligt att anvnda ett frgfilter som blockerar vissa frger, oftast fr att ka kontrasten eller ndra stmningen i bilden. Det ultravioletta filtret blockerar ultraviolett ljus som registreras av filmen, men inte av gat. Ett polariserande filter blockerar ljus av olika polarisation. Detta r vridbart och kan anvndas till att minska reflexer i speglande ytor eller gra himlen mrkare i frgbilder. Ett softfilter ger hela bilden ett romantiskt skimmer.</p>
+
+<a name="blixt"/>
+<h2>Blixt</h2>
+<p class="bread">Nr ljusfrhllandena r dliga kan det vara lmpligt att anvnda ett blixtaggregat, en lampa som avger ett kraftigt ljussken under en kort tidsperiod. Blixten har utvecklats frn en enkel fackla med brinnande magnesiumpulver till en liten glimlampa som matas med spnning frn kondensatorer uppladdade av batterier. Det finns ven studioaggregat som drivs med ntspnning. Exponeringen berknas utifrn avstndet till motivet med hjlp av blixtens ledtal, som talar om hur pass kraftigt aggregatet r. Alternativt mts det reflekterade ljuset av en sensor, antingen p blixten eller inuti kameran, som stnger av blixten nr tillrckligt mycket ljus ntt filmen.</p>
+<p class="bread">De flesta kompaktkameror och mnga systemkameror har idag ett inbyggt blixtaggregat. Den strsta nackdelen med att placera blixten p kameran r att mnniskor ofta fr "rda gon". Detta beror p att ljuset reflekteras mot blodkrlen i nthinnan. Man kan undvika detta genom att placera blixten ngon annanstans eller lta ljuset reflekteras mot en vit vgg.</p>
+<br clear="all"/>
+<hr/>
+<p>Fredrik Arnerup</p>
+<!--
+<div id="menu">
+[<a href="index.shtml">hem</a>] * 
+[<a href="album/index.shtml">bildarkiv</a>] * 
+[<a href="program.shtml">program</a>] * 
+[<a href="pilot/pilot.shtml">Palm Pilot</a>] * 
+[<a href="music.shtml">jukebox</a>] * 
+[<a href="http://www.e.kth.se/~e97_far/musique/musique.html">Musique
+-97</a>] * 
+[<a href="cv.shtml">kurser</a>] * 
+[<a href="bookmarks.cgi">bokmrken</a>] 
+</div>
+<hr/>
+<address>
+Fredrik Arnerup<br/>
+Bjrkuddsvgen 60B<br/>
+178 34 Eker<br/><br/>
+073-618 80 33<br/>
+alt. 08-560 336 17<br/>
+<a href="mailto:e97_far@e.kth.se">e97_far@e.kth.se</a>
+</address>
+<a href="http://www.kth.se/computer/ansvar/disclaimer.html"><img src="http://www.kth.se/bilder/disclaimer.gif" alt="[disclaimer]" border="0" width="25" height="20"/></a>
+<a href="http://www.e.kth.se/esekt/org/emission/"><img src="bilder/emissionennow.gif" alt="[Emissionen Now!]" border="0" width="88" height="31"/></a>
+-->
+
+</body>
+</html>
diff -Nur -x CVS passepartout-0.6/src/xml2ps/Makefile.am passepartout/src/xml2ps/Makefile.am
--- passepartout-0.6/src/xml2ps/Makefile.am	2004-03-23 01:51:40.000000000 +0100
+++ passepartout/src/xml2ps/Makefile.am	2004-11-15 21:24:19.000000000 +0100
@@ -13,7 +13,7 @@
 
 xml2ps_SOURCES = main.cc
 
-libxml2ps_a_CXXFLAGS = $(XML2_CFLAGS) $(XMLPP_CFLAGS) $(GTKMM_CFLAGS)	\
+libxml2ps_a_CXXFLAGS = $(XMLPP_CFLAGS) $(GTKMM_CFLAGS)	\
 		$(GNOMECANVAS_CFLAGS)
 
 libxml2ps_a_CXXFLAGS += -I$(top_srcdir)/src
diff -Nur -x CVS passepartout-0.6/src/xml2ps/navarone.em passepartout/src/xml2ps/navarone.em
--- passepartout-0.6/src/xml2ps/navarone.em	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/xml2ps/navarone.em	2002-01-19 23:52:15.000000000 +0100
@@ -0,0 +1,65 @@
+<?xml version="1.0" encoding="iso-8859-1" ?>
+<!DOCTYPE artikel SYSTEM "emission.dtd">
+<artikel>
+  <!-- sidrubrik>Bokrecensioner:</sidrubrik-->
+  
+  <rubrik>Kanonerna p Navarone</rubrik>
+  
+  <ingress>Emissionen recenserar Alistair MacLeans klassiker om den mindre
+    av omvlvningarna vid nitton<bp/>hundra<bp/>talets brjan.</ingress>
+  
+  <para><start>Kriget har gtt in</start> i en ny fas och Tyskland har
+    potential fr att ta led<bp/>ningen i kampen om jorden.
+    Navarone sitter som en propp och isolerar de alli<bp/>erade.
+    En laddning kan bli sista stten.</para>
+  
+  <para>En grupp batteri<bp/>eliminatorer drar ut i flt och stter p
+    motstnds<bp/>rrelsen.
+    Det r en ganska sluten krets, men de lyckas f kontakt med
+    ledaren.
+    Tyvrr visar sig motstndet innehlla diskreta element med tveksamma
+    kopplingar.</para>
+
+  <para>Effektiv spnning p hg niv.</para>
+
+  <del>
+    <rubrik>Experimentjunk ...</rubrik>
+    
+    <para>Ett stycke utan de speciella prickar och ringar som visar att en
+      text har skrivits i Sverige.</para>
+    
+    <para>                
+                     
+        </para>
+    
+    <para>Rk<bp/>smrgs<bp/>kompatibelt och
+      ombuds<bp/>manna<bp/>sprk<bp/>bruks<bp/>passande.
+      Rk<bp/>smrgs<bp/>kompatibelt och
+      ombuds<bp/>manna<bp/>sprk<bp/>bruks<bp/>passande.
+      Rk<bp/>smrgs<bp/>kompatibelt och
+      ombuds<bp/>manna<bp/>sprk<bp/>bruks<bp/>passande.
+      Rk<bp/>smrgs<bp/>kompatibelt och
+      ombuds<bp/>manna<bp/>sprk<bp/>bruks<bp/>passande.
+    </para>
+    
+    <para>Och s skriver vi lite mer text hr, bara fr att det ska bli
+      lite lngre.
+      Inget innehll, <em>men inget kan ocks vara viktigt</em>, och
+      det r i alla fall ngra rader vanlig text som kan fylla ut lite
+      snyggt.</para>
+    <para><!-- Todo: Do not fake! --></para>
+  </del>
+  <del>
+    <para>Vi vill ha mera text, vi vill ha flera ord, ett litet typsatt,
+      objt, tryckbart vanligt ord.
+      Och vi ska stta dem, och vi ska trycka dem, s att vi har en tidning
+      fre deadlinen&#160;...
+    </para>
+    <para>Det kommer texter hr, det str en dator dr, och pengar kanske
+      om man sljer annonser.
+      Frst TeX och decwrite hll, sen vi fr frame corp fll, men nu
+      kanske man ska hacka rubbet sjlv&#160;...</para>
+  </del>
+  
+  <signatur>Fredrik &amp; Rasmus</signatur>
+</artikel>
diff -Nur -x CVS passepartout-0.6/src/xml2ps/smusk.em passepartout/src/xml2ps/smusk.em
--- passepartout-0.6/src/xml2ps/smusk.em	1970-01-01 01:00:00.000000000 +0100
+++ passepartout/src/xml2ps/smusk.em	2002-09-19 14:18:17.000000000 +0200
@@ -0,0 +1,292 @@
+<?xml version="1.0" encoding="iso-8859-1" ?>
+<!DOCTYPE artikel SYSTEM "emission.dtd">
+<artikel page="foo">
+  <rubrik>SMusK tournee 1997<br/>
+    <small>- eller &nbsp; Hur kul r det, p en skala?</small></rubrik>
+  
+  <!-- sidebar 26/6 avfrd frn Teknis<br/>
+    27/6 Kpenhamn<br/>
+    28/6 Ratzeburg<br/>
+    29/6 Schlo Zeilitzheim<br/>
+    30/6 Erlangen, jaga<bp/>flickorna<bp/>ur<bp/>husen<br/>
+    1/7 Karlsruhe<br/>
+    2/7 Luxemburg<br/>
+    3/7 Luxemburg<br/>
+    4/7 Schtzenfest Hannover<br/>
+    5/7 Schtzenfest Hannover<br/>
+    6/7 hem igen -->
+
+  <!--bild href="smusk-a.jpg">
+    <bildtext><strong>Partybussen</strong> - ett hem bortifrn hemma,
+      med stmning utver qaaken.</bildtext>
+  </bild-->
+
+  <ingress>Vad r vl en turn?&nbsp; Den kan vara lng&nbsp;...&nbsp; och
+    varm&nbsp;...&nbsp; och anstrngande&nbsp;...&nbsp; och
+    alldeles&nbsp;...&nbsp; alldeles underbar!</ingress>
+  
+  <para><start>Fortfarande opverkad</start> av mobil<bp/>telefonin hrskar
+    den positiva vanmakten. Det kan finnas bde ostdade lgenheter
+    och ogjorda jobb drhemma, men det r &mdash; faktiskt &mdash;
+    inget att gra t. Man flyter vidare utan att kunna gra ngot
+    nyttigt, eller fr den delen ha lust heller.  Om man r i
+    oansvarig stllning dvs, vilket de flesta r.</para>
+  
+  <para>De ansvariga har dock <u>frdelen av att ha makt att <em>sga t folk
+    vad de skall gra</em></u>, s gr de det. Det rcker att upprepa varje
+    upplysning tio-tjugo gnger s har de flesta hrt och fattat. Vid
+    tillstllningar som dessa visar sig <u>vr <em>symbol</em> fret mycket
+    vlfunnen</u>. <q>Var r vi, var ter vi, var skall vi spela?</q> I
+    andanom hr man bh:na frn skocken.  S det r inte mycket som
+    slr tio dagar p vuxenskolresa. Jag menar, bara att f skriva de
+    dr lustiga dubbel-s:en p vykorten hem gr det vrt det.</para>
+
+  <del><rubrik>Frdmedlet</rubrik>
+
+    <para><u>pX <sup>pX<sub><u>pX</u></sub>pX</sup><sub>pX</sub> Px</u>
+      (A<sub>1</sub> * e<sup>x<sup>2<sup>3</sup></sup></sup>)</para>
+    
+  <para>Den absoluta centralpunkten fr turnn r bussen.</para>
+
+  <para>Kvllen fre avfrd fylls den med allt som r ndvndigt fr en
+    bra turn; Vi flyttar p ngra sten och bygger vr bussbar
+    emellan, vid bakre drren, med skinnsoffor bredvid och
+    mittemot. Bra med plats fr en jamgrupp och ett party, eller
+    flera. </para>
+
+  <para>Efter avfrd delas mngder av nyttiga saker ut, ett s k Rambo-kit
+    med penna, papper, alvedon, godis, kondomer m.m. Turn t-shirt,
+    oideo<bp/>logiskt bl i r. Turnhfte (ljusrtt) med
+    turist<bp/>information, drinkrecept och ideo<bp/>logiskt korsord. Och, inte
+    minst viktigt, nappflaskorna delas ut (optimalt fr drinkarna, gr
+    inte snder, ltt att skriva namn p, spiller inte ens om man
+    tappar den) drmed kan baren ocks ppna, festens epicentrum,
+    centralpunkten i buss<bp/>partyt, navet kring vilket frjdandet
+    snurrar. Konsumtionen rknas om till cl brnnvinsekvivalent och
+    streckas upp p en lista. Den som druckit mest (bara i baren,
+    annat rknas inte) under dygnet fr / mste nsta dag bra
+    barledarvsten.</para>
+  </del>
+
+  <del><rubrik>I am Cornholio!</rubrik>
+
+<!-- table align="right" width="268"><tr><td>
+    <a href="smusk-d.jpg"><img src="smusk-d.gif" alt=""></a><br/>
+    <strong>Get Happy</strong> - dansande demoner duperar Deuchlandish dunge
+</td></tr></table-->
+
+  <para>S kallade race r inget nytt, de har funnits i evrdeliga tider,
+    men d gllt Betongblandare (lika delar Bailey's och lime, blandas
+    i munnen) eller tequila. Nu har begreppet utvidgats till att glla
+    allt som gr att snabbt f i sig, dvs alla sorters livsmedel plus
+    snuff. Det har ocks ftt ett nytt utfrande och tillgr numera p
+    fljande vis; De inblandade lser innantill frn frpackningen, ju
+    lngre text desto bttre, sedan hver man snabbt i sig varan varp
+    man drar trjan upp ver nacken och vrlar "AAAAH", eventuellt
+    fjt av "I am Cornholio!". Har ni sett "Beavis &amp; Butt-head" knner
+    ni igen er, annars inte (s varfr skriver jag det hr?)</para>
+  </del>
+
+  <del>
+    <rubrik>Snart hedersmedborgare</rubrik>
+
+    <para>S gr det p tills Kpenhamn, huvudstad i Danmark. Drifrn
+      till resans huvudml; Tyskland och Ratzeburg.  En liten trivsam
+      stad precis vid gamla stgrnsen. Grundades av Henrik Lejonet p
+      1100-talet och ligger p den gamla saltvgen. Frutom ett gng
+      spelningar ker vi bt p sjarna (dr ett av Tysklands bsta
+      roddarlag trnar) runtom. Staden frsker gra oss till
+      hedersmedborgare, men vi kommer fram till att vi bara varit dr
+      nio gnger n. (Ytterligare ett skl att vara med p nsta
+      turn). Efter en glad dag i solen ntrar vi ter bussen. Nr vi
+      som brukligt konstaterat att ingen fattas br det
+      ivg. Avfrds<bp/>kommandot triggar omedel<bp/>bart ett massivt bussparty,
+      det bsta p ratal. Fonky music dnar ut ver de verlastade
+      sofforna vid baren och race fljer p race alltmedan bussen
+      susar ner mot Zeilitzheim. Dm om vr frvning nr vi en timme
+      efter att vi startat ter befinner oss vid en mycket bekant
+      parkeringsplats. Det tappade armbandsur som r orsaken till
+      revarvet hittas snabbt och vi antrder ter autobahn. Baletten
+      r i farten och vinner dagsligan, och det mrks inte alls p
+      spelningen dagen efter.</para>
+
+    <para>S blir den ocks lite speciell.</para>
+  </del>
+  <del>
+    <rubrik>Na fuu, das war lecker!</rubrik>
+
+    <para>Den gamble batterist Ludde fick frra ret p turn en
+      fdelsedagspresent.  Ett kassettband med tysk telefonsex.  Med
+      en inlevelse som fr frken Ur att framst som Traci Lords lser
+      flickorna titlar som "Anita spielt mit drei Bller". Detta
+      kulturdokument anvnds nu och framgent under turnn som
+      sprkkurs med frhr efter varje avsnitt. Bst r inlrningen p
+      de sm utrop som kommer ibland.  Mmm, Jaa, Na-fuu, das war
+      lecker! Ett febrilt skande inleds efter "drei Bller", men
+      affrerna sljer bara tv, fyra eller fem, attans. </para>
+
+    <para>Bad, bus och picknick<bp/>lunch (se upp fr nedfallande kottar) i
+      Wrzburg.  Framt eftermiddagen ankommer vi Schlo Zeilitzheim
+      halvvgs mellan Frankfurt och Nrnberg. Slottsfru r den mycket
+      sympatiska grevinnan Marina von Halem, fdd von
+      Richthofen. Hennes far var kusin med Rde Baronen och i
+      slotts<bp/>korridorerna finns det montrar med bcker om honom, en av
+      dem skriven av hans underlydande Hermann Gring. Fr att gra
+      ngon nytta skall vi spela p torget p byfesten. Sagt och
+      gjort, efter middagen stts spelmaskineriet ter i rrelse.
+      Trummorna stts upp, notstll och snganlggning kommer p plats
+      och baletten gr sig klar alltmedan en av svartnande moln
+      alltmer kringrnd sol nnu strlar ver torget. Dirigenten slr
+      an och de frsamlade byborna bnkar sig
+      frvntans<bp/>fullt&nbsp;...</para>
+  </del>
+
+  <del><rubrik>Woosh</rubrik>
+
+    <para>Inga bildbevis finns, men ngonstans i det fljande kaoset,
+      rytande vinden och slagregnet r det flera som svr p att de
+      sett ett par balettpojkar springa ver torget. Fljande kvde
+      skaldas; <em>Vred var himlen, stormvind riste, ljungande viggar
+      och strtande regn, sgos i skymning, nakna kmpar, lpande
+      trotsigt, torget tvrs, till goters gamman</em>.</para>
+
+    <para>Ngra timmar senare blir det en spelning i alla fall, inte
+      nmnvrt pverkad av en omnt distribuerad flaska
+      lakritsshots. Vi dras oss tillbaka till vra slottsgemak och
+      vaknar upp till en ny underbar morgon i detta vackra
+      vindistrikt. De hgade besker en lokal vingrd, andra letar
+      fga framgngsrikt efter en lunchrestaurang.</para>
+  </del>
+  <del>
+    <rubrik>Burschenschaft Bubenreuter</rubrik>
+
+<!--table align="right" width="194"><tr><td>
+    <a href="smusk-b.jpg"><img src="smusk-b.gif" alt=""></a><br/>
+    <strong>Framfr</strong> gamla lktaren i Karlsruhe
+</td></tr></table -->
+
+    <para>Lngt nere, i Bayern, ligger Erlangen, en stad som r
+      synonym med Siemens. Vi kvarterar in oss i en studentfrening,
+      ett s. k. Burschen<bp/>schaft (ungefr brdraskap, Bursche = grabb,
+      slyngel, busfr). Tysk studentfrening med stort hus,
+      studenterna (bara mn) bor gratis under studietiden och betalar
+      sedan nr de blir stora tyskar med fet Mercedes. Hr kan man
+      spela biljard eller fktas, nufrtiden kr de med ansiktsskydd,
+      fegisarna. Vggarna i matsalen r dekorerade med mlningar frn
+      den rofulla och manliga historien. P kvllen br det ut en
+      liten bit till byn Bubenreuter (som studentfreningen r
+      uppkallad efter) dr vi bevistar den rliga
+      jaga-flickornaur-husen-festen. Den tillgr p s stt att
+      studenterna drar runt mellan villorna (vars grsmattor
+      antagligen r klippta med nagelsax) och hmtar ut sina flickor
+      varvid flickornas frldrar bjuder p sm sm glas med brnnvin
+      och sm sm smrgsar. I en dimmig forntid sgs det ha gtt mer
+      bryskt till d ynglingarna stormade in i hrbrena och rotade
+      igenom kllare och garderober i sin jakt p ledigt
+      kjoltyg.</para>
+
+    <para>Studenterna i sina rda mssor drar omkring p en tunna med
+      l och ibland rusar de pltsligt ett tjugotal meter under
+      livliga tjoanden. Allt r mycket pittoreskt. Vi gr en bejublad
+      spelning p byfesten och fr s mycket lbongar att vi blir kvar
+      ett bra tag.  Det gr att vi tyvrr inte kan festa s mycket i
+      det excellenta partyhus som Burschenschaftet utgr, men man kan
+      inte f allt.</para>
+  </del>
+
+  <del><rubrik>Back from IKEA</rubrik>
+
+    <para>Efter ytterligare en morgon utan r kttfrs till frukost
+      drar vi benen efter oss upp till Karlsruhe. Hr bor vi hos en
+      festfrening i en gammal lktare som byggts om till bland annat
+      gymnastiksal. Som brukligt har de gjort stor affr av vr
+      ankomst. Sta'n r tapetserad med affischer, dr vi i pratbubblor
+      sger "Back from IKEA!" och "Super! mit Cocktails!". I r r det
+      r som synes cocktailtema och vi har under nerfrden sytt flugor
+      s att vi r fina p spelningen. Vi gr gratis i baren. En
+      mrklig upplevelse, dricka kalla drinkar, i glas&nbsp;... Immer viel
+      Spa! </para>
+
+    <para>Strkta av den utmrkta mat tyskarna nu lrt sig att laga r
+      det dags att stoppa undan D-marken och i stllet hala fram sina
+      belgiska franc fr nu skall vi till Luxemburg. (Sanningen att
+      sga r det svrt att gra av med pengar, det mesta ingr i
+      resan.) Men p autobahn tar det stopp, chauffren kan inte gasa
+      och kr av och brjar leta efter den trasiga gasvajern.  Efter
+      en haltimmes letande uppdagas att det r avgasbromsen, den
+      s. k. <q>retarden</q> som inte slagits av. Resten av resan fr samme
+      chauffr hra vlfrtjnta gliringar som <q>-Retarden, dr framme
+      vid ratten. -vilken av dom menar du?</q>. De krystade, men fr det
+      inte mindre roliga, skmten brjar inte klinga av frrn i
+      </para>
+  </del>
+
+  <del><rubrik>Luxemburg</rubrik>
+
+    <para>Dr besker vi en gammal bekant, champagnehuset Bernard
+      Massard, som bjuder p film och rundtur och undfgnas med musik,
+      sng och dans.  Publiken bestr av en dansk skol<bp/>orkester i
+      varierad lder.  Efter detta folksfrbrdrande beger vi oss
+      ngra stenkast till vrt nsta slott. Vi dumpar sakerna och ker
+      in och gr sta'n.  Ngra av oss hittar en kinarestaurang och
+      bestller tta<bp/>rtters<bp/>menyn. Tre timmar senare rullar
+      vi dr<bp/>ifrn, tur att baletten inte skall dansa i
+      kvll.</para>
+
+    <para>Andra dagen i storfurstendmet pbrjas med studie<bp/>besk p
+      EU-parlamentet (mot<bp/>prestation fr att vi fr bo gratis p deras
+      slott), en svensk tjnsteman berttar om parlamentet och vilka
+      som sitter dr, i sanning en samling, skojigt att hra. Som
+      present fr vi varsin pocketkalkylator. Efter en tur ver den
+      rda bron som r ett av stadens landmrken spelar vi p
+      stortorget, Place d'Armes. Drefter fljer veckans mest bisarra
+      fram<bp/>trdande, p en sportklubb skall vi spela fr
+      restauranggsterna. Men en strtskur gr det omjligt att spela
+      p grsplanen.  Lsningen kan beskdas p en av bilderna;
+      Orkestern str p sidan medan baletten dansar p balkongen
+      framfr restaurangfnstren (en gst skymtas genom
+      glaset). Intrycket inifrn r minst sagt mrkligt eftersom det
+      knappt hrs ngonting in. Men gsterna har kul, och vi
+      ocks. </para>
+  </del>
+
+  <del><rubrik>Slutet r nra</rubrik>
+
+<!--table align="right" width="137"><tr><td>
+    <a href="smusk-e.jpg"><img src="smusk-e.gif" alt=""></a><br/>
+    <strong>Sax</strong> r sexigt&nbsp;...
+</td></tr></table -->
+
+    <para>Bara en stad kvar. Hannover med sin Schtzen<bp/>fest, Tysklands
+      strsta baluns nst efter Oktoberfest. Fest<bp/>platsen fylls under
+      tio dagar av ett tivoli med enorma marngmaskiner. Fr att
+      klargra skalan; pariserhjulet r 60 meter. I detta vimmel av
+      glada tyska civilister och skyttegillen i gr och grna
+      uniformer finns ocks vi, i ngot mindre militriska, men dock,
+      grna rockar.  Nsta tysk som frgar dumt skall jag sl i att vi
+      r ett punkskyttegille frn Knigsberg. Spelning som brukligt p
+      restau<bp/>rangen i mitten. Lrdagen avlper lugnt, efter det
+      obligatoriska besket i musikaffren r jag och min assistent p
+      jakt efter tbara snuskiga saker till pris i korsordstvlingen,
+      tyvrr dlig lycka, utbudet var bttre frr. Inte ens "drei
+      Bller" har de.</para>
+
+<!-- table align="right" width="180"><tr><td>
+    <a href="smusk-c.jpg"><img src="smusk-c.gif" alt=""></a><br/>
+    <strong>Alla stt r bra.</strong> Hr ses hoppande
+    fnstershoppande hoppor. 
+</td></tr></table -->
+
+    <para>Efter kvllsspelningen terstr bara att packa ihop och ka
+      hem. Sedan ett par r har en oroande trend infunnit sig.  1995
+      blev en batterist kvar p en bensinstation vid Hamburg, men det
+      gick bra, han tog sig till Kpenhamn och blev hmtad av sin
+      far. I r somnade tv saxofonister p frjan och fick ta
+      tget. (Vad som egentligen hnde blev tema p en uppsatstvling
+      i bussen, mnga frslag kom in) En extrapolation ger att 1999
+      blir nsta gng, och om utvecklingen r exponentiell blir det
+      lite jobbigt om ett tag. S sk SMusK, vi behver nytt
+      folk&nbsp;... </para>
+  </del>
+  <signatur>Text &amp; bild: Lillwall</signatur>
+</artikel>
diff -Nur -x CVS passepartout-0.6/src/xml2ps/xcanvas.hh passepartout/src/xml2ps/xcanvas.hh
--- passepartout-0.6/src/xml2ps/xcanvas.hh	2004-07-22 00:01:36.000000000 +0200
+++ passepartout/src/xml2ps/xcanvas.hh	2004-11-12 16:18:12.000000000 +0100
@@ -29,7 +29,7 @@
 };
 typedef std::vector<Part> Parts;
 
-class XCanvas: public Canvas, public SigC::Object {
+class XCanvas: public Canvas, public sigc::trackable {
 public:
   explicit XCanvas(const PageVec& pages, bool allow_extra_pages);
   virtual ~XCanvas();
